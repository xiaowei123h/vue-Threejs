{"version":3,"sources":["webpack:///./src/components/jsm/libs/dat.gui.module.js","webpack:///./src/components/jsm/loaders/GLTFLoader.js","webpack:///./src/components/jsm/controls/OrbitControls.js"],"names":["colorToString","color","forceCSSHex","colorFormat","__state","conversionName","toString","r","Math","round","g","b","a","h","s","toFixed","v","str","hex","length","ARR_EACH","Array","prototype","forEach","ARR_SLICE","slice","Common","BREAK","extend","target","this","each","call","arguments","obj","isObject","Object","keys","key","isUndefined","bind","defaults","compose","toCall","args","i","apply","itr","scope","l","_key","defer","fnc","setTimeout","debounce","func","threshold","callImmediately","timeout","callNow","clearTimeout","toArray","undefined","isNull","isNaN","_isNaN","isArray","constructor","isNumber","isString","isBoolean","isFunction","Function","INTERPRETATIONS","litmus","conversions","THREE_CHAR_HEX","read","original","test","match","space","parseInt","write","SIX_CHAR_HEX","CSS_RGB","parseFloat","CSS_RGBA","HEX","RGB_ARRAY","RGBA_ARRAY","RGBA_OBJ","RGB_OBJ","HSVA_OBJ","HSV_OBJ","result","toReturn","interpret","family","conversion","tmpComponent","ColorMath","hsv_to_rgb","hi","floor","f","p","q","t","c","rgb_to_hsv","min","max","delta","NaN","rgb_to_hex","hex_with_component","component_from_hex","componentIndex","value","_typeof","Symbol","_typeof2","iterator","classCallCheck","instance","Constructor","TypeError","createClass","defineProperties","props","descriptor","enumerable","configurable","writable","defineProperty","protoProps","staticProps","get","object","property","receiver","desc","getOwnPropertyDescriptor","parent","getPrototypeOf","getter","inherits","subClass","superClass","create","setPrototypeOf","__proto__","possibleConstructorReturn","self","ReferenceError","Color","Error","defineRGBComponent","component","componentHexIndex","recalculateRGB","set","defineHSVComponent","recalculateHSV","COMPONENTS","Controller","initialValue","domElement","document","createElement","__onChange","__onFinishChange","newValue","updateDisplay","getValue","EVENT_MAP_INV","HTMLEvents","MouseEvents","KeyboardEvents","k","e","CSS_VALUE_PIXELS","cssValueToPixels","val","dom","makeSelectable","elem","selectable","style","onselectstart","MozUserSelect","KhtmlUserSelect","unselectable","makeFullscreen","hor","vert","vertical","horizontal","position","left","right","top","bottom","fakeEvent","eventType","pars","aux","params","className","evt","createEvent","clientX","x","clientY","y","initMouseEvent","bubbles","cancelable","window","clickCount","init","initKeyboardEvent","initKeyEvent","ctrlKey","altKey","shiftKey","metaKey","keyCode","charCode","initEvent","dispatchEvent","event","newBool","bool","addEventListener","attachEvent","unbind","removeEventListener","detachEvent","addClass","classes","split","indexOf","push","join","replace","removeClass","removeAttribute","index","splice","hasClass","RegExp","getWidth","getComputedStyle","width","getHeight","height","getOffset","el","offset","offsetParent","offsetLeft","offsetTop","isActive","activeElement","type","href","BooleanController","_Controller","_this2","_this","__prev","__checkbox","setAttribute","setValue","appendChild","checked","OptionController","opts","options","__select","map","element","opt","innerHTML","desiredValue","selectedIndex","StringController","onChange","__input","blur","numDecimals","_x","NumberController","_params","__min","__max","__step","step","__impliedStep","pow","log","abs","LN10","__precision","_v","minValue","maxValue","stepValue","NumberControllerBox","_NumberController","__truncationSuspended","prevY","onFinish","onMouseDrag","diff","onMouseUp","attempted","decimals","tenTo","i1","i2","o1","o2","NumberControllerSlider","preventDefault","bgRect","__background","getBoundingClientRect","onTouchMove","touches","onTouchEnd","__foreground","pct","FunctionController","text","__button","fire","ColorController","__color","__temp","__selector","__saturation_field","__field_knob","__field_knob_border","__hue_knob","__hue_field","__input_textShadow","onBlur","valueField","fieldDown","setSV","fieldUpSV","fieldDownH","setH","fieldUpH","toOriginal","fieldRect","_ref","padding","backgroundColor","boxShadow","border","borderRadius","zIndex","borderRight","marginRight","display","cursor","background","linearGradient","cssText","outline","textAlign","fontWeight","textShadow","mismatch","flip","_flip","marginLeft","marginTop","toHexString","vendors","vendor","css","cssContent","indoc","doc","injected","head","getElementsByTagName","ControllerFactory","requestAnimationFrame$1","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","CenteredDiv","backgroundElement","opacity","WebkitTransition","transition","body","hide","webkitTransform","layout","innerWidth","innerHeight","___$insertStyle","DEFAULT_DEFAULT_PRESET_NAME","SUPPORTS_LOCAL_STORAGE","localStorage","SAVE_DIALOGUE","autoPlaceVirgin","autoPlaceContainer","hideableGuis","GUI","__ul","__folders","__controllers","__rememberedObjects","__rememberedObjectIndecesToControllers","__listening","closeOnTop","autoPlace","DEFAULT_WIDTH","resizable","hideable","load","preset","scrollable","root","useLocalStorage","getItem","getLocalStorageHash","saveToLocalStorage","titleRow","getRoot","gui","__preset_select","setPresetSelectIndex","revert","setWidth","name","closed","CLASS_CLOSED","onResize","__closeButton","TEXT_OPEN","TEXT_CLOSED","setItem","CLASS_MAIN","savedGui","JSON","parse","CLASS_CLOSE_BUTTON","CLASS_CLOSE_TOP","insertBefore","childNodes","CLASS_CLOSE_BOTTOM","titleRowName","createTextNode","addRow","CLASS_AUTO_PLACE_CONTAINER","CLASS_AUTO_PLACE","__resizeHandler","onResizeDebounced","addResizeHandle","stringify","getSaveObject","saveToLocalStorageIfPossible","newDom","liBefore","li","removeListeners","markPresetModified","modified","recallSavedValue","controller","matchedIndex","controllerMap","remembered","presetMap","_add","factoryArgs","concat","before","__li","container","CLASS_CONTROLLER_ROW","__gui","_options","nextSibling","nextElementSibling","remove","_nextSibling","_name","firstElementChild","listen","box","method","pc","pb","returned","oldName","wasListening","newController","stopPropagation","borderLeftColor","isModified","augmentController","location","addPresetOption","setSelected","showHideExplain","explain","pmouseX","drag","dragStop","CLASS_DRAG","dragStart","__resize_handle","w","__save_row","getCurrentPreset","useInitialValues","savedValues","toggleHide","CLASS_TOO_TALL","_keydownHandler","which","add","addColor","removeChild","destroy","subfolder","removeFolder","addFolder","newGuiParams","folders","folder","parentElement","open","close","show","node","offsetHeight","remember","div","firstChild","gears","button","button2","button3","select","getElementById","localStorageCheckBox","saveLocally","newConstructorTextArea","focus","save","presetName","prompt","saveAs","addSaveMenu","updateDisplays","controllerArray","GUI$1","GLTFLoader","manager","Loader","dracoLoader","ddsLoader","ktx2Loader","meshoptDecoder","pluginCallbacks","register","parser","GLTFMaterialsClearcoatExtension","GLTFTextureBasisUExtension","GLTFTextureWebPExtension","GLTFMaterialsTransmissionExtension","GLTFLightsExtension","GLTFMeshoptCompression","assign","url","onLoad","onProgress","onError","resourcePath","path","LoaderUtils","extractUrlBase","itemStart","_onError","console","error","itemError","itemEnd","loader","FileLoader","setPath","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","data","gltf","setDRACOLoader","setDDSLoader","setKTX2Loader","setMeshoptDecoder","unregister","content","extensions","plugins","decodeText","Uint8Array","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","KHR_BINARY_GLTF","headerView","DataView","BINARY_EXTENSION_HEADER_LENGTH","header","magic","version","getUint32","chunkView","chunkIndex","byteLength","chunkLength","chunkType","BINARY_EXTENSION_CHUNK_TYPES","contentArray","BIN","byteOffset","json","asset","GLTFParser","crossOrigin","fileLoader","plugin","extensionsUsed","extensionName","extensionsRequired","KHR_MATERIALS_UNLIT","GLTFMaterialsUnlitExtension","KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS","GLTFMaterialsPbrSpecularGlossinessExtension","KHR_DRACO_MESH_COMPRESSION","GLTFDracoMeshCompressionExtension","MSFT_TEXTURE_DDS","GLTFTextureDDSExtension","KHR_TEXTURE_TRANSFORM","GLTFTextureTransformExtension","KHR_MESH_QUANTIZATION","GLTFMeshQuantizationExtension","warn","setExtensions","setPlugins","KHR_LIGHTS_PUNCTUAL","KHR_MATERIALS_CLEARCOAT","KHR_MATERIALS_TRANSMISSION","KHR_TEXTURE_BASISU","EXT_TEXTURE_WEBP","EXT_MESHOPT_COMPRESSION","cache","refs","uses","isSupported","_markDefs","nodeDefs","nodes","nodeIndex","nodeLength","nodeDef","light","_addNodeRef","_loadLight","lightIndex","cacheKey","dependency","lightNode","lightDef","lights","fromArray","range","DirectionalLight","PointLight","distance","SpotLight","spot","innerConeAngle","outerConeAngle","PI","angle","penumbra","decay","intensity","createUniqueName","Promise","resolve","createNodeAttachment","then","_getNodeRef","getMaterialType","MeshBasicMaterial","extendParams","materialParams","materialDef","pending","metallicRoughness","pbrMetallicRoughness","baseColorFactor","array","baseColorTexture","assignTexture","all","materialIndex","materials","MeshPhysicalMaterial","extendMaterialParams","extension","clearcoatFactor","clearcoat","clearcoatTexture","clearcoatRoughnessFactor","clearcoatRoughness","clearcoatRoughnessTexture","clearcoatNormalTexture","scale","clearcoatNormalScale","Vector2","transmissionFactor","transmission","transmissionTexture","loadTexture","textureIndex","textureDef","textures","source","images","loadTextureImage","uri","getHandler","textureLoader","detectSupport","image","Image","src","onload","onerror","loadBufferView","bufferView","bufferViews","extensionDef","buffer","getDependency","decoder","supported","ready","res","count","stride","byteStride","ArrayBuffer","decodeGltfBuffer","mode","filter","preload","GLTFMeshStandardSGMaterial","MeshStandardMaterial","isGLTFSpecularGlossinessMaterial","specularMapParsFragmentChunk","glossinessMapParsFragmentChunk","specularMapFragmentChunk","glossinessMapFragmentChunk","lightPhysicalFragmentChunk","uniforms","specular","setHex","glossiness","specularMap","glossinessMap","_extraUniforms","onBeforeCompile","shader","uniformName","fragmentShader","defines","USE_SPECULARMAP","USE_GLOSSINESSMAP","USE_UV","metalness","roughness","metalnessMap","roughnessMap","setValues","specularGlossinessParams","pbrSpecularGlossiness","diffuseFactor","diffuseTexture","emissive","glossinessFactor","specularFactor","specularGlossinessTexture","specGlossMapDef","createMaterial","material","fog","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","TangentSpaceNormalMap","normalScale","displacementMap","displacementScale","displacementBias","alphaMap","envMap","envMapIntensity","refractionRatio","GLTFCubicSplineInterpolant","parameterPositions","sampleValues","sampleSize","resultBuffer","Interpolant","decodePrimitive","primitive","bufferViewIndex","gltfAttributeMap","attributes","threeAttributeMap","attributeNormalizedMap","attributeTypeMap","attributeName","threeAttributeName","ATTRIBUTES","toLowerCase","accessorDef","accessors","componentType","WEBGL_COMPONENT_TYPES","normalized","decodeDracoFile","geometry","attribute","extendTexture","texture","transform","clone","rotation","repeat","texCoord","needsUpdate","copy","copySampleValue_","values","valueSize","beforeStart_","afterEnd_","interpolate_","t0","t1","stride2","stride3","td","pp","ppp","offset1","offset0","s2","s3","s0","s1","p0","m0","p1","m1","WEBGL_CONSTANTS","5120","Int8Array","5121","5122","Int16Array","5123","Uint16Array","5125","Uint32Array","5126","Float32Array","WEBGL_FILTERS","9728","NearestFilter","9729","LinearFilter","9984","NearestMipmapNearestFilter","9985","LinearMipmapNearestFilter","9986","NearestMipmapLinearFilter","9987","LinearMipmapLinearFilter","WEBGL_WRAPPINGS","33071","ClampToEdgeWrapping","33648","MirroredRepeatWrapping","10497","RepeatWrapping","WEBGL_TYPE_SIZES","SCALAR","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","WEIGHTS_0","JOINTS_0","PATH_PROPERTIES","translation","weights","INTERPOLATION","CUBICSPLINE","LINEAR","InterpolateLinear","STEP","InterpolateDiscrete","ALPHA_MODES","resolveURL","addUnknownExtensionsToUserData","knownExtensions","objectDef","userData","gltfExtensions","assignExtrasToUserData","gltfDef","extras","updateMorphTargets","mesh","meshDef","il","morphTargetInfluences","targetNames","morphTargetDictionary","createAttributesKey","attributesKey","sort","objects","removeAll","associations","Map","primitiveCache","meshCache","cameraCache","lightCache","nodeNamesUsed","createImageBitmap","navigator","userAgent","ImageBitmapLoader","TextureLoader","setCrossOrigin","addPrimitiveAttributes","primitiveDef","assignAttributeAccessor","accessorIndex","accessor","gltfAttributeName","indices","setIndex","Box3","Vector3","targets","maxDisplacement","vector","setX","setY","setZ","expandByVector","boundingBox","sphere","Sphere","getCenter","center","radius","distanceTo","boundingSphere","computeBounds","hasMorphPosition","hasMorphNormal","pendingPositionAccessors","pendingNormalAccessors","pendingAccessor","normal","morphPositions","morphNormals","morphAttributes","morphTargetsRelative","addMorphTargets","toTrianglesDrawMode","drawMode","getIndex","getAttribute","numberOfTriangles","newIndices","TriangleFanDrawMode","getX","newGeometry","_invokeAll","ext","getDependencies","dependencies","scene","scenes","animations","cameras","catch","skinDefs","skins","meshDefs","meshes","skinIndex","skinLength","joints","isBone","skin","isSkinnedMesh","camera","ref","_invokeOne","unshift","loadScene","loadNode","loadMesh","loadAccessor","loadBuffer","loadMaterial","loadSkin","loadAnimation","loadCamera","defs","def","bufferIndex","bufferDef","buffers","reject","bufferViewDef","sparse","pendingBufferViews","bufferAttribute","itemSize","TypedArray","elementBytes","BYTES_PER_ELEMENT","itemBytes","ibSlice","ibCacheKey","ib","InterleavedBuffer","InterleavedBufferAttribute","BufferAttribute","itemSizeIndices","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","setW","textureExtensions","URL","webkitURL","sourceURI","isObjectURL","hasAlpha","mimeType","colorType","getUint8","blob","Blob","createObjectURL","isImageBitmapLoader","imageBitmap","CanvasTexture","revokeObjectURL","flipY","format","RGBFormat","sampler","samplers","magFilter","minFilter","wrapS","wrapT","mapName","mapDef","gltfReference","assignFinalMaterial","useVertexTangents","tangent","useVertexColors","useFlatShading","useSkinning","useMorphTargets","useMorphNormals","isPoints","uuid","pointsMaterial","PointsMaterial","Material","sizeAttenuation","isLine","lineMaterial","LineBasicMaterial","cachedMaterial","skinning","vertexTangents","vertexColors","flatShading","morphTargets","uv2","uv","materialType","materialExtensions","sgExtension","kmuExtension","metallicFactor","roughnessFactor","metallicRoughnessTexture","doubleSided","side","DoubleSide","alphaMode","transparent","depthWrite","alphaTest","alphaCutoff","normalTexture","occlusionTexture","strength","emissiveFactor","emissiveTexture","encoding","sRGBEncoding","originalName","PropertyBinding","sanitizeNodeName","loadGeometries","primitives","createDracoPrimitive","dracoExtension","geometryPromise","cached","promise","BufferGeometry","meshIndex","depthTest","FrontSide","results","geometries","SkinnedMesh","Mesh","skinWeight","normalizeSkinWeights","TriangleStripDrawMode","LineSegments","Line","LineLoop","Points","group","Group","cameraIndex","cameraDef","PerspectiveCamera","MathUtils","radToDeg","yfov","aspectRatio","znear","zfar","OrthographicCamera","xmag","ymag","skinDef","skinEntry","inverseBindMatrices","animationIndex","animationDef","pendingNodes","pendingInputAccessors","pendingOutputAccessors","pendingSamplers","pendingTargets","channels","channel","id","input","parameters","output","inputAccessors","outputAccessors","tracks","inputAccessor","outputAccessor","TypedKeyframeTrack","updateMatrix","matrixAutoUpdate","NumberKeyframeTrack","QuaternionKeyframeTrack","VectorKeyframeTrack","targetName","interpolation","traverse","isMesh","outputArray","scaled","j","jl","track","createInterpolant","times","getValueSize","isInterpolantFactoryMethodGLTFCubicSpline","AnimationClip","nodeName","o","Bone","Object3D","matrix","Matrix4","applyMatrix4","quaternion","buildNodeHierachy","nodeId","parentObject","pendingJoints","jointNodes","bones","boneInverses","jointNode","mat","Skeleton","matrixWorld","children","child","sceneIndex","sceneDef","nodeIds","__webpack_require__","d","__webpack_exports__","OrbitControls","__WEBPACK_IMPORTED_MODULE_0__components_build_three_module_js__","quat","quatInverse","lastPosition","lastQuaternion","twoPI","enabled","minDistance","maxDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","enableKeys","LEFT","UP","RIGHT","BOTTOM","mouseButtons","MOUSE","ROTATE","MIDDLE","DOLLY","PAN","ONE","TOUCH","TWO","DOLLY_PAN","target0","position0","zoom0","zoom","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","saveState","reset","updateProjectionMatrix","changeEvent","update","state","STATE","NONE","Quaternion","setFromUnitVectors","up","invert","sub","applyQuaternion","setFromVector3","rotateLeft","sphericalDelta","isFinite","makeSafe","addScaledVector","panOffset","setFromSpherical","lookAt","multiplyScalar","zoomChanged","distanceToSquared","EPS","dot","dispose","onContextMenu","onPointerDown","onMouseWheel","onTouchStart","ownerDocument","onPointerMove","onPointerUp","onKeyDown","startEvent","endEvent","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","getZoomScale","rotateUp","panLeft","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","isPerspectiveCamera","targetDistance","tan","fov","clientHeight","isOrthographicCamera","clientWidth","dollyOut","dollyScale","dollyIn","handleMouseDownRotate","handleMouseDownPan","handleTouchStartRotate","pageX","pageY","handleTouchStartPan","handleTouchStartDolly","dx","dy","sqrt","handleTouchMoveRotate","subVectors","handleTouchMovePan","handleTouchMoveDolly","pointerType","mouseAction","handleMouseDownDolly","onMouseDown","handleMouseMoveRotate","handleMouseMoveDolly","handleMouseMovePan","onMouseMove","handleMouseWheel","handleKeyDown","handleTouchStartDollyPan","DOLLY_ROTATE","handleTouchStartDollyRotate","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","EventDispatcher","MapControls"],"mappings":"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","file":"static/js/0.a40645d39e742b82dda1.js","sourcesContent":["/**\r\n * dat-gui JavaScript Controller Library\r\n * http://code.google.com/p/dat-gui\r\n *\r\n * Copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n\r\nfunction ___$insertStyle( css ) {\r\n\r\n\tif ( ! css ) {\r\n\r\n\t\treturn;\r\n\r\n\t}\r\n\tif ( typeof window === 'undefined' ) {\r\n\r\n\t\treturn;\r\n\r\n\t}\r\n\r\n\tvar style = document.createElement( 'style' );\r\n\r\n\tstyle.setAttribute( 'type', 'text/css' );\r\n\tstyle.innerHTML = css;\r\n\tdocument.head.appendChild( style );\r\n\r\n\treturn css;\r\n\r\n}\r\n\r\nfunction colorToString( color, forceCSSHex ) {\r\n\r\n\tvar colorFormat = color.__state.conversionName.toString();\r\n\tvar r = Math.round( color.r );\r\n\tvar g = Math.round( color.g );\r\n\tvar b = Math.round( color.b );\r\n\tvar a = color.a;\r\n\tvar h = Math.round( color.h );\r\n\tvar s = color.s.toFixed( 1 );\r\n\tvar v = color.v.toFixed( 1 );\r\n\tif ( forceCSSHex || colorFormat === 'THREE_CHAR_HEX' || colorFormat === 'SIX_CHAR_HEX' ) {\r\n\r\n\t\tvar str = color.hex.toString( 16 );\r\n\t\twhile ( str.length < 6 ) {\r\n\r\n\t\t\tstr = '0' + str;\r\n\r\n\t\t}\r\n\t\treturn '#' + str;\r\n\r\n\t} else if ( colorFormat === 'CSS_RGB' ) {\r\n\r\n\t\treturn 'rgb(' + r + ',' + g + ',' + b + ')';\r\n\r\n\t} else if ( colorFormat === 'CSS_RGBA' ) {\r\n\r\n\t\treturn 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';\r\n\r\n\t} else if ( colorFormat === 'HEX' ) {\r\n\r\n\t\treturn '0x' + color.hex.toString( 16 );\r\n\r\n\t} else if ( colorFormat === 'RGB_ARRAY' ) {\r\n\r\n\t\treturn '[' + r + ',' + g + ',' + b + ']';\r\n\r\n\t} else if ( colorFormat === 'RGBA_ARRAY' ) {\r\n\r\n\t\treturn '[' + r + ',' + g + ',' + b + ',' + a + ']';\r\n\r\n\t} else if ( colorFormat === 'RGB_OBJ' ) {\r\n\r\n\t\treturn '{r:' + r + ',g:' + g + ',b:' + b + '}';\r\n\r\n\t} else if ( colorFormat === 'RGBA_OBJ' ) {\r\n\r\n\t\treturn '{r:' + r + ',g:' + g + ',b:' + b + ',a:' + a + '}';\r\n\r\n\t} else if ( colorFormat === 'HSV_OBJ' ) {\r\n\r\n\t\treturn '{h:' + h + ',s:' + s + ',v:' + v + '}';\r\n\r\n\t} else if ( colorFormat === 'HSVA_OBJ' ) {\r\n\r\n\t\treturn '{h:' + h + ',s:' + s + ',v:' + v + ',a:' + a + '}';\r\n\r\n\t}\r\n\treturn 'unknown format';\r\n\r\n}\r\n\r\nvar ARR_EACH = Array.prototype.forEach;\r\nvar ARR_SLICE = Array.prototype.slice;\r\nvar Common = {\r\n\tBREAK: {},\r\n\textend: function extend( target ) {\r\n\r\n\t\tthis.each( ARR_SLICE.call( arguments, 1 ), function ( obj ) {\r\n\r\n\t\t\tvar keys = this.isObject( obj ) ? Object.keys( obj ) : [];\r\n\t\t\tkeys.forEach( function ( key ) {\r\n\r\n\t\t\t\tif ( ! this.isUndefined( obj[ key ] ) ) {\r\n\r\n\t\t\t\t\ttarget[ key ] = obj[ key ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}.bind( this ) );\r\n\r\n\t\t}, this );\r\n\t\treturn target;\r\n\r\n\t},\r\n\tdefaults: function defaults( target ) {\r\n\r\n\t\tthis.each( ARR_SLICE.call( arguments, 1 ), function ( obj ) {\r\n\r\n\t\t\tvar keys = this.isObject( obj ) ? Object.keys( obj ) : [];\r\n\t\t\tkeys.forEach( function ( key ) {\r\n\r\n\t\t\t\tif ( this.isUndefined( target[ key ] ) ) {\r\n\r\n\t\t\t\t\ttarget[ key ] = obj[ key ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}.bind( this ) );\r\n\r\n\t\t}, this );\r\n\t\treturn target;\r\n\r\n\t},\r\n\tcompose: function compose() {\r\n\r\n\t\tvar toCall = ARR_SLICE.call( arguments );\r\n\t\treturn function () {\r\n\r\n\t\t\tvar args = ARR_SLICE.call( arguments );\r\n\t\t\tfor ( var i = toCall.length - 1; i >= 0; i -- ) {\r\n\r\n\t\t\t\targs = [ toCall[ i ].apply( this, args ) ];\r\n\r\n\t\t\t}\r\n\t\t\treturn args[ 0 ];\r\n\r\n\t\t};\r\n\r\n\t},\r\n\teach: function each( obj, itr, scope ) {\r\n\r\n\t\tif ( ! obj ) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\t\tif ( ARR_EACH && obj.forEach && obj.forEach === ARR_EACH ) {\r\n\r\n\t\t\tobj.forEach( itr, scope );\r\n\r\n\t\t} else if ( obj.length === obj.length + 0 ) {\r\n\r\n\t\t\tvar key = void 0;\r\n\t\t\tvar l = void 0;\r\n\t\t\tfor ( key = 0, l = obj.length; key < l; key ++ ) {\r\n\r\n\t\t\t\tif ( key in obj && itr.call( scope, obj[ key ], key ) === this.BREAK ) {\r\n\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tfor ( var _key in obj ) {\r\n\r\n\t\t\t\tif ( itr.call( scope, obj[ _key ], _key ) === this.BREAK ) {\r\n\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\tdefer: function defer( fnc ) {\r\n\r\n\t\tsetTimeout( fnc, 0 );\r\n\r\n\t},\r\n\tdebounce: function debounce( func, threshold, callImmediately ) {\r\n\r\n\t\tvar timeout = void 0;\r\n\t\treturn function () {\r\n\r\n\t\t\tvar obj = this;\r\n\t\t\tvar args = arguments;\r\n\t\t\tfunction delayed() {\r\n\r\n\t\t\t\ttimeout = null;\r\n\t\t\t\tif ( ! callImmediately ) func.apply( obj, args );\r\n\r\n\t\t\t}\r\n\t\t\tvar callNow = callImmediately || ! timeout;\r\n\t\t\tclearTimeout( timeout );\r\n\t\t\ttimeout = setTimeout( delayed, threshold );\r\n\t\t\tif ( callNow ) {\r\n\r\n\t\t\t\tfunc.apply( obj, args );\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t},\r\n\ttoArray: function toArray( obj ) {\r\n\r\n\t\tif ( obj.toArray ) return obj.toArray();\r\n\t\treturn ARR_SLICE.call( obj );\r\n\r\n\t},\r\n\tisUndefined: function isUndefined( obj ) {\r\n\r\n\t\treturn obj === undefined;\r\n\r\n\t},\r\n\tisNull: function isNull( obj ) {\r\n\r\n\t\treturn obj === null;\r\n\r\n\t},\r\n\tisNaN: function ( _isNaN ) {\r\n\r\n\t\tfunction isNaN() {\r\n\r\n\t\t\treturn _isNaN.apply( this, arguments );\r\n\r\n\t\t}\r\n\t\tisNaN.toString = function () {\r\n\r\n\t\t\treturn _isNaN.toString();\r\n\r\n\t\t};\r\n\t\treturn isNaN;\r\n\r\n\t}( function ( obj ) {\r\n\r\n\t\treturn isNaN( obj );\r\n\r\n\t} ),\r\n\tisArray: Array.isArray || function ( obj ) {\r\n\r\n\t\treturn obj.constructor === Array;\r\n\r\n\t},\r\n\tisObject: function isObject( obj ) {\r\n\r\n\t\treturn obj === Object( obj );\r\n\r\n\t},\r\n\tisNumber: function isNumber( obj ) {\r\n\r\n\t\treturn obj === obj + 0;\r\n\r\n\t},\r\n\tisString: function isString( obj ) {\r\n\r\n\t\treturn obj === obj + '';\r\n\r\n\t},\r\n\tisBoolean: function isBoolean( obj ) {\r\n\r\n\t\treturn obj === false || obj === true;\r\n\r\n\t},\r\n\tisFunction: function isFunction( obj ) {\r\n\r\n\t\treturn obj instanceof Function;\r\n\r\n\t}\r\n};\r\n\r\nvar INTERPRETATIONS = [\r\n\t{\r\n\t\tlitmus: Common.isString,\r\n\t\tconversions: {\r\n\t\t\tTHREE_CHAR_HEX: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tvar test = original.match( /^#([A-F0-9])([A-F0-9])([A-F0-9])$/i );\r\n\t\t\t\t\tif ( test === null ) {\r\n\r\n\t\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tspace: 'HEX',\r\n\t\t\t\t\t\thex: parseInt( '0x' + test[ 1 ].toString() + test[ 1 ].toString() + test[ 2 ].toString() + test[ 2 ].toString() + test[ 3 ].toString() + test[ 3 ].toString(), 0 )\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: colorToString\r\n\t\t\t},\r\n\t\t\tSIX_CHAR_HEX: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tvar test = original.match( /^#([A-F0-9]{6})$/i );\r\n\t\t\t\t\tif ( test === null ) {\r\n\r\n\t\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tspace: 'HEX',\r\n\t\t\t\t\t\thex: parseInt( '0x' + test[ 1 ].toString(), 0 )\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: colorToString\r\n\t\t\t},\r\n\t\t\tCSS_RGB: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tvar test = original.match( /^rgb\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/ );\r\n\t\t\t\t\tif ( test === null ) {\r\n\r\n\t\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tspace: 'RGB',\r\n\t\t\t\t\t\tr: parseFloat( test[ 1 ] ),\r\n\t\t\t\t\t\tg: parseFloat( test[ 2 ] ),\r\n\t\t\t\t\t\tb: parseFloat( test[ 3 ] )\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: colorToString\r\n\t\t\t},\r\n\t\t\tCSS_RGBA: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tvar test = original.match( /^rgba\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/ );\r\n\t\t\t\t\tif ( test === null ) {\r\n\r\n\t\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tspace: 'RGB',\r\n\t\t\t\t\t\tr: parseFloat( test[ 1 ] ),\r\n\t\t\t\t\t\tg: parseFloat( test[ 2 ] ),\r\n\t\t\t\t\t\tb: parseFloat( test[ 3 ] ),\r\n\t\t\t\t\t\ta: parseFloat( test[ 4 ] )\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: colorToString\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tlitmus: Common.isNumber,\r\n\t\tconversions: {\r\n\t\t\tHEX: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tspace: 'HEX',\r\n\t\t\t\t\t\thex: original,\r\n\t\t\t\t\t\tconversionName: 'HEX'\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: function write( color ) {\r\n\r\n\t\t\t\t\treturn color.hex;\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tlitmus: Common.isArray,\r\n\t\tconversions: {\r\n\t\t\tRGB_ARRAY: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tif ( original.length !== 3 ) {\r\n\r\n\t\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tspace: 'RGB',\r\n\t\t\t\t\t\tr: original[ 0 ],\r\n\t\t\t\t\t\tg: original[ 1 ],\r\n\t\t\t\t\t\tb: original[ 2 ]\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: function write( color ) {\r\n\r\n\t\t\t\t\treturn [ color.r, color.g, color.b ];\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tRGBA_ARRAY: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tif ( original.length !== 4 ) return false;\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tspace: 'RGB',\r\n\t\t\t\t\t\tr: original[ 0 ],\r\n\t\t\t\t\t\tg: original[ 1 ],\r\n\t\t\t\t\t\tb: original[ 2 ],\r\n\t\t\t\t\t\ta: original[ 3 ]\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: function write( color ) {\r\n\r\n\t\t\t\t\treturn [ color.r, color.g, color.b, color.a ];\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tlitmus: Common.isObject,\r\n\t\tconversions: {\r\n\t\t\tRGBA_OBJ: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tif ( Common.isNumber( original.r ) && Common.isNumber( original.g ) && Common.isNumber( original.b ) && Common.isNumber( original.a ) ) {\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tspace: 'RGB',\r\n\t\t\t\t\t\t\tr: original.r,\r\n\t\t\t\t\t\t\tg: original.g,\r\n\t\t\t\t\t\t\tb: original.b,\r\n\t\t\t\t\t\t\ta: original.a\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: function write( color ) {\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tr: color.r,\r\n\t\t\t\t\t\tg: color.g,\r\n\t\t\t\t\t\tb: color.b,\r\n\t\t\t\t\t\ta: color.a\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tRGB_OBJ: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tif ( Common.isNumber( original.r ) && Common.isNumber( original.g ) && Common.isNumber( original.b ) ) {\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tspace: 'RGB',\r\n\t\t\t\t\t\t\tr: original.r,\r\n\t\t\t\t\t\t\tg: original.g,\r\n\t\t\t\t\t\t\tb: original.b\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: function write( color ) {\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tr: color.r,\r\n\t\t\t\t\t\tg: color.g,\r\n\t\t\t\t\t\tb: color.b\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tHSVA_OBJ: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tif ( Common.isNumber( original.h ) && Common.isNumber( original.s ) && Common.isNumber( original.v ) && Common.isNumber( original.a ) ) {\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tspace: 'HSV',\r\n\t\t\t\t\t\t\th: original.h,\r\n\t\t\t\t\t\t\ts: original.s,\r\n\t\t\t\t\t\t\tv: original.v,\r\n\t\t\t\t\t\t\ta: original.a\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: function write( color ) {\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\th: color.h,\r\n\t\t\t\t\t\ts: color.s,\r\n\t\t\t\t\t\tv: color.v,\r\n\t\t\t\t\t\ta: color.a\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tHSV_OBJ: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tif ( Common.isNumber( original.h ) && Common.isNumber( original.s ) && Common.isNumber( original.v ) ) {\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tspace: 'HSV',\r\n\t\t\t\t\t\t\th: original.h,\r\n\t\t\t\t\t\t\ts: original.s,\r\n\t\t\t\t\t\t\tv: original.v\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: function write( color ) {\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\th: color.h,\r\n\t\t\t\t\t\ts: color.s,\r\n\t\t\t\t\t\tv: color.v\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} ];\r\nvar result = void 0;\r\nvar toReturn = void 0;\r\nvar interpret = function interpret() {\r\n\r\n\ttoReturn = false;\r\n\tvar original = arguments.length > 1 ? Common.toArray( arguments ) : arguments[ 0 ];\r\n\tCommon.each( INTERPRETATIONS, function ( family ) {\r\n\r\n\t\tif ( family.litmus( original ) ) {\r\n\r\n\t\t\tCommon.each( family.conversions, function ( conversion, conversionName ) {\r\n\r\n\t\t\t\tresult = conversion.read( original );\r\n\t\t\t\tif ( toReturn === false && result !== false ) {\r\n\r\n\t\t\t\t\ttoReturn = result;\r\n\t\t\t\t\tresult.conversionName = conversionName;\r\n\t\t\t\t\tresult.conversion = conversion;\r\n\t\t\t\t\treturn Common.BREAK;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\t\t\treturn Common.BREAK;\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\treturn toReturn;\r\n\r\n};\r\n\r\nvar tmpComponent = void 0;\r\nvar ColorMath = {\r\n\thsv_to_rgb: function hsv_to_rgb( h, s, v ) {\r\n\r\n\t\tvar hi = Math.floor( h / 60 ) % 6;\r\n\t\tvar f = h / 60 - Math.floor( h / 60 );\r\n\t\tvar p = v * ( 1.0 - s );\r\n\t\tvar q = v * ( 1.0 - f * s );\r\n\t\tvar t = v * ( 1.0 - ( 1.0 - f ) * s );\r\n\t\tvar c = [[ v, t, p ], [ q, v, p ], [ p, v, t ], [ p, q, v ], [ t, p, v ], [ v, p, q ]][ hi ];\r\n\t\treturn {\r\n\t\t\tr: c[ 0 ] * 255,\r\n\t\t\tg: c[ 1 ] * 255,\r\n\t\t\tb: c[ 2 ] * 255\r\n\t\t};\r\n\r\n\t},\r\n\trgb_to_hsv: function rgb_to_hsv( r, g, b ) {\r\n\r\n\t\tvar min = Math.min( r, g, b );\r\n\t\tvar max = Math.max( r, g, b );\r\n\t\tvar delta = max - min;\r\n\t\tvar h = void 0;\r\n\t\tvar s = void 0;\r\n\t\tif ( max !== 0 ) {\r\n\r\n\t\t\ts = delta / max;\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn {\r\n\t\t\t\th: NaN,\r\n\t\t\t\ts: 0,\r\n\t\t\t\tv: 0\r\n\t\t\t};\r\n\r\n\t\t}\r\n\t\tif ( r === max ) {\r\n\r\n\t\t\th = ( g - b ) / delta;\r\n\r\n\t\t} else if ( g === max ) {\r\n\r\n\t\t\th = 2 + ( b - r ) / delta;\r\n\r\n\t\t} else {\r\n\r\n\t\t\th = 4 + ( r - g ) / delta;\r\n\r\n\t\t}\r\n\t\th /= 6;\r\n\t\tif ( h < 0 ) {\r\n\r\n\t\t\th += 1;\r\n\r\n\t\t}\r\n\t\treturn {\r\n\t\t\th: h * 360,\r\n\t\t\ts: s,\r\n\t\t\tv: max / 255\r\n\t\t};\r\n\r\n\t},\r\n\trgb_to_hex: function rgb_to_hex( r, g, b ) {\r\n\r\n\t\tvar hex = this.hex_with_component( 0, 2, r );\r\n\t\thex = this.hex_with_component( hex, 1, g );\r\n\t\thex = this.hex_with_component( hex, 0, b );\r\n\t\treturn hex;\r\n\r\n\t},\r\n\tcomponent_from_hex: function component_from_hex( hex, componentIndex ) {\r\n\r\n\t\treturn hex >> componentIndex * 8 & 0xFF;\r\n\r\n\t},\r\n\thex_with_component: function hex_with_component( hex, componentIndex, value ) {\r\n\r\n\t\treturn value << ( tmpComponent = componentIndex * 8 ) | hex & ~ ( 0xFF << tmpComponent );\r\n\r\n\t}\r\n};\r\n\r\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function ( obj ) {\r\n\r\n\treturn typeof obj;\r\n\r\n} : function ( obj ) {\r\n\r\n\treturn obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar classCallCheck = function ( instance, Constructor ) {\r\n\r\n\tif ( ! ( instance instanceof Constructor ) ) {\r\n\r\n\t\tthrow new TypeError( \"Cannot call a class as a function\" );\r\n\r\n\t}\r\n\r\n};\r\n\r\nvar createClass = function () {\r\n\r\n\tfunction defineProperties( target, props ) {\r\n\r\n\t\tfor ( var i = 0; i < props.length; i ++ ) {\r\n\r\n\t\t\tvar descriptor = props[ i ];\r\n\t\t\tdescriptor.enumerable = descriptor.enumerable || false;\r\n\t\t\tdescriptor.configurable = true;\r\n\t\t\tif ( \"value\" in descriptor ) descriptor.writable = true;\r\n\t\t\tObject.defineProperty( target, descriptor.key, descriptor );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn function ( Constructor, protoProps, staticProps ) {\r\n\r\n\t\tif ( protoProps ) defineProperties( Constructor.prototype, protoProps );\r\n\t\tif ( staticProps ) defineProperties( Constructor, staticProps );\r\n\t\treturn Constructor;\r\n\r\n\t};\r\n\r\n}();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar get = function get( object, property, receiver ) {\r\n\r\n\tif ( object === null ) object = Function.prototype;\r\n\tvar desc = Object.getOwnPropertyDescriptor( object, property );\r\n\r\n\tif ( desc === undefined ) {\r\n\r\n\t\tvar parent = Object.getPrototypeOf( object );\r\n\r\n\t\tif ( parent === null ) {\r\n\r\n\t\t\treturn undefined;\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn get( parent, property, receiver );\r\n\r\n\t\t}\r\n\r\n\t} else if ( \"value\" in desc ) {\r\n\r\n\t\treturn desc.value;\r\n\r\n\t} else {\r\n\r\n\t\tvar getter = desc.get;\r\n\r\n\t\tif ( getter === undefined ) {\r\n\r\n\t\t\treturn undefined;\r\n\r\n\t\t}\r\n\r\n\t\treturn getter.call( receiver );\r\n\r\n\t}\r\n\r\n};\r\n\r\nvar inherits = function ( subClass, superClass ) {\r\n\r\n\tif ( typeof superClass !== \"function\" && superClass !== null ) {\r\n\r\n\t\tthrow new TypeError( \"Super expression must either be null or a function, not \" + typeof superClass );\r\n\r\n\t}\r\n\r\n\tsubClass.prototype = Object.create( superClass && superClass.prototype, {\r\n\t\tconstructor: {\r\n\t\t\tvalue: subClass,\r\n\t\t\tenumerable: false,\r\n\t\t\twritable: true,\r\n\t\t\tconfigurable: true\r\n\t\t}\r\n\t} );\r\n\tif ( superClass ) Object.setPrototypeOf ? Object.setPrototypeOf( subClass, superClass ) : subClass.__proto__ = superClass;\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar possibleConstructorReturn = function ( self, call ) {\r\n\r\n\tif ( ! self ) {\r\n\r\n\t\tthrow new ReferenceError( \"this hasn't been initialised - super() hasn't been called\" );\r\n\r\n\t}\r\n\r\n\treturn call && ( typeof call === \"object\" || typeof call === \"function\" ) ? call : self;\r\n\r\n};\r\n\r\nvar Color = function () {\r\n\r\n\tfunction Color() {\r\n\r\n\t\tclassCallCheck( this, Color );\r\n\t\tthis.__state = interpret.apply( this, arguments );\r\n\t\tif ( this.__state === false ) {\r\n\r\n\t\t\tthrow new Error( 'Failed to interpret color arguments' );\r\n\r\n\t\t}\r\n\t\tthis.__state.a = this.__state.a || 1;\r\n\r\n\t}\r\n\tcreateClass( Color, [ {\r\n\t\tkey: 'toString',\r\n\t\tvalue: function toString() {\r\n\r\n\t\t\treturn colorToString( this );\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'toHexString',\r\n\t\tvalue: function toHexString() {\r\n\r\n\t\t\treturn colorToString( this, true );\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'toOriginal',\r\n\t\tvalue: function toOriginal() {\r\n\r\n\t\t\treturn this.__state.conversion.write( this );\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn Color;\r\n\r\n}();\r\nfunction defineRGBComponent( target, component, componentHexIndex ) {\r\n\r\n\tObject.defineProperty( target, component, {\r\n\t\tget: function get$$1() {\r\n\r\n\t\t\tif ( this.__state.space === 'RGB' ) {\r\n\r\n\t\t\t\treturn this.__state[ component ];\r\n\r\n\t\t\t}\r\n\t\t\tColor.recalculateRGB( this, component, componentHexIndex );\r\n\t\t\treturn this.__state[ component ];\r\n\r\n\t\t},\r\n\t\tset: function set$$1( v ) {\r\n\r\n\t\t\tif ( this.__state.space !== 'RGB' ) {\r\n\r\n\t\t\t\tColor.recalculateRGB( this, component, componentHexIndex );\r\n\t\t\t\tthis.__state.space = 'RGB';\r\n\r\n\t\t\t}\r\n\t\t\tthis.__state[ component ] = v;\r\n\r\n\t\t}\r\n\t} );\r\n\r\n}\r\nfunction defineHSVComponent( target, component ) {\r\n\r\n\tObject.defineProperty( target, component, {\r\n\t\tget: function get$$1() {\r\n\r\n\t\t\tif ( this.__state.space === 'HSV' ) {\r\n\r\n\t\t\t\treturn this.__state[ component ];\r\n\r\n\t\t\t}\r\n\t\t\tColor.recalculateHSV( this );\r\n\t\t\treturn this.__state[ component ];\r\n\r\n\t\t},\r\n\t\tset: function set$$1( v ) {\r\n\r\n\t\t\tif ( this.__state.space !== 'HSV' ) {\r\n\r\n\t\t\t\tColor.recalculateHSV( this );\r\n\t\t\t\tthis.__state.space = 'HSV';\r\n\r\n\t\t\t}\r\n\t\t\tthis.__state[ component ] = v;\r\n\r\n\t\t}\r\n\t} );\r\n\r\n}\r\nColor.recalculateRGB = function ( color, component, componentHexIndex ) {\r\n\r\n\tif ( color.__state.space === 'HEX' ) {\r\n\r\n\t\tcolor.__state[ component ] = ColorMath.component_from_hex( color.__state.hex, componentHexIndex );\r\n\r\n\t} else if ( color.__state.space === 'HSV' ) {\r\n\r\n\t\tCommon.extend( color.__state, ColorMath.hsv_to_rgb( color.__state.h, color.__state.s, color.__state.v ) );\r\n\r\n\t} else {\r\n\r\n\t\tthrow new Error( 'Corrupted color state' );\r\n\r\n\t}\r\n\r\n};\r\nColor.recalculateHSV = function ( color ) {\r\n\r\n\tvar result = ColorMath.rgb_to_hsv( color.r, color.g, color.b );\r\n\tCommon.extend( color.__state, {\r\n\t\ts: result.s,\r\n\t\tv: result.v\r\n\t} );\r\n\tif ( ! Common.isNaN( result.h ) ) {\r\n\r\n\t\tcolor.__state.h = result.h;\r\n\r\n\t} else if ( Common.isUndefined( color.__state.h ) ) {\r\n\r\n\t\tcolor.__state.h = 0;\r\n\r\n\t}\r\n\r\n};\r\nColor.COMPONENTS = [ 'r', 'g', 'b', 'h', 's', 'v', 'hex', 'a' ];\r\ndefineRGBComponent( Color.prototype, 'r', 2 );\r\ndefineRGBComponent( Color.prototype, 'g', 1 );\r\ndefineRGBComponent( Color.prototype, 'b', 0 );\r\ndefineHSVComponent( Color.prototype, 'h' );\r\ndefineHSVComponent( Color.prototype, 's' );\r\ndefineHSVComponent( Color.prototype, 'v' );\r\nObject.defineProperty( Color.prototype, 'a', {\r\n\tget: function get$$1() {\r\n\r\n\t\treturn this.__state.a;\r\n\r\n\t},\r\n\tset: function set$$1( v ) {\r\n\r\n\t\tthis.__state.a = v;\r\n\r\n\t}\r\n} );\r\nObject.defineProperty( Color.prototype, 'hex', {\r\n\tget: function get$$1() {\r\n\r\n\t\tif ( this.__state.space !== 'HEX' ) {\r\n\r\n\t\t\tthis.__state.hex = ColorMath.rgb_to_hex( this.r, this.g, this.b );\r\n\t\t\tthis.__state.space = 'HEX';\r\n\r\n\t\t}\r\n\t\treturn this.__state.hex;\r\n\r\n\t},\r\n\tset: function set$$1( v ) {\r\n\r\n\t\tthis.__state.space = 'HEX';\r\n\t\tthis.__state.hex = v;\r\n\r\n\t}\r\n} );\r\n\r\nvar Controller = function () {\r\n\r\n\tfunction Controller( object, property ) {\r\n\r\n\t\tclassCallCheck( this, Controller );\r\n\t\tthis.initialValue = object[ property ];\r\n\t\tthis.domElement = document.createElement( 'div' );\r\n\t\tthis.object = object;\r\n\t\tthis.property = property;\r\n\t\tthis.__onChange = undefined;\r\n\t\tthis.__onFinishChange = undefined;\r\n\r\n\t}\r\n\tcreateClass( Controller, [ {\r\n\t\tkey: 'onChange',\r\n\t\tvalue: function onChange( fnc ) {\r\n\r\n\t\t\tthis.__onChange = fnc;\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'onFinishChange',\r\n\t\tvalue: function onFinishChange( fnc ) {\r\n\r\n\t\t\tthis.__onFinishChange = fnc;\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'setValue',\r\n\t\tvalue: function setValue( newValue ) {\r\n\r\n\t\t\tthis.object[ this.property ] = newValue;\r\n\t\t\tif ( this.__onChange ) {\r\n\r\n\t\t\t\tthis.__onChange.call( this, newValue );\r\n\r\n\t\t\t}\r\n\t\t\tthis.updateDisplay();\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'getValue',\r\n\t\tvalue: function getValue() {\r\n\r\n\t\t\treturn this.object[ this.property ];\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'updateDisplay',\r\n\t\tvalue: function updateDisplay() {\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'isModified',\r\n\t\tvalue: function isModified() {\r\n\r\n\t\t\treturn this.initialValue !== this.getValue();\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn Controller;\r\n\r\n}();\r\n\r\nvar EVENT_MAP = {\r\n\tHTMLEvents: [ 'change' ],\r\n\tMouseEvents: [ 'click', 'mousemove', 'mousedown', 'mouseup', 'mouseover' ],\r\n\tKeyboardEvents: [ 'keydown' ]\r\n};\r\nvar EVENT_MAP_INV = {};\r\nCommon.each( EVENT_MAP, function ( v, k ) {\r\n\r\n\tCommon.each( v, function ( e ) {\r\n\r\n\t\tEVENT_MAP_INV[ e ] = k;\r\n\r\n\t} );\r\n\r\n} );\r\nvar CSS_VALUE_PIXELS = /(\\d+(\\.\\d+)?)px/;\r\nfunction cssValueToPixels( val ) {\r\n\r\n\tif ( val === '0' || Common.isUndefined( val ) ) {\r\n\r\n\t\treturn 0;\r\n\r\n\t}\r\n\tvar match = val.match( CSS_VALUE_PIXELS );\r\n\tif ( ! Common.isNull( match ) ) {\r\n\r\n\t\treturn parseFloat( match[ 1 ] );\r\n\r\n\t}\r\n\treturn 0;\r\n\r\n}\r\nvar dom = {\r\n\tmakeSelectable: function makeSelectable( elem, selectable ) {\r\n\r\n\t\tif ( elem === undefined || elem.style === undefined ) return;\r\n\t\telem.onselectstart = selectable ? function () {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t} : function () {};\r\n\t\telem.style.MozUserSelect = selectable ? 'auto' : 'none';\r\n\t\telem.style.KhtmlUserSelect = selectable ? 'auto' : 'none';\r\n\t\telem.unselectable = selectable ? 'on' : 'off';\r\n\r\n\t},\r\n\tmakeFullscreen: function makeFullscreen( elem, hor, vert ) {\r\n\r\n\t\tvar vertical = vert;\r\n\t\tvar horizontal = hor;\r\n\t\tif ( Common.isUndefined( horizontal ) ) {\r\n\r\n\t\t\thorizontal = true;\r\n\r\n\t\t}\r\n\t\tif ( Common.isUndefined( vertical ) ) {\r\n\r\n\t\t\tvertical = true;\r\n\r\n\t\t}\r\n\t\telem.style.position = 'absolute';\r\n\t\tif ( horizontal ) {\r\n\r\n\t\t\telem.style.left = 0;\r\n\t\t\telem.style.right = 0;\r\n\r\n\t\t}\r\n\t\tif ( vertical ) {\r\n\r\n\t\t\telem.style.top = 0;\r\n\t\t\telem.style.bottom = 0;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\tfakeEvent: function fakeEvent( elem, eventType, pars, aux ) {\r\n\r\n\t\tvar params = pars || {};\r\n\t\tvar className = EVENT_MAP_INV[ eventType ];\r\n\t\tif ( ! className ) {\r\n\r\n\t\t\tthrow new Error( 'Event type ' + eventType + ' not supported.' );\r\n\r\n\t\t}\r\n\t\tvar evt = document.createEvent( className );\r\n\t\tswitch ( className ) {\r\n\r\n\t\t\tcase 'MouseEvents':\r\n\t\t\t{\r\n\r\n\t\t\t\tvar clientX = params.x || params.clientX || 0;\r\n\t\t\t\tvar clientY = params.y || params.clientY || 0;\r\n\t\t\t\tevt.initMouseEvent( eventType, params.bubbles || false, params.cancelable || true, window, params.clickCount || 1, 0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\tclientX,\r\n\t\t\t\t\tclientY,\r\n\t\t\t\t\tfalse, false, false, false, 0, null );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\t\tcase 'KeyboardEvents':\r\n\t\t\t{\r\n\r\n\t\t\t\tvar init = evt.initKeyboardEvent || evt.initKeyEvent;\r\n\t\t\t\tCommon.defaults( params, {\r\n\t\t\t\t\tcancelable: true,\r\n\t\t\t\t\tctrlKey: false,\r\n\t\t\t\t\taltKey: false,\r\n\t\t\t\t\tshiftKey: false,\r\n\t\t\t\t\tmetaKey: false,\r\n\t\t\t\t\tkeyCode: undefined,\r\n\t\t\t\t\tcharCode: undefined\r\n\t\t\t\t} );\r\n\t\t\t\tinit( eventType, params.bubbles || false, params.cancelable, window, params.ctrlKey, params.altKey, params.shiftKey, params.metaKey, params.keyCode, params.charCode );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\t\tdefault:\r\n\t\t\t{\r\n\r\n\t\t\t\tevt.initEvent( eventType, params.bubbles || false, params.cancelable || true );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tCommon.defaults( evt, aux );\r\n\t\telem.dispatchEvent( evt );\r\n\r\n\t},\r\n\tbind: function bind( elem, event, func, newBool ) {\r\n\r\n\t\tvar bool = newBool || false;\r\n\t\tif ( elem.addEventListener ) {\r\n\r\n\t\t\telem.addEventListener( event, func, bool );\r\n\r\n\t\t} else if ( elem.attachEvent ) {\r\n\r\n\t\t\telem.attachEvent( 'on' + event, func );\r\n\r\n\t\t}\r\n\t\treturn dom;\r\n\r\n\t},\r\n\tunbind: function unbind( elem, event, func, newBool ) {\r\n\r\n\t\tvar bool = newBool || false;\r\n\t\tif ( elem.removeEventListener ) {\r\n\r\n\t\t\telem.removeEventListener( event, func, bool );\r\n\r\n\t\t} else if ( elem.detachEvent ) {\r\n\r\n\t\t\telem.detachEvent( 'on' + event, func );\r\n\r\n\t\t}\r\n\t\treturn dom;\r\n\r\n\t},\r\n\taddClass: function addClass( elem, className ) {\r\n\r\n\t\tif ( elem.className === undefined ) {\r\n\r\n\t\t\telem.className = className;\r\n\r\n\t\t} else if ( elem.className !== className ) {\r\n\r\n\t\t\tvar classes = elem.className.split( / +/ );\r\n\t\t\tif ( classes.indexOf( className ) === - 1 ) {\r\n\r\n\t\t\t\tclasses.push( className );\r\n\t\t\t\telem.className = classes.join( ' ' ).replace( /^\\s+/, '' ).replace( /\\s+$/, '' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn dom;\r\n\r\n\t},\r\n\tremoveClass: function removeClass( elem, className ) {\r\n\r\n\t\tif ( className ) {\r\n\r\n\t\t\tif ( elem.className === className ) {\r\n\r\n\t\t\t\telem.removeAttribute( 'class' );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar classes = elem.className.split( / +/ );\r\n\t\t\t\tvar index = classes.indexOf( className );\r\n\t\t\t\tif ( index !== - 1 ) {\r\n\r\n\t\t\t\t\tclasses.splice( index, 1 );\r\n\t\t\t\t\telem.className = classes.join( ' ' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\telem.className = undefined;\r\n\r\n\t\t}\r\n\t\treturn dom;\r\n\r\n\t},\r\n\thasClass: function hasClass( elem, className ) {\r\n\r\n\t\treturn new RegExp( '(?:^|\\\\s+)' + className + '(?:\\\\s+|$)' ).test( elem.className ) || false;\r\n\r\n\t},\r\n\tgetWidth: function getWidth( elem ) {\r\n\r\n\t\tvar style = getComputedStyle( elem );\r\n\t\treturn cssValueToPixels( style[ 'border-left-width' ] ) + cssValueToPixels( style[ 'border-right-width' ] ) + cssValueToPixels( style[ 'padding-left' ] ) + cssValueToPixels( style[ 'padding-right' ] ) + cssValueToPixels( style.width );\r\n\r\n\t},\r\n\tgetHeight: function getHeight( elem ) {\r\n\r\n\t\tvar style = getComputedStyle( elem );\r\n\t\treturn cssValueToPixels( style[ 'border-top-width' ] ) + cssValueToPixels( style[ 'border-bottom-width' ] ) + cssValueToPixels( style[ 'padding-top' ] ) + cssValueToPixels( style[ 'padding-bottom' ] ) + cssValueToPixels( style.height );\r\n\r\n\t},\r\n\tgetOffset: function getOffset( el ) {\r\n\r\n\t\tvar elem = el;\r\n\t\tvar offset = { left: 0, top: 0 };\r\n\t\tif ( elem.offsetParent ) {\r\n\r\n\t\t\tdo {\r\n\r\n\t\t\t\toffset.left += elem.offsetLeft;\r\n\t\t\t\toffset.top += elem.offsetTop;\r\n\t\t\t\telem = elem.offsetParent;\r\n\r\n\t\t\t} while ( elem );\r\n\r\n\t\t}\r\n\t\treturn offset;\r\n\r\n\t},\r\n\tisActive: function isActive( elem ) {\r\n\r\n\t\treturn elem === document.activeElement && ( elem.type || elem.href );\r\n\r\n\t}\r\n};\r\n\r\nvar BooleanController = function ( _Controller ) {\r\n\r\n\tinherits( BooleanController, _Controller );\r\n\tfunction BooleanController( object, property ) {\r\n\r\n\t\tclassCallCheck( this, BooleanController );\r\n\t\tvar _this2 = possibleConstructorReturn( this, ( BooleanController.__proto__ || Object.getPrototypeOf( BooleanController ) ).call( this, object, property ) );\r\n\t\tvar _this = _this2;\r\n\t\t_this2.__prev = _this2.getValue();\r\n\t\t_this2.__checkbox = document.createElement( 'input' );\r\n\t\t_this2.__checkbox.setAttribute( 'type', 'checkbox' );\r\n\t\tfunction onChange() {\r\n\r\n\t\t\t_this.setValue( ! _this.__prev );\r\n\r\n\t\t}\r\n\t\tdom.bind( _this2.__checkbox, 'change', onChange, false );\r\n\t\t_this2.domElement.appendChild( _this2.__checkbox );\r\n\t\t_this2.updateDisplay();\r\n\t\treturn _this2;\r\n\r\n\t}\r\n\tcreateClass( BooleanController, [ {\r\n\t\tkey: 'setValue',\r\n\t\tvalue: function setValue( v ) {\r\n\r\n\t\t\tvar toReturn = get( BooleanController.prototype.__proto__ || Object.getPrototypeOf( BooleanController.prototype ), 'setValue', this ).call( this, v );\r\n\t\t\tif ( this.__onFinishChange ) {\r\n\r\n\t\t\t\tthis.__onFinishChange.call( this, this.getValue() );\r\n\r\n\t\t\t}\r\n\t\t\tthis.__prev = this.getValue();\r\n\t\t\treturn toReturn;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'updateDisplay',\r\n\t\tvalue: function updateDisplay() {\r\n\r\n\t\t\tif ( this.getValue() === true ) {\r\n\r\n\t\t\t\tthis.__checkbox.setAttribute( 'checked', 'checked' );\r\n\t\t\t\tthis.__checkbox.checked = true;\r\n\t\t\t\tthis.__prev = true;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.__checkbox.checked = false;\r\n\t\t\t\tthis.__prev = false;\r\n\r\n\t\t\t}\r\n\t\t\treturn get( BooleanController.prototype.__proto__ || Object.getPrototypeOf( BooleanController.prototype ), 'updateDisplay', this ).call( this );\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn BooleanController;\r\n\r\n}( Controller );\r\n\r\nvar OptionController = function ( _Controller ) {\r\n\r\n\tinherits( OptionController, _Controller );\r\n\tfunction OptionController( object, property, opts ) {\r\n\r\n\t\tclassCallCheck( this, OptionController );\r\n\t\tvar _this2 = possibleConstructorReturn( this, ( OptionController.__proto__ || Object.getPrototypeOf( OptionController ) ).call( this, object, property ) );\r\n\t\tvar options = opts;\r\n\t\tvar _this = _this2;\r\n\t\t_this2.__select = document.createElement( 'select' );\r\n\t\tif ( Common.isArray( options ) ) {\r\n\r\n\t\t\tvar map = {};\r\n\t\t\tCommon.each( options, function ( element ) {\r\n\r\n\t\t\t\tmap[ element ] = element;\r\n\r\n\t\t\t} );\r\n\t\t\toptions = map;\r\n\r\n\t\t}\r\n\t\tCommon.each( options, function ( value, key ) {\r\n\r\n\t\t\tvar opt = document.createElement( 'option' );\r\n\t\t\topt.innerHTML = key;\r\n\t\t\topt.setAttribute( 'value', value );\r\n\t\t\t_this.__select.appendChild( opt );\r\n\r\n\t\t} );\r\n\t\t_this2.updateDisplay();\r\n\t\tdom.bind( _this2.__select, 'change', function () {\r\n\r\n\t\t\tvar desiredValue = this.options[ this.selectedIndex ].value;\r\n\t\t\t_this.setValue( desiredValue );\r\n\r\n\t\t} );\r\n\t\t_this2.domElement.appendChild( _this2.__select );\r\n\t\treturn _this2;\r\n\r\n\t}\r\n\tcreateClass( OptionController, [ {\r\n\t\tkey: 'setValue',\r\n\t\tvalue: function setValue( v ) {\r\n\r\n\t\t\tvar toReturn = get( OptionController.prototype.__proto__ || Object.getPrototypeOf( OptionController.prototype ), 'setValue', this ).call( this, v );\r\n\t\t\tif ( this.__onFinishChange ) {\r\n\r\n\t\t\t\tthis.__onFinishChange.call( this, this.getValue() );\r\n\r\n\t\t\t}\r\n\t\t\treturn toReturn;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'updateDisplay',\r\n\t\tvalue: function updateDisplay() {\r\n\r\n\t\t\tif ( dom.isActive( this.__select ) ) return this;\r\n\t\t\tthis.__select.value = this.getValue();\r\n\t\t\treturn get( OptionController.prototype.__proto__ || Object.getPrototypeOf( OptionController.prototype ), 'updateDisplay', this ).call( this );\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn OptionController;\r\n\r\n}( Controller );\r\n\r\nvar StringController = function ( _Controller ) {\r\n\r\n\tinherits( StringController, _Controller );\r\n\tfunction StringController( object, property ) {\r\n\r\n\t\tclassCallCheck( this, StringController );\r\n\t\tvar _this2 = possibleConstructorReturn( this, ( StringController.__proto__ || Object.getPrototypeOf( StringController ) ).call( this, object, property ) );\r\n\t\tvar _this = _this2;\r\n\t\tfunction onChange() {\r\n\r\n\t\t\t_this.setValue( _this.__input.value );\r\n\r\n\t\t}\r\n\t\tfunction onBlur() {\r\n\r\n\t\t\tif ( _this.__onFinishChange ) {\r\n\r\n\t\t\t\t_this.__onFinishChange.call( _this, _this.getValue() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t_this2.__input = document.createElement( 'input' );\r\n\t\t_this2.__input.setAttribute( 'type', 'text' );\r\n\t\tdom.bind( _this2.__input, 'keyup', onChange );\r\n\t\tdom.bind( _this2.__input, 'change', onChange );\r\n\t\tdom.bind( _this2.__input, 'blur', onBlur );\r\n\t\tdom.bind( _this2.__input, 'keydown', function ( e ) {\r\n\r\n\t\t\tif ( e.keyCode === 13 ) {\r\n\r\n\t\t\t\tthis.blur();\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\t\t_this2.updateDisplay();\r\n\t\t_this2.domElement.appendChild( _this2.__input );\r\n\t\treturn _this2;\r\n\r\n\t}\r\n\tcreateClass( StringController, [ {\r\n\t\tkey: 'updateDisplay',\r\n\t\tvalue: function updateDisplay() {\r\n\r\n\t\t\tif ( ! dom.isActive( this.__input ) ) {\r\n\r\n\t\t\t\tthis.__input.value = this.getValue();\r\n\r\n\t\t\t}\r\n\t\t\treturn get( StringController.prototype.__proto__ || Object.getPrototypeOf( StringController.prototype ), 'updateDisplay', this ).call( this );\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn StringController;\r\n\r\n}( Controller );\r\n\r\nfunction numDecimals( x ) {\r\n\r\n\tvar _x = x.toString();\r\n\tif ( _x.indexOf( '.' ) > - 1 ) {\r\n\r\n\t\treturn _x.length - _x.indexOf( '.' ) - 1;\r\n\r\n\t}\r\n\treturn 0;\r\n\r\n}\r\nvar NumberController = function ( _Controller ) {\r\n\r\n\tinherits( NumberController, _Controller );\r\n\tfunction NumberController( object, property, params ) {\r\n\r\n\t\tclassCallCheck( this, NumberController );\r\n\t\tvar _this = possibleConstructorReturn( this, ( NumberController.__proto__ || Object.getPrototypeOf( NumberController ) ).call( this, object, property ) );\r\n\t\tvar _params = params || {};\r\n\t\t_this.__min = _params.min;\r\n\t\t_this.__max = _params.max;\r\n\t\t_this.__step = _params.step;\r\n\t\tif ( Common.isUndefined( _this.__step ) ) {\r\n\r\n\t\t\tif ( _this.initialValue === 0 ) {\r\n\r\n\t\t\t\t_this.__impliedStep = 1;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_this.__impliedStep = Math.pow( 10, Math.floor( Math.log( Math.abs( _this.initialValue ) ) / Math.LN10 ) ) / 10;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_this.__impliedStep = _this.__step;\r\n\r\n\t\t}\r\n\t\t_this.__precision = numDecimals( _this.__impliedStep );\r\n\t\treturn _this;\r\n\r\n\t}\r\n\tcreateClass( NumberController, [ {\r\n\t\tkey: 'setValue',\r\n\t\tvalue: function setValue( v ) {\r\n\r\n\t\t\tvar _v = v;\r\n\t\t\tif ( this.__min !== undefined && _v < this.__min ) {\r\n\r\n\t\t\t\t_v = this.__min;\r\n\r\n\t\t\t} else if ( this.__max !== undefined && _v > this.__max ) {\r\n\r\n\t\t\t\t_v = this.__max;\r\n\r\n\t\t\t}\r\n\t\t\tif ( this.__step !== undefined && _v % this.__step !== 0 ) {\r\n\r\n\t\t\t\t_v = Math.round( _v / this.__step ) * this.__step;\r\n\r\n\t\t\t}\r\n\t\t\treturn get( NumberController.prototype.__proto__ || Object.getPrototypeOf( NumberController.prototype ), 'setValue', this ).call( this, _v );\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'min',\r\n\t\tvalue: function min( minValue ) {\r\n\r\n\t\t\tthis.__min = minValue;\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'max',\r\n\t\tvalue: function max( maxValue ) {\r\n\r\n\t\t\tthis.__max = maxValue;\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'step',\r\n\t\tvalue: function step( stepValue ) {\r\n\r\n\t\t\tthis.__step = stepValue;\r\n\t\t\tthis.__impliedStep = stepValue;\r\n\t\t\tthis.__precision = numDecimals( stepValue );\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn NumberController;\r\n\r\n}( Controller );\r\n\r\nfunction roundToDecimal( value, decimals ) {\r\n\r\n\tvar tenTo = Math.pow( 10, decimals );\r\n\treturn Math.round( value * tenTo ) / tenTo;\r\n\r\n}\r\nvar NumberControllerBox = function ( _NumberController ) {\r\n\r\n\tinherits( NumberControllerBox, _NumberController );\r\n\tfunction NumberControllerBox( object, property, params ) {\r\n\r\n\t\tclassCallCheck( this, NumberControllerBox );\r\n\t\tvar _this2 = possibleConstructorReturn( this, ( NumberControllerBox.__proto__ || Object.getPrototypeOf( NumberControllerBox ) ).call( this, object, property, params ) );\r\n\t\t_this2.__truncationSuspended = false;\r\n\t\tvar _this = _this2;\r\n\t\tvar prevY = void 0;\r\n\t\tfunction onChange() {\r\n\r\n\t\t\tvar attempted = parseFloat( _this.__input.value );\r\n\t\t\tif ( ! Common.isNaN( attempted ) ) {\r\n\r\n\t\t\t\t_this.setValue( attempted );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tfunction onFinish() {\r\n\r\n\t\t\tif ( _this.__onFinishChange ) {\r\n\r\n\t\t\t\t_this.__onFinishChange.call( _this, _this.getValue() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tfunction onBlur() {\r\n\r\n\t\t\tonFinish();\r\n\r\n\t\t}\r\n\t\tfunction onMouseDrag( e ) {\r\n\r\n\t\t\tvar diff = prevY - e.clientY;\r\n\t\t\t_this.setValue( _this.getValue() + diff * _this.__impliedStep );\r\n\t\t\tprevY = e.clientY;\r\n\r\n\t\t}\r\n\t\tfunction onMouseUp() {\r\n\r\n\t\t\tdom.unbind( window, 'mousemove', onMouseDrag );\r\n\t\t\tdom.unbind( window, 'mouseup', onMouseUp );\r\n\t\t\tonFinish();\r\n\r\n\t\t}\r\n\t\tfunction onMouseDown( e ) {\r\n\r\n\t\t\tdom.bind( window, 'mousemove', onMouseDrag );\r\n\t\t\tdom.bind( window, 'mouseup', onMouseUp );\r\n\t\t\tprevY = e.clientY;\r\n\r\n\t\t}\r\n\t\t_this2.__input = document.createElement( 'input' );\r\n\t\t_this2.__input.setAttribute( 'type', 'text' );\r\n\t\tdom.bind( _this2.__input, 'change', onChange );\r\n\t\tdom.bind( _this2.__input, 'blur', onBlur );\r\n\t\tdom.bind( _this2.__input, 'mousedown', onMouseDown );\r\n\t\tdom.bind( _this2.__input, 'keydown', function ( e ) {\r\n\r\n\t\t\tif ( e.keyCode === 13 ) {\r\n\r\n\t\t\t\t_this.__truncationSuspended = true;\r\n\t\t\t\tthis.blur();\r\n\t\t\t\t_this.__truncationSuspended = false;\r\n\t\t\t\tonFinish();\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\t\t_this2.updateDisplay();\r\n\t\t_this2.domElement.appendChild( _this2.__input );\r\n\t\treturn _this2;\r\n\r\n\t}\r\n\tcreateClass( NumberControllerBox, [ {\r\n\t\tkey: 'updateDisplay',\r\n\t\tvalue: function updateDisplay() {\r\n\r\n\t\t\tthis.__input.value = this.__truncationSuspended ? this.getValue() : roundToDecimal( this.getValue(), this.__precision );\r\n\t\t\treturn get( NumberControllerBox.prototype.__proto__ || Object.getPrototypeOf( NumberControllerBox.prototype ), 'updateDisplay', this ).call( this );\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn NumberControllerBox;\r\n\r\n}( NumberController );\r\n\r\nfunction map( v, i1, i2, o1, o2 ) {\r\n\r\n\treturn o1 + ( o2 - o1 ) * ( ( v - i1 ) / ( i2 - i1 ) );\r\n\r\n}\r\nvar NumberControllerSlider = function ( _NumberController ) {\r\n\r\n\tinherits( NumberControllerSlider, _NumberController );\r\n\tfunction NumberControllerSlider( object, property, min, max, step ) {\r\n\r\n\t\tclassCallCheck( this, NumberControllerSlider );\r\n\t\tvar _this2 = possibleConstructorReturn( this, ( NumberControllerSlider.__proto__ || Object.getPrototypeOf( NumberControllerSlider ) ).call( this, object, property, { min: min, max: max, step: step } ) );\r\n\t\tvar _this = _this2;\r\n\t\t_this2.__background = document.createElement( 'div' );\r\n\t\t_this2.__foreground = document.createElement( 'div' );\r\n\t\tdom.bind( _this2.__background, 'mousedown', onMouseDown );\r\n\t\tdom.bind( _this2.__background, 'touchstart', onTouchStart );\r\n\t\tdom.addClass( _this2.__background, 'slider' );\r\n\t\tdom.addClass( _this2.__foreground, 'slider-fg' );\r\n\t\tfunction onMouseDown( e ) {\r\n\r\n\t\t\tdocument.activeElement.blur();\r\n\t\t\tdom.bind( window, 'mousemove', onMouseDrag );\r\n\t\t\tdom.bind( window, 'mouseup', onMouseUp );\r\n\t\t\tonMouseDrag( e );\r\n\r\n\t\t}\r\n\t\tfunction onMouseDrag( e ) {\r\n\r\n\t\t\te.preventDefault();\r\n\t\t\tvar bgRect = _this.__background.getBoundingClientRect();\r\n\t\t\t_this.setValue( map( e.clientX, bgRect.left, bgRect.right, _this.__min, _this.__max ) );\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\t\tfunction onMouseUp() {\r\n\r\n\t\t\tdom.unbind( window, 'mousemove', onMouseDrag );\r\n\t\t\tdom.unbind( window, 'mouseup', onMouseUp );\r\n\t\t\tif ( _this.__onFinishChange ) {\r\n\r\n\t\t\t\t_this.__onFinishChange.call( _this, _this.getValue() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tfunction onTouchStart( e ) {\r\n\r\n\t\t\tif ( e.touches.length !== 1 ) {\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\t\t\tdom.bind( window, 'touchmove', onTouchMove );\r\n\t\t\tdom.bind( window, 'touchend', onTouchEnd );\r\n\t\t\tonTouchMove( e );\r\n\r\n\t\t}\r\n\t\tfunction onTouchMove( e ) {\r\n\r\n\t\t\tvar clientX = e.touches[ 0 ].clientX;\r\n\t\t\tvar bgRect = _this.__background.getBoundingClientRect();\r\n\t\t\t_this.setValue( map( clientX, bgRect.left, bgRect.right, _this.__min, _this.__max ) );\r\n\r\n\t\t}\r\n\t\tfunction onTouchEnd() {\r\n\r\n\t\t\tdom.unbind( window, 'touchmove', onTouchMove );\r\n\t\t\tdom.unbind( window, 'touchend', onTouchEnd );\r\n\t\t\tif ( _this.__onFinishChange ) {\r\n\r\n\t\t\t\t_this.__onFinishChange.call( _this, _this.getValue() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t_this2.updateDisplay();\r\n\t\t_this2.__background.appendChild( _this2.__foreground );\r\n\t\t_this2.domElement.appendChild( _this2.__background );\r\n\t\treturn _this2;\r\n\r\n\t}\r\n\tcreateClass( NumberControllerSlider, [ {\r\n\t\tkey: 'updateDisplay',\r\n\t\tvalue: function updateDisplay() {\r\n\r\n\t\t\tvar pct = ( this.getValue() - this.__min ) / ( this.__max - this.__min );\r\n\t\t\tthis.__foreground.style.width = pct * 100 + '%';\r\n\t\t\treturn get( NumberControllerSlider.prototype.__proto__ || Object.getPrototypeOf( NumberControllerSlider.prototype ), 'updateDisplay', this ).call( this );\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn NumberControllerSlider;\r\n\r\n}( NumberController );\r\n\r\nvar FunctionController = function ( _Controller ) {\r\n\r\n\tinherits( FunctionController, _Controller );\r\n\tfunction FunctionController( object, property, text ) {\r\n\r\n\t\tclassCallCheck( this, FunctionController );\r\n\t\tvar _this2 = possibleConstructorReturn( this, ( FunctionController.__proto__ || Object.getPrototypeOf( FunctionController ) ).call( this, object, property ) );\r\n\t\tvar _this = _this2;\r\n\t\t_this2.__button = document.createElement( 'div' );\r\n\t\t_this2.__button.innerHTML = text === undefined ? 'Fire' : text;\r\n\t\tdom.bind( _this2.__button, 'click', function ( e ) {\r\n\r\n\t\t\te.preventDefault();\r\n\t\t\t_this.fire();\r\n\t\t\treturn false;\r\n\r\n\t\t} );\r\n\t\tdom.addClass( _this2.__button, 'button' );\r\n\t\t_this2.domElement.appendChild( _this2.__button );\r\n\t\treturn _this2;\r\n\r\n\t}\r\n\tcreateClass( FunctionController, [ {\r\n\t\tkey: 'fire',\r\n\t\tvalue: function fire() {\r\n\r\n\t\t\tif ( this.__onChange ) {\r\n\r\n\t\t\t\tthis.__onChange.call( this );\r\n\r\n\t\t\t}\r\n\t\t\tthis.getValue().call( this.object );\r\n\t\t\tif ( this.__onFinishChange ) {\r\n\r\n\t\t\t\tthis.__onFinishChange.call( this, this.getValue() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn FunctionController;\r\n\r\n}( Controller );\r\n\r\nvar ColorController = function ( _Controller ) {\r\n\r\n\tinherits( ColorController, _Controller );\r\n\tfunction ColorController( object, property ) {\r\n\r\n\t\tclassCallCheck( this, ColorController );\r\n\t\tvar _this2 = possibleConstructorReturn( this, ( ColorController.__proto__ || Object.getPrototypeOf( ColorController ) ).call( this, object, property ) );\r\n\t\t_this2.__color = new Color( _this2.getValue() );\r\n\t\t_this2.__temp = new Color( 0 );\r\n\t\tvar _this = _this2;\r\n\t\t_this2.domElement = document.createElement( 'div' );\r\n\t\tdom.makeSelectable( _this2.domElement, false );\r\n\t\t_this2.__selector = document.createElement( 'div' );\r\n\t\t_this2.__selector.className = 'selector';\r\n\t\t_this2.__saturation_field = document.createElement( 'div' );\r\n\t\t_this2.__saturation_field.className = 'saturation-field';\r\n\t\t_this2.__field_knob = document.createElement( 'div' );\r\n\t\t_this2.__field_knob.className = 'field-knob';\r\n\t\t_this2.__field_knob_border = '2px solid ';\r\n\t\t_this2.__hue_knob = document.createElement( 'div' );\r\n\t\t_this2.__hue_knob.className = 'hue-knob';\r\n\t\t_this2.__hue_field = document.createElement( 'div' );\r\n\t\t_this2.__hue_field.className = 'hue-field';\r\n\t\t_this2.__input = document.createElement( 'input' );\r\n\t\t_this2.__input.type = 'text';\r\n\t\t_this2.__input_textShadow = '0 1px 1px ';\r\n\t\tdom.bind( _this2.__input, 'keydown', function ( e ) {\r\n\r\n\t\t\tif ( e.keyCode === 13 ) {\r\n\r\n\t\t\t\tonBlur.call( this );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\t\tdom.bind( _this2.__input, 'blur', onBlur );\r\n\t\tdom.bind( _this2.__selector, 'mousedown', function () {\r\n\r\n\t\t\tdom.addClass( this, 'drag' ).bind( window, 'mouseup', function () {\r\n\r\n\t\t\t\tdom.removeClass( _this.__selector, 'drag' );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\t\tdom.bind( _this2.__selector, 'touchstart', function () {\r\n\r\n\t\t\tdom.addClass( this, 'drag' ).bind( window, 'touchend', function () {\r\n\r\n\t\t\t\tdom.removeClass( _this.__selector, 'drag' );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\t\tvar valueField = document.createElement( 'div' );\r\n\t\tCommon.extend( _this2.__selector.style, {\r\n\t\t\twidth: '122px',\r\n\t\t\theight: '102px',\r\n\t\t\tpadding: '3px',\r\n\t\t\tbackgroundColor: '#222',\r\n\t\t\tboxShadow: '0px 1px 3px rgba(0,0,0,0.3)'\r\n\t\t} );\r\n\t\tCommon.extend( _this2.__field_knob.style, {\r\n\t\t\tposition: 'absolute',\r\n\t\t\twidth: '12px',\r\n\t\t\theight: '12px',\r\n\t\t\tborder: _this2.__field_knob_border + ( _this2.__color.v < 0.5 ? '#fff' : '#000' ),\r\n\t\t\tboxShadow: '0px 1px 3px rgba(0,0,0,0.5)',\r\n\t\t\tborderRadius: '12px',\r\n\t\t\tzIndex: 1\r\n\t\t} );\r\n\t\tCommon.extend( _this2.__hue_knob.style, {\r\n\t\t\tposition: 'absolute',\r\n\t\t\twidth: '15px',\r\n\t\t\theight: '2px',\r\n\t\t\tborderRight: '4px solid #fff',\r\n\t\t\tzIndex: 1\r\n\t\t} );\r\n\t\tCommon.extend( _this2.__saturation_field.style, {\r\n\t\t\twidth: '100px',\r\n\t\t\theight: '100px',\r\n\t\t\tborder: '1px solid #555',\r\n\t\t\tmarginRight: '3px',\r\n\t\t\tdisplay: 'inline-block',\r\n\t\t\tcursor: 'pointer'\r\n\t\t} );\r\n\t\tCommon.extend( valueField.style, {\r\n\t\t\twidth: '100%',\r\n\t\t\theight: '100%',\r\n\t\t\tbackground: 'none'\r\n\t\t} );\r\n\t\tlinearGradient( valueField, 'top', 'rgba(0,0,0,0)', '#000' );\r\n\t\tCommon.extend( _this2.__hue_field.style, {\r\n\t\t\twidth: '15px',\r\n\t\t\theight: '100px',\r\n\t\t\tborder: '1px solid #555',\r\n\t\t\tcursor: 'ns-resize',\r\n\t\t\tposition: 'absolute',\r\n\t\t\ttop: '3px',\r\n\t\t\tright: '3px'\r\n\t\t} );\r\n\t\thueGradient( _this2.__hue_field );\r\n\t\tCommon.extend( _this2.__input.style, {\r\n\t\t\toutline: 'none',\r\n\t\t\ttextAlign: 'center',\r\n\t\t\tcolor: '#fff',\r\n\t\t\tborder: 0,\r\n\t\t\tfontWeight: 'bold',\r\n\t\t\ttextShadow: _this2.__input_textShadow + 'rgba(0,0,0,0.7)'\r\n\t\t} );\r\n\t\tdom.bind( _this2.__saturation_field, 'mousedown', fieldDown );\r\n\t\tdom.bind( _this2.__saturation_field, 'touchstart', fieldDown );\r\n\t\tdom.bind( _this2.__field_knob, 'mousedown', fieldDown );\r\n\t\tdom.bind( _this2.__field_knob, 'touchstart', fieldDown );\r\n\t\tdom.bind( _this2.__hue_field, 'mousedown', fieldDownH );\r\n\t\tdom.bind( _this2.__hue_field, 'touchstart', fieldDownH );\r\n\t\tfunction fieldDown( e ) {\r\n\r\n\t\t\tsetSV( e );\r\n\t\t\tdom.bind( window, 'mousemove', setSV );\r\n\t\t\tdom.bind( window, 'touchmove', setSV );\r\n\t\t\tdom.bind( window, 'mouseup', fieldUpSV );\r\n\t\t\tdom.bind( window, 'touchend', fieldUpSV );\r\n\r\n\t\t}\r\n\t\tfunction fieldDownH( e ) {\r\n\r\n\t\t\tsetH( e );\r\n\t\t\tdom.bind( window, 'mousemove', setH );\r\n\t\t\tdom.bind( window, 'touchmove', setH );\r\n\t\t\tdom.bind( window, 'mouseup', fieldUpH );\r\n\t\t\tdom.bind( window, 'touchend', fieldUpH );\r\n\r\n\t\t}\r\n\t\tfunction fieldUpSV() {\r\n\r\n\t\t\tdom.unbind( window, 'mousemove', setSV );\r\n\t\t\tdom.unbind( window, 'touchmove', setSV );\r\n\t\t\tdom.unbind( window, 'mouseup', fieldUpSV );\r\n\t\t\tdom.unbind( window, 'touchend', fieldUpSV );\r\n\t\t\tonFinish();\r\n\r\n\t\t}\r\n\t\tfunction fieldUpH() {\r\n\r\n\t\t\tdom.unbind( window, 'mousemove', setH );\r\n\t\t\tdom.unbind( window, 'touchmove', setH );\r\n\t\t\tdom.unbind( window, 'mouseup', fieldUpH );\r\n\t\t\tdom.unbind( window, 'touchend', fieldUpH );\r\n\t\t\tonFinish();\r\n\r\n\t\t}\r\n\t\tfunction onBlur() {\r\n\r\n\t\t\tvar i = interpret( this.value );\r\n\t\t\tif ( i !== false ) {\r\n\r\n\t\t\t\t_this.__color.__state = i;\r\n\t\t\t\t_this.setValue( _this.__color.toOriginal() );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.value = _this.__color.toString();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tfunction onFinish() {\r\n\r\n\t\t\tif ( _this.__onFinishChange ) {\r\n\r\n\t\t\t\t_this.__onFinishChange.call( _this, _this.__color.toOriginal() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t_this2.__saturation_field.appendChild( valueField );\r\n\t\t_this2.__selector.appendChild( _this2.__field_knob );\r\n\t\t_this2.__selector.appendChild( _this2.__saturation_field );\r\n\t\t_this2.__selector.appendChild( _this2.__hue_field );\r\n\t\t_this2.__hue_field.appendChild( _this2.__hue_knob );\r\n\t\t_this2.domElement.appendChild( _this2.__input );\r\n\t\t_this2.domElement.appendChild( _this2.__selector );\r\n\t\t_this2.updateDisplay();\r\n\t\tfunction setSV( e ) {\r\n\r\n\t\t\tif ( e.type.indexOf( 'touch' ) === - 1 ) {\r\n\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t}\r\n\t\t\tvar fieldRect = _this.__saturation_field.getBoundingClientRect();\r\n\t\t\tvar _ref = e.touches && e.touches[ 0 ] || e,\r\n\t\t\t\tclientX = _ref.clientX,\r\n\t\t\t\tclientY = _ref.clientY;\r\n\t\t\tvar s = ( clientX - fieldRect.left ) / ( fieldRect.right - fieldRect.left );\r\n\t\t\tvar v = 1 - ( clientY - fieldRect.top ) / ( fieldRect.bottom - fieldRect.top );\r\n\t\t\tif ( v > 1 ) {\r\n\r\n\t\t\t\tv = 1;\r\n\r\n\t\t\t} else if ( v < 0 ) {\r\n\r\n\t\t\t\tv = 0;\r\n\r\n\t\t\t}\r\n\t\t\tif ( s > 1 ) {\r\n\r\n\t\t\t\ts = 1;\r\n\r\n\t\t\t} else if ( s < 0 ) {\r\n\r\n\t\t\t\ts = 0;\r\n\r\n\t\t\t}\r\n\t\t\t_this.__color.v = v;\r\n\t\t\t_this.__color.s = s;\r\n\t\t\t_this.setValue( _this.__color.toOriginal() );\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\t\tfunction setH( e ) {\r\n\r\n\t\t\tif ( e.type.indexOf( 'touch' ) === - 1 ) {\r\n\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t}\r\n\t\t\tvar fieldRect = _this.__hue_field.getBoundingClientRect();\r\n\t\t\tvar _ref2 = e.touches && e.touches[ 0 ] || e,\r\n\t\t\t\tclientY = _ref2.clientY;\r\n\t\t\tvar h = 1 - ( clientY - fieldRect.top ) / ( fieldRect.bottom - fieldRect.top );\r\n\t\t\tif ( h > 1 ) {\r\n\r\n\t\t\t\th = 1;\r\n\r\n\t\t\t} else if ( h < 0 ) {\r\n\r\n\t\t\t\th = 0;\r\n\r\n\t\t\t}\r\n\t\t\t_this.__color.h = h * 360;\r\n\t\t\t_this.setValue( _this.__color.toOriginal() );\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\t\treturn _this2;\r\n\r\n\t}\r\n\tcreateClass( ColorController, [ {\r\n\t\tkey: 'updateDisplay',\r\n\t\tvalue: function updateDisplay() {\r\n\r\n\t\t\tvar i = interpret( this.getValue() );\r\n\t\t\tif ( i !== false ) {\r\n\r\n\t\t\t\tvar mismatch = false;\r\n\t\t\t\tCommon.each( Color.COMPONENTS, function ( component ) {\r\n\r\n\t\t\t\t\tif ( ! Common.isUndefined( i[ component ] ) && ! Common.isUndefined( this.__color.__state[ component ] ) && i[ component ] !== this.__color.__state[ component ] ) {\r\n\r\n\t\t\t\t\t\tmismatch = true;\r\n\t\t\t\t\t\treturn {};\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}, this );\r\n\t\t\t\tif ( mismatch ) {\r\n\r\n\t\t\t\t\tCommon.extend( this.__color.__state, i );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tCommon.extend( this.__temp.__state, this.__color.__state );\r\n\t\t\tthis.__temp.a = 1;\r\n\t\t\tvar flip = this.__color.v < 0.5 || this.__color.s > 0.5 ? 255 : 0;\r\n\t\t\tvar _flip = 255 - flip;\r\n\t\t\tCommon.extend( this.__field_knob.style, {\r\n\t\t\t\tmarginLeft: 100 * this.__color.s - 7 + 'px',\r\n\t\t\t\tmarginTop: 100 * ( 1 - this.__color.v ) - 7 + 'px',\r\n\t\t\t\tbackgroundColor: this.__temp.toHexString(),\r\n\t\t\t\tborder: this.__field_knob_border + 'rgb(' + flip + ',' + flip + ',' + flip + ')'\r\n\t\t\t} );\r\n\t\t\tthis.__hue_knob.style.marginTop = ( 1 - this.__color.h / 360 ) * 100 + 'px';\r\n\t\t\tthis.__temp.s = 1;\r\n\t\t\tthis.__temp.v = 1;\r\n\t\t\tlinearGradient( this.__saturation_field, 'left', '#fff', this.__temp.toHexString() );\r\n\t\t\tthis.__input.value = this.__color.toString();\r\n\t\t\tCommon.extend( this.__input.style, {\r\n\t\t\t\tbackgroundColor: this.__color.toHexString(),\r\n\t\t\t\tcolor: 'rgb(' + flip + ',' + flip + ',' + flip + ')',\r\n\t\t\t\ttextShadow: this.__input_textShadow + 'rgba(' + _flip + ',' + _flip + ',' + _flip + ',.7)'\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn ColorController;\r\n\r\n}( Controller );\r\nvar vendors = [ '-moz-', '-o-', '-webkit-', '-ms-', '' ];\r\nfunction linearGradient( elem, x, a, b ) {\r\n\r\n\telem.style.background = '';\r\n\tCommon.each( vendors, function ( vendor ) {\r\n\r\n\t\telem.style.cssText += 'background: ' + vendor + 'linear-gradient(' + x + ', ' + a + ' 0%, ' + b + ' 100%); ';\r\n\r\n\t} );\r\n\r\n}\r\nfunction hueGradient( elem ) {\r\n\r\n\telem.style.background = '';\r\n\telem.style.cssText += 'background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);';\r\n\telem.style.cssText += 'background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\r\n\telem.style.cssText += 'background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\r\n\telem.style.cssText += 'background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\r\n\telem.style.cssText += 'background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\r\n\r\n}\r\n\r\nvar css = {\r\n\tload: function load( url, indoc ) {\r\n\r\n\t\tvar doc = indoc || document;\r\n\t\tvar link = doc.createElement( 'link' );\r\n\t\tlink.type = 'text/css';\r\n\t\tlink.rel = 'stylesheet';\r\n\t\tlink.href = url;\r\n\t\tdoc.getElementsByTagName( 'head' )[ 0 ].appendChild( link );\r\n\r\n\t},\r\n\tinject: function inject( cssContent, indoc ) {\r\n\r\n\t\tvar doc = indoc || document;\r\n\t\tvar injected = document.createElement( 'style' );\r\n\t\tinjected.type = 'text/css';\r\n\t\tinjected.innerHTML = cssContent;\r\n\t\tvar head = doc.getElementsByTagName( 'head' )[ 0 ];\r\n\t\ttry {\r\n\r\n\t\t\thead.appendChild( injected );\r\n\r\n\t\t} catch ( e ) {\r\n\t\t}\r\n\r\n\t}\r\n};\r\n\r\nvar saveDialogContents = \"<div id=\\\"dg-save\\\" class=\\\"dg dialogue\\\">\\n\\n  Here's the new load parameter for your <code>GUI</code>'s constructor:\\n\\n  <textarea id=\\\"dg-new-constructor\\\"></textarea>\\n\\n  <div id=\\\"dg-save-locally\\\">\\n\\n    <input id=\\\"dg-local-storage\\\" type=\\\"checkbox\\\"/> Automatically save\\n    values to <code>localStorage</code> on exit.\\n\\n    <div id=\\\"dg-local-explain\\\">The values saved to <code>localStorage</code> will\\n      override those passed to <code>dat.GUI</code>'s constructor. This makes it\\n      easier to work incrementally, but <code>localStorage</code> is fragile,\\n      and your friends may not see the same values you do.\\n\\n    </div>\\n\\n  </div>\\n\\n</div>\";\r\n\r\nvar ControllerFactory = function ControllerFactory( object, property ) {\r\n\r\n\tvar initialValue = object[ property ];\r\n\tif ( Common.isArray( arguments[ 2 ] ) || Common.isObject( arguments[ 2 ] ) ) {\r\n\r\n\t\treturn new OptionController( object, property, arguments[ 2 ] );\r\n\r\n\t}\r\n\tif ( Common.isNumber( initialValue ) ) {\r\n\r\n\t\tif ( Common.isNumber( arguments[ 2 ] ) && Common.isNumber( arguments[ 3 ] ) ) {\r\n\r\n\t\t\tif ( Common.isNumber( arguments[ 4 ] ) ) {\r\n\r\n\t\t\t\treturn new NumberControllerSlider( object, property, arguments[ 2 ], arguments[ 3 ], arguments[ 4 ] );\r\n\r\n\t\t\t}\r\n\t\t\treturn new NumberControllerSlider( object, property, arguments[ 2 ], arguments[ 3 ] );\r\n\r\n\t\t}\r\n\t\tif ( Common.isNumber( arguments[ 4 ] ) ) {\r\n\r\n\t\t\treturn new NumberControllerBox( object, property, { min: arguments[ 2 ], max: arguments[ 3 ], step: arguments[ 4 ] } );\r\n\r\n\t\t}\r\n\t\treturn new NumberControllerBox( object, property, { min: arguments[ 2 ], max: arguments[ 3 ] } );\r\n\r\n\t}\r\n\tif ( Common.isString( initialValue ) ) {\r\n\r\n\t\treturn new StringController( object, property );\r\n\r\n\t}\r\n\tif ( Common.isFunction( initialValue ) ) {\r\n\r\n\t\treturn new FunctionController( object, property, '' );\r\n\r\n\t}\r\n\tif ( Common.isBoolean( initialValue ) ) {\r\n\r\n\t\treturn new BooleanController( object, property );\r\n\r\n\t}\r\n\treturn null;\r\n\r\n};\r\n\r\nfunction requestAnimationFrame( callback ) {\r\n\r\n\tsetTimeout( callback, 1000 / 60 );\r\n\r\n}\r\nvar requestAnimationFrame$1 = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || requestAnimationFrame;\r\n\r\nvar CenteredDiv = function () {\r\n\r\n\tfunction CenteredDiv() {\r\n\r\n\t\tclassCallCheck( this, CenteredDiv );\r\n\t\tthis.backgroundElement = document.createElement( 'div' );\r\n\t\tCommon.extend( this.backgroundElement.style, {\r\n\t\t\tbackgroundColor: 'rgba(0,0,0,0.8)',\r\n\t\t\ttop: 0,\r\n\t\t\tleft: 0,\r\n\t\t\tdisplay: 'none',\r\n\t\t\tzIndex: '1000',\r\n\t\t\topacity: 0,\r\n\t\t\tWebkitTransition: 'opacity 0.2s linear',\r\n\t\t\ttransition: 'opacity 0.2s linear'\r\n\t\t} );\r\n\t\tdom.makeFullscreen( this.backgroundElement );\r\n\t\tthis.backgroundElement.style.position = 'fixed';\r\n\t\tthis.domElement = document.createElement( 'div' );\r\n\t\tCommon.extend( this.domElement.style, {\r\n\t\t\tposition: 'fixed',\r\n\t\t\tdisplay: 'none',\r\n\t\t\tzIndex: '1001',\r\n\t\t\topacity: 0,\r\n\t\t\tWebkitTransition: '-webkit-transform 0.2s ease-out, opacity 0.2s linear',\r\n\t\t\ttransition: 'transform 0.2s ease-out, opacity 0.2s linear'\r\n\t\t} );\r\n\t\tdocument.body.appendChild( this.backgroundElement );\r\n\t\tdocument.body.appendChild( this.domElement );\r\n\t\tvar _this = this;\r\n\t\tdom.bind( this.backgroundElement, 'click', function () {\r\n\r\n\t\t\t_this.hide();\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\tcreateClass( CenteredDiv, [ {\r\n\t\tkey: 'show',\r\n\t\tvalue: function show() {\r\n\r\n\t\t\tvar _this = this;\r\n\t\t\tthis.backgroundElement.style.display = 'block';\r\n\t\t\tthis.domElement.style.display = 'block';\r\n\t\t\tthis.domElement.style.opacity = 0;\r\n\t\t\tthis.domElement.style.webkitTransform = 'scale(1.1)';\r\n\t\t\tthis.layout();\r\n\t\t\tCommon.defer( function () {\r\n\r\n\t\t\t\t_this.backgroundElement.style.opacity = 1;\r\n\t\t\t\t_this.domElement.style.opacity = 1;\r\n\t\t\t\t_this.domElement.style.webkitTransform = 'scale(1)';\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'hide',\r\n\t\tvalue: function hide() {\r\n\r\n\t\t\tvar _this = this;\r\n\t\t\tvar hide = function hide() {\r\n\r\n\t\t\t\t_this.domElement.style.display = 'none';\r\n\t\t\t\t_this.backgroundElement.style.display = 'none';\r\n\t\t\t\tdom.unbind( _this.domElement, 'webkitTransitionEnd', hide );\r\n\t\t\t\tdom.unbind( _this.domElement, 'transitionend', hide );\r\n\t\t\t\tdom.unbind( _this.domElement, 'oTransitionEnd', hide );\r\n\r\n\t\t\t};\r\n\t\t\tdom.bind( this.domElement, 'webkitTransitionEnd', hide );\r\n\t\t\tdom.bind( this.domElement, 'transitionend', hide );\r\n\t\t\tdom.bind( this.domElement, 'oTransitionEnd', hide );\r\n\t\t\tthis.backgroundElement.style.opacity = 0;\r\n\t\t\tthis.domElement.style.opacity = 0;\r\n\t\t\tthis.domElement.style.webkitTransform = 'scale(1.1)';\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'layout',\r\n\t\tvalue: function layout() {\r\n\r\n\t\t\tthis.domElement.style.left = window.innerWidth / 2 - dom.getWidth( this.domElement ) / 2 + 'px';\r\n\t\t\tthis.domElement.style.top = window.innerHeight / 2 - dom.getHeight( this.domElement ) / 2 + 'px';\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn CenteredDiv;\r\n\r\n}();\r\n\r\nvar styleSheet = ___$insertStyle( \".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\\n\" );\r\n\r\ncss.inject( styleSheet );\r\nvar CSS_NAMESPACE = 'dg';\r\nvar HIDE_KEY_CODE = 72;\r\nvar CLOSE_BUTTON_HEIGHT = 20;\r\nvar DEFAULT_DEFAULT_PRESET_NAME = 'Default';\r\nvar SUPPORTS_LOCAL_STORAGE = function () {\r\n\r\n\ttry {\r\n\r\n\t\treturn !! window.localStorage;\r\n\r\n\t} catch ( e ) {\r\n\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n}();\r\nvar SAVE_DIALOGUE = void 0;\r\nvar autoPlaceVirgin = true;\r\nvar autoPlaceContainer = void 0;\r\nvar hide = false;\r\nvar hideableGuis = [];\r\nvar GUI = function GUI( pars ) {\r\n\r\n\tvar _this = this;\r\n\tvar params = pars || {};\r\n\tthis.domElement = document.createElement( 'div' );\r\n\tthis.__ul = document.createElement( 'ul' );\r\n\tthis.domElement.appendChild( this.__ul );\r\n\tdom.addClass( this.domElement, CSS_NAMESPACE );\r\n\tthis.__folders = {};\r\n\tthis.__controllers = [];\r\n\tthis.__rememberedObjects = [];\r\n\tthis.__rememberedObjectIndecesToControllers = [];\r\n\tthis.__listening = [];\r\n\tparams = Common.defaults( params, {\r\n\t\tcloseOnTop: false,\r\n\t\tautoPlace: true,\r\n\t\twidth: GUI.DEFAULT_WIDTH\r\n\t} );\r\n\tparams = Common.defaults( params, {\r\n\t\tresizable: params.autoPlace,\r\n\t\thideable: params.autoPlace\r\n\t} );\r\n\tif ( ! Common.isUndefined( params.load ) ) {\r\n\r\n\t\tif ( params.preset ) {\r\n\r\n\t\t\tparams.load.preset = params.preset;\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\tparams.load = { preset: DEFAULT_DEFAULT_PRESET_NAME };\r\n\r\n\t}\r\n\tif ( Common.isUndefined( params.parent ) && params.hideable ) {\r\n\r\n\t\thideableGuis.push( this );\r\n\r\n\t}\r\n\tparams.resizable = Common.isUndefined( params.parent ) && params.resizable;\r\n\tif ( params.autoPlace && Common.isUndefined( params.scrollable ) ) {\r\n\r\n\t\tparams.scrollable = true;\r\n\r\n\t}\r\n\tvar useLocalStorage = SUPPORTS_LOCAL_STORAGE && localStorage.getItem( getLocalStorageHash( this, 'isLocal' ) ) === 'true';\r\n\tvar saveToLocalStorage = void 0;\r\n\tvar titleRow = void 0;\r\n\tObject.defineProperties( this,\r\n\t\t{\r\n\t\t\tparent: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.parent;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tscrollable: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.scrollable;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tautoPlace: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.autoPlace;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcloseOnTop: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.closeOnTop;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tpreset: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\tif ( _this.parent ) {\r\n\r\n\t\t\t\t\t\treturn _this.getRoot().preset;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn params.load.preset;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function set$$1( v ) {\r\n\r\n\t\t\t\t\tif ( _this.parent ) {\r\n\r\n\t\t\t\t\t\t_this.getRoot().preset = v;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tparams.load.preset = v;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsetPresetSelectIndex( this );\r\n\t\t\t\t\t_this.revert();\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\twidth: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.width;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function set$$1( v ) {\r\n\r\n\t\t\t\t\tparams.width = v;\r\n\t\t\t\t\tsetWidth( _this, v );\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tname: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.name;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function set$$1( v ) {\r\n\r\n\t\t\t\t\tparams.name = v;\r\n\t\t\t\t\tif ( titleRow ) {\r\n\r\n\t\t\t\t\t\ttitleRow.innerHTML = params.name;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclosed: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.closed;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function set$$1( v ) {\r\n\r\n\t\t\t\t\tparams.closed = v;\r\n\t\t\t\t\tif ( params.closed ) {\r\n\r\n\t\t\t\t\t\tdom.addClass( _this.__ul, GUI.CLASS_CLOSED );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tdom.removeClass( _this.__ul, GUI.CLASS_CLOSED );\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.onResize();\r\n\t\t\t\t\tif ( _this.__closeButton ) {\r\n\r\n\t\t\t\t\t\t_this.__closeButton.innerHTML = v ? GUI.TEXT_OPEN : GUI.TEXT_CLOSED;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tload: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.load;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tuseLocalStorage: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn useLocalStorage;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function set$$1( bool ) {\r\n\r\n\t\t\t\t\tif ( SUPPORTS_LOCAL_STORAGE ) {\r\n\r\n\t\t\t\t\t\tuseLocalStorage = bool;\r\n\t\t\t\t\t\tif ( bool ) {\r\n\r\n\t\t\t\t\t\t\tdom.bind( window, 'unload', saveToLocalStorage );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tdom.unbind( window, 'unload', saveToLocalStorage );\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlocalStorage.setItem( getLocalStorageHash( _this, 'isLocal' ), bool );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\tif ( Common.isUndefined( params.parent ) ) {\r\n\r\n\t\tthis.closed = params.closed || false;\r\n\t\tdom.addClass( this.domElement, GUI.CLASS_MAIN );\r\n\t\tdom.makeSelectable( this.domElement, false );\r\n\t\tif ( SUPPORTS_LOCAL_STORAGE ) {\r\n\r\n\t\t\tif ( useLocalStorage ) {\r\n\r\n\t\t\t\t_this.useLocalStorage = true;\r\n\t\t\t\tvar savedGui = localStorage.getItem( getLocalStorageHash( this, 'gui' ) );\r\n\t\t\t\tif ( savedGui ) {\r\n\r\n\t\t\t\t\tparams.load = JSON.parse( savedGui );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tthis.__closeButton = document.createElement( 'div' );\r\n\t\tthis.__closeButton.innerHTML = GUI.TEXT_CLOSED;\r\n\t\tdom.addClass( this.__closeButton, GUI.CLASS_CLOSE_BUTTON );\r\n\t\tif ( params.closeOnTop ) {\r\n\r\n\t\t\tdom.addClass( this.__closeButton, GUI.CLASS_CLOSE_TOP );\r\n\t\t\tthis.domElement.insertBefore( this.__closeButton, this.domElement.childNodes[ 0 ] );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tdom.addClass( this.__closeButton, GUI.CLASS_CLOSE_BOTTOM );\r\n\t\t\tthis.domElement.appendChild( this.__closeButton );\r\n\r\n\t\t}\r\n\t\tdom.bind( this.__closeButton, 'click', function () {\r\n\r\n\t\t\t_this.closed = ! _this.closed;\r\n\r\n\t\t} );\r\n\r\n\t} else {\r\n\r\n\t\tif ( params.closed === undefined ) {\r\n\r\n\t\t\tparams.closed = true;\r\n\r\n\t\t}\r\n\t\tvar titleRowName = document.createTextNode( params.name );\r\n\t\tdom.addClass( titleRowName, 'controller-name' );\r\n\t\ttitleRow = addRow( _this, titleRowName );\r\n\t\tvar onClickTitle = function onClickTitle( e ) {\r\n\r\n\t\t\te.preventDefault();\r\n\t\t\t_this.closed = ! _this.closed;\r\n\t\t\treturn false;\r\n\r\n\t\t};\r\n\t\tdom.addClass( this.__ul, GUI.CLASS_CLOSED );\r\n\t\tdom.addClass( titleRow, 'title' );\r\n\t\tdom.bind( titleRow, 'click', onClickTitle );\r\n\t\tif ( ! params.closed ) {\r\n\r\n\t\t\tthis.closed = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\tif ( params.autoPlace ) {\r\n\r\n\t\tif ( Common.isUndefined( params.parent ) ) {\r\n\r\n\t\t\tif ( autoPlaceVirgin ) {\r\n\r\n\t\t\t\tautoPlaceContainer = document.createElement( 'div' );\r\n\t\t\t\tdom.addClass( autoPlaceContainer, CSS_NAMESPACE );\r\n\t\t\t\tdom.addClass( autoPlaceContainer, GUI.CLASS_AUTO_PLACE_CONTAINER );\r\n\t\t\t\tdocument.body.appendChild( autoPlaceContainer );\r\n\t\t\t\tautoPlaceVirgin = false;\r\n\r\n\t\t\t}\r\n\t\t\tautoPlaceContainer.appendChild( this.domElement );\r\n\t\t\tdom.addClass( this.domElement, GUI.CLASS_AUTO_PLACE );\r\n\r\n\t\t}\r\n\t\tif ( ! this.parent ) {\r\n\r\n\t\t\tsetWidth( _this, params.width );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\tthis.__resizeHandler = function () {\r\n\r\n\t\t_this.onResizeDebounced();\r\n\r\n\t};\r\n\tdom.bind( window, 'resize', this.__resizeHandler );\r\n\tdom.bind( this.__ul, 'webkitTransitionEnd', this.__resizeHandler );\r\n\tdom.bind( this.__ul, 'transitionend', this.__resizeHandler );\r\n\tdom.bind( this.__ul, 'oTransitionEnd', this.__resizeHandler );\r\n\tthis.onResize();\r\n\tif ( params.resizable ) {\r\n\r\n\t\taddResizeHandle( this );\r\n\r\n\t}\r\n\tsaveToLocalStorage = function saveToLocalStorage() {\r\n\r\n\t\tif ( SUPPORTS_LOCAL_STORAGE && localStorage.getItem( getLocalStorageHash( _this, 'isLocal' ) ) === 'true' ) {\r\n\r\n\t\t\tlocalStorage.setItem( getLocalStorageHash( _this, 'gui' ), JSON.stringify( _this.getSaveObject() ) );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\tthis.saveToLocalStorageIfPossible = saveToLocalStorage;\r\n\tfunction resetWidth() {\r\n\r\n\t\tvar root = _this.getRoot();\r\n\t\troot.width += 1;\r\n\t\tCommon.defer( function () {\r\n\r\n\t\t\troot.width -= 1;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\tif ( ! params.parent ) {\r\n\r\n\t\tresetWidth();\r\n\r\n\t}\r\n\r\n};\r\nGUI.toggleHide = function () {\r\n\r\n\thide = ! hide;\r\n\tCommon.each( hideableGuis, function ( gui ) {\r\n\r\n\t\tgui.domElement.style.display = hide ? 'none' : '';\r\n\r\n\t} );\r\n\r\n};\r\nGUI.CLASS_AUTO_PLACE = 'a';\r\nGUI.CLASS_AUTO_PLACE_CONTAINER = 'ac';\r\nGUI.CLASS_MAIN = 'main';\r\nGUI.CLASS_CONTROLLER_ROW = 'cr';\r\nGUI.CLASS_TOO_TALL = 'taller-than-window';\r\nGUI.CLASS_CLOSED = 'closed';\r\nGUI.CLASS_CLOSE_BUTTON = 'close-button';\r\nGUI.CLASS_CLOSE_TOP = 'close-top';\r\nGUI.CLASS_CLOSE_BOTTOM = 'close-bottom';\r\nGUI.CLASS_DRAG = 'drag';\r\nGUI.DEFAULT_WIDTH = 245;\r\nGUI.TEXT_CLOSED = 'Close Controls';\r\nGUI.TEXT_OPEN = 'Open Controls';\r\nGUI._keydownHandler = function ( e ) {\r\n\r\n\tif ( document.activeElement.type !== 'text' && ( e.which === HIDE_KEY_CODE || e.keyCode === HIDE_KEY_CODE ) ) {\r\n\r\n\t\tGUI.toggleHide();\r\n\r\n\t}\r\n\r\n};\r\ndom.bind( window, 'keydown', GUI._keydownHandler, false );\r\nCommon.extend( GUI.prototype,\r\n\t{\r\n\t\tadd: function add( object, property ) {\r\n\r\n\t\t\treturn _add( this, object, property, {\r\n\t\t\t\tfactoryArgs: Array.prototype.slice.call( arguments, 2 )\r\n\t\t\t} );\r\n\r\n\t\t},\r\n\t\taddColor: function addColor( object, property ) {\r\n\r\n\t\t\treturn _add( this, object, property, {\r\n\t\t\t\tcolor: true\r\n\t\t\t} );\r\n\r\n\t\t},\r\n\t\tremove: function remove( controller ) {\r\n\r\n\t\t\tthis.__ul.removeChild( controller.__li );\r\n\t\t\tthis.__controllers.splice( this.__controllers.indexOf( controller ), 1 );\r\n\t\t\tvar _this = this;\r\n\t\t\tCommon.defer( function () {\r\n\r\n\t\t\t\t_this.onResize();\r\n\r\n\t\t\t} );\r\n\r\n\t\t},\r\n\t\tdestroy: function destroy() {\r\n\r\n\t\t\tif ( this.parent ) {\r\n\r\n\t\t\t\tthrow new Error( 'Only the root GUI should be removed with .destroy(). ' + 'For subfolders, use gui.removeFolder(folder) instead.' );\r\n\r\n\t\t\t}\r\n\t\t\tif ( this.autoPlace ) {\r\n\r\n\t\t\t\tautoPlaceContainer.removeChild( this.domElement );\r\n\r\n\t\t\t}\r\n\t\t\tvar _this = this;\r\n\t\t\tCommon.each( this.__folders, function ( subfolder ) {\r\n\r\n\t\t\t\t_this.removeFolder( subfolder );\r\n\r\n\t\t\t} );\r\n\t\t\tdom.unbind( window, 'keydown', GUI._keydownHandler, false );\r\n\t\t\tremoveListeners( this );\r\n\r\n\t\t},\r\n\t\taddFolder: function addFolder( name ) {\r\n\r\n\t\t\tif ( this.__folders[ name ] !== undefined ) {\r\n\r\n\t\t\t\tthrow new Error( 'You already have a folder in this GUI by the' + ' name \"' + name + '\"' );\r\n\r\n\t\t\t}\r\n\t\t\tvar newGuiParams = { name: name, parent: this };\r\n\t\t\tnewGuiParams.autoPlace = this.autoPlace;\r\n\t\t\tif ( this.load &&\r\n    this.load.folders &&\r\n    this.load.folders[ name ] ) {\r\n\r\n\t\t\t\tnewGuiParams.closed = this.load.folders[ name ].closed;\r\n\t\t\t\tnewGuiParams.load = this.load.folders[ name ];\r\n\r\n\t\t\t}\r\n\t\t\tvar gui = new GUI( newGuiParams );\r\n\t\t\tthis.__folders[ name ] = gui;\r\n\t\t\tvar li = addRow( this, gui.domElement );\r\n\t\t\tdom.addClass( li, 'folder' );\r\n\t\t\treturn gui;\r\n\r\n\t\t},\r\n\t\tremoveFolder: function removeFolder( folder ) {\r\n\r\n\t\t\tthis.__ul.removeChild( folder.domElement.parentElement );\r\n\t\t\tdelete this.__folders[ folder.name ];\r\n\t\t\tif ( this.load &&\r\n    this.load.folders &&\r\n    this.load.folders[ folder.name ] ) {\r\n\r\n\t\t\t\tdelete this.load.folders[ folder.name ];\r\n\r\n\t\t\t}\r\n\t\t\tremoveListeners( folder );\r\n\t\t\tvar _this = this;\r\n\t\t\tCommon.each( folder.__folders, function ( subfolder ) {\r\n\r\n\t\t\t\tfolder.removeFolder( subfolder );\r\n\r\n\t\t\t} );\r\n\t\t\tCommon.defer( function () {\r\n\r\n\t\t\t\t_this.onResize();\r\n\r\n\t\t\t} );\r\n\r\n\t\t},\r\n\t\topen: function open() {\r\n\r\n\t\t\tthis.closed = false;\r\n\r\n\t\t},\r\n\t\tclose: function close() {\r\n\r\n\t\t\tthis.closed = true;\r\n\r\n\t\t},\r\n\t\thide: function hide() {\r\n\r\n\t\t\tthis.domElement.style.display = 'none';\r\n\r\n\t\t},\r\n\t\tshow: function show() {\r\n\r\n\t\t\tthis.domElement.style.display = '';\r\n\r\n\t\t},\r\n\t\tonResize: function onResize() {\r\n\r\n\t\t\tvar root = this.getRoot();\r\n\t\t\tif ( root.scrollable ) {\r\n\r\n\t\t\t\tvar top = dom.getOffset( root.__ul ).top;\r\n\t\t\t\tvar h = 0;\r\n\t\t\t\tCommon.each( root.__ul.childNodes, function ( node ) {\r\n\r\n\t\t\t\t\tif ( ! ( root.autoPlace && node === root.__save_row ) ) {\r\n\r\n\t\t\t\t\t\th += dom.getHeight( node );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\t\t\t\tif ( window.innerHeight - top - CLOSE_BUTTON_HEIGHT < h ) {\r\n\r\n\t\t\t\t\tdom.addClass( root.domElement, GUI.CLASS_TOO_TALL );\r\n\t\t\t\t\troot.__ul.style.height = window.innerHeight - top - CLOSE_BUTTON_HEIGHT + 'px';\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tdom.removeClass( root.domElement, GUI.CLASS_TOO_TALL );\r\n\t\t\t\t\troot.__ul.style.height = 'auto';\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tif ( root.__resize_handle ) {\r\n\r\n\t\t\t\tCommon.defer( function () {\r\n\r\n\t\t\t\t\troot.__resize_handle.style.height = root.__ul.offsetHeight + 'px';\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\t\t\tif ( root.__closeButton ) {\r\n\r\n\t\t\t\troot.__closeButton.style.width = root.width + 'px';\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tonResizeDebounced: Common.debounce( function () {\r\n\r\n\t\t\tthis.onResize();\r\n\r\n\t\t}, 50 ),\r\n\t\tremember: function remember() {\r\n\r\n\t\t\tif ( Common.isUndefined( SAVE_DIALOGUE ) ) {\r\n\r\n\t\t\t\tSAVE_DIALOGUE = new CenteredDiv();\r\n\t\t\t\tSAVE_DIALOGUE.domElement.innerHTML = saveDialogContents;\r\n\r\n\t\t\t}\r\n\t\t\tif ( this.parent ) {\r\n\r\n\t\t\t\tthrow new Error( 'You can only call remember on a top level GUI.' );\r\n\r\n\t\t\t}\r\n\t\t\tvar _this = this;\r\n\t\t\tCommon.each( Array.prototype.slice.call( arguments ), function ( object ) {\r\n\r\n\t\t\t\tif ( _this.__rememberedObjects.length === 0 ) {\r\n\r\n\t\t\t\t\taddSaveMenu( _this );\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif ( _this.__rememberedObjects.indexOf( object ) === - 1 ) {\r\n\r\n\t\t\t\t\t_this.__rememberedObjects.push( object );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\t\t\tif ( this.autoPlace ) {\r\n\r\n\t\t\t\tsetWidth( this, this.width );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tgetRoot: function getRoot() {\r\n\r\n\t\t\tvar gui = this;\r\n\t\t\twhile ( gui.parent ) {\r\n\r\n\t\t\t\tgui = gui.parent;\r\n\r\n\t\t\t}\r\n\t\t\treturn gui;\r\n\r\n\t\t},\r\n\t\tgetSaveObject: function getSaveObject() {\r\n\r\n\t\t\tvar toReturn = this.load;\r\n\t\t\ttoReturn.closed = this.closed;\r\n\t\t\tif ( this.__rememberedObjects.length > 0 ) {\r\n\r\n\t\t\t\ttoReturn.preset = this.preset;\r\n\t\t\t\tif ( ! toReturn.remembered ) {\r\n\r\n\t\t\t\t\ttoReturn.remembered = {};\r\n\r\n\t\t\t\t}\r\n\t\t\t\ttoReturn.remembered[ this.preset ] = getCurrentPreset( this );\r\n\r\n\t\t\t}\r\n\t\t\ttoReturn.folders = {};\r\n\t\t\tCommon.each( this.__folders, function ( element, key ) {\r\n\r\n\t\t\t\ttoReturn.folders[ key ] = element.getSaveObject();\r\n\r\n\t\t\t} );\r\n\t\t\treturn toReturn;\r\n\r\n\t\t},\r\n\t\tsave: function save() {\r\n\r\n\t\t\tif ( ! this.load.remembered ) {\r\n\r\n\t\t\t\tthis.load.remembered = {};\r\n\r\n\t\t\t}\r\n\t\t\tthis.load.remembered[ this.preset ] = getCurrentPreset( this );\r\n\t\t\tmarkPresetModified( this, false );\r\n\t\t\tthis.saveToLocalStorageIfPossible();\r\n\r\n\t\t},\r\n\t\tsaveAs: function saveAs( presetName ) {\r\n\r\n\t\t\tif ( ! this.load.remembered ) {\r\n\r\n\t\t\t\tthis.load.remembered = {};\r\n\t\t\t\tthis.load.remembered[ DEFAULT_DEFAULT_PRESET_NAME ] = getCurrentPreset( this, true );\r\n\r\n\t\t\t}\r\n\t\t\tthis.load.remembered[ presetName ] = getCurrentPreset( this );\r\n\t\t\tthis.preset = presetName;\r\n\t\t\taddPresetOption( this, presetName, true );\r\n\t\t\tthis.saveToLocalStorageIfPossible();\r\n\r\n\t\t},\r\n\t\trevert: function revert( gui ) {\r\n\r\n\t\t\tCommon.each( this.__controllers, function ( controller ) {\r\n\r\n\t\t\t\tif ( ! this.getRoot().load.remembered ) {\r\n\r\n\t\t\t\t\tcontroller.setValue( controller.initialValue );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\trecallSavedValue( gui || this.getRoot(), controller );\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif ( controller.__onFinishChange ) {\r\n\r\n\t\t\t\t\tcontroller.__onFinishChange.call( controller, controller.getValue() );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}, this );\r\n\t\t\tCommon.each( this.__folders, function ( folder ) {\r\n\r\n\t\t\t\tfolder.revert( folder );\r\n\r\n\t\t\t} );\r\n\t\t\tif ( ! gui ) {\r\n\r\n\t\t\t\tmarkPresetModified( this.getRoot(), false );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tlisten: function listen( controller ) {\r\n\r\n\t\t\tvar init = this.__listening.length === 0;\r\n\t\t\tthis.__listening.push( controller );\r\n\t\t\tif ( init ) {\r\n\r\n\t\t\t\tupdateDisplays( this.__listening );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tupdateDisplay: function updateDisplay() {\r\n\r\n\t\t\tCommon.each( this.__controllers, function ( controller ) {\r\n\r\n\t\t\t\tcontroller.updateDisplay();\r\n\r\n\t\t\t} );\r\n\t\t\tCommon.each( this.__folders, function ( folder ) {\r\n\r\n\t\t\t\tfolder.updateDisplay();\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\t} );\r\nfunction addRow( gui, newDom, liBefore ) {\r\n\r\n\tvar li = document.createElement( 'li' );\r\n\tif ( newDom ) {\r\n\r\n\t\tli.appendChild( newDom );\r\n\r\n\t}\r\n\tif ( liBefore ) {\r\n\r\n\t\tgui.__ul.insertBefore( li, liBefore );\r\n\r\n\t} else {\r\n\r\n\t\tgui.__ul.appendChild( li );\r\n\r\n\t}\r\n\tgui.onResize();\r\n\treturn li;\r\n\r\n}\r\nfunction removeListeners( gui ) {\r\n\r\n\tdom.unbind( window, 'resize', gui.__resizeHandler );\r\n\tif ( gui.saveToLocalStorageIfPossible ) {\r\n\r\n\t\tdom.unbind( window, 'unload', gui.saveToLocalStorageIfPossible );\r\n\r\n\t}\r\n\r\n}\r\nfunction markPresetModified( gui, modified ) {\r\n\r\n\tvar opt = gui.__preset_select[ gui.__preset_select.selectedIndex ];\r\n\tif ( modified ) {\r\n\r\n\t\topt.innerHTML = opt.value + '*';\r\n\r\n\t} else {\r\n\r\n\t\topt.innerHTML = opt.value;\r\n\r\n\t}\r\n\r\n}\r\nfunction augmentController( gui, li, controller ) {\r\n\r\n\tcontroller.__li = li;\r\n\tcontroller.__gui = gui;\r\n\tCommon.extend( controller, {\r\n\t\toptions: function options( _options ) {\r\n\r\n\t\t\tif ( arguments.length > 1 ) {\r\n\r\n\t\t\t\tvar nextSibling = controller.__li.nextElementSibling;\r\n\t\t\t\tcontroller.remove();\r\n\t\t\t\treturn _add( gui, controller.object, controller.property, {\r\n\t\t\t\t\tbefore: nextSibling,\r\n\t\t\t\t\tfactoryArgs: [ Common.toArray( arguments ) ]\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\t\t\tif ( Common.isArray( _options ) || Common.isObject( _options ) ) {\r\n\r\n\t\t\t\tvar _nextSibling = controller.__li.nextElementSibling;\r\n\t\t\t\tcontroller.remove();\r\n\t\t\t\treturn _add( gui, controller.object, controller.property, {\r\n\t\t\t\t\tbefore: _nextSibling,\r\n\t\t\t\t\tfactoryArgs: [ _options ]\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tname: function name( _name ) {\r\n\r\n\t\t\tcontroller.__li.firstElementChild.firstElementChild.innerHTML = _name;\r\n\t\t\treturn controller;\r\n\r\n\t\t},\r\n\t\tlisten: function listen() {\r\n\r\n\t\t\tcontroller.__gui.listen( controller );\r\n\t\t\treturn controller;\r\n\r\n\t\t},\r\n\t\tremove: function remove() {\r\n\r\n\t\t\tcontroller.__gui.remove( controller );\r\n\t\t\treturn controller;\r\n\r\n\t\t}\r\n\t} );\r\n\tif ( controller instanceof NumberControllerSlider ) {\r\n\r\n\t\tvar box = new NumberControllerBox( controller.object, controller.property, { min: controller.__min, max: controller.__max, step: controller.__step } );\r\n\t\tCommon.each( [ 'updateDisplay', 'onChange', 'onFinishChange', 'step', 'min', 'max' ], function ( method ) {\r\n\r\n\t\t\tvar pc = controller[ method ];\r\n\t\t\tvar pb = box[ method ];\r\n\t\t\tcontroller[ method ] = box[ method ] = function () {\r\n\r\n\t\t\t\tvar args = Array.prototype.slice.call( arguments );\r\n\t\t\t\tpb.apply( box, args );\r\n\t\t\t\treturn pc.apply( controller, args );\r\n\r\n\t\t\t};\r\n\r\n\t\t} );\r\n\t\tdom.addClass( li, 'has-slider' );\r\n\t\tcontroller.domElement.insertBefore( box.domElement, controller.domElement.firstElementChild );\r\n\r\n\t} else if ( controller instanceof NumberControllerBox ) {\r\n\r\n\t\tvar r = function r( returned ) {\r\n\r\n\t\t\tif ( Common.isNumber( controller.__min ) && Common.isNumber( controller.__max ) ) {\r\n\r\n\t\t\t\tvar oldName = controller.__li.firstElementChild.firstElementChild.innerHTML;\r\n\t\t\t\tvar wasListening = controller.__gui.__listening.indexOf( controller ) > - 1;\r\n\t\t\t\tcontroller.remove();\r\n\t\t\t\tvar newController = _add( gui, controller.object, controller.property, {\r\n\t\t\t\t\tbefore: controller.__li.nextElementSibling,\r\n\t\t\t\t\tfactoryArgs: [ controller.__min, controller.__max, controller.__step ]\r\n\t\t\t\t} );\r\n\t\t\t\tnewController.name( oldName );\r\n\t\t\t\tif ( wasListening ) newController.listen();\r\n\t\t\t\treturn newController;\r\n\r\n\t\t\t}\r\n\t\t\treturn returned;\r\n\r\n\t\t};\r\n\t\tcontroller.min = Common.compose( r, controller.min );\r\n\t\tcontroller.max = Common.compose( r, controller.max );\r\n\r\n\t} else if ( controller instanceof BooleanController ) {\r\n\r\n\t\tdom.bind( li, 'click', function () {\r\n\r\n\t\t\tdom.fakeEvent( controller.__checkbox, 'click' );\r\n\r\n\t\t} );\r\n\t\tdom.bind( controller.__checkbox, 'click', function ( e ) {\r\n\r\n\t\t\te.stopPropagation();\r\n\r\n\t\t} );\r\n\r\n\t} else if ( controller instanceof FunctionController ) {\r\n\r\n\t\tdom.bind( li, 'click', function () {\r\n\r\n\t\t\tdom.fakeEvent( controller.__button, 'click' );\r\n\r\n\t\t} );\r\n\t\tdom.bind( li, 'mouseover', function () {\r\n\r\n\t\t\tdom.addClass( controller.__button, 'hover' );\r\n\r\n\t\t} );\r\n\t\tdom.bind( li, 'mouseout', function () {\r\n\r\n\t\t\tdom.removeClass( controller.__button, 'hover' );\r\n\r\n\t\t} );\r\n\r\n\t} else if ( controller instanceof ColorController ) {\r\n\r\n\t\tdom.addClass( li, 'color' );\r\n\t\tcontroller.updateDisplay = Common.compose( function ( val ) {\r\n\r\n\t\t\tli.style.borderLeftColor = controller.__color.toString();\r\n\t\t\treturn val;\r\n\r\n\t\t}, controller.updateDisplay );\r\n\t\tcontroller.updateDisplay();\r\n\r\n\t}\r\n\tcontroller.setValue = Common.compose( function ( val ) {\r\n\r\n\t\tif ( gui.getRoot().__preset_select && controller.isModified() ) {\r\n\r\n\t\t\tmarkPresetModified( gui.getRoot(), true );\r\n\r\n\t\t}\r\n\t\treturn val;\r\n\r\n\t}, controller.setValue );\r\n\r\n}\r\nfunction recallSavedValue( gui, controller ) {\r\n\r\n\tvar root = gui.getRoot();\r\n\tvar matchedIndex = root.__rememberedObjects.indexOf( controller.object );\r\n\tif ( matchedIndex !== - 1 ) {\r\n\r\n\t\tvar controllerMap = root.__rememberedObjectIndecesToControllers[ matchedIndex ];\r\n\t\tif ( controllerMap === undefined ) {\r\n\r\n\t\t\tcontrollerMap = {};\r\n\t\t\troot.__rememberedObjectIndecesToControllers[ matchedIndex ] = controllerMap;\r\n\r\n\t\t}\r\n\t\tcontrollerMap[ controller.property ] = controller;\r\n\t\tif ( root.load && root.load.remembered ) {\r\n\r\n\t\t\tvar presetMap = root.load.remembered;\r\n\t\t\tvar preset = void 0;\r\n\t\t\tif ( presetMap[ gui.preset ] ) {\r\n\r\n\t\t\t\tpreset = presetMap[ gui.preset ];\r\n\r\n\t\t\t} else if ( presetMap[ DEFAULT_DEFAULT_PRESET_NAME ] ) {\r\n\r\n\t\t\t\tpreset = presetMap[ DEFAULT_DEFAULT_PRESET_NAME ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\t\t\tif ( preset[ matchedIndex ] && preset[ matchedIndex ][ controller.property ] !== undefined ) {\r\n\r\n\t\t\t\tvar value = preset[ matchedIndex ][ controller.property ];\r\n\t\t\t\tcontroller.initialValue = value;\r\n\t\t\t\tcontroller.setValue( value );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\nfunction _add( gui, object, property, params ) {\r\n\r\n\tif ( object[ property ] === undefined ) {\r\n\r\n\t\tthrow new Error( 'Object \"' + object + '\" has no property \"' + property + '\"' );\r\n\r\n\t}\r\n\tvar controller = void 0;\r\n\tif ( params.color ) {\r\n\r\n\t\tcontroller = new ColorController( object, property );\r\n\r\n\t} else {\r\n\r\n\t\tvar factoryArgs = [ object, property ].concat( params.factoryArgs );\r\n\t\tcontroller = ControllerFactory.apply( gui, factoryArgs );\r\n\r\n\t}\r\n\tif ( params.before instanceof Controller ) {\r\n\r\n\t\tparams.before = params.before.__li;\r\n\r\n\t}\r\n\trecallSavedValue( gui, controller );\r\n\tdom.addClass( controller.domElement, 'c' );\r\n\tvar name = document.createElement( 'span' );\r\n\tdom.addClass( name, 'property-name' );\r\n\tname.innerHTML = controller.property;\r\n\tvar container = document.createElement( 'div' );\r\n\tcontainer.appendChild( name );\r\n\tcontainer.appendChild( controller.domElement );\r\n\tvar li = addRow( gui, container, params.before );\r\n\tdom.addClass( li, GUI.CLASS_CONTROLLER_ROW );\r\n\tif ( controller instanceof ColorController ) {\r\n\r\n\t\tdom.addClass( li, 'color' );\r\n\r\n\t} else {\r\n\r\n\t\tdom.addClass( li, _typeof( controller.getValue() ) );\r\n\r\n\t}\r\n\taugmentController( gui, li, controller );\r\n\tgui.__controllers.push( controller );\r\n\treturn controller;\r\n\r\n}\r\nfunction getLocalStorageHash( gui, key ) {\r\n\r\n\treturn document.location.href + '.' + key;\r\n\r\n}\r\nfunction addPresetOption( gui, name, setSelected ) {\r\n\r\n\tvar opt = document.createElement( 'option' );\r\n\topt.innerHTML = name;\r\n\topt.value = name;\r\n\tgui.__preset_select.appendChild( opt );\r\n\tif ( setSelected ) {\r\n\r\n\t\tgui.__preset_select.selectedIndex = gui.__preset_select.length - 1;\r\n\r\n\t}\r\n\r\n}\r\nfunction showHideExplain( gui, explain ) {\r\n\r\n\texplain.style.display = gui.useLocalStorage ? 'block' : 'none';\r\n\r\n}\r\nfunction addSaveMenu( gui ) {\r\n\r\n\tvar div = gui.__save_row = document.createElement( 'li' );\r\n\tdom.addClass( gui.domElement, 'has-save' );\r\n\tgui.__ul.insertBefore( div, gui.__ul.firstChild );\r\n\tdom.addClass( div, 'save-row' );\r\n\tvar gears = document.createElement( 'span' );\r\n\tgears.innerHTML = '&nbsp;';\r\n\tdom.addClass( gears, 'button gears' );\r\n\tvar button = document.createElement( 'span' );\r\n\tbutton.innerHTML = 'Save';\r\n\tdom.addClass( button, 'button' );\r\n\tdom.addClass( button, 'save' );\r\n\tvar button2 = document.createElement( 'span' );\r\n\tbutton2.innerHTML = 'New';\r\n\tdom.addClass( button2, 'button' );\r\n\tdom.addClass( button2, 'save-as' );\r\n\tvar button3 = document.createElement( 'span' );\r\n\tbutton3.innerHTML = 'Revert';\r\n\tdom.addClass( button3, 'button' );\r\n\tdom.addClass( button3, 'revert' );\r\n\tvar select = gui.__preset_select = document.createElement( 'select' );\r\n\tif ( gui.load && gui.load.remembered ) {\r\n\r\n\t\tCommon.each( gui.load.remembered, function ( value, key ) {\r\n\r\n\t\t\taddPresetOption( gui, key, key === gui.preset );\r\n\r\n\t\t} );\r\n\r\n\t} else {\r\n\r\n\t\taddPresetOption( gui, DEFAULT_DEFAULT_PRESET_NAME, false );\r\n\r\n\t}\r\n\tdom.bind( select, 'change', function () {\r\n\r\n\t\tfor ( var index = 0; index < gui.__preset_select.length; index ++ ) {\r\n\r\n\t\t\tgui.__preset_select[ index ].innerHTML = gui.__preset_select[ index ].value;\r\n\r\n\t\t}\r\n\t\tgui.preset = this.value;\r\n\r\n\t} );\r\n\tdiv.appendChild( select );\r\n\tdiv.appendChild( gears );\r\n\tdiv.appendChild( button );\r\n\tdiv.appendChild( button2 );\r\n\tdiv.appendChild( button3 );\r\n\tif ( SUPPORTS_LOCAL_STORAGE ) {\r\n\r\n\t\tvar explain = document.getElementById( 'dg-local-explain' );\r\n\t\tvar localStorageCheckBox = document.getElementById( 'dg-local-storage' );\r\n\t\tvar saveLocally = document.getElementById( 'dg-save-locally' );\r\n\t\tsaveLocally.style.display = 'block';\r\n\t\tif ( localStorage.getItem( getLocalStorageHash( gui, 'isLocal' ) ) === 'true' ) {\r\n\r\n\t\t\tlocalStorageCheckBox.setAttribute( 'checked', 'checked' );\r\n\r\n\t\t}\r\n\t\tshowHideExplain( gui, explain );\r\n\t\tdom.bind( localStorageCheckBox, 'change', function () {\r\n\r\n\t\t\tgui.useLocalStorage = ! gui.useLocalStorage;\r\n\t\t\tshowHideExplain( gui, explain );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\tvar newConstructorTextArea = document.getElementById( 'dg-new-constructor' );\r\n\tdom.bind( newConstructorTextArea, 'keydown', function ( e ) {\r\n\r\n\t\tif ( e.metaKey && ( e.which === 67 || e.keyCode === 67 ) ) {\r\n\r\n\t\t\tSAVE_DIALOGUE.hide();\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\tdom.bind( gears, 'click', function () {\r\n\r\n\t\tnewConstructorTextArea.innerHTML = JSON.stringify( gui.getSaveObject(), undefined, 2 );\r\n\t\tSAVE_DIALOGUE.show();\r\n\t\tnewConstructorTextArea.focus();\r\n\t\tnewConstructorTextArea.select();\r\n\r\n\t} );\r\n\tdom.bind( button, 'click', function () {\r\n\r\n\t\tgui.save();\r\n\r\n\t} );\r\n\tdom.bind( button2, 'click', function () {\r\n\r\n\t\tvar presetName = prompt( 'Enter a new preset name.' );\r\n\t\tif ( presetName ) {\r\n\r\n\t\t\tgui.saveAs( presetName );\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\tdom.bind( button3, 'click', function () {\r\n\r\n\t\tgui.revert();\r\n\r\n\t} );\r\n\r\n}\r\nfunction addResizeHandle( gui ) {\r\n\r\n\tvar pmouseX = void 0;\r\n\tgui.__resize_handle = document.createElement( 'div' );\r\n\tCommon.extend( gui.__resize_handle.style, {\r\n\t\twidth: '6px',\r\n\t\tmarginLeft: '-3px',\r\n\t\theight: '200px',\r\n\t\tcursor: 'ew-resize',\r\n\t\tposition: 'absolute'\r\n\t} );\r\n\tfunction drag( e ) {\r\n\r\n\t\te.preventDefault();\r\n\t\tgui.width += pmouseX - e.clientX;\r\n\t\tgui.onResize();\r\n\t\tpmouseX = e.clientX;\r\n\t\treturn false;\r\n\r\n\t}\r\n\tfunction dragStop() {\r\n\r\n\t\tdom.removeClass( gui.__closeButton, GUI.CLASS_DRAG );\r\n\t\tdom.unbind( window, 'mousemove', drag );\r\n\t\tdom.unbind( window, 'mouseup', dragStop );\r\n\r\n\t}\r\n\tfunction dragStart( e ) {\r\n\r\n\t\te.preventDefault();\r\n\t\tpmouseX = e.clientX;\r\n\t\tdom.addClass( gui.__closeButton, GUI.CLASS_DRAG );\r\n\t\tdom.bind( window, 'mousemove', drag );\r\n\t\tdom.bind( window, 'mouseup', dragStop );\r\n\t\treturn false;\r\n\r\n\t}\r\n\tdom.bind( gui.__resize_handle, 'mousedown', dragStart );\r\n\tdom.bind( gui.__closeButton, 'mousedown', dragStart );\r\n\tgui.domElement.insertBefore( gui.__resize_handle, gui.domElement.firstElementChild );\r\n\r\n}\r\nfunction setWidth( gui, w ) {\r\n\r\n\tgui.domElement.style.width = w + 'px';\r\n\tif ( gui.__save_row && gui.autoPlace ) {\r\n\r\n\t\tgui.__save_row.style.width = w + 'px';\r\n\r\n\t}\r\n\tif ( gui.__closeButton ) {\r\n\r\n\t\tgui.__closeButton.style.width = w + 'px';\r\n\r\n\t}\r\n\r\n}\r\nfunction getCurrentPreset( gui, useInitialValues ) {\r\n\r\n\tvar toReturn = {};\r\n\tCommon.each( gui.__rememberedObjects, function ( val, index ) {\r\n\r\n\t\tvar savedValues = {};\r\n\t\tvar controllerMap = gui.__rememberedObjectIndecesToControllers[ index ];\r\n\t\tCommon.each( controllerMap, function ( controller, property ) {\r\n\r\n\t\t\tsavedValues[ property ] = useInitialValues ? controller.initialValue : controller.getValue();\r\n\r\n\t\t} );\r\n\t\ttoReturn[ index ] = savedValues;\r\n\r\n\t} );\r\n\treturn toReturn;\r\n\r\n}\r\nfunction setPresetSelectIndex( gui ) {\r\n\r\n\tfor ( var index = 0; index < gui.__preset_select.length; index ++ ) {\r\n\r\n\t\tif ( gui.__preset_select[ index ].value === gui.preset ) {\r\n\r\n\t\t\tgui.__preset_select.selectedIndex = index;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\nfunction updateDisplays( controllerArray ) {\r\n\r\n\tif ( controllerArray.length !== 0 ) {\r\n\r\n\t\trequestAnimationFrame$1.call( window, function () {\r\n\r\n\t\t\tupdateDisplays( controllerArray );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\tCommon.each( controllerArray, function ( c ) {\r\n\r\n\t\tc.updateDisplay();\r\n\r\n\t} );\r\n\r\n}\r\n\r\nvar color = {\r\n\tColor: Color,\r\n\tmath: ColorMath,\r\n\tinterpret: interpret\r\n};\r\nvar controllers = {\r\n\tController: Controller,\r\n\tBooleanController: BooleanController,\r\n\tOptionController: OptionController,\r\n\tStringController: StringController,\r\n\tNumberController: NumberController,\r\n\tNumberControllerBox: NumberControllerBox,\r\n\tNumberControllerSlider: NumberControllerSlider,\r\n\tFunctionController: FunctionController,\r\n\tColorController: ColorController\r\n};\r\nvar dom$1 = { dom: dom };\r\nvar gui = { GUI: GUI };\r\nvar GUI$1 = GUI;\r\nvar index = {\r\n\tcolor: color,\r\n\tcontrollers: controllers,\r\n\tdom: dom$1,\r\n\tgui: gui,\r\n\tGUI: GUI$1\r\n};\r\n\r\nexport { color, controllers, dom$1 as dom, gui, GUI$1 as GUI };\r\nexport default index;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/libs/dat.gui.module.js","import {\r\n\tAnimationClip,\r\n\tBone,\r\n\tBox3,\r\n\tBufferAttribute,\r\n\tBufferGeometry,\r\n\tCanvasTexture,\r\n\tClampToEdgeWrapping,\r\n\tColor,\r\n\tDirectionalLight,\r\n\tDoubleSide,\r\n\tFileLoader,\r\n\tFrontSide,\r\n\tGroup,\r\n\tImageBitmapLoader,\r\n\tInterleavedBuffer,\r\n\tInterleavedBufferAttribute,\r\n\tInterpolant,\r\n\tInterpolateDiscrete,\r\n\tInterpolateLinear,\r\n\tLine,\r\n\tLineBasicMaterial,\r\n\tLineLoop,\r\n\tLineSegments,\r\n\tLinearFilter,\r\n\tLinearMipmapLinearFilter,\r\n\tLinearMipmapNearestFilter,\r\n\tLoader,\r\n\tLoaderUtils,\r\n\tMaterial,\r\n\tMathUtils,\r\n\tMatrix4,\r\n\tMesh,\r\n\tMeshBasicMaterial,\r\n\tMeshPhysicalMaterial,\r\n\tMeshStandardMaterial,\r\n\tMirroredRepeatWrapping,\r\n\tNearestFilter,\r\n\tNearestMipmapLinearFilter,\r\n\tNearestMipmapNearestFilter,\r\n\tNumberKeyframeTrack,\r\n\tObject3D,\r\n\tOrthographicCamera,\r\n\tPerspectiveCamera,\r\n\tPointLight,\r\n\tPoints,\r\n\tPointsMaterial,\r\n\tPropertyBinding,\r\n\tQuaternionKeyframeTrack,\r\n\tRGBFormat,\r\n\tRepeatWrapping,\r\n\tSkeleton,\r\n\tSkinnedMesh,\r\n\tSphere,\r\n\tSpotLight,\r\n\tTangentSpaceNormalMap,\r\n\tTextureLoader,\r\n\tTriangleFanDrawMode,\r\n\tTriangleStripDrawMode,\r\n\tVector2,\r\n\tVector3,\r\n\tVectorKeyframeTrack,\r\n\tsRGBEncoding\r\n} from \"@/components/build/three.module.js\";\r\n\r\nvar GLTFLoader = ( function () {\r\n\r\n\tfunction GLTFLoader( manager ) {\r\n\r\n\t\tLoader.call( this, manager );\r\n\r\n\t\tthis.dracoLoader = null;\r\n\t\tthis.ddsLoader = null;\r\n\t\tthis.ktx2Loader = null;\r\n\t\tthis.meshoptDecoder = null;\r\n\r\n\t\tthis.pluginCallbacks = [];\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFMaterialsClearcoatExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFTextureBasisUExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFTextureWebPExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFMaterialsTransmissionExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFLightsExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFMeshoptCompression( parser );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tGLTFLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\t\tconstructor: GLTFLoader,\r\n\r\n\t\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\t\tvar scope = this;\r\n\r\n\t\t\tvar resourcePath;\r\n\r\n\t\t\tif ( this.resourcePath !== '' ) {\r\n\r\n\t\t\t\tresourcePath = this.resourcePath;\r\n\r\n\t\t\t} else if ( this.path !== '' ) {\r\n\r\n\t\t\t\tresourcePath = this.path;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Tells the LoadingManager to track an extra item, which resolves after\r\n\t\t\t// the model is fully loaded. This means the count of items loaded will\r\n\t\t\t// be incorrect, but ensures manager.onLoad() does not fire early.\r\n\t\t\tthis.manager.itemStart( url );\r\n\r\n\t\t\tvar _onError = function ( e ) {\r\n\r\n\t\t\t\tif ( onError ) {\r\n\r\n\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.manager.itemError( url );\r\n\t\t\t\tscope.manager.itemEnd( url );\r\n\r\n\t\t\t};\r\n\r\n\t\t\tvar loader = new FileLoader( this.manager );\r\n\r\n\t\t\tloader.setPath( this.path );\r\n\t\t\tloader.setResponseType( 'arraybuffer' );\r\n\t\t\tloader.setRequestHeader( this.requestHeader );\r\n\t\t\tloader.setWithCredentials( this.withCredentials );\r\n\r\n\t\t\tloader.load( url, function ( data ) {\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tscope.parse( data, resourcePath, function ( gltf ) {\r\n\r\n\t\t\t\t\t\tonLoad( gltf );\r\n\r\n\t\t\t\t\t\tscope.manager.itemEnd( url );\r\n\r\n\t\t\t\t\t}, _onError );\r\n\r\n\t\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\t\t_onError( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}, onProgress, _onError );\r\n\r\n\t\t},\r\n\r\n\t\tsetDRACOLoader: function ( dracoLoader ) {\r\n\r\n\t\t\tthis.dracoLoader = dracoLoader;\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tsetDDSLoader: function ( ddsLoader ) {\r\n\r\n\t\t\tthis.ddsLoader = ddsLoader;\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tsetKTX2Loader: function ( ktx2Loader ) {\r\n\r\n\t\t\tthis.ktx2Loader = ktx2Loader;\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tsetMeshoptDecoder: function ( meshoptDecoder ) {\r\n\r\n\t\t\tthis.meshoptDecoder = meshoptDecoder;\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tregister: function ( callback ) {\r\n\r\n\t\t\tif ( this.pluginCallbacks.indexOf( callback ) === - 1 ) {\r\n\r\n\t\t\t\tthis.pluginCallbacks.push( callback );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tunregister: function ( callback ) {\r\n\r\n\t\t\tif ( this.pluginCallbacks.indexOf( callback ) !== - 1 ) {\r\n\r\n\t\t\t\tthis.pluginCallbacks.splice( this.pluginCallbacks.indexOf( callback ), 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tparse: function ( data, path, onLoad, onError ) {\r\n\r\n\t\t\tvar content;\r\n\t\t\tvar extensions = {};\r\n\t\t\tvar plugins = {};\r\n\r\n\t\t\tif ( typeof data === 'string' ) {\r\n\r\n\t\t\t\tcontent = data;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar magic = LoaderUtils.decodeText( new Uint8Array( data, 0, 4 ) );\r\n\r\n\t\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\r\n\r\n\t\t\t\t\ttry {\r\n\r\n\t\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\r\n\r\n\t\t\t\t\t} catch ( error ) {\r\n\r\n\t\t\t\t\t\tif ( onError ) onError( error );\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcontent = extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tcontent = LoaderUtils.decodeText( new Uint8Array( data ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar json = JSON.parse( content );\r\n\r\n\t\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\r\n\r\n\t\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.' ) );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar parser = new GLTFParser( json, {\r\n\r\n\t\t\t\tpath: path || this.resourcePath || '',\r\n\t\t\t\tcrossOrigin: this.crossOrigin,\r\n\t\t\t\tmanager: this.manager,\r\n\t\t\t\tktx2Loader: this.ktx2Loader,\r\n\t\t\t\tmeshoptDecoder: this.meshoptDecoder\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tparser.fileLoader.setRequestHeader( this.requestHeader );\r\n\r\n\t\t\tfor ( var i = 0; i < this.pluginCallbacks.length; i ++ ) {\r\n\r\n\t\t\t\tvar plugin = this.pluginCallbacks[ i ]( parser );\r\n\t\t\t\tplugins[ plugin.name ] = plugin;\r\n\r\n\t\t\t\t// Workaround to avoid determining as unknown extension\r\n\t\t\t\t// in addUnknownExtensionsToUserData().\r\n\t\t\t\t// Remove this workaround if we move all the existing\r\n\t\t\t\t// extension handlers to plugin system\r\n\t\t\t\textensions[ plugin.name ] = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( json.extensionsUsed ) {\r\n\r\n\t\t\t\tfor ( var i = 0; i < json.extensionsUsed.length; ++ i ) {\r\n\r\n\t\t\t\t\tvar extensionName = json.extensionsUsed[ i ];\r\n\t\t\t\t\tvar extensionsRequired = json.extensionsRequired || [];\r\n\r\n\t\t\t\t\tswitch ( extensionName ) {\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_UNLIT:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsUnlitExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsPbrSpecularGlossinessExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFDracoMeshCompressionExtension( json, this.dracoLoader );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.MSFT_TEXTURE_DDS:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureDDSExtension( this.ddsLoader );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_TEXTURE_TRANSFORM:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureTransformExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_MESH_QUANTIZATION:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFMeshQuantizationExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t\tif ( extensionsRequired.indexOf( extensionName ) >= 0 && plugins[ extensionName ] === undefined ) {\r\n\r\n\t\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".' );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tparser.setExtensions( extensions );\r\n\t\t\tparser.setPlugins( plugins );\r\n\t\t\tparser.parse( onLoad, onError );\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\r\n\t/* GLTFREGISTRY */\r\n\r\n\tfunction GLTFRegistry() {\r\n\r\n\t\tvar objects = {};\r\n\r\n\t\treturn\t{\r\n\r\n\t\t\tget: function ( key ) {\r\n\r\n\t\t\t\treturn objects[ key ];\r\n\r\n\t\t\t},\r\n\r\n\t\t\tadd: function ( key, object ) {\r\n\r\n\t\t\t\tobjects[ key ] = object;\r\n\r\n\t\t\t},\r\n\r\n\t\t\tremove: function ( key ) {\r\n\r\n\t\t\t\tdelete objects[ key ];\r\n\r\n\t\t\t},\r\n\r\n\t\t\tremoveAll: function () {\r\n\r\n\t\t\t\tobjects = {};\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/*********************************/\r\n\t/********** EXTENSIONS ***********/\r\n\t/*********************************/\r\n\r\n\tvar EXTENSIONS = {\r\n\t\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\r\n\t\tKHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\r\n\t\tKHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\r\n\t\tKHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',\r\n\t\tKHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness',\r\n\t\tKHR_MATERIALS_TRANSMISSION: 'KHR_materials_transmission',\r\n\t\tKHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\r\n\t\tKHR_TEXTURE_BASISU: 'KHR_texture_basisu',\r\n\t\tKHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\r\n\t\tKHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\r\n\t\tEXT_TEXTURE_WEBP: 'EXT_texture_webp',\r\n\t\tEXT_MESHOPT_COMPRESSION: 'EXT_meshopt_compression',\r\n\t\tMSFT_TEXTURE_DDS: 'MSFT_texture_dds'\r\n\t};\r\n\r\n\t/**\r\n\t * DDS Texture Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/MSFT_texture_dds\r\n\t *\r\n\t */\r\n\tfunction GLTFTextureDDSExtension( ddsLoader ) {\r\n\r\n\t\tif ( ! ddsLoader ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader' );\r\n\r\n\t\t}\r\n\r\n\t\tthis.name = EXTENSIONS.MSFT_TEXTURE_DDS;\r\n\t\tthis.ddsLoader = ddsLoader;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Punctual Lights Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\r\n\t */\r\n\tfunction GLTFLightsExtension( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\r\n\r\n\t\t// Object3D instance caches\r\n\t\tthis.cache = { refs: {}, uses: {} };\r\n\r\n\t}\r\n\r\n\tGLTFLightsExtension.prototype._markDefs = function () {\r\n\r\n\t\tvar parser = this.parser;\r\n\t\tvar nodeDefs = this.parser.json.nodes || [];\r\n\r\n\t\tfor ( var nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\r\n\r\n\t\t\tvar nodeDef = nodeDefs[ nodeIndex ];\r\n\r\n\t\t\tif ( nodeDef.extensions\r\n\t\t\t\t&& nodeDef.extensions[ this.name ]\r\n\t\t\t\t&& nodeDef.extensions[ this.name ].light !== undefined ) {\r\n\r\n\t\t\t\tparser._addNodeRef( this.cache, nodeDef.extensions[ this.name ].light );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tGLTFLightsExtension.prototype._loadLight = function ( lightIndex ) {\r\n\r\n\t\tvar parser = this.parser;\r\n\t\tvar cacheKey = 'light:' + lightIndex;\r\n\t\tvar dependency = parser.cache.get( cacheKey );\r\n\r\n\t\tif ( dependency ) return dependency;\r\n\r\n\t\tvar json = parser.json;\r\n\t\tvar extensions = ( json.extensions && json.extensions[ this.name ] ) || {};\r\n\t\tvar lightDefs = extensions.lights || [];\r\n\t\tvar lightDef = lightDefs[ lightIndex ];\r\n\t\tvar lightNode;\r\n\r\n\t\tvar color = new Color( 0xffffff );\r\n\r\n\t\tif ( lightDef.color !== undefined ) color.fromArray( lightDef.color );\r\n\r\n\t\tvar range = lightDef.range !== undefined ? lightDef.range : 0;\r\n\r\n\t\tswitch ( lightDef.type ) {\r\n\r\n\t\t\tcase 'directional':\r\n\t\t\t\tlightNode = new DirectionalLight( color );\r\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\r\n\t\t\t\tlightNode.add( lightNode.target );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'point':\r\n\t\t\t\tlightNode = new PointLight( color );\r\n\t\t\t\tlightNode.distance = range;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'spot':\r\n\t\t\t\tlightNode = new SpotLight( color );\r\n\t\t\t\tlightNode.distance = range;\r\n\t\t\t\t// Handle spotlight properties.\r\n\t\t\t\tlightDef.spot = lightDef.spot || {};\r\n\t\t\t\tlightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\r\n\t\t\t\tlightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\r\n\t\t\t\tlightNode.angle = lightDef.spot.outerConeAngle;\r\n\t\t\t\tlightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\r\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\r\n\t\t\t\tlightNode.add( lightNode.target );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unexpected light type, \"' + lightDef.type + '\".' );\r\n\r\n\t\t}\r\n\r\n\t\t// Some lights (e.g. spot) default to a position other than the origin. Reset the position\r\n\t\t// here, because node-level parsing will only override position if explicitly specified.\r\n\t\tlightNode.position.set( 0, 0, 0 );\r\n\r\n\t\tlightNode.decay = 2;\r\n\r\n\t\tif ( lightDef.intensity !== undefined ) lightNode.intensity = lightDef.intensity;\r\n\r\n\t\tlightNode.name = parser.createUniqueName( lightDef.name || ( 'light_' + lightIndex ) );\r\n\r\n\t\tdependency = Promise.resolve( lightNode );\r\n\r\n\t\tparser.cache.add( cacheKey, dependency );\r\n\r\n\t\treturn dependency;\r\n\r\n\t};\r\n\r\n\tGLTFLightsExtension.prototype.createNodeAttachment = function ( nodeIndex ) {\r\n\r\n\t\tvar self = this;\r\n\t\tvar parser = this.parser;\r\n\t\tvar json = parser.json;\r\n\t\tvar nodeDef = json.nodes[ nodeIndex ];\r\n\t\tvar lightDef = ( nodeDef.extensions && nodeDef.extensions[ this.name ] ) || {};\r\n\t\tvar lightIndex = lightDef.light;\r\n\r\n\t\tif ( lightIndex === undefined ) return null;\r\n\r\n\t\treturn this._loadLight( lightIndex ).then( function ( light ) {\r\n\r\n\t\t\treturn parser._getNodeRef( self.cache, lightIndex, light );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Unlit Materials Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\r\n\t */\r\n\tfunction GLTFMaterialsUnlitExtension() {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\r\n\r\n\t}\r\n\r\n\tGLTFMaterialsUnlitExtension.prototype.getMaterialType = function () {\r\n\r\n\t\treturn MeshBasicMaterial;\r\n\r\n\t};\r\n\r\n\tGLTFMaterialsUnlitExtension.prototype.extendParams = function ( materialParams, materialDef, parser ) {\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\r\n\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\tvar metallicRoughness = materialDef.pbrMetallicRoughness;\r\n\r\n\t\tif ( metallicRoughness ) {\r\n\r\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\r\n\r\n\t\t\t\tvar array = metallicRoughness.baseColorFactor;\r\n\r\n\t\t\t\tmaterialParams.color.fromArray( array );\r\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Clearcoat Materials Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat\r\n\t */\r\n\tfunction GLTFMaterialsClearcoatExtension( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;\r\n\r\n\t}\r\n\r\n\tGLTFMaterialsClearcoatExtension.prototype.getMaterialType = function ( materialIndex ) {\r\n\r\n\t\tvar parser = this.parser;\r\n\t\tvar materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\r\n\r\n\t\treturn MeshPhysicalMaterial;\r\n\r\n\t};\r\n\r\n\tGLTFMaterialsClearcoatExtension.prototype.extendMaterialParams = function ( materialIndex, materialParams ) {\r\n\r\n\t\tvar parser = this.parser;\r\n\t\tvar materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\r\n\r\n\t\t\treturn Promise.resolve();\r\n\r\n\t\t}\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tvar extension = materialDef.extensions[ this.name ];\r\n\r\n\t\tif ( extension.clearcoatFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.clearcoat = extension.clearcoatFactor;\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.clearcoatTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatMap', extension.clearcoatTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.clearcoatRoughnessFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.clearcoatRoughnessTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatRoughnessMap', extension.clearcoatRoughnessTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.clearcoatNormalTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatNormalMap', extension.clearcoatNormalTexture ) );\r\n\r\n\t\t\tif ( extension.clearcoatNormalTexture.scale !== undefined ) {\r\n\r\n\t\t\t\tvar scale = extension.clearcoatNormalTexture.scale;\r\n\r\n\t\t\t\tmaterialParams.clearcoatNormalScale = new Vector2( scale, scale );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Transmission Materials Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_transmission\r\n\t * Draft: https://github.com/KhronosGroup/glTF/pull/1698\r\n\t */\r\n\tfunction GLTFMaterialsTransmissionExtension( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_TRANSMISSION;\r\n\r\n\t}\r\n\r\n\tGLTFMaterialsTransmissionExtension.prototype.getMaterialType = function ( materialIndex ) {\r\n\r\n\t\tvar parser = this.parser;\r\n\t\tvar materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\r\n\r\n\t\treturn MeshPhysicalMaterial;\r\n\r\n\t};\r\n\r\n\tGLTFMaterialsTransmissionExtension.prototype.extendMaterialParams = function ( materialIndex, materialParams ) {\r\n\r\n\t\tvar parser = this.parser;\r\n\t\tvar materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\r\n\r\n\t\t\treturn Promise.resolve();\r\n\r\n\t\t}\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tvar extension = materialDef.extensions[ this.name ];\r\n\r\n\t\tif ( extension.transmissionFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.transmission = extension.transmissionFactor;\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.transmissionTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'transmissionMap', extension.transmissionTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * BasisU Texture Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu\r\n\t */\r\n\tfunction GLTFTextureBasisUExtension( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_BASISU;\r\n\r\n\t}\r\n\r\n\tGLTFTextureBasisUExtension.prototype.loadTexture = function ( textureIndex ) {\r\n\r\n\t\tvar parser = this.parser;\r\n\t\tvar json = parser.json;\r\n\r\n\t\tvar textureDef = json.textures[ textureIndex ];\r\n\r\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ this.name ] ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tvar extension = textureDef.extensions[ this.name ];\r\n\t\tvar source = json.images[ extension.source ];\r\n\t\tvar loader = parser.options.ktx2Loader;\r\n\r\n\t\tif ( ! loader ) {\r\n\r\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\r\n\r\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures' );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// Assumes that the extension is optional and that a fallback texture is present\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn parser.loadTextureImage( textureIndex, source, loader );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * WebP Texture Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp\r\n\t */\r\n\tfunction GLTFTextureWebPExtension( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_WEBP;\r\n\t\tthis.isSupported = null;\r\n\r\n\t}\r\n\r\n\tGLTFTextureWebPExtension.prototype.loadTexture = function ( textureIndex ) {\r\n\r\n\t\tvar name = this.name;\r\n\t\tvar parser = this.parser;\r\n\t\tvar json = parser.json;\r\n\r\n\t\tvar textureDef = json.textures[ textureIndex ];\r\n\r\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tvar extension = textureDef.extensions[ name ];\r\n\t\tvar source = json.images[ extension.source ];\r\n\t\tvar loader = source.uri ? parser.options.manager.getHandler( source.uri ) : parser.textureLoader;\r\n\r\n\t\treturn this.detectSupport().then( function ( isSupported ) {\r\n\r\n\t\t\tif ( isSupported ) return parser.loadTextureImage( textureIndex, source, loader );\r\n\r\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {\r\n\r\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: WebP required by asset but unsupported.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Fall back to PNG or JPEG.\r\n\t\t\treturn parser.loadTexture( textureIndex );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\tGLTFTextureWebPExtension.prototype.detectSupport = function () {\r\n\r\n\t\tif ( ! this.isSupported ) {\r\n\r\n\t\t\tthis.isSupported = new Promise( function ( resolve ) {\r\n\r\n\t\t\t\tvar image = new Image();\r\n\r\n\t\t\t\t// Lossy test image. Support for lossy images doesn't guarantee support for all\r\n\t\t\t\t// WebP images, unfortunately.\r\n\t\t\t\timage.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';\r\n\r\n\t\t\t\timage.onload = image.onerror = function () {\r\n\r\n\t\t\t\t\tresolve( image.height === 1 );\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.isSupported;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t* meshopt BufferView Compression Extension\r\n\t*\r\n\t* Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_meshopt_compression\r\n\t*/\r\n\tfunction GLTFMeshoptCompression( parser ) {\r\n\r\n\t\tthis.name = EXTENSIONS.EXT_MESHOPT_COMPRESSION;\r\n\t\tthis.parser = parser;\r\n\r\n\t}\r\n\r\n\tGLTFMeshoptCompression.prototype.loadBufferView = function ( index ) {\r\n\r\n\t\tvar json = this.parser.json;\r\n\t\tvar bufferView = json.bufferViews[ index ];\r\n\r\n\t\tif ( bufferView.extensions && bufferView.extensions[ this.name ] ) {\r\n\r\n\t\t\tvar extensionDef = bufferView.extensions[ this.name ];\r\n\r\n\t\t\tvar buffer = this.parser.getDependency( 'buffer', extensionDef.buffer );\r\n\t\t\tvar decoder = this.parser.options.meshoptDecoder;\r\n\r\n\t\t\tif ( ! decoder || ! decoder.supported ) {\r\n\r\n\t\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\r\n\r\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files' );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// Assumes that the extension is optional and that fallback buffer data is present\r\n\t\t\t\t\treturn null;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn Promise.all( [ buffer, decoder.ready ] ).then( function ( res ) {\r\n\r\n\t\t\t\tvar byteOffset = extensionDef.byteOffset || 0;\r\n\t\t\t\tvar byteLength = extensionDef.byteLength || 0;\r\n\r\n\t\t\t\tvar count = extensionDef.count;\r\n\t\t\t\tvar stride = extensionDef.byteStride;\r\n\r\n\t\t\t\tvar result = new ArrayBuffer( count * stride );\r\n\t\t\t\tvar source = new Uint8Array( res[ 0 ], byteOffset, byteLength );\r\n\r\n\t\t\t\tdecoder.decodeGltfBuffer( new Uint8Array( result ), count, stride, source, extensionDef.mode, extensionDef.filter );\r\n\t\t\t\treturn result;\r\n\r\n\t\t\t} );\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t/* BINARY EXTENSION */\r\n\tvar BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\r\n\tvar BINARY_EXTENSION_HEADER_LENGTH = 12;\r\n\tvar BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\r\n\r\n\tfunction GLTFBinaryExtension( data ) {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\r\n\t\tthis.content = null;\r\n\t\tthis.body = null;\r\n\r\n\t\tvar headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\r\n\r\n\t\tthis.header = {\r\n\t\t\tmagic: LoaderUtils.decodeText( new Uint8Array( data.slice( 0, 4 ) ) ),\r\n\t\t\tversion: headerView.getUint32( 4, true ),\r\n\t\t\tlength: headerView.getUint32( 8, true )\r\n\t\t};\r\n\r\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\r\n\r\n\t\t} else if ( this.header.version < 2.0 ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected.' );\r\n\r\n\t\t}\r\n\r\n\t\tvar chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\r\n\t\tvar chunkIndex = 0;\r\n\r\n\t\twhile ( chunkIndex < chunkView.byteLength ) {\r\n\r\n\t\t\tvar chunkLength = chunkView.getUint32( chunkIndex, true );\r\n\t\t\tchunkIndex += 4;\r\n\r\n\t\t\tvar chunkType = chunkView.getUint32( chunkIndex, true );\r\n\t\t\tchunkIndex += 4;\r\n\r\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\r\n\r\n\t\t\t\tvar contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\r\n\t\t\t\tthis.content = LoaderUtils.decodeText( contentArray );\r\n\r\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\r\n\r\n\t\t\t\tvar byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\r\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Clients must ignore chunks with unknown types.\r\n\r\n\t\t\tchunkIndex += chunkLength;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.content === null ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * DRACO Mesh Compression Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\r\n\t */\r\n\tfunction GLTFDracoMeshCompressionExtension( json, dracoLoader ) {\r\n\r\n\t\tif ( ! dracoLoader ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: No DRACOLoader instance provided.' );\r\n\r\n\t\t}\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\r\n\t\tthis.json = json;\r\n\t\tthis.dracoLoader = dracoLoader;\r\n\t\tthis.dracoLoader.preload();\r\n\r\n\t}\r\n\r\n\tGLTFDracoMeshCompressionExtension.prototype.decodePrimitive = function ( primitive, parser ) {\r\n\r\n\t\tvar json = this.json;\r\n\t\tvar dracoLoader = this.dracoLoader;\r\n\t\tvar bufferViewIndex = primitive.extensions[ this.name ].bufferView;\r\n\t\tvar gltfAttributeMap = primitive.extensions[ this.name ].attributes;\r\n\t\tvar threeAttributeMap = {};\r\n\t\tvar attributeNormalizedMap = {};\r\n\t\tvar attributeTypeMap = {};\r\n\r\n\t\tfor ( var attributeName in gltfAttributeMap ) {\r\n\r\n\t\t\tvar threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\r\n\r\n\t\t\tthreeAttributeMap[ threeAttributeName ] = gltfAttributeMap[ attributeName ];\r\n\r\n\t\t}\r\n\r\n\t\tfor ( attributeName in primitive.attributes ) {\r\n\r\n\t\t\tvar threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\r\n\r\n\t\t\tif ( gltfAttributeMap[ attributeName ] !== undefined ) {\r\n\r\n\t\t\t\tvar accessorDef = json.accessors[ primitive.attributes[ attributeName ] ];\r\n\t\t\t\tvar componentType = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\r\n\r\n\t\t\t\tattributeTypeMap[ threeAttributeName ] = componentType;\r\n\t\t\t\tattributeNormalizedMap[ threeAttributeName ] = accessorDef.normalized === true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn parser.getDependency( 'bufferView', bufferViewIndex ).then( function ( bufferView ) {\r\n\r\n\t\t\treturn new Promise( function ( resolve ) {\r\n\r\n\t\t\t\tdracoLoader.decodeDracoFile( bufferView, function ( geometry ) {\r\n\r\n\t\t\t\t\tfor ( var attributeName in geometry.attributes ) {\r\n\r\n\t\t\t\t\t\tvar attribute = geometry.attributes[ attributeName ];\r\n\t\t\t\t\t\tvar normalized = attributeNormalizedMap[ attributeName ];\r\n\r\n\t\t\t\t\t\tif ( normalized !== undefined ) attribute.normalized = normalized;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tresolve( geometry );\r\n\r\n\t\t\t\t}, threeAttributeMap, attributeTypeMap );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Texture Transform Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\r\n\t */\r\n\tfunction GLTFTextureTransformExtension() {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\r\n\r\n\t}\r\n\r\n\tGLTFTextureTransformExtension.prototype.extendTexture = function ( texture, transform ) {\r\n\r\n\t\ttexture = texture.clone();\r\n\r\n\t\tif ( transform.offset !== undefined ) {\r\n\r\n\t\t\ttexture.offset.fromArray( transform.offset );\r\n\r\n\t\t}\r\n\r\n\t\tif ( transform.rotation !== undefined ) {\r\n\r\n\t\t\ttexture.rotation = transform.rotation;\r\n\r\n\t\t}\r\n\r\n\t\tif ( transform.scale !== undefined ) {\r\n\r\n\t\t\ttexture.repeat.fromArray( transform.scale );\r\n\r\n\t\t}\r\n\r\n\t\tif ( transform.texCoord !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV sets in \"' + this.name + '\" extension not yet supported.' );\r\n\r\n\t\t}\r\n\r\n\t\ttexture.needsUpdate = true;\r\n\r\n\t\treturn texture;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specular-Glossiness Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness\r\n\t */\r\n\r\n\t/**\r\n\t * A sub class of StandardMaterial with some of the functionality\r\n\t * changed via the `onBeforeCompile` callback\r\n\t * @pailhead\r\n\t */\r\n\r\n\tfunction GLTFMeshStandardSGMaterial( params ) {\r\n\r\n\t\tMeshStandardMaterial.call( this );\r\n\r\n\t\tthis.isGLTFSpecularGlossinessMaterial = true;\r\n\r\n\t\t//various chunks that need replacing\r\n\t\tvar specularMapParsFragmentChunk = [\r\n\t\t\t'#ifdef USE_SPECULARMAP',\r\n\t\t\t'\tuniform sampler2D specularMap;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar glossinessMapParsFragmentChunk = [\r\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\r\n\t\t\t'\tuniform sampler2D glossinessMap;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar specularMapFragmentChunk = [\r\n\t\t\t'vec3 specularFactor = specular;',\r\n\t\t\t'#ifdef USE_SPECULARMAP',\r\n\t\t\t'\tvec4 texelSpecular = texture2D( specularMap, vUv );',\r\n\t\t\t'\ttexelSpecular = sRGBToLinear( texelSpecular );',\r\n\t\t\t'\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n\t\t\t'\tspecularFactor *= texelSpecular.rgb;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar glossinessMapFragmentChunk = [\r\n\t\t\t'float glossinessFactor = glossiness;',\r\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\r\n\t\t\t'\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\r\n\t\t\t'\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n\t\t\t'\tglossinessFactor *= texelGlossiness.a;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar lightPhysicalFragmentChunk = [\r\n\t\t\t'PhysicalMaterial material;',\r\n\t\t\t'material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );',\r\n\t\t\t'vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );',\r\n\t\t\t'float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );',\r\n\t\t\t'material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.',\r\n\t\t\t'material.specularRoughness += geometryRoughness;',\r\n\t\t\t'material.specularRoughness = min( material.specularRoughness, 1.0 );',\r\n\t\t\t'material.specularColor = specularFactor;',\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar uniforms = {\r\n\t\t\tspecular: { value: new Color().setHex( 0xffffff ) },\r\n\t\t\tglossiness: { value: 1 },\r\n\t\t\tspecularMap: { value: null },\r\n\t\t\tglossinessMap: { value: null }\r\n\t\t};\r\n\r\n\t\tthis._extraUniforms = uniforms;\r\n\r\n\t\tthis.onBeforeCompile = function ( shader ) {\r\n\r\n\t\t\tfor ( var uniformName in uniforms ) {\r\n\r\n\t\t\t\tshader.uniforms[ uniformName ] = uniforms[ uniformName ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tshader.fragmentShader = shader.fragmentShader\r\n\t\t\t\t.replace( 'uniform float roughness;', 'uniform vec3 specular;' )\r\n\t\t\t\t.replace( 'uniform float metalness;', 'uniform float glossiness;' )\r\n\t\t\t\t.replace( '#include <roughnessmap_pars_fragment>', specularMapParsFragmentChunk )\r\n\t\t\t\t.replace( '#include <metalnessmap_pars_fragment>', glossinessMapParsFragmentChunk )\r\n\t\t\t\t.replace( '#include <roughnessmap_fragment>', specularMapFragmentChunk )\r\n\t\t\t\t.replace( '#include <metalnessmap_fragment>', glossinessMapFragmentChunk )\r\n\t\t\t\t.replace( '#include <lights_physical_fragment>', lightPhysicalFragmentChunk );\r\n\r\n\t\t};\r\n\r\n\t\tObject.defineProperties( this, {\r\n\r\n\t\t\tspecular: {\r\n\t\t\t\tget: function () {\r\n\r\n\t\t\t\t\treturn uniforms.specular.value;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function ( v ) {\r\n\r\n\t\t\t\t\tuniforms.specular.value = v;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tspecularMap: {\r\n\t\t\t\tget: function () {\r\n\r\n\t\t\t\t\treturn uniforms.specularMap.value;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function ( v ) {\r\n\r\n\t\t\t\t\tuniforms.specularMap.value = v;\r\n\r\n\t\t\t\t\tif ( v ) {\r\n\r\n\t\t\t\t\t\tthis.defines.USE_SPECULARMAP = ''; // USE_UV is set by the renderer for specular maps\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tdelete this.defines.USE_SPECULARMAP;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tglossiness: {\r\n\t\t\t\tget: function () {\r\n\r\n\t\t\t\t\treturn uniforms.glossiness.value;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function ( v ) {\r\n\r\n\t\t\t\t\tuniforms.glossiness.value = v;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tglossinessMap: {\r\n\t\t\t\tget: function () {\r\n\r\n\t\t\t\t\treturn uniforms.glossinessMap.value;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function ( v ) {\r\n\r\n\t\t\t\t\tuniforms.glossinessMap.value = v;\r\n\r\n\t\t\t\t\tif ( v ) {\r\n\r\n\t\t\t\t\t\tthis.defines.USE_GLOSSINESSMAP = '';\r\n\t\t\t\t\t\tthis.defines.USE_UV = '';\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tdelete this.defines.USE_GLOSSINESSMAP;\r\n\t\t\t\t\t\tdelete this.defines.USE_UV;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tdelete this.metalness;\r\n\t\tdelete this.roughness;\r\n\t\tdelete this.metalnessMap;\r\n\t\tdelete this.roughnessMap;\r\n\r\n\t\tthis.setValues( params );\r\n\r\n\t}\r\n\r\n\tGLTFMeshStandardSGMaterial.prototype = Object.create( MeshStandardMaterial.prototype );\r\n\tGLTFMeshStandardSGMaterial.prototype.constructor = GLTFMeshStandardSGMaterial;\r\n\r\n\tGLTFMeshStandardSGMaterial.prototype.copy = function ( source ) {\r\n\r\n\t\tMeshStandardMaterial.prototype.copy.call( this, source );\r\n\t\tthis.specularMap = source.specularMap;\r\n\t\tthis.specular.copy( source.specular );\r\n\t\tthis.glossinessMap = source.glossinessMap;\r\n\t\tthis.glossiness = source.glossiness;\r\n\t\tdelete this.metalness;\r\n\t\tdelete this.roughness;\r\n\t\tdelete this.metalnessMap;\r\n\t\tdelete this.roughnessMap;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tfunction GLTFMaterialsPbrSpecularGlossinessExtension() {\r\n\r\n\t\treturn {\r\n\r\n\t\t\tname: EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,\r\n\r\n\t\t\tspecularGlossinessParams: [\r\n\t\t\t\t'color',\r\n\t\t\t\t'map',\r\n\t\t\t\t'lightMap',\r\n\t\t\t\t'lightMapIntensity',\r\n\t\t\t\t'aoMap',\r\n\t\t\t\t'aoMapIntensity',\r\n\t\t\t\t'emissive',\r\n\t\t\t\t'emissiveIntensity',\r\n\t\t\t\t'emissiveMap',\r\n\t\t\t\t'bumpMap',\r\n\t\t\t\t'bumpScale',\r\n\t\t\t\t'normalMap',\r\n\t\t\t\t'normalMapType',\r\n\t\t\t\t'displacementMap',\r\n\t\t\t\t'displacementScale',\r\n\t\t\t\t'displacementBias',\r\n\t\t\t\t'specularMap',\r\n\t\t\t\t'specular',\r\n\t\t\t\t'glossinessMap',\r\n\t\t\t\t'glossiness',\r\n\t\t\t\t'alphaMap',\r\n\t\t\t\t'envMap',\r\n\t\t\t\t'envMapIntensity',\r\n\t\t\t\t'refractionRatio',\r\n\t\t\t],\r\n\r\n\t\t\tgetMaterialType: function () {\r\n\r\n\t\t\t\treturn GLTFMeshStandardSGMaterial;\r\n\r\n\t\t\t},\r\n\r\n\t\t\textendParams: function ( materialParams, materialDef, parser ) {\r\n\r\n\t\t\t\tvar pbrSpecularGlossiness = materialDef.extensions[ this.name ];\r\n\r\n\t\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\r\n\t\t\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\t\t\tvar pending = [];\r\n\r\n\t\t\t\tif ( Array.isArray( pbrSpecularGlossiness.diffuseFactor ) ) {\r\n\r\n\t\t\t\t\tvar array = pbrSpecularGlossiness.diffuseFactor;\r\n\r\n\t\t\t\t\tmaterialParams.color.fromArray( array );\r\n\t\t\t\t\tmaterialParams.opacity = array[ 3 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pbrSpecularGlossiness.diffuseTexture !== undefined ) {\r\n\r\n\t\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', pbrSpecularGlossiness.diffuseTexture ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmaterialParams.emissive = new Color( 0.0, 0.0, 0.0 );\r\n\t\t\t\tmaterialParams.glossiness = pbrSpecularGlossiness.glossinessFactor !== undefined ? pbrSpecularGlossiness.glossinessFactor : 1.0;\r\n\t\t\t\tmaterialParams.specular = new Color( 1.0, 1.0, 1.0 );\r\n\r\n\t\t\t\tif ( Array.isArray( pbrSpecularGlossiness.specularFactor ) ) {\r\n\r\n\t\t\t\t\tmaterialParams.specular.fromArray( pbrSpecularGlossiness.specularFactor );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pbrSpecularGlossiness.specularGlossinessTexture !== undefined ) {\r\n\r\n\t\t\t\t\tvar specGlossMapDef = pbrSpecularGlossiness.specularGlossinessTexture;\r\n\t\t\t\t\tpending.push( parser.assignTexture( materialParams, 'glossinessMap', specGlossMapDef ) );\r\n\t\t\t\t\tpending.push( parser.assignTexture( materialParams, 'specularMap', specGlossMapDef ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn Promise.all( pending );\r\n\r\n\t\t\t},\r\n\r\n\t\t\tcreateMaterial: function ( materialParams ) {\r\n\r\n\t\t\t\tvar material = new GLTFMeshStandardSGMaterial( materialParams );\r\n\t\t\t\tmaterial.fog = true;\r\n\r\n\t\t\t\tmaterial.color = materialParams.color;\r\n\r\n\t\t\t\tmaterial.map = materialParams.map === undefined ? null : materialParams.map;\r\n\r\n\t\t\t\tmaterial.lightMap = null;\r\n\t\t\t\tmaterial.lightMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.aoMap = materialParams.aoMap === undefined ? null : materialParams.aoMap;\r\n\t\t\t\tmaterial.aoMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.emissive = materialParams.emissive;\r\n\t\t\t\tmaterial.emissiveIntensity = 1.0;\r\n\t\t\t\tmaterial.emissiveMap = materialParams.emissiveMap === undefined ? null : materialParams.emissiveMap;\r\n\r\n\t\t\t\tmaterial.bumpMap = materialParams.bumpMap === undefined ? null : materialParams.bumpMap;\r\n\t\t\t\tmaterial.bumpScale = 1;\r\n\r\n\t\t\t\tmaterial.normalMap = materialParams.normalMap === undefined ? null : materialParams.normalMap;\r\n\t\t\t\tmaterial.normalMapType = TangentSpaceNormalMap;\r\n\r\n\t\t\t\tif ( materialParams.normalScale ) material.normalScale = materialParams.normalScale;\r\n\r\n\t\t\t\tmaterial.displacementMap = null;\r\n\t\t\t\tmaterial.displacementScale = 1;\r\n\t\t\t\tmaterial.displacementBias = 0;\r\n\r\n\t\t\t\tmaterial.specularMap = materialParams.specularMap === undefined ? null : materialParams.specularMap;\r\n\t\t\t\tmaterial.specular = materialParams.specular;\r\n\r\n\t\t\t\tmaterial.glossinessMap = materialParams.glossinessMap === undefined ? null : materialParams.glossinessMap;\r\n\t\t\t\tmaterial.glossiness = materialParams.glossiness;\r\n\r\n\t\t\t\tmaterial.alphaMap = null;\r\n\r\n\t\t\t\tmaterial.envMap = materialParams.envMap === undefined ? null : materialParams.envMap;\r\n\t\t\t\tmaterial.envMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.refractionRatio = 0.98;\r\n\r\n\t\t\t\treturn material;\r\n\r\n\t\t\t},\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Mesh Quantization Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\r\n\t */\r\n\tfunction GLTFMeshQuantizationExtension() {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\r\n\r\n\t}\r\n\r\n\t/*********************************/\r\n\t/********** INTERPOLATION ********/\r\n\t/*********************************/\r\n\r\n\t// Spline Interpolation\r\n\t// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\r\n\tfunction GLTFCubicSplineInterpolant( parameterPositions, sampleValues, sampleSize, resultBuffer ) {\r\n\r\n\t\tInterpolant.call( this, parameterPositions, sampleValues, sampleSize, resultBuffer );\r\n\r\n\t}\r\n\r\n\tGLTFCubicSplineInterpolant.prototype = Object.create( Interpolant.prototype );\r\n\tGLTFCubicSplineInterpolant.prototype.constructor = GLTFCubicSplineInterpolant;\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.copySampleValue_ = function ( index ) {\r\n\r\n\t\t// Copies a sample value to the result buffer. See description of glTF\r\n\t\t// CUBICSPLINE values layout in interpolate_() function below.\r\n\r\n\t\tvar result = this.resultBuffer,\r\n\t\t\tvalues = this.sampleValues,\r\n\t\t\tvalueSize = this.valueSize,\r\n\t\t\toffset = index * valueSize * 3 + valueSize;\r\n\r\n\t\tfor ( var i = 0; i !== valueSize; i ++ ) {\r\n\r\n\t\t\tresult[ i ] = values[ offset + i ];\r\n\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\r\n\t};\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.beforeStart_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.afterEnd_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.interpolate_ = function ( i1, t0, t, t1 ) {\r\n\r\n\t\tvar result = this.resultBuffer;\r\n\t\tvar values = this.sampleValues;\r\n\t\tvar stride = this.valueSize;\r\n\r\n\t\tvar stride2 = stride * 2;\r\n\t\tvar stride3 = stride * 3;\r\n\r\n\t\tvar td = t1 - t0;\r\n\r\n\t\tvar p = ( t - t0 ) / td;\r\n\t\tvar pp = p * p;\r\n\t\tvar ppp = pp * p;\r\n\r\n\t\tvar offset1 = i1 * stride3;\r\n\t\tvar offset0 = offset1 - stride3;\r\n\r\n\t\tvar s2 = - 2 * ppp + 3 * pp;\r\n\t\tvar s3 = ppp - pp;\r\n\t\tvar s0 = 1 - s2;\r\n\t\tvar s1 = s3 - pp + p;\r\n\r\n\t\t// Layout of keyframe output values for CUBICSPLINE animations:\r\n\t\t//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\r\n\t\tfor ( var i = 0; i !== stride; i ++ ) {\r\n\r\n\t\t\tvar p0 = values[ offset0 + i + stride ]; // splineVertex_k\r\n\t\t\tvar m0 = values[ offset0 + i + stride2 ] * td; // outTangent_k * (t_k+1 - t_k)\r\n\t\t\tvar p1 = values[ offset1 + i + stride ]; // splineVertex_k+1\r\n\t\t\tvar m1 = values[ offset1 + i ] * td; // inTangent_k+1 * (t_k+1 - t_k)\r\n\r\n\t\t\tresult[ i ] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\r\n\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\r\n\t};\r\n\r\n\t/*********************************/\r\n\t/********** INTERNALS ************/\r\n\t/*********************************/\r\n\r\n\t/* CONSTANTS */\r\n\r\n\tvar WEBGL_CONSTANTS = {\r\n\t\tFLOAT: 5126,\r\n\t\t//FLOAT_MAT2: 35674,\r\n\t\tFLOAT_MAT3: 35675,\r\n\t\tFLOAT_MAT4: 35676,\r\n\t\tFLOAT_VEC2: 35664,\r\n\t\tFLOAT_VEC3: 35665,\r\n\t\tFLOAT_VEC4: 35666,\r\n\t\tLINEAR: 9729,\r\n\t\tREPEAT: 10497,\r\n\t\tSAMPLER_2D: 35678,\r\n\t\tPOINTS: 0,\r\n\t\tLINES: 1,\r\n\t\tLINE_LOOP: 2,\r\n\t\tLINE_STRIP: 3,\r\n\t\tTRIANGLES: 4,\r\n\t\tTRIANGLE_STRIP: 5,\r\n\t\tTRIANGLE_FAN: 6,\r\n\t\tUNSIGNED_BYTE: 5121,\r\n\t\tUNSIGNED_SHORT: 5123\r\n\t};\r\n\r\n\tvar WEBGL_COMPONENT_TYPES = {\r\n\t\t5120: Int8Array,\r\n\t\t5121: Uint8Array,\r\n\t\t5122: Int16Array,\r\n\t\t5123: Uint16Array,\r\n\t\t5125: Uint32Array,\r\n\t\t5126: Float32Array\r\n\t};\r\n\r\n\tvar WEBGL_FILTERS = {\r\n\t\t9728: NearestFilter,\r\n\t\t9729: LinearFilter,\r\n\t\t9984: NearestMipmapNearestFilter,\r\n\t\t9985: LinearMipmapNearestFilter,\r\n\t\t9986: NearestMipmapLinearFilter,\r\n\t\t9987: LinearMipmapLinearFilter\r\n\t};\r\n\r\n\tvar WEBGL_WRAPPINGS = {\r\n\t\t33071: ClampToEdgeWrapping,\r\n\t\t33648: MirroredRepeatWrapping,\r\n\t\t10497: RepeatWrapping\r\n\t};\r\n\r\n\tvar WEBGL_TYPE_SIZES = {\r\n\t\t'SCALAR': 1,\r\n\t\t'VEC2': 2,\r\n\t\t'VEC3': 3,\r\n\t\t'VEC4': 4,\r\n\t\t'MAT2': 4,\r\n\t\t'MAT3': 9,\r\n\t\t'MAT4': 16\r\n\t};\r\n\r\n\tvar ATTRIBUTES = {\r\n\t\tPOSITION: 'position',\r\n\t\tNORMAL: 'normal',\r\n\t\tTANGENT: 'tangent',\r\n\t\tTEXCOORD_0: 'uv',\r\n\t\tTEXCOORD_1: 'uv2',\r\n\t\tCOLOR_0: 'color',\r\n\t\tWEIGHTS_0: 'skinWeight',\r\n\t\tJOINTS_0: 'skinIndex',\r\n\t};\r\n\r\n\tvar PATH_PROPERTIES = {\r\n\t\tscale: 'scale',\r\n\t\ttranslation: 'position',\r\n\t\trotation: 'quaternion',\r\n\t\tweights: 'morphTargetInfluences'\r\n\t};\r\n\r\n\tvar INTERPOLATION = {\r\n\t\tCUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\r\n\t\t                        // keyframe track will be initialized with a default interpolation type, then modified.\r\n\t\tLINEAR: InterpolateLinear,\r\n\t\tSTEP: InterpolateDiscrete\r\n\t};\r\n\r\n\tvar ALPHA_MODES = {\r\n\t\tOPAQUE: 'OPAQUE',\r\n\t\tMASK: 'MASK',\r\n\t\tBLEND: 'BLEND'\r\n\t};\r\n\r\n\t/* UTILITY FUNCTIONS */\r\n\r\n\tfunction resolveURL( url, path ) {\r\n\r\n\t\t// Invalid URL\r\n\t\tif ( typeof url !== 'string' || url === '' ) return '';\r\n\r\n\t\t// Host Relative URL\r\n\t\tif ( /^https?:\\/\\//i.test( path ) && /^\\//.test( url ) ) {\r\n\r\n\t\t\tpath = path.replace( /(^https?:\\/\\/[^\\/]+).*/i, '$1' );\r\n\r\n\t\t}\r\n\r\n\t\t// Absolute URL http://,https://,//\r\n\t\tif ( /^(https?:)?\\/\\//i.test( url ) ) return url;\r\n\r\n\t\t// Data URI\r\n\t\tif ( /^data:.*,.*$/i.test( url ) ) return url;\r\n\r\n\t\t// Blob URL\r\n\t\tif ( /^blob:.*$/i.test( url ) ) return url;\r\n\r\n\t\t// Relative URL\r\n\t\treturn path + url;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\r\n\t */\r\n\tfunction createDefaultMaterial( cache ) {\r\n\r\n\t\tif ( cache[ 'DefaultMaterial' ] === undefined ) {\r\n\r\n\t\t\tcache[ 'DefaultMaterial' ] = new MeshStandardMaterial( {\r\n\t\t\t\tcolor: 0xFFFFFF,\r\n\t\t\t\temissive: 0x000000,\r\n\t\t\t\tmetalness: 1,\r\n\t\t\t\troughness: 1,\r\n\t\t\t\ttransparent: false,\r\n\t\t\t\tdepthTest: true,\r\n\t\t\t\tside: FrontSide\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn cache[ 'DefaultMaterial' ];\r\n\r\n\t}\r\n\r\n\tfunction addUnknownExtensionsToUserData( knownExtensions, object, objectDef ) {\r\n\r\n\t\t// Add unknown glTF extensions to an object's userData.\r\n\r\n\t\tfor ( var name in objectDef.extensions ) {\r\n\r\n\t\t\tif ( knownExtensions[ name ] === undefined ) {\r\n\r\n\t\t\t\tobject.userData.gltfExtensions = object.userData.gltfExtensions || {};\r\n\t\t\t\tobject.userData.gltfExtensions[ name ] = objectDef.extensions[ name ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object3D|Material|BufferGeometry} object\r\n\t * @param {GLTF.definition} gltfDef\r\n\t */\r\n\tfunction assignExtrasToUserData( object, gltfDef ) {\r\n\r\n\t\tif ( gltfDef.extras !== undefined ) {\r\n\r\n\t\t\tif ( typeof gltfDef.extras === 'object' ) {\r\n\r\n\t\t\t\tObject.assign( object.userData, gltfDef.extras );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\r\n\t *\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {Array<GLTF.Target>} targets\r\n\t * @param {GLTFParser} parser\r\n\t * @return {Promise<BufferGeometry>}\r\n\t */\r\n\tfunction addMorphTargets( geometry, targets, parser ) {\r\n\r\n\t\tvar hasMorphPosition = false;\r\n\t\tvar hasMorphNormal = false;\r\n\r\n\t\tfor ( var i = 0, il = targets.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar target = targets[ i ];\r\n\r\n\t\t\tif ( target.POSITION !== undefined ) hasMorphPosition = true;\r\n\t\t\tif ( target.NORMAL !== undefined ) hasMorphNormal = true;\r\n\r\n\t\t\tif ( hasMorphPosition && hasMorphNormal ) break;\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! hasMorphPosition && ! hasMorphNormal ) return Promise.resolve( geometry );\r\n\r\n\t\tvar pendingPositionAccessors = [];\r\n\t\tvar pendingNormalAccessors = [];\r\n\r\n\t\tfor ( var i = 0, il = targets.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar target = targets[ i ];\r\n\r\n\t\t\tif ( hasMorphPosition ) {\r\n\r\n\t\t\t\tvar pendingAccessor = target.POSITION !== undefined\r\n\t\t\t\t\t? parser.getDependency( 'accessor', target.POSITION )\r\n\t\t\t\t\t: geometry.attributes.position;\r\n\r\n\t\t\t\tpendingPositionAccessors.push( pendingAccessor );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasMorphNormal ) {\r\n\r\n\t\t\t\tvar pendingAccessor = target.NORMAL !== undefined\r\n\t\t\t\t\t? parser.getDependency( 'accessor', target.NORMAL )\r\n\t\t\t\t\t: geometry.attributes.normal;\r\n\r\n\t\t\t\tpendingNormalAccessors.push( pendingAccessor );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( [\r\n\t\t\tPromise.all( pendingPositionAccessors ),\r\n\t\t\tPromise.all( pendingNormalAccessors )\r\n\t\t] ).then( function ( accessors ) {\r\n\r\n\t\t\tvar morphPositions = accessors[ 0 ];\r\n\t\t\tvar morphNormals = accessors[ 1 ];\r\n\r\n\t\t\tif ( hasMorphPosition ) geometry.morphAttributes.position = morphPositions;\r\n\t\t\tif ( hasMorphNormal ) geometry.morphAttributes.normal = morphNormals;\r\n\t\t\tgeometry.morphTargetsRelative = true;\r\n\r\n\t\t\treturn geometry;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Mesh} mesh\r\n\t * @param {GLTF.Mesh} meshDef\r\n\t */\r\n\tfunction updateMorphTargets( mesh, meshDef ) {\r\n\r\n\t\tmesh.updateMorphTargets();\r\n\r\n\t\tif ( meshDef.weights !== undefined ) {\r\n\r\n\t\t\tfor ( var i = 0, il = meshDef.weights.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// .extras has user-defined data, so check that .extras.targetNames is an array.\r\n\t\tif ( meshDef.extras && Array.isArray( meshDef.extras.targetNames ) ) {\r\n\r\n\t\t\tvar targetNames = meshDef.extras.targetNames;\r\n\r\n\t\t\tif ( mesh.morphTargetInfluences.length === targetNames.length ) {\r\n\r\n\t\t\t\tmesh.morphTargetDictionary = {};\r\n\r\n\t\t\t\tfor ( var i = 0, il = targetNames.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tmesh.morphTargetDictionary[ targetNames[ i ] ] = i;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction createPrimitiveKey( primitiveDef ) {\r\n\r\n\t\tvar dracoExtension = primitiveDef.extensions && primitiveDef.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ];\r\n\t\tvar geometryKey;\r\n\r\n\t\tif ( dracoExtension ) {\r\n\r\n\t\t\tgeometryKey = 'draco:' + dracoExtension.bufferView\r\n\t\t\t\t+ ':' + dracoExtension.indices\r\n\t\t\t\t+ ':' + createAttributesKey( dracoExtension.attributes );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tgeometryKey = primitiveDef.indices + ':' + createAttributesKey( primitiveDef.attributes ) + ':' + primitiveDef.mode;\r\n\r\n\t\t}\r\n\r\n\t\treturn geometryKey;\r\n\r\n\t}\r\n\r\n\tfunction createAttributesKey( attributes ) {\r\n\r\n\t\tvar attributesKey = '';\r\n\r\n\t\tvar keys = Object.keys( attributes ).sort();\r\n\r\n\t\tfor ( var i = 0, il = keys.length; i < il; i ++ ) {\r\n\r\n\t\t\tattributesKey += keys[ i ] + ':' + attributes[ keys[ i ] ] + ';';\r\n\r\n\t\t}\r\n\r\n\t\treturn attributesKey;\r\n\r\n\t}\r\n\r\n\t/* GLTF PARSER */\r\n\r\n\tfunction GLTFParser( json, options ) {\r\n\r\n\t\tthis.json = json || {};\r\n\t\tthis.extensions = {};\r\n\t\tthis.plugins = {};\r\n\t\tthis.options = options || {};\r\n\r\n\t\t// loader object cache\r\n\t\tthis.cache = new GLTFRegistry();\r\n\r\n\t\t// associations between Three.js objects and glTF elements\r\n\t\tthis.associations = new Map();\r\n\r\n\t\t// BufferGeometry caching\r\n\t\tthis.primitiveCache = {};\r\n\r\n\t\t// Object3D instance caches\r\n\t\tthis.meshCache = { refs: {}, uses: {} };\r\n\t\tthis.cameraCache = { refs: {}, uses: {} };\r\n\t\tthis.lightCache = { refs: {}, uses: {} };\r\n\r\n\t\t// Track node names, to ensure no duplicates\r\n\t\tthis.nodeNamesUsed = {};\r\n\r\n\t\t// Use an ImageBitmapLoader if imageBitmaps are supported. Moves much of the\r\n\t\t// expensive work of uploading a texture to the GPU off the main thread.\r\n\t\tif ( typeof createImageBitmap !== 'undefined' && /Firefox/.test( navigator.userAgent ) === false ) {\r\n\t\t\tthis.textureLoader = new ImageBitmapLoader( this.options.manager );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.textureLoader = new TextureLoader( this.options.manager );\r\n\r\n\t\t}\r\n\r\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\r\n\r\n\t\tthis.fileLoader = new FileLoader( this.options.manager );\r\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\r\n\r\n\t\tif ( this.options.crossOrigin === 'use-credentials' ) {\r\n\r\n\t\t\tthis.fileLoader.setWithCredentials( true );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tGLTFParser.prototype.setExtensions = function ( extensions ) {\r\n\r\n\t\tthis.extensions = extensions;\r\n\r\n\t};\r\n\r\n\tGLTFParser.prototype.setPlugins = function ( plugins ) {\r\n\r\n\t\tthis.plugins = plugins;\r\n\r\n\t};\r\n\r\n\tGLTFParser.prototype.parse = function ( onLoad, onError ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\r\n\t\t// Clear the loader cache\r\n\t\tthis.cache.removeAll();\r\n\r\n\t\t// Mark the special nodes/meshes in json for efficient parse\r\n\t\tthis._invokeAll( function ( ext ) {\r\n\r\n\t\t\treturn ext._markDefs && ext._markDefs();\r\n\r\n\t\t} );\r\n\r\n\t\tPromise.all( [\r\n\r\n\t\t\tthis.getDependencies( 'scene' ),\r\n\t\t\tthis.getDependencies( 'animation' ),\r\n\t\t\tthis.getDependencies( 'camera' ),\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tvar result = {\r\n\t\t\t\tscene: dependencies[ 0 ][ json.scene || 0 ],\r\n\t\t\t\tscenes: dependencies[ 0 ],\r\n\t\t\t\tanimations: dependencies[ 1 ],\r\n\t\t\t\tcameras: dependencies[ 2 ],\r\n\t\t\t\tasset: json.asset,\r\n\t\t\t\tparser: parser,\r\n\t\t\t\tuserData: {}\r\n\t\t\t};\r\n\r\n\t\t\taddUnknownExtensionsToUserData( extensions, result, json );\r\n\r\n\t\t\tassignExtrasToUserData( result, json );\r\n\r\n\t\t\tonLoad( result );\r\n\r\n\t\t} ).catch( onError );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Marks the special nodes/meshes in json for efficient parse.\r\n\t */\r\n\tGLTFParser.prototype._markDefs = function () {\r\n\r\n\t\tvar nodeDefs = this.json.nodes || [];\r\n\t\tvar skinDefs = this.json.skins || [];\r\n\t\tvar meshDefs = this.json.meshes || [];\r\n\r\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\r\n\t\t// Object3D. Use the skins' joint references to mark bones.\r\n\t\tfor ( var skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\r\n\r\n\t\t\tvar joints = skinDefs[ skinIndex ].joints;\r\n\r\n\t\t\tfor ( var i = 0, il = joints.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Iterate over all nodes, marking references to shared resources,\r\n\t\t// as well as skeleton joints.\r\n\t\tfor ( var nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\r\n\r\n\t\t\tvar nodeDef = nodeDefs[ nodeIndex ];\r\n\r\n\t\t\tif ( nodeDef.mesh !== undefined ) {\r\n\r\n\t\t\t\tthis._addNodeRef( this.meshCache, nodeDef.mesh );\r\n\r\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\r\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\r\n\t\t\t\t// to mark SkinnedMesh if node has skin.\r\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\r\n\r\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.camera !== undefined ) {\r\n\r\n\t\t\t\tthis._addNodeRef( this.cameraCache, nodeDef.camera );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Counts references to shared node / Object3D resources. These resources\r\n\t * can be reused, or \"instantiated\", at multiple nodes in the scene\r\n\t * hierarchy. Mesh, Camera, and Light instances are instantiated and must\r\n\t * be marked. Non-scenegraph resources (like Materials, Geometries, and\r\n\t * Textures) can be reused directly and are not marked here.\r\n\t *\r\n\t * Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\r\n\t */\r\n\tGLTFParser.prototype._addNodeRef = function ( cache, index ) {\r\n\r\n\t\tif ( index === undefined ) return;\r\n\r\n\t\tif ( cache.refs[ index ] === undefined ) {\r\n\r\n\t\t\tcache.refs[ index ] = cache.uses[ index ] = 0;\r\n\r\n\t\t}\r\n\r\n\t\tcache.refs[ index ] ++;\r\n\r\n\t};\r\n\r\n\t/** Returns a reference to a shared resource, cloning it if necessary. */\r\n\tGLTFParser.prototype._getNodeRef = function ( cache, index, object ) {\r\n\r\n\t\tif ( cache.refs[ index ] <= 1 ) return object;\r\n\r\n\t\tvar ref = object.clone();\r\n\r\n\t\tref.name += '_instance_' + ( cache.uses[ index ] ++ );\r\n\r\n\t\treturn ref;\r\n\r\n\t};\r\n\r\n\tGLTFParser.prototype._invokeOne = function ( func ) {\r\n\r\n\t\tvar extensions = Object.values( this.plugins );\r\n\t\textensions.push( this );\r\n\r\n\t\tfor ( var i = 0; i < extensions.length; i ++ ) {\r\n\r\n\t\t\tvar result = func( extensions[ i ] );\r\n\r\n\t\t\tif ( result ) return result;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tGLTFParser.prototype._invokeAll = function ( func ) {\r\n\r\n\t\tvar extensions = Object.values( this.plugins );\r\n\t\textensions.unshift( this );\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tfor ( var i = 0; i < extensions.length; i ++ ) {\r\n\r\n\t\t\tvar result = func( extensions[ i ] );\r\n\r\n\t\t\tif ( result ) pending.push( result );\r\n\r\n\t\t}\r\n\r\n\t\treturn pending;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Requests the specified dependency asynchronously, with caching.\r\n\t * @param {string} type\r\n\t * @param {number} index\r\n\t * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}\r\n\t */\r\n\tGLTFParser.prototype.getDependency = function ( type, index ) {\r\n\r\n\t\tvar cacheKey = type + ':' + index;\r\n\t\tvar dependency = this.cache.get( cacheKey );\r\n\r\n\t\tif ( ! dependency ) {\r\n\r\n\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\tcase 'scene':\r\n\t\t\t\t\tdependency = this.loadScene( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'node':\r\n\t\t\t\t\tdependency = this.loadNode( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'mesh':\r\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\t\t\treturn ext.loadMesh && ext.loadMesh( index );\r\n\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'accessor':\r\n\t\t\t\t\tdependency = this.loadAccessor( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'bufferView':\r\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\t\t\treturn ext.loadBufferView && ext.loadBufferView( index );\r\n\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'buffer':\r\n\t\t\t\t\tdependency = this.loadBuffer( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'material':\r\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\t\t\treturn ext.loadMaterial && ext.loadMaterial( index );\r\n\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'texture':\r\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\t\t\treturn ext.loadTexture && ext.loadTexture( index );\r\n\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'skin':\r\n\t\t\t\t\tdependency = this.loadSkin( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'animation':\r\n\t\t\t\t\tdependency = this.loadAnimation( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'camera':\r\n\t\t\t\t\tdependency = this.loadCamera( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow new Error( 'Unknown type: ' + type );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.cache.add( cacheKey, dependency );\r\n\r\n\t\t}\r\n\r\n\t\treturn dependency;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Requests all dependencies of the specified type asynchronously, with caching.\r\n\t * @param {string} type\r\n\t * @return {Promise<Array<Object>>}\r\n\t */\r\n\tGLTFParser.prototype.getDependencies = function ( type ) {\r\n\r\n\t\tvar dependencies = this.cache.get( type );\r\n\r\n\t\tif ( ! dependencies ) {\r\n\r\n\t\t\tvar parser = this;\r\n\t\t\tvar defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\r\n\r\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\r\n\r\n\t\t\t\treturn parser.getDependency( type, index );\r\n\r\n\t\t\t} ) );\r\n\r\n\t\t\tthis.cache.add( type, dependencies );\r\n\r\n\t\t}\r\n\r\n\t\treturn dependencies;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n\t * @param {number} bufferIndex\r\n\t * @return {Promise<ArrayBuffer>}\r\n\t */\r\n\tGLTFParser.prototype.loadBuffer = function ( bufferIndex ) {\r\n\r\n\t\tvar bufferDef = this.json.buffers[ bufferIndex ];\r\n\t\tvar loader = this.fileLoader;\r\n\r\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\r\n\r\n\t\t}\r\n\r\n\t\t// If present, GLB container is required to be the first buffer.\r\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\r\n\r\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\r\n\r\n\t\t}\r\n\r\n\t\tvar options = this.options;\r\n\r\n\t\treturn new Promise( function ( resolve, reject ) {\r\n\r\n\t\t\tloader.load( resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\r\n\r\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n\t * @param {number} bufferViewIndex\r\n\t * @return {Promise<ArrayBuffer>}\r\n\t */\r\n\tGLTFParser.prototype.loadBufferView = function ( bufferViewIndex ) {\r\n\r\n\t\tvar bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\r\n\r\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\r\n\r\n\t\t\tvar byteLength = bufferViewDef.byteLength || 0;\r\n\t\t\tvar byteOffset = bufferViewDef.byteOffset || 0;\r\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\r\n\t * @param {number} accessorIndex\r\n\t * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\r\n\t */\r\n\tGLTFParser.prototype.loadAccessor = function ( accessorIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\r\n\t\tvar accessorDef = this.json.accessors[ accessorIndex ];\r\n\r\n\t\tif ( accessorDef.bufferView === undefined && accessorDef.sparse === undefined ) {\r\n\r\n\t\t\t// Ignore empty accessors, which may be used to declare runtime\r\n\t\t\t// information about attributes coming from another source (e.g. Draco\r\n\t\t\t// compression extension).\r\n\t\t\treturn Promise.resolve( null );\r\n\r\n\t\t}\r\n\r\n\t\tvar pendingBufferViews = [];\r\n\r\n\t\tif ( accessorDef.bufferView !== undefined ) {\r\n\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tpendingBufferViews.push( null );\r\n\r\n\t\t}\r\n\r\n\t\tif ( accessorDef.sparse !== undefined ) {\r\n\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\r\n\r\n\t\t\tvar bufferView = bufferViews[ 0 ];\r\n\r\n\t\t\tvar itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\r\n\t\t\tvar TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\r\n\r\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\r\n\t\t\tvar elementBytes = TypedArray.BYTES_PER_ELEMENT;\r\n\t\t\tvar itemBytes = elementBytes * itemSize;\r\n\t\t\tvar byteOffset = accessorDef.byteOffset || 0;\r\n\t\t\tvar byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[ accessorDef.bufferView ].byteStride : undefined;\r\n\t\t\tvar normalized = accessorDef.normalized === true;\r\n\t\t\tvar array, bufferAttribute;\r\n\r\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\r\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\r\n\r\n\t\t\t\t// Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\r\n\t\t\t\t// This makes sure that IBA.count reflects accessor.count properly\r\n\t\t\t\tvar ibSlice = Math.floor( byteOffset / byteStride );\r\n\t\t\t\tvar ibCacheKey = 'InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;\r\n\t\t\t\tvar ib = parser.cache.get( ibCacheKey );\r\n\r\n\t\t\t\tif ( ! ib ) {\r\n\r\n\t\t\t\t\tarray = new TypedArray( bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes );\r\n\r\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\r\n\t\t\t\t\tib = new InterleavedBuffer( array, byteStride / elementBytes );\r\n\r\n\t\t\t\t\tparser.cache.add( ibCacheKey, ib );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbufferAttribute = new InterleavedBufferAttribute( ib, itemSize, ( byteOffset % byteStride ) / elementBytes, normalized );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( bufferView === null ) {\r\n\r\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tarray = new TypedArray( bufferView, byteOffset, accessorDef.count * itemSize );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbufferAttribute = new BufferAttribute( array, itemSize, normalized );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\r\n\t\t\tif ( accessorDef.sparse !== undefined ) {\r\n\r\n\t\t\t\tvar itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\r\n\t\t\t\tvar TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\r\n\r\n\t\t\t\tvar byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\r\n\t\t\t\tvar byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\r\n\r\n\t\t\t\tvar sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\r\n\t\t\t\tvar sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\r\n\r\n\t\t\t\tif ( bufferView !== null ) {\r\n\r\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\r\n\t\t\t\t\tbufferAttribute = new BufferAttribute( bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( var i = 0, il = sparseIndices.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tvar index = sparseIndices[ i ];\r\n\r\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\r\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\r\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\r\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\r\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn bufferAttribute;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\r\n\t * @param {number} textureIndex\r\n\t * @return {Promise<THREE.Texture>}\r\n\t */\r\n\tGLTFParser.prototype.loadTexture = function ( textureIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar options = this.options;\r\n\r\n\t\tvar textureDef = json.textures[ textureIndex ];\r\n\r\n\t\tvar textureExtensions = textureDef.extensions || {};\r\n\r\n\t\tvar source;\r\n\r\n\t\tif ( textureExtensions[ EXTENSIONS.MSFT_TEXTURE_DDS ] ) {\r\n\r\n\t\t\tsource = json.images[ textureExtensions[ EXTENSIONS.MSFT_TEXTURE_DDS ].source ];\r\n\r\n\t\t} else {\r\n\r\n\t\t\tsource = json.images[ textureDef.source ];\r\n\r\n\t\t}\r\n\r\n\t\tvar loader;\r\n\r\n\t\tif ( source.uri ) {\r\n\r\n\t\t\tloader = options.manager.getHandler( source.uri );\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! loader ) {\r\n\r\n\t\t\tloader = textureExtensions[ EXTENSIONS.MSFT_TEXTURE_DDS ]\r\n\t\t\t\t? parser.extensions[ EXTENSIONS.MSFT_TEXTURE_DDS ].ddsLoader\r\n\t\t\t\t: this.textureLoader;\r\n\r\n\t\t}\r\n\r\n\t\treturn this.loadTextureImage( textureIndex, source, loader );\r\n\r\n\t};\r\n\r\n\tGLTFParser.prototype.loadTextureImage = function ( textureIndex, source, loader ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar options = this.options;\r\n\r\n\t\tvar textureDef = json.textures[ textureIndex ];\r\n\r\n\t\tvar URL = self.URL || self.webkitURL;\r\n\r\n\t\tvar sourceURI = source.uri;\r\n\t\tvar isObjectURL = false;\r\n\t\tvar hasAlpha = true;\r\n\r\n\t\tif ( source.mimeType === 'image/jpeg' ) hasAlpha = false;\r\n\r\n\t\tif ( source.bufferView !== undefined ) {\r\n\r\n\t\t\t// Load binary image data from bufferView, if provided.\r\n\t\t\t\r\n\t\t\tsourceURI = parser.getDependency( 'bufferView', source.bufferView ).then( function ( bufferView ) {\r\n\r\n\t\t\t\tif ( source.mimeType === 'image/png' ) {\r\n\r\n\t\t\t\t\t// Inspect the PNG 'IHDR' chunk to determine whether the image could have an\r\n\t\t\t\t\t// alpha channel. This check is conservative — the image could have an alpha\r\n\t\t\t\t\t// channel with all values == 1, and the indexed type (colorType == 3) only\r\n\t\t\t\t\t// sometimes contains alpha.\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// https://en.wikipedia.org/wiki/Portable_Network_Graphics#File_header\r\n\t\t\t\t\tvar colorType = new DataView( bufferView, 25, 1 ).getUint8( 0, false );\r\n\t\t\t\t\thasAlpha = colorType === 6 || colorType === 4 || colorType === 3;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tisObjectURL = true;\r\n\t\t\t\tvar blob = new Blob( [ bufferView ], { type: source.mimeType } );\r\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\r\n\t\t\t\treturn sourceURI;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve( sourceURI ).then( function ( sourceURI ) {\r\n\r\n\t\t\treturn new Promise( function ( resolve, reject ) {\r\n\r\n\t\t\t\tvar onLoad = resolve;\r\n\r\n\t\t\t\tif ( loader.isImageBitmapLoader === true ) {\r\n\r\n\t\t\t\t\tonLoad = function ( imageBitmap ) {\r\n\r\n\t\t\t\t\t\tresolve( new CanvasTexture( imageBitmap ) );\r\n\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tloader.load( resolveURL( sourceURI, options.path ), onLoad, undefined, reject );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} ).then( function ( texture ) {\r\n\r\n\t\t\t// Clean up resources and configure Texture.\r\n\r\n\t\t\tif ( isObjectURL === true ) {\r\n\r\n\t\t\t\tURL.revokeObjectURL( sourceURI );\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture.flipY = false;\r\n\r\n\t\t\tif ( textureDef.name ) texture.name = textureDef.name;\r\n\r\n\t\t\t// When there is definitely no alpha channel in the texture, set RGBFormat to save space.\r\n\t\t\tif ( ! hasAlpha ) texture.format = RGBFormat;\r\n\r\n\t\t\tvar samplers = json.samplers || {};\r\n\t\t\tvar sampler = samplers[ textureDef.sampler ] || {};\r\n\r\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;\r\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || LinearMipmapLinearFilter;\r\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;\r\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;\r\n\r\n\t\t\tparser.associations.set( texture, {\r\n\t\t\t\ttype: 'textures',\r\n\t\t\t\tindex: textureIndex\r\n\t\t\t} );\r\n\r\n\t\t\treturn texture;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Asynchronously assigns a texture to the given material parameters.\r\n\t * @param {Object} materialParams\r\n\t * @param {string} mapName\r\n\t * @param {Object} mapDef\r\n\t * @return {Promise}\r\n\t */\r\n\tGLTFParser.prototype.assignTexture = function ( materialParams, mapName, mapDef ) {\r\n\r\n\t\tvar parser = this;\r\n\r\n\t\treturn this.getDependency( 'texture', mapDef.index ).then( function ( texture ) {\r\n\r\n\t\t\t// Materials sample aoMap from UV set 1 and other maps from UV set 0 - this can't be configured\r\n\t\t\t// However, we will copy UV set 0 to UV set 1 on demand for aoMap\r\n\t\t\tif ( mapDef.texCoord !== undefined && mapDef.texCoord != 0 && ! ( mapName === 'aoMap' && mapDef.texCoord == 1 ) ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV set ' + mapDef.texCoord + ' for texture ' + mapName + ' not yet supported.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] ) {\r\n\r\n\t\t\t\tvar transform = mapDef.extensions !== undefined ? mapDef.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] : undefined;\r\n\r\n\t\t\t\tif ( transform ) {\r\n\r\n\t\t\t\t\tvar gltfReference = parser.associations.get( texture );\r\n\t\t\t\t\ttexture = parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ].extendTexture( texture, transform );\r\n\t\t\t\t\tparser.associations.set( texture, gltfReference );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterialParams[ mapName ] = texture;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Assigns final material to a Mesh, Line, or Points instance. The instance\r\n\t * already has a material (generated from the glTF material options alone)\r\n\t * but reuse of the same glTF material may require multiple threejs materials\r\n\t * to accomodate different primitive types, defines, etc. New materials will\r\n\t * be created if necessary, and reused from a cache.\r\n\t * @param  {Object3D} mesh Mesh, Line, or Points instance.\r\n\t */\r\n\tGLTFParser.prototype.assignFinalMaterial = function ( mesh ) {\r\n\r\n\t\tvar geometry = mesh.geometry;\r\n\t\tvar material = mesh.material;\r\n\r\n\t\tvar useVertexTangents = geometry.attributes.tangent !== undefined;\r\n\t\tvar useVertexColors = geometry.attributes.color !== undefined;\r\n\t\tvar useFlatShading = geometry.attributes.normal === undefined;\r\n\t\tvar useSkinning = mesh.isSkinnedMesh === true;\r\n\t\tvar useMorphTargets = Object.keys( geometry.morphAttributes ).length > 0;\r\n\t\tvar useMorphNormals = useMorphTargets && geometry.morphAttributes.normal !== undefined;\r\n\r\n\t\tif ( mesh.isPoints ) {\r\n\r\n\t\t\tvar cacheKey = 'PointsMaterial:' + material.uuid;\r\n\r\n\t\t\tvar pointsMaterial = this.cache.get( cacheKey );\r\n\r\n\t\t\tif ( ! pointsMaterial ) {\r\n\r\n\t\t\t\tpointsMaterial = new PointsMaterial();\r\n\t\t\t\tMaterial.prototype.copy.call( pointsMaterial, material );\r\n\t\t\t\tpointsMaterial.color.copy( material.color );\r\n\t\t\t\tpointsMaterial.map = material.map;\r\n\t\t\t\tpointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\r\n\r\n\t\t\t\tthis.cache.add( cacheKey, pointsMaterial );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = pointsMaterial;\r\n\r\n\t\t} else if ( mesh.isLine ) {\r\n\r\n\t\t\tvar cacheKey = 'LineBasicMaterial:' + material.uuid;\r\n\r\n\t\t\tvar lineMaterial = this.cache.get( cacheKey );\r\n\r\n\t\t\tif ( ! lineMaterial ) {\r\n\r\n\t\t\t\tlineMaterial = new LineBasicMaterial();\r\n\t\t\t\tMaterial.prototype.copy.call( lineMaterial, material );\r\n\t\t\t\tlineMaterial.color.copy( material.color );\r\n\r\n\t\t\t\tthis.cache.add( cacheKey, lineMaterial );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = lineMaterial;\r\n\r\n\t\t}\r\n\r\n\t\t// Clone the material if it will be modified\r\n\t\tif ( useVertexTangents || useVertexColors || useFlatShading || useSkinning || useMorphTargets ) {\r\n\r\n\t\t\tvar cacheKey = 'ClonedMaterial:' + material.uuid + ':';\r\n\r\n\t\t\tif ( material.isGLTFSpecularGlossinessMaterial ) cacheKey += 'specular-glossiness:';\r\n\t\t\tif ( useSkinning ) cacheKey += 'skinning:';\r\n\t\t\tif ( useVertexTangents ) cacheKey += 'vertex-tangents:';\r\n\t\t\tif ( useVertexColors ) cacheKey += 'vertex-colors:';\r\n\t\t\tif ( useFlatShading ) cacheKey += 'flat-shading:';\r\n\t\t\tif ( useMorphTargets ) cacheKey += 'morph-targets:';\r\n\t\t\tif ( useMorphNormals ) cacheKey += 'morph-normals:';\r\n\r\n\t\t\tvar cachedMaterial = this.cache.get( cacheKey );\r\n\r\n\t\t\tif ( ! cachedMaterial ) {\r\n\r\n\t\t\t\tcachedMaterial = material.clone();\r\n\r\n\t\t\t\tif ( useSkinning ) cachedMaterial.skinning = true;\r\n\t\t\t\tif ( useVertexTangents ) cachedMaterial.vertexTangents = true;\r\n\t\t\t\tif ( useVertexColors ) cachedMaterial.vertexColors = true;\r\n\t\t\t\tif ( useFlatShading ) cachedMaterial.flatShading = true;\r\n\t\t\t\tif ( useMorphTargets ) cachedMaterial.morphTargets = true;\r\n\t\t\t\tif ( useMorphNormals ) cachedMaterial.morphNormals = true;\r\n\r\n\t\t\t\tthis.cache.add( cacheKey, cachedMaterial );\r\n\r\n\t\t\t\tthis.associations.set( cachedMaterial, this.associations.get( material ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = cachedMaterial;\r\n\r\n\t\t}\r\n\r\n\t\t// workarounds for mesh and geometry\r\n\r\n\t\tif ( material.aoMap && geometry.attributes.uv2 === undefined && geometry.attributes.uv !== undefined ) {\r\n\r\n\t\t\tgeometry.setAttribute( 'uv2', geometry.attributes.uv );\r\n\r\n\t\t}\r\n\r\n\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\r\n\t\tif ( material.normalScale && ! useVertexTangents ) {\r\n\r\n\t\t\tmaterial.normalScale.y = - material.normalScale.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.clearcoatNormalScale && ! useVertexTangents ) {\r\n\r\n\t\t\tmaterial.clearcoatNormalScale.y = - material.clearcoatNormalScale.y;\r\n\r\n\t\t}\r\n\r\n\t\tmesh.material = material;\r\n\r\n\t};\r\n\r\n\tGLTFParser.prototype.getMaterialType = function ( /* materialIndex */ ) {\r\n\r\n\t\treturn MeshStandardMaterial;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\r\n\t * @param {number} materialIndex\r\n\t * @return {Promise<Material>}\r\n\t */\r\n\tGLTFParser.prototype.loadMaterial = function ( materialIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\t\tvar materialDef = json.materials[ materialIndex ];\r\n\r\n\t\tvar materialType;\r\n\t\tvar materialParams = {};\r\n\t\tvar materialExtensions = materialDef.extensions || {};\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] ) {\r\n\r\n\t\t\tvar sgExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\r\n\t\t\tmaterialType = sgExtension.getMaterialType();\r\n\t\t\tpending.push( sgExtension.extendParams( materialParams, materialDef, parser ) );\r\n\r\n\t\t} else if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ] ) {\r\n\r\n\t\t\tvar kmuExtension = extensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ];\r\n\t\t\tmaterialType = kmuExtension.getMaterialType();\r\n\t\t\tpending.push( kmuExtension.extendParams( materialParams, materialDef, parser ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// Specification:\r\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\r\n\r\n\t\t\tvar metallicRoughness = materialDef.pbrMetallicRoughness || {};\r\n\r\n\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\r\n\t\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\r\n\r\n\t\t\t\tvar array = metallicRoughness.baseColorFactor;\r\n\r\n\t\t\t\tmaterialParams.color.fromArray( array );\r\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\r\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\r\n\r\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture ) );\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterialType = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\treturn ext.getMaterialType && ext.getMaterialType( materialIndex );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tpending.push( Promise.all( this._invokeAll( function ( ext ) {\r\n\r\n\t\t\t\treturn ext.extendMaterialParams && ext.extendMaterialParams( materialIndex, materialParams );\r\n\r\n\t\t\t} ) ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.doubleSided === true ) {\r\n\r\n\t\t\tmaterialParams.side = DoubleSide;\r\n\r\n\t\t}\r\n\r\n\t\tvar alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\r\n\r\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\r\n\r\n\t\t\tmaterialParams.transparent = true;\r\n\r\n\t\t\t// See: https://github.com/mrdoob/three.js/issues/17706\r\n\t\t\tmaterialParams.depthWrite = false;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmaterialParams.transparent = false;\r\n\r\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\r\n\r\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture ) );\r\n\r\n\t\t\tmaterialParams.normalScale = new Vector2( 1, 1 );\r\n\r\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\r\n\r\n\t\t\t\tmaterialParams.normalScale.set( materialDef.normalTexture.scale, materialDef.normalTexture.scale );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture ) );\r\n\r\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\r\n\r\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tmaterialParams.emissive = new Color().fromArray( materialDef.emissiveFactor );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending ).then( function () {\r\n\r\n\t\t\tvar material;\r\n\r\n\t\t\tif ( materialType === GLTFMeshStandardSGMaterial ) {\r\n\r\n\t\t\t\tmaterial = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].createMaterial( materialParams );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmaterial = new materialType( materialParams );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialDef.name ) material.name = materialDef.name;\r\n\r\n\t\t\t// baseColorTexture, emissiveTexture, and specularGlossinessTexture use sRGB encoding.\r\n\t\t\tif ( material.map ) material.map.encoding = sRGBEncoding;\r\n\t\t\tif ( material.emissiveMap ) material.emissiveMap.encoding = sRGBEncoding;\r\n\r\n\t\t\tassignExtrasToUserData( material, materialDef );\r\n\r\n\t\t\tparser.associations.set( material, { type: 'materials', index: materialIndex } );\r\n\r\n\t\t\tif ( materialDef.extensions ) addUnknownExtensionsToUserData( extensions, material, materialDef );\r\n\r\n\t\t\treturn material;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/** When Object3D instances are targeted by animation, they need unique names. */\r\n\tGLTFParser.prototype.createUniqueName = function ( originalName ) {\r\n\r\n\t\tvar name = PropertyBinding.sanitizeNodeName( originalName || '' );\r\n\r\n\t\tfor ( var i = 1; this.nodeNamesUsed[ name ]; ++ i ) {\r\n\r\n\t\t\tname = originalName + '_' + i;\r\n\r\n\t\t}\r\n\r\n\t\tthis.nodeNamesUsed[ name ] = true;\r\n\r\n\t\treturn name;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {GLTF.Primitive} primitiveDef\r\n\t * @param {GLTFParser} parser\r\n\t */\r\n\tfunction computeBounds( geometry, primitiveDef, parser ) {\r\n\r\n\t\tvar attributes = primitiveDef.attributes;\r\n\r\n\t\tvar box = new Box3();\r\n\r\n\t\tif ( attributes.POSITION !== undefined ) {\r\n\r\n\t\t\tvar accessor = parser.json.accessors[ attributes.POSITION ];\r\n\r\n\t\t\tvar min = accessor.min;\r\n\t\t\tvar max = accessor.max;\r\n\r\n\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\r\n\r\n\t\t\tif ( min !== undefined && max !== undefined ) {\r\n\r\n\t\t\t\tbox.set(\r\n\t\t\t\t\tnew Vector3( min[ 0 ], min[ 1 ], min[ 2 ] ),\r\n\t\t\t\t\tnew Vector3( max[ 0 ], max[ 1 ], max[ 2 ] ) );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar targets = primitiveDef.targets;\r\n\r\n\t\tif ( targets !== undefined ) {\r\n\r\n\t\t\tvar maxDisplacement = new Vector3();\r\n\t\t\tvar vector = new Vector3();\r\n\r\n\t\t\tfor ( var i = 0, il = targets.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar target = targets[ i ];\r\n\r\n\t\t\t\tif ( target.POSITION !== undefined ) {\r\n\r\n\t\t\t\t\tvar accessor = parser.json.accessors[ target.POSITION ];\r\n\t\t\t\t\tvar min = accessor.min;\r\n\t\t\t\t\tvar max = accessor.max;\r\n\r\n\t\t\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\r\n\r\n\t\t\t\t\tif ( min !== undefined && max !== undefined ) {\r\n\r\n\t\t\t\t\t\t// we need to get max of absolute components because target weight is [-1,1]\r\n\t\t\t\t\t\tvector.setX( Math.max( Math.abs( min[ 0 ] ), Math.abs( max[ 0 ] ) ) );\r\n\t\t\t\t\t\tvector.setY( Math.max( Math.abs( min[ 1 ] ), Math.abs( max[ 1 ] ) ) );\r\n\t\t\t\t\t\tvector.setZ( Math.max( Math.abs( min[ 2 ] ), Math.abs( max[ 2 ] ) ) );\r\n\r\n\t\t\t\t\t\t// Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative\r\n\t\t\t\t\t\t// to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets\r\n\t\t\t\t\t\t// are used to implement key-frame animations and as such only two are active at a time - this results in very large\r\n\t\t\t\t\t\t// boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.\r\n\t\t\t\t\t\tmaxDisplacement.max( vector );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.\r\n\t\t\tbox.expandByVector( maxDisplacement );\r\n\r\n\t\t}\r\n\r\n\t\tgeometry.boundingBox = box;\r\n\r\n\t\tvar sphere = new Sphere();\r\n\r\n\t\tbox.getCenter( sphere.center );\r\n\t\tsphere.radius = box.min.distanceTo( box.max ) / 2;\r\n\r\n\t\tgeometry.boundingSphere = sphere;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {GLTF.Primitive} primitiveDef\r\n\t * @param {GLTFParser} parser\r\n\t * @return {Promise<BufferGeometry>}\r\n\t */\r\n\tfunction addPrimitiveAttributes( geometry, primitiveDef, parser ) {\r\n\r\n\t\tvar attributes = primitiveDef.attributes;\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tfunction assignAttributeAccessor( accessorIndex, attributeName ) {\r\n\r\n\t\t\treturn parser.getDependency( 'accessor', accessorIndex )\r\n\t\t\t\t.then( function ( accessor ) {\r\n\r\n\t\t\t\t\tgeometry.setAttribute( attributeName, accessor );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var gltfAttributeName in attributes ) {\r\n\r\n\t\t\tvar threeAttributeName = ATTRIBUTES[ gltfAttributeName ] || gltfAttributeName.toLowerCase();\r\n\r\n\t\t\t// Skip attributes already provided by e.g. Draco extension.\r\n\t\t\tif ( threeAttributeName in geometry.attributes ) continue;\r\n\r\n\t\t\tpending.push( assignAttributeAccessor( attributes[ gltfAttributeName ], threeAttributeName ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( primitiveDef.indices !== undefined && ! geometry.index ) {\r\n\r\n\t\t\tvar accessor = parser.getDependency( 'accessor', primitiveDef.indices ).then( function ( accessor ) {\r\n\r\n\t\t\t\tgeometry.setIndex( accessor );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tpending.push( accessor );\r\n\r\n\t\t}\r\n\r\n\t\tassignExtrasToUserData( geometry, primitiveDef );\r\n\r\n\t\tcomputeBounds( geometry, primitiveDef, parser );\r\n\r\n\t\treturn Promise.all( pending ).then( function () {\r\n\r\n\t\t\treturn primitiveDef.targets !== undefined\r\n\t\t\t\t? addMorphTargets( geometry, primitiveDef.targets, parser )\r\n\t\t\t\t: geometry;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {Number} drawMode\r\n\t * @return {BufferGeometry}\r\n\t */\r\n\tfunction toTrianglesDrawMode( geometry, drawMode ) {\r\n\r\n\t\tvar index = geometry.getIndex();\r\n\r\n\t\t// generate index if not present\r\n\r\n\t\tif ( index === null ) {\r\n\r\n\t\t\tvar indices = [];\r\n\r\n\t\t\tvar position = geometry.getAttribute( 'position' );\r\n\r\n\t\t\tif ( position !== undefined ) {\r\n\r\n\t\t\t\tfor ( var i = 0; i < position.count; i ++ ) {\r\n\r\n\t\t\t\t\tindices.push( i );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.setIndex( indices );\r\n\t\t\t\tindex = geometry.getIndex();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.error( 'THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );\r\n\t\t\t\treturn geometry;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tvar numberOfTriangles = index.count - 2;\r\n\t\tvar newIndices = [];\r\n\r\n\t\tif ( drawMode === TriangleFanDrawMode ) {\r\n\r\n\t\t\t// gl.TRIANGLE_FAN\r\n\r\n\t\t\tfor ( var i = 1; i <= numberOfTriangles; i ++ ) {\r\n\r\n\t\t\t\tnewIndices.push( index.getX( 0 ) );\r\n\t\t\t\tnewIndices.push( index.getX( i ) );\r\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// gl.TRIANGLE_STRIP\r\n\r\n\t\t\tfor ( var i = 0; i < numberOfTriangles; i ++ ) {\r\n\r\n\t\t\t\tif ( i % 2 === 0 ) {\r\n\r\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\r\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\r\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\r\n\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\r\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\r\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( ( newIndices.length / 3 ) !== numberOfTriangles ) {\r\n\r\n\t\t\tconsole.error( 'THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );\r\n\r\n\t\t}\r\n\r\n\t\t// build final geometry\r\n\r\n\t\tvar newGeometry = geometry.clone();\r\n\t\tnewGeometry.setIndex( newIndices );\r\n\r\n\t\treturn newGeometry;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\r\n\t *\r\n\t * Creates BufferGeometries from primitives.\r\n\t *\r\n\t * @param {Array<GLTF.Primitive>} primitives\r\n\t * @return {Promise<Array<BufferGeometry>>}\r\n\t */\r\n\tGLTFParser.prototype.loadGeometries = function ( primitives ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar extensions = this.extensions;\r\n\t\tvar cache = this.primitiveCache;\r\n\r\n\t\tfunction createDracoPrimitive( primitive ) {\r\n\r\n\t\t\treturn extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ]\r\n\t\t\t\t.decodePrimitive( primitive, parser )\r\n\t\t\t\t.then( function ( geometry ) {\r\n\r\n\t\t\t\t\treturn addPrimitiveAttributes( geometry, primitive, parser );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tfor ( var i = 0, il = primitives.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar primitive = primitives[ i ];\r\n\t\t\tvar cacheKey = createPrimitiveKey( primitive );\r\n\r\n\t\t\t// See if we've already created this geometry\r\n\t\t\tvar cached = cache[ cacheKey ];\r\n\r\n\t\t\tif ( cached ) {\r\n\r\n\t\t\t\t// Use the cached geometry if it exists\r\n\t\t\t\tpending.push( cached.promise );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar geometryPromise;\r\n\r\n\t\t\t\tif ( primitive.extensions && primitive.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ] ) {\r\n\r\n\t\t\t\t\t// Use DRACO geometry if available\r\n\t\t\t\t\tgeometryPromise = createDracoPrimitive( primitive );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// Otherwise create a new geometry\r\n\t\t\t\t\tgeometryPromise = addPrimitiveAttributes( new BufferGeometry(), primitive, parser );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Cache this geometry\r\n\t\t\t\tcache[ cacheKey ] = { primitive: primitive, promise: geometryPromise };\r\n\r\n\t\t\t\tpending.push( geometryPromise );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\r\n\t * @param {number} meshIndex\r\n\t * @return {Promise<Group|Mesh|SkinnedMesh>}\r\n\t */\r\n\tGLTFParser.prototype.loadMesh = function ( meshIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\r\n\t\tvar meshDef = json.meshes[ meshIndex ];\r\n\t\tvar primitives = meshDef.primitives;\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tfor ( var i = 0, il = primitives.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar material = primitives[ i ].material === undefined\r\n\t\t\t\t? createDefaultMaterial( this.cache )\r\n\t\t\t\t: this.getDependency( 'material', primitives[ i ].material );\r\n\r\n\t\t\tpending.push( material );\r\n\r\n\t\t}\r\n\r\n\t\tpending.push( parser.loadGeometries( primitives ) );\r\n\r\n\t\treturn Promise.all( pending ).then( function ( results ) {\r\n\r\n\t\t\tvar materials = results.slice( 0, results.length - 1 );\r\n\t\t\tvar geometries = results[ results.length - 1 ];\r\n\r\n\t\t\tvar meshes = [];\r\n\r\n\t\t\tfor ( var i = 0, il = geometries.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar geometry = geometries[ i ];\r\n\t\t\t\tvar primitive = primitives[ i ];\r\n\r\n\t\t\t\t// 1. create Mesh\r\n\r\n\t\t\t\tvar mesh;\r\n\r\n\t\t\t\tvar material = materials[ i ];\r\n\r\n\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\r\n\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\r\n\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\r\n\t\t\t\t\tprimitive.mode === undefined ) {\r\n\r\n\t\t\t\t\t// .isSkinnedMesh isn't in glTF spec. See ._markDefs()\r\n\t\t\t\t\tmesh = meshDef.isSkinnedMesh === true\r\n\t\t\t\t\t\t? new SkinnedMesh( geometry, material )\r\n\t\t\t\t\t\t: new Mesh( geometry, material );\r\n\r\n\t\t\t\t\tif ( mesh.isSkinnedMesh === true && ! mesh.geometry.attributes.skinWeight.normalized ) {\r\n\r\n\t\t\t\t\t\t// we normalize floating point skin weight array to fix malformed assets (see #15319)\r\n\t\t\t\t\t\t// it's important to skip this for non-float32 data since normalizeSkinWeights assumes non-normalized inputs\r\n\t\t\t\t\t\tmesh.normalizeSkinWeights();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\r\n\r\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleStripDrawMode );\r\n\r\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\r\n\r\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleFanDrawMode );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\r\n\r\n\t\t\t\t\tmesh = new LineSegments( geometry, material );\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\r\n\r\n\t\t\t\t\tmesh = new Line( geometry, material );\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\r\n\r\n\t\t\t\t\tmesh = new LineLoop( geometry, material );\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\r\n\r\n\t\t\t\t\tmesh = new Points( geometry, material );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( Object.keys( mesh.geometry.morphAttributes ).length > 0 ) {\r\n\r\n\t\t\t\t\tupdateMorphTargets( mesh, meshDef );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmesh.name = parser.createUniqueName( meshDef.name || ( 'mesh_' + meshIndex ) );\r\n\r\n\t\t\t\tassignExtrasToUserData( mesh, meshDef );\r\n\r\n\t\t\t\tif ( primitive.extensions ) addUnknownExtensionsToUserData( extensions, mesh, primitive );\r\n\r\n\t\t\t\tparser.assignFinalMaterial( mesh );\r\n\r\n\t\t\t\tmeshes.push( mesh );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( meshes.length === 1 ) {\r\n\r\n\t\t\t\treturn meshes[ 0 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar group = new Group();\r\n\r\n\t\t\tfor ( var i = 0, il = meshes.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tgroup.add( meshes[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn group;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\r\n\t * @param {number} cameraIndex\r\n\t * @return {Promise<THREE.Camera>}\r\n\t */\r\n\tGLTFParser.prototype.loadCamera = function ( cameraIndex ) {\r\n\r\n\t\tvar camera;\r\n\t\tvar cameraDef = this.json.cameras[ cameraIndex ];\r\n\t\tvar params = cameraDef[ cameraDef.type ];\r\n\r\n\t\tif ( ! params ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( cameraDef.type === 'perspective' ) {\r\n\r\n\t\t\tcamera = new PerspectiveCamera( MathUtils.radToDeg( params.yfov ), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6 );\r\n\r\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\r\n\r\n\t\t\tcamera = new OrthographicCamera( - params.xmag, params.xmag, params.ymag, - params.ymag, params.znear, params.zfar );\r\n\r\n\t\t}\r\n\r\n\t\tif ( cameraDef.name ) camera.name = this.createUniqueName( cameraDef.name );\r\n\r\n\t\tassignExtrasToUserData( camera, cameraDef );\r\n\r\n\t\treturn Promise.resolve( camera );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\r\n\t * @param {number} skinIndex\r\n\t * @return {Promise<Object>}\r\n\t */\r\n\tGLTFParser.prototype.loadSkin = function ( skinIndex ) {\r\n\r\n\t\tvar skinDef = this.json.skins[ skinIndex ];\r\n\r\n\t\tvar skinEntry = { joints: skinDef.joints };\r\n\r\n\t\tif ( skinDef.inverseBindMatrices === undefined ) {\r\n\r\n\t\t\treturn Promise.resolve( skinEntry );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.getDependency( 'accessor', skinDef.inverseBindMatrices ).then( function ( accessor ) {\r\n\r\n\t\t\tskinEntry.inverseBindMatrices = accessor;\r\n\r\n\t\t\treturn skinEntry;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\r\n\t * @param {number} animationIndex\r\n\t * @return {Promise<AnimationClip>}\r\n\t */\r\n\tGLTFParser.prototype.loadAnimation = function ( animationIndex ) {\r\n\r\n\t\tvar json = this.json;\r\n\r\n\t\tvar animationDef = json.animations[ animationIndex ];\r\n\r\n\t\tvar pendingNodes = [];\r\n\t\tvar pendingInputAccessors = [];\r\n\t\tvar pendingOutputAccessors = [];\r\n\t\tvar pendingSamplers = [];\r\n\t\tvar pendingTargets = [];\r\n\r\n\t\tfor ( var i = 0, il = animationDef.channels.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar channel = animationDef.channels[ i ];\r\n\t\t\tvar sampler = animationDef.samplers[ channel.sampler ];\r\n\t\t\tvar target = channel.target;\r\n\t\t\tvar name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\r\n\t\t\tvar input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\r\n\t\t\tvar output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\r\n\r\n\t\t\tpendingNodes.push( this.getDependency( 'node', name ) );\r\n\t\t\tpendingInputAccessors.push( this.getDependency( 'accessor', input ) );\r\n\t\t\tpendingOutputAccessors.push( this.getDependency( 'accessor', output ) );\r\n\t\t\tpendingSamplers.push( sampler );\r\n\t\t\tpendingTargets.push( target );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( [\r\n\r\n\t\t\tPromise.all( pendingNodes ),\r\n\t\t\tPromise.all( pendingInputAccessors ),\r\n\t\t\tPromise.all( pendingOutputAccessors ),\r\n\t\t\tPromise.all( pendingSamplers ),\r\n\t\t\tPromise.all( pendingTargets )\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tvar nodes = dependencies[ 0 ];\r\n\t\t\tvar inputAccessors = dependencies[ 1 ];\r\n\t\t\tvar outputAccessors = dependencies[ 2 ];\r\n\t\t\tvar samplers = dependencies[ 3 ];\r\n\t\t\tvar targets = dependencies[ 4 ];\r\n\r\n\t\t\tvar tracks = [];\r\n\r\n\t\t\tfor ( var i = 0, il = nodes.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar node = nodes[ i ];\r\n\t\t\t\tvar inputAccessor = inputAccessors[ i ];\r\n\t\t\t\tvar outputAccessor = outputAccessors[ i ];\r\n\t\t\t\tvar sampler = samplers[ i ];\r\n\t\t\t\tvar target = targets[ i ];\r\n\r\n\t\t\t\tif ( node === undefined ) continue;\r\n\r\n\t\t\t\tnode.updateMatrix();\r\n\t\t\t\tnode.matrixAutoUpdate = true;\r\n\r\n\t\t\t\tvar TypedKeyframeTrack;\r\n\r\n\t\t\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\r\n\r\n\t\t\t\t\tcase PATH_PROPERTIES.weights:\r\n\r\n\t\t\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase PATH_PROPERTIES.rotation:\r\n\r\n\t\t\t\t\t\tTypedKeyframeTrack = QuaternionKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase PATH_PROPERTIES.position:\r\n\t\t\t\t\tcase PATH_PROPERTIES.scale:\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar targetName = node.name ? node.name : node.uuid;\r\n\r\n\t\t\t\tvar interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;\r\n\r\n\t\t\t\tvar targetNames = [];\r\n\r\n\t\t\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\r\n\r\n\t\t\t\t\t// Node may be a Group (glTF mesh with several primitives) or a Mesh.\r\n\t\t\t\t\tnode.traverse( function ( object ) {\r\n\r\n\t\t\t\t\t\tif ( object.isMesh === true && object.morphTargetInfluences ) {\r\n\r\n\t\t\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttargetNames.push( targetName );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar outputArray = outputAccessor.array;\r\n\r\n\t\t\t\tif ( outputAccessor.normalized ) {\r\n\r\n\t\t\t\t\tvar scale;\r\n\r\n\t\t\t\t\tif ( outputArray.constructor === Int8Array ) {\r\n\r\n\t\t\t\t\t\tscale = 1 / 127;\r\n\r\n\t\t\t\t\t} else if ( outputArray.constructor === Uint8Array ) {\r\n\r\n\t\t\t\t\t\tscale = 1 / 255;\r\n\r\n\t\t\t\t\t} else if ( outputArray.constructor == Int16Array ) {\r\n\r\n\t\t\t\t\t\tscale = 1 / 32767;\r\n\r\n\t\t\t\t\t} else if ( outputArray.constructor === Uint16Array ) {\r\n\r\n\t\t\t\t\t\tscale = 1 / 65535;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported output accessor component type.' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar scaled = new Float32Array( outputArray.length );\r\n\r\n\t\t\t\t\tfor ( var j = 0, jl = outputArray.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\tscaled[ j ] = outputArray[ j ] * scale;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\toutputArray = scaled;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( var j = 0, jl = targetNames.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tvar track = new TypedKeyframeTrack(\r\n\t\t\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\r\n\t\t\t\t\t\tinputAccessor.array,\r\n\t\t\t\t\t\toutputArray,\r\n\t\t\t\t\t\tinterpolation\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// Override interpolation with custom factory method.\r\n\t\t\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\r\n\r\n\t\t\t\t\t\ttrack.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline( result ) {\r\n\r\n\t\t\t\t\t\t\t// A CUBICSPLINE keyframe in glTF has three output values for each input value,\r\n\t\t\t\t\t\t\t// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\r\n\t\t\t\t\t\t\t// must be divided by three to get the interpolant's sampleSize argument.\r\n\r\n\t\t\t\t\t\t\treturn new GLTFCubicSplineInterpolant( this.times, this.values, this.getValueSize() / 3, result );\r\n\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\r\n\t\t\t\t\t\ttrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttracks.push( track );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar name = animationDef.name ? animationDef.name : 'animation_' + animationIndex;\r\n\r\n\t\t\treturn new AnimationClip( name, undefined, tracks );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\r\n\t * @param {number} nodeIndex\r\n\t * @return {Promise<Object3D>}\r\n\t */\r\n\tGLTFParser.prototype.loadNode = function ( nodeIndex ) {\r\n\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\t\tvar parser = this;\r\n\r\n\t\tvar nodeDef = json.nodes[ nodeIndex ];\r\n\r\n\t\t// reserve node's name before its dependencies, so the root has the intended name.\r\n\t\tvar nodeName = nodeDef.name ? parser.createUniqueName( nodeDef.name ) : '';\r\n\r\n\t\treturn ( function () {\r\n\r\n\t\t\tvar pending = [];\r\n\r\n\t\t\tif ( nodeDef.mesh !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.getDependency( 'mesh', nodeDef.mesh ).then( function ( mesh ) {\r\n\r\n\t\t\t\t\tvar node = parser._getNodeRef( parser.meshCache, nodeDef.mesh, mesh );\r\n\r\n\t\t\t\t\t// if weights are provided on the node, override weights on the mesh.\r\n\t\t\t\t\tif ( nodeDef.weights !== undefined ) {\r\n\r\n\t\t\t\t\t\tnode.traverse( function ( o ) {\r\n\r\n\t\t\t\t\t\t\tif ( ! o.isMesh ) return;\r\n\r\n\t\t\t\t\t\t\tfor ( var i = 0, il = nodeDef.weights.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\t\t\to.morphTargetInfluences[ i ] = nodeDef.weights[ i ];\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn node;\r\n\r\n\t\t\t\t} ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.camera !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.getDependency( 'camera', nodeDef.camera ).then( function ( camera ) {\r\n\r\n\t\t\t\t\treturn parser._getNodeRef( parser.cameraCache, nodeDef.camera, camera );\r\n\r\n\t\t\t\t} ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tparser._invokeAll( function ( ext ) {\r\n\r\n\t\t\t\treturn ext.createNodeAttachment && ext.createNodeAttachment( nodeIndex );\r\n\r\n\t\t\t} ).forEach( function ( promise ) {\r\n\r\n\t\t\t\tpending.push( promise );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\treturn Promise.all( pending );\r\n\r\n\t\t}() ).then( function ( objects ) {\r\n\r\n\t\t\tvar node;\r\n\r\n\t\t\t// .isBone isn't in glTF spec. See ._markDefs\r\n\t\t\tif ( nodeDef.isBone === true ) {\r\n\r\n\t\t\t\tnode = new Bone();\r\n\r\n\t\t\t} else if ( objects.length > 1 ) {\r\n\r\n\t\t\t\tnode = new Group();\r\n\r\n\t\t\t} else if ( objects.length === 1 ) {\r\n\r\n\t\t\t\tnode = objects[ 0 ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tnode = new Object3D();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( node !== objects[ 0 ] ) {\r\n\r\n\t\t\t\tfor ( var i = 0, il = objects.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tnode.add( objects[ i ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.name ) {\r\n\r\n\t\t\t\tnode.userData.name = nodeDef.name;\r\n\t\t\t\tnode.name = nodeName;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tassignExtrasToUserData( node, nodeDef );\r\n\r\n\t\t\tif ( nodeDef.extensions ) addUnknownExtensionsToUserData( extensions, node, nodeDef );\r\n\r\n\t\t\tif ( nodeDef.matrix !== undefined ) {\r\n\r\n\t\t\t\tvar matrix = new Matrix4();\r\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\r\n\t\t\t\tnode.applyMatrix4( matrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\r\n\r\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\r\n\r\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\r\n\r\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tparser.associations.set( node, { type: 'nodes', index: nodeIndex } );\r\n\r\n\t\t\treturn node;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\r\n\t * @param {number} sceneIndex\r\n\t * @return {Promise<Group>}\r\n\t */\r\n\tGLTFParser.prototype.loadScene = function () {\r\n\r\n\t\t// scene node hierachy builder\r\n\r\n\t\tfunction buildNodeHierachy( nodeId, parentObject, json, parser ) {\r\n\r\n\t\t\tvar nodeDef = json.nodes[ nodeId ];\r\n\r\n\t\t\treturn parser.getDependency( 'node', nodeId ).then( function ( node ) {\r\n\r\n\t\t\t\tif ( nodeDef.skin === undefined ) return node;\r\n\r\n\t\t\t\t// build skeleton here as well\r\n\r\n\t\t\t\tvar skinEntry;\r\n\r\n\t\t\t\treturn parser.getDependency( 'skin', nodeDef.skin ).then( function ( skin ) {\r\n\r\n\t\t\t\t\tskinEntry = skin;\r\n\r\n\t\t\t\t\tvar pendingJoints = [];\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = skinEntry.joints.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tpendingJoints.push( parser.getDependency( 'node', skinEntry.joints[ i ] ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn Promise.all( pendingJoints );\r\n\r\n\t\t\t\t} ).then( function ( jointNodes ) {\r\n\r\n\t\t\t\t\tnode.traverse( function ( mesh ) {\r\n\r\n\t\t\t\t\t\tif ( ! mesh.isMesh ) return;\r\n\r\n\t\t\t\t\t\tvar bones = [];\r\n\t\t\t\t\t\tvar boneInverses = [];\r\n\r\n\t\t\t\t\t\tfor ( var j = 0, jl = jointNodes.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\t\tvar jointNode = jointNodes[ j ];\r\n\r\n\t\t\t\t\t\t\tif ( jointNode ) {\r\n\r\n\t\t\t\t\t\t\t\tbones.push( jointNode );\r\n\r\n\t\t\t\t\t\t\t\tvar mat = new Matrix4();\r\n\r\n\t\t\t\t\t\t\t\tif ( skinEntry.inverseBindMatrices !== undefined ) {\r\n\r\n\t\t\t\t\t\t\t\t\tmat.fromArray( skinEntry.inverseBindMatrices.array, j * 16 );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tboneInverses.push( mat );\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', skinEntry.joints[ j ] );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tmesh.bind( new Skeleton( bones, boneInverses ), mesh.matrixWorld );\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\treturn node;\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t} ).then( function ( node ) {\r\n\r\n\t\t\t\t// build node hierachy\r\n\r\n\t\t\t\tparentObject.add( node );\r\n\r\n\t\t\t\tvar pending = [];\r\n\r\n\t\t\t\tif ( nodeDef.children ) {\r\n\r\n\t\t\t\t\tvar children = nodeDef.children;\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = children.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar child = children[ i ];\r\n\t\t\t\t\t\tpending.push( buildNodeHierachy( child, node, json, parser ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn Promise.all( pending );\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn function loadScene( sceneIndex ) {\r\n\r\n\t\t\tvar json = this.json;\r\n\t\t\tvar extensions = this.extensions;\r\n\t\t\tvar sceneDef = this.json.scenes[ sceneIndex ];\r\n\t\t\tvar parser = this;\r\n\r\n\t\t\t// Loader returns Group, not Scene.\r\n\t\t\t// See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172\r\n\t\t\tvar scene = new Group();\r\n\t\t\tif ( sceneDef.name ) scene.name = parser.createUniqueName( sceneDef.name );\r\n\r\n\t\t\tassignExtrasToUserData( scene, sceneDef );\r\n\r\n\t\t\tif ( sceneDef.extensions ) addUnknownExtensionsToUserData( extensions, scene, sceneDef );\r\n\r\n\t\t\tvar nodeIds = sceneDef.nodes || [];\r\n\r\n\t\t\tvar pending = [];\r\n\r\n\t\t\tfor ( var i = 0, il = nodeIds.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tpending.push( buildNodeHierachy( nodeIds[ i ], scene, json, parser ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn Promise.all( pending ).then( function () {\r\n\r\n\t\t\t\treturn scene;\r\n\r\n\t\t\t} );\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\treturn GLTFLoader;\r\n\r\n} )();\r\n\r\nexport { GLTFLoader };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/loaders/GLTFLoader.js","import {\r\n\tEventDispatcher,\r\n\tMOUSE,\r\n\tQuaternion,\r\n\tSpherical,\r\n\tTOUCH,\r\n\tVector2,\r\n\tVector3\r\n} from \"@/components/build/three.module.js\";\r\n\r\n// This set of controls performs orbiting, dollying (zooming), and panning.\r\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\r\n//\r\n//    Orbit - left mouse / touch: one-finger move\r\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\r\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\r\n\r\nvar OrbitControls = function ( object, domElement ) {\r\n\r\n\tif ( domElement === undefined ) console.warn( 'THREE.OrbitControls: The second parameter \"domElement\" is now mandatory.' );\r\n\tif ( domElement === document ) console.error( 'THREE.OrbitControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.' );\r\n\r\n\tthis.object = object;\r\n\tthis.domElement = domElement;\r\n\r\n\t// Set to false to disable this control\r\n\tthis.enabled = true;\r\n\r\n\t// \"target\" sets the location of focus, where the object orbits around\r\n\tthis.target = new Vector3();\r\n\r\n\t// How far you can dolly in and out ( PerspectiveCamera only )\r\n\tthis.minDistance = 0;\r\n\tthis.maxDistance = Infinity;\r\n\r\n\t// How far you can zoom in and out ( OrthographicCamera only )\r\n\tthis.minZoom = 0;\r\n\tthis.maxZoom = Infinity;\r\n\r\n\t// How far you can orbit vertically, upper and lower limits.\r\n\t// Range is 0 to Math.PI radians.\r\n\tthis.minPolarAngle = 0; // radians\r\n\tthis.maxPolarAngle = Math.PI; // radians\r\n\r\n\t// How far you can orbit horizontally, upper and lower limits.\r\n\t// If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\r\n\tthis.minAzimuthAngle = - Infinity; // radians\r\n\tthis.maxAzimuthAngle = Infinity; // radians\r\n\r\n\t// Set to true to enable damping (inertia)\r\n\t// If damping is enabled, you must call controls.update() in your animation loop\r\n\tthis.enableDamping = false;\r\n\tthis.dampingFactor = 0.05;\r\n\r\n\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\r\n\t// Set to false to disable zooming\r\n\tthis.enableZoom = true;\r\n\tthis.zoomSpeed = 1.0;\r\n\r\n\t// Set to false to disable rotating\r\n\tthis.enableRotate = true;\r\n\tthis.rotateSpeed = 1.0;\r\n\r\n\t// Set to false to disable panning\r\n\tthis.enablePan = true;\r\n\tthis.panSpeed = 1.0;\r\n\tthis.screenSpacePanning = true; // if false, pan orthogonal to world-space direction camera.up\r\n\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\r\n\r\n\t// Set to true to automatically rotate around the target\r\n\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\r\n\tthis.autoRotate = false;\r\n\tthis.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\r\n\r\n\t// Set to false to disable use of the keys\r\n\tthis.enableKeys = true;\r\n\r\n\t// The four arrow keys\r\n\tthis.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\r\n\r\n\t// Mouse buttons\r\n\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\r\n\r\n\t// Touch fingers\r\n\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\r\n\r\n\t// for reset\r\n\tthis.target0 = this.target.clone();\r\n\tthis.position0 = this.object.position.clone();\r\n\tthis.zoom0 = this.object.zoom;\r\n\r\n\t//\r\n\t// public methods\r\n\t//\r\n\r\n\tthis.getPolarAngle = function () {\r\n\r\n\t\treturn spherical.phi;\r\n\r\n\t};\r\n\r\n\tthis.getAzimuthalAngle = function () {\r\n\r\n\t\treturn spherical.theta;\r\n\r\n\t};\r\n\r\n\tthis.saveState = function () {\r\n\r\n\t\tscope.target0.copy( scope.target );\r\n\t\tscope.position0.copy( scope.object.position );\r\n\t\tscope.zoom0 = scope.object.zoom;\r\n\r\n\t};\r\n\r\n\tthis.reset = function () {\r\n\r\n\t\tscope.target.copy( scope.target0 );\r\n\t\tscope.object.position.copy( scope.position0 );\r\n\t\tscope.object.zoom = scope.zoom0;\r\n\r\n\t\tscope.object.updateProjectionMatrix();\r\n\t\tscope.dispatchEvent( changeEvent );\r\n\r\n\t\tscope.update();\r\n\r\n\t\tstate = STATE.NONE;\r\n\r\n\t};\r\n\r\n\t// this method is exposed, but perhaps it would be better if we can make it private...\r\n\tthis.update = function () {\r\n\r\n\t\tvar offset = new Vector3();\r\n\r\n\t\t// so camera.up is the orbit axis\r\n\t\tvar quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\r\n\t\tvar quatInverse = quat.clone().invert();\r\n\r\n\t\tvar lastPosition = new Vector3();\r\n\t\tvar lastQuaternion = new Quaternion();\r\n\r\n\t\tvar twoPI = 2 * Math.PI;\r\n\r\n\t\treturn function update() {\r\n\r\n\t\t\tvar position = scope.object.position;\r\n\r\n\t\t\toffset.copy( position ).sub( scope.target );\r\n\r\n\t\t\t// rotate offset to \"y-axis-is-up\" space\r\n\t\t\toffset.applyQuaternion( quat );\r\n\r\n\t\t\t// angle from z-axis around y-axis\r\n\t\t\tspherical.setFromVector3( offset );\r\n\r\n\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\r\n\r\n\t\t\t\trotateLeft( getAutoRotationAngle() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( scope.enableDamping ) {\r\n\r\n\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\r\n\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tspherical.theta += sphericalDelta.theta;\r\n\t\t\t\tspherical.phi += sphericalDelta.phi;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// restrict theta to be between desired limits\r\n\r\n\t\t\tvar min = scope.minAzimuthAngle;\r\n\t\t\tvar max = scope.maxAzimuthAngle;\r\n\r\n\t\t\tif ( isFinite( min ) && isFinite( max ) ) {\r\n\r\n\t\t\t\tif ( min < - Math.PI ) min += twoPI; else if ( min > Math.PI ) min -= twoPI;\r\n\r\n\t\t\t\tif ( max < - Math.PI ) max += twoPI; else if ( max > Math.PI ) max -= twoPI;\r\n\r\n\t\t\t\tif ( min <= max ) {\r\n\r\n\t\t\t\t\tspherical.theta = Math.max( min, Math.min( max, spherical.theta ) );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tspherical.theta = ( spherical.theta > ( min + max ) / 2 ) ?\r\n\t\t\t\t\t\tMath.max( min, spherical.theta ) :\r\n\t\t\t\t\t\tMath.min( max, spherical.theta );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// restrict phi to be between desired limits\r\n\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\r\n\r\n\t\t\tspherical.makeSafe();\r\n\r\n\r\n\t\t\tspherical.radius *= scale;\r\n\r\n\t\t\t// restrict radius to be between desired limits\r\n\t\t\tspherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\r\n\r\n\t\t\t// move target to panned location\r\n\r\n\t\t\tif ( scope.enableDamping === true ) {\r\n\r\n\t\t\t\tscope.target.addScaledVector( panOffset, scope.dampingFactor );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tscope.target.add( panOffset );\r\n\r\n\t\t\t}\r\n\r\n\t\t\toffset.setFromSpherical( spherical );\r\n\r\n\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\r\n\t\t\toffset.applyQuaternion( quatInverse );\r\n\r\n\t\t\tposition.copy( scope.target ).add( offset );\r\n\r\n\t\t\tscope.object.lookAt( scope.target );\r\n\r\n\t\t\tif ( scope.enableDamping === true ) {\r\n\r\n\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\r\n\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\r\n\r\n\t\t\t\tpanOffset.multiplyScalar( 1 - scope.dampingFactor );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tsphericalDelta.set( 0, 0, 0 );\r\n\r\n\t\t\t\tpanOffset.set( 0, 0, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tscale = 1;\r\n\r\n\t\t\t// update condition is:\r\n\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\r\n\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\r\n\r\n\t\t\tif ( zoomChanged ||\r\n\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\r\n\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\r\n\r\n\t\t\t\tscope.dispatchEvent( changeEvent );\r\n\r\n\t\t\t\tlastPosition.copy( scope.object.position );\r\n\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\r\n\t\t\t\tzoomChanged = false;\r\n\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\tthis.dispose = function () {\r\n\r\n\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu, false );\r\n\r\n\t\tscope.domElement.removeEventListener( 'pointerdown', onPointerDown, false );\r\n\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel, false );\r\n\r\n\t\tscope.domElement.removeEventListener( 'touchstart', onTouchStart, false );\r\n\t\tscope.domElement.removeEventListener( 'touchend', onTouchEnd, false );\r\n\t\tscope.domElement.removeEventListener( 'touchmove', onTouchMove, false );\r\n\r\n\t\tscope.domElement.ownerDocument.removeEventListener( 'pointermove', onPointerMove, false );\r\n\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerup', onPointerUp, false );\r\n\r\n\t\tscope.domElement.removeEventListener( 'keydown', onKeyDown, false );\r\n\r\n\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\r\n\r\n\t};\r\n\r\n\t//\r\n\t// internals\r\n\t//\r\n\r\n\tvar scope = this;\r\n\r\n\tvar changeEvent = { type: 'change' };\r\n\tvar startEvent = { type: 'start' };\r\n\tvar endEvent = { type: 'end' };\r\n\r\n\tvar STATE = {\r\n\t\tNONE: - 1,\r\n\t\tROTATE: 0,\r\n\t\tDOLLY: 1,\r\n\t\tPAN: 2,\r\n\t\tTOUCH_ROTATE: 3,\r\n\t\tTOUCH_PAN: 4,\r\n\t\tTOUCH_DOLLY_PAN: 5,\r\n\t\tTOUCH_DOLLY_ROTATE: 6\r\n\t};\r\n\r\n\tvar state = STATE.NONE;\r\n\r\n\tvar EPS = 0.000001;\r\n\r\n\t// current position in spherical coordinates\r\n\tvar spherical = new Spherical();\r\n\tvar sphericalDelta = new Spherical();\r\n\r\n\tvar scale = 1;\r\n\tvar panOffset = new Vector3();\r\n\tvar zoomChanged = false;\r\n\r\n\tvar rotateStart = new Vector2();\r\n\tvar rotateEnd = new Vector2();\r\n\tvar rotateDelta = new Vector2();\r\n\r\n\tvar panStart = new Vector2();\r\n\tvar panEnd = new Vector2();\r\n\tvar panDelta = new Vector2();\r\n\r\n\tvar dollyStart = new Vector2();\r\n\tvar dollyEnd = new Vector2();\r\n\tvar dollyDelta = new Vector2();\r\n\r\n\tfunction getAutoRotationAngle() {\r\n\r\n\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\r\n\r\n\t}\r\n\r\n\tfunction getZoomScale() {\r\n\r\n\t\treturn Math.pow( 0.95, scope.zoomSpeed );\r\n\r\n\t}\r\n\r\n\tfunction rotateLeft( angle ) {\r\n\r\n\t\tsphericalDelta.theta -= angle;\r\n\r\n\t}\r\n\r\n\tfunction rotateUp( angle ) {\r\n\r\n\t\tsphericalDelta.phi -= angle;\r\n\r\n\t}\r\n\r\n\tvar panLeft = function () {\r\n\r\n\t\tvar v = new Vector3();\r\n\r\n\t\treturn function panLeft( distance, objectMatrix ) {\r\n\r\n\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\r\n\t\t\tv.multiplyScalar( - distance );\r\n\r\n\t\t\tpanOffset.add( v );\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\tvar panUp = function () {\r\n\r\n\t\tvar v = new Vector3();\r\n\r\n\t\treturn function panUp( distance, objectMatrix ) {\r\n\r\n\t\t\tif ( scope.screenSpacePanning === true ) {\r\n\r\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 1 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 );\r\n\t\t\t\tv.crossVectors( scope.object.up, v );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tv.multiplyScalar( distance );\r\n\r\n\t\t\tpanOffset.add( v );\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\t// deltaX and deltaY are in pixels; right and down are positive\r\n\tvar pan = function () {\r\n\r\n\t\tvar offset = new Vector3();\r\n\r\n\t\treturn function pan( deltaX, deltaY ) {\r\n\r\n\t\t\tvar element = scope.domElement;\r\n\r\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\r\n\r\n\t\t\t\t// perspective\r\n\t\t\t\tvar position = scope.object.position;\r\n\t\t\t\toffset.copy( position ).sub( scope.target );\r\n\t\t\t\tvar targetDistance = offset.length();\r\n\r\n\t\t\t\t// half of the fov is center to top of screen\r\n\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\r\n\r\n\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\r\n\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\r\n\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\r\n\r\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\r\n\r\n\t\t\t\t// orthographic\r\n\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\r\n\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// camera neither orthographic nor perspective\r\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\r\n\t\t\t\tscope.enablePan = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\tfunction dollyOut( dollyScale ) {\r\n\r\n\t\tif ( scope.object.isPerspectiveCamera ) {\r\n\r\n\t\t\tscale /= dollyScale;\r\n\r\n\t\t} else if ( scope.object.isOrthographicCamera ) {\r\n\r\n\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\r\n\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\tzoomChanged = true;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\r\n\t\t\tscope.enableZoom = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction dollyIn( dollyScale ) {\r\n\r\n\t\tif ( scope.object.isPerspectiveCamera ) {\r\n\r\n\t\t\tscale *= dollyScale;\r\n\r\n\t\t} else if ( scope.object.isOrthographicCamera ) {\r\n\r\n\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\r\n\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\tzoomChanged = true;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\r\n\t\t\tscope.enableZoom = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//\r\n\t// event callbacks - update the object state\r\n\t//\r\n\r\n\tfunction handleMouseDownRotate( event ) {\r\n\r\n\t\trotateStart.set( event.clientX, event.clientY );\r\n\r\n\t}\r\n\r\n\tfunction handleMouseDownDolly( event ) {\r\n\r\n\t\tdollyStart.set( event.clientX, event.clientY );\r\n\r\n\t}\r\n\r\n\tfunction handleMouseDownPan( event ) {\r\n\r\n\t\tpanStart.set( event.clientX, event.clientY );\r\n\r\n\t}\r\n\r\n\tfunction handleMouseMoveRotate( event ) {\r\n\r\n\t\trotateEnd.set( event.clientX, event.clientY );\r\n\r\n\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\r\n\r\n\t\tvar element = scope.domElement;\r\n\r\n\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\r\n\r\n\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\r\n\r\n\t\trotateStart.copy( rotateEnd );\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleMouseMoveDolly( event ) {\r\n\r\n\t\tdollyEnd.set( event.clientX, event.clientY );\r\n\r\n\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\r\n\r\n\t\tif ( dollyDelta.y > 0 ) {\r\n\r\n\t\t\tdollyOut( getZoomScale() );\r\n\r\n\t\t} else if ( dollyDelta.y < 0 ) {\r\n\r\n\t\t\tdollyIn( getZoomScale() );\r\n\r\n\t\t}\r\n\r\n\t\tdollyStart.copy( dollyEnd );\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleMouseMovePan( event ) {\r\n\r\n\t\tpanEnd.set( event.clientX, event.clientY );\r\n\r\n\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\r\n\r\n\t\tpan( panDelta.x, panDelta.y );\r\n\r\n\t\tpanStart.copy( panEnd );\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleMouseUp( /*event*/ ) {\r\n\r\n\t\t// no-op\r\n\r\n\t}\r\n\r\n\tfunction handleMouseWheel( event ) {\r\n\r\n\t\tif ( event.deltaY < 0 ) {\r\n\r\n\t\t\tdollyIn( getZoomScale() );\r\n\r\n\t\t} else if ( event.deltaY > 0 ) {\r\n\r\n\t\t\tdollyOut( getZoomScale() );\r\n\r\n\t\t}\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleKeyDown( event ) {\r\n\r\n\t\tvar needsUpdate = false;\r\n\r\n\t\tswitch ( event.keyCode ) {\r\n\r\n\t\t\tcase scope.keys.UP:\r\n\t\t\t\tpan( 0, scope.keyPanSpeed );\r\n\t\t\t\tneedsUpdate = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase scope.keys.BOTTOM:\r\n\t\t\t\tpan( 0, - scope.keyPanSpeed );\r\n\t\t\t\tneedsUpdate = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase scope.keys.LEFT:\r\n\t\t\t\tpan( scope.keyPanSpeed, 0 );\r\n\t\t\t\tneedsUpdate = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase scope.keys.RIGHT:\r\n\t\t\t\tpan( - scope.keyPanSpeed, 0 );\r\n\t\t\t\tneedsUpdate = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tif ( needsUpdate ) {\r\n\r\n\t\t\t// prevent the browser from scrolling on cursor keys\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\tscope.update();\r\n\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\tfunction handleTouchStartRotate( event ) {\r\n\r\n\t\tif ( event.touches.length == 1 ) {\r\n\r\n\t\t\trotateStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\r\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\r\n\r\n\t\t\trotateStart.set( x, y );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction handleTouchStartPan( event ) {\r\n\r\n\t\tif ( event.touches.length == 1 ) {\r\n\r\n\t\t\tpanStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\r\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\r\n\r\n\t\t\tpanStart.set( x, y );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction handleTouchStartDolly( event ) {\r\n\r\n\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\r\n\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\r\n\r\n\t\tvar distance = Math.sqrt( dx * dx + dy * dy );\r\n\r\n\t\tdollyStart.set( 0, distance );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchStartDollyPan( event ) {\r\n\r\n\t\tif ( scope.enableZoom ) handleTouchStartDolly( event );\r\n\r\n\t\tif ( scope.enablePan ) handleTouchStartPan( event );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchStartDollyRotate( event ) {\r\n\r\n\t\tif ( scope.enableZoom ) handleTouchStartDolly( event );\r\n\r\n\t\tif ( scope.enableRotate ) handleTouchStartRotate( event );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchMoveRotate( event ) {\r\n\r\n\t\tif ( event.touches.length == 1 ) {\r\n\r\n\t\t\trotateEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\r\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\r\n\r\n\t\t\trotateEnd.set( x, y );\r\n\r\n\t\t}\r\n\r\n\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\r\n\r\n\t\tvar element = scope.domElement;\r\n\r\n\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\r\n\r\n\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\r\n\r\n\t\trotateStart.copy( rotateEnd );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchMovePan( event ) {\r\n\r\n\t\tif ( event.touches.length == 1 ) {\r\n\r\n\t\t\tpanEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\r\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\r\n\r\n\t\t\tpanEnd.set( x, y );\r\n\r\n\t\t}\r\n\r\n\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\r\n\r\n\t\tpan( panDelta.x, panDelta.y );\r\n\r\n\t\tpanStart.copy( panEnd );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchMoveDolly( event ) {\r\n\r\n\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\r\n\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\r\n\r\n\t\tvar distance = Math.sqrt( dx * dx + dy * dy );\r\n\r\n\t\tdollyEnd.set( 0, distance );\r\n\r\n\t\tdollyDelta.set( 0, Math.pow( dollyEnd.y / dollyStart.y, scope.zoomSpeed ) );\r\n\r\n\t\tdollyOut( dollyDelta.y );\r\n\r\n\t\tdollyStart.copy( dollyEnd );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchMoveDollyPan( event ) {\r\n\r\n\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\r\n\r\n\t\tif ( scope.enablePan ) handleTouchMovePan( event );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchMoveDollyRotate( event ) {\r\n\r\n\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\r\n\r\n\t\tif ( scope.enableRotate ) handleTouchMoveRotate( event );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchEnd( /*event*/ ) {\r\n\r\n\t\t// no-op\r\n\r\n\t}\r\n\r\n\t//\r\n\t// event handlers - FSM: listen for events and reset state\r\n\t//\r\n\r\n\tfunction onPointerDown( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tswitch ( event.pointerType ) {\r\n\r\n\t\t\tcase 'mouse':\r\n\t\t\tcase 'pen':\r\n\t\t\t\tonMouseDown( event );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// TODO touch\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onPointerMove( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tswitch ( event.pointerType ) {\r\n\r\n\t\t\tcase 'mouse':\r\n\t\t\tcase 'pen':\r\n\t\t\t\tonMouseMove( event );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// TODO touch\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onPointerUp( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tswitch ( event.pointerType ) {\r\n\r\n\t\t\tcase 'mouse':\r\n\t\t\tcase 'pen':\r\n\t\t\t\tonMouseUp( event );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// TODO touch\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onMouseDown( event ) {\r\n\r\n\t\t// Prevent the browser from scrolling.\r\n\t\tevent.preventDefault();\r\n\r\n\t\t// Manually set the focus since calling preventDefault above\r\n\t\t// prevents the browser from setting it automatically.\r\n\r\n\t\tscope.domElement.focus ? scope.domElement.focus() : window.focus();\r\n\r\n\t\tvar mouseAction;\r\n\r\n\t\tswitch ( event.button ) {\r\n\r\n\t\t\tcase 0:\r\n\r\n\t\t\t\tmouseAction = scope.mouseButtons.LEFT;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1:\r\n\r\n\t\t\t\tmouseAction = scope.mouseButtons.MIDDLE;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2:\r\n\r\n\t\t\t\tmouseAction = scope.mouseButtons.RIGHT;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\r\n\t\t\t\tmouseAction = - 1;\r\n\r\n\t\t}\r\n\r\n\t\tswitch ( mouseAction ) {\r\n\r\n\t\t\tcase MOUSE.DOLLY:\r\n\r\n\t\t\t\tif ( scope.enableZoom === false ) return;\r\n\r\n\t\t\t\thandleMouseDownDolly( event );\r\n\r\n\t\t\t\tstate = STATE.DOLLY;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase MOUSE.ROTATE:\r\n\r\n\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\r\n\r\n\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\thandleMouseDownPan( event );\r\n\r\n\t\t\t\t\tstate = STATE.PAN;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\thandleMouseDownRotate( event );\r\n\r\n\t\t\t\t\tstate = STATE.ROTATE;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase MOUSE.PAN:\r\n\r\n\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\r\n\r\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\thandleMouseDownRotate( event );\r\n\r\n\t\t\t\t\tstate = STATE.ROTATE;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\thandleMouseDownPan( event );\r\n\r\n\t\t\t\t\tstate = STATE.PAN;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\r\n\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t}\r\n\r\n\t\tif ( state !== STATE.NONE ) {\r\n\r\n\t\t\tscope.domElement.ownerDocument.addEventListener( 'pointermove', onPointerMove, false );\r\n\t\t\tscope.domElement.ownerDocument.addEventListener( 'pointerup', onPointerUp, false );\r\n\r\n\t\t\tscope.dispatchEvent( startEvent );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onMouseMove( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tswitch ( state ) {\r\n\r\n\t\t\tcase STATE.ROTATE:\r\n\r\n\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\thandleMouseMoveRotate( event );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.DOLLY:\r\n\r\n\t\t\t\tif ( scope.enableZoom === false ) return;\r\n\r\n\t\t\t\thandleMouseMoveDolly( event );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.PAN:\r\n\r\n\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\thandleMouseMovePan( event );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onMouseUp( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\thandleMouseUp( event );\r\n\r\n\t\tscope.domElement.ownerDocument.removeEventListener( 'pointermove', onPointerMove, false );\r\n\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerup', onPointerUp, false );\r\n\r\n\t\tscope.dispatchEvent( endEvent );\r\n\r\n\t\tstate = STATE.NONE;\r\n\r\n\t}\r\n\r\n\tfunction onMouseWheel( event ) {\r\n\r\n\t\tif ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tscope.dispatchEvent( startEvent );\r\n\r\n\t\thandleMouseWheel( event );\r\n\r\n\t\tscope.dispatchEvent( endEvent );\r\n\r\n\t}\r\n\r\n\tfunction onKeyDown( event ) {\r\n\r\n\t\tif ( scope.enabled === false || scope.enableKeys === false || scope.enablePan === false ) return;\r\n\r\n\t\thandleKeyDown( event );\r\n\r\n\t}\r\n\r\n\tfunction onTouchStart( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault(); // prevent scrolling\r\n\r\n\t\tswitch ( event.touches.length ) {\r\n\r\n\t\t\tcase 1:\r\n\r\n\t\t\t\tswitch ( scope.touches.ONE ) {\r\n\r\n\t\t\t\t\tcase TOUCH.ROTATE:\r\n\r\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\thandleTouchStartRotate( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase TOUCH.PAN:\r\n\r\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\thandleTouchStartPan( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2:\r\n\r\n\t\t\t\tswitch ( scope.touches.TWO ) {\r\n\r\n\t\t\t\t\tcase TOUCH.DOLLY_PAN:\r\n\r\n\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\thandleTouchStartDollyPan( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\r\n\r\n\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\thandleTouchStartDollyRotate( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\r\n\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t}\r\n\r\n\t\tif ( state !== STATE.NONE ) {\r\n\r\n\t\t\tscope.dispatchEvent( startEvent );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onTouchMove( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault(); // prevent scrolling\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tswitch ( state ) {\r\n\r\n\t\t\tcase STATE.TOUCH_ROTATE:\r\n\r\n\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\thandleTouchMoveRotate( event );\r\n\r\n\t\t\t\tscope.update();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.TOUCH_PAN:\r\n\r\n\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\thandleTouchMovePan( event );\r\n\r\n\t\t\t\tscope.update();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.TOUCH_DOLLY_PAN:\r\n\r\n\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\r\n\r\n\t\t\t\thandleTouchMoveDollyPan( event );\r\n\r\n\t\t\t\tscope.update();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\r\n\r\n\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\r\n\r\n\t\t\t\thandleTouchMoveDollyRotate( event );\r\n\r\n\t\t\t\tscope.update();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\r\n\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onTouchEnd( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\thandleTouchEnd( event );\r\n\r\n\t\tscope.dispatchEvent( endEvent );\r\n\r\n\t\tstate = STATE.NONE;\r\n\r\n\t}\r\n\r\n\tfunction onContextMenu( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tscope.domElement.addEventListener( 'contextmenu', onContextMenu, false );\r\n\r\n\tscope.domElement.addEventListener( 'pointerdown', onPointerDown, false );\r\n\tscope.domElement.addEventListener( 'wheel', onMouseWheel, false );\r\n\r\n\tscope.domElement.addEventListener( 'touchstart', onTouchStart, false );\r\n\tscope.domElement.addEventListener( 'touchend', onTouchEnd, false );\r\n\tscope.domElement.addEventListener( 'touchmove', onTouchMove, false );\r\n\r\n\tscope.domElement.addEventListener( 'keydown', onKeyDown, false );\r\n\r\n\t// force an update at start\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nOrbitControls.prototype = Object.create( EventDispatcher.prototype );\r\nOrbitControls.prototype.constructor = OrbitControls;\r\n\r\n\r\n// This set of controls performs orbiting, dollying (zooming), and panning.\r\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\r\n// This is very similar to OrbitControls, another set of touch behavior\r\n//\r\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\r\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\r\n//    Pan - left mouse, or arrow keys / touch: one-finger move\r\n\r\nvar MapControls = function ( object, domElement ) {\r\n\r\n\tOrbitControls.call( this, object, domElement );\r\n\r\n\tthis.screenSpacePanning = false; // pan orthogonal to world-space direction camera.up\r\n\r\n\tthis.mouseButtons.LEFT = MOUSE.PAN;\r\n\tthis.mouseButtons.RIGHT = MOUSE.ROTATE;\r\n\r\n\tthis.touches.ONE = TOUCH.PAN;\r\n\tthis.touches.TWO = TOUCH.DOLLY_ROTATE;\r\n\r\n};\r\n\r\nMapControls.prototype = Object.create( EventDispatcher.prototype );\r\nMapControls.prototype.constructor = MapControls;\r\n\r\nexport { OrbitControls, MapControls };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/controls/OrbitControls.js"],"sourceRoot":""}