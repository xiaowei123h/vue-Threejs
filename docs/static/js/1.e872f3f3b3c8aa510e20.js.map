{"version":3,"sources":["webpack:///./src/components/jsm/loaders/ColladaLoader.js","webpack:///./src/components/jsm/libs/tween.module.min.js","webpack:///src/views/loader/webglLoaderColladaKnematics.vue","webpack:///./src/views/loader/webglLoaderColladaKnematics.vue?f4ab","webpack:///./src/views/loader/webglLoaderColladaKnematics.vue","webpack:///./node_modules/process/browser.js"],"names":["__webpack_require__","d","__webpack_exports__","ColladaLoader","__WEBPACK_IMPORTED_MODULE_0__components_build_three_module_js__","__WEBPACK_IMPORTED_MODULE_1__loaders_TGALoader_js__","manager","Loader","call","this","prototype","Object","assign","create","constructor","load","url","onLoad","onProgress","onError","scope","path","LoaderUtils","extractUrlBase","loader","FileLoader","setPath","setRequestHeader","requestHeader","setWithCredentials","withCredentials","text","parse","e","console","error","itemError","options","convertUpAxis","value","warn","getElementsByTagName","xml","name","array","childNodes","i","l","length","child","nodeName","push","parseStrings","parts","trim","split","Array","parseFloats","parseFloat","parseInts","parseInt","parseId","substring","isEmpty","object","keys","parseLibrary","libraryName","parser","library","undefined","elements","buildLibrary","data","builder","build","getBuild","parseAnimationSampler","inputs","nodeType","id","getAttribute","semantic","parseAnimationChannel","shift","sid","arraySyntax","indexOf","memberSyntax","member","indices","replace","sampler","buildAnimation","tracks","channels","samplers","sources","target","hasOwnProperty","channel","inputId","INPUT","outputId","OUTPUT","createKeyframeTracks","buildAnimationChannel","getAnimation","animations","inputSource","outputSource","time","stride","il","j","jl","node","nodes","object3D","getNode","transform","transforms","defaultMatrix","matrix","clone","transpose","index","keyframes","sort","a","b","transformAnimationData","prepareAnimationData","uuid","position","Vector3","scale","quaternion","Quaternion","animation","times","positionData","quaternionData","scaleData","keyframe","fromArray","decompose","x","y","z","w","VectorKeyframeTrack","QuaternionKeyframeTrack","property","defaultValue","empty","prev","next","getPrev","getNext","interpolate","createMissingKeyframes","key","buildAnimationClip","duration","end","start","animationTracks","AnimationClip","getAnimationClip","clips","parseSkin","bindShapeMatrix","textContent","parseSource","joints","parseJoints","vertexWeights","parseVertexWeights","offset","vcount","v","buildController","geometry","geometries","skin","weights","jointOffset","JOINT","weightOffset","WEIGHT","jointSource","inverseSource","INV_BIND_MATRIX","jointCount","vertexSkinData","skinIndex","weightId","skinWeight","weight","descending","bindMatrix","Matrix4","identity","boneInverse","buildSkin","skinIndices","skinWeights","buildImage","init_from","getImage","images","parseEffectProfileCOMMON","surfaces","parseEffectNewparam","technique","parseEffectTechnique","extra","parseEffectExtra","parseEffectSurface","parseEffectSampler","source","type","parameters","parseEffectParameters","parseEffectParameter","opaque","parseEffectParameterTexture","parseEffectParameterTextureExtra","parseEffectParameterTextureExtraTechnique","toUpperCase","parseEffectExtraTechnique","buildEffect","buildMaterial","material","effect","effects","profile","MeshPhongMaterial","MeshLambertMaterial","MeshBasicMaterial","getTexture","textureObject","image","extension","slice","lastIndexOf","toLowerCase","tgaLoader","textureLoader","getTextureLoader","texture","wrapS","wrapU","RepeatWrapping","ClampToEdgeWrapping","wrapT","wrapV","set","offsetU","offsetV","repeat","repeatU","repeatV","parameter","color","map","specular","specularMap","normalMap","lightMap","float","shininess","emissive","emissiveMap","transparent","transparency","opacity","double_sided","side","DoubleSide","getMaterial","materials","parseCameraOptics","parseCameraTechnique","parseCameraParameters","buildCamera","camera","optics","PerspectiveCamera","yfov","aspect_ratio","znear","zfar","ymag","xmag","aspectRatio","OrthographicCamera","getCamera","cameras","parseLightTechnique","parseLightParameters","Color","falloffAngle","f","distance","Math","sqrt","buildLight","light","DirectionalLight","PointLight","SpotLight","AmbientLight","copy","getLight","lights","accessor","parseGeometryVertices","parseGeometryPrimitive","primitive","count","hasUV","inputname","max","p","checkUVCoordinates","primitives","uvsNeedsFix","buildGeometry","vertices","groupedPrimitives","groupPrimitives","primitiveType","buildGeometryType","normal","uv","uv2","BufferGeometry","materialKeys","g","vc","addGroup","input","prevLength","buildGeometryData","setAttribute","Float32BufferAttribute","pushVector","sourceStride","sourceArray","c","k","kl","getGeometry","buildKinematicsModel","parseKinematicsTechniqueCommon","parseKinematicsJoint","links","parseKinematicsLink","parseKinematicsJointParameter","axis","limits","min","static","zeroPosition","middlePosition","attachments","parseKinematicsAttachment","parseKinematicsTransform","joint","pop","obj","angle","MathUtils","degToRad","parsePhysicsRigidBody","parsePhysicsTechniqueCommon","inertia","mass","parseKinematicsBindJointAxis","param","tmpJointIndex","jointIndex","substr","buildKinematicsScene","vector","parseNode","instanceCameras","instanceControllers","instanceLights","instanceGeometries","instanceNodes","parseNodeInstance","multiply","makeTranslation","makeRotationAxis","log","hasNode","skeletons","instances","instance","symbol","buildSkeleton","boneData","sortedBoneData","skeleton","buildBoneHierarchy","visualScenes","children","bone","processed","bones","boneInverses","Skeleton","root","traverse","isBone","buildNode","objects","instanceCamera","controller","controllers","newObjects","buildObjects","isSkinnedMesh","bind","normalizeSkinWeights","instanceLight","Bone","Group","add","fallbackMaterial","resolveMaterialBinding","instanceMaterials","LineBasicMaterial","skinning","attributes","LineSegments","Line","SkinnedMesh","Mesh","buildVisualScene","group","getVisualScene","scene","Scene","DOMParser","parseFromString","collada","parserError","errorText","errorElement","result","stack","Node","TEXT_NODE","apply","parserErrorToText","version","asset","unit","hasAttribute","parseAssetUnit","upAxis","parseAssetUpAxis","parseAsset","TextureLoader","resourcePath","setCrossOrigin","crossOrigin","TGALoader","kinematics","kinematicsModels","physicsModels","kinematicsScenes","parseAnimation","hasChildren","generateUUID","mesh","element","prepareNodes","rigidBodies","bindJointAxis","setupAnimations","kinematicsModelId","kinematicsSceneId","visualSceneId","kinematicsModel","kinematicsScene","getKinematicsScene","visualScene","jointMap","targetElement","querySelector","parentVisualElement","parentElement","connect","m0","getJointValue","jointData","setJointValue","visualElement","visualElementName","buildTransformList","setupKinematics","parseScene","setFromEuler","Euler","PI","multiplyScalar","_Group","_tweens","_tweensAddedDuringUpdate","getAll","t","removeAll","getId","remove","update","n","TWEEN","now","r","_isPlaying","_nextId","nextId","self","process","hrtime","performance","Date","getTime","Tween","_object","_valuesStart","_valuesEnd","_valuesStartRepeat","_duration","_repeat","_repeatDelayTime","_yoyo","_reversed","_delayTime","_startTime","_easingFunction","Easing","Linear","None","_interpolationFunction","Interpolation","_chainedTweens","_onStartCallback","_onStartCallbackFired","_onUpdateCallback","_onCompleteCallback","_onStopCallback","_group","_id","isPlaying","to","concat","stop","stopChainedTweens","delay","repeatDelay","yoyo","easing","interpolation","chain","arguments","onStart","onUpdate","onComplete","onStop","charAt","isFinite","s","o","u","Quadratic","In","Out","InOut","Cubic","Quartic","Quintic","Sinusoidal","cos","sin","Exponential","pow","Circular","Elastic","Back","Bounce","floor","Utils","Bezier","Bernstein","CatmullRom","Factorial","define","module","exports","_typeof","webglLoaderColladaKnematics","container","stats","renderer","particleLight","dae","kinematicsTween","tweenParameters","mounted","_this","isMesh","flatShading","updateMatrix","init","animate","methods","document","createElement","getElementsByClassName","appendChild","$THREE","$webglInnerWidth","window","innerHeight","grid","GridHelper","SphereBufferGeometry","HemisphereLight","pointLight","WebGLRenderer","setPixelRatio","devicePixelRatio","setSize","domElement","$Stats","dom","style","left","setupTween","addEventListener","onWindowResize","_this2","randInt","prop","old","tween_module_min","setTimeout","$onWindowResize","requestAnimationFrame","render","timer","lookAt","loader_webglLoaderColladaKnematics","$createElement","_self","_c","_m","staticRenderFns","_h","staticClass","attrs","href","rel","_v","Component","normalizeComponent","ssrContext","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","Error","defaultClearTimeout","runTimeout","fun","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","drainQueue","timeout","len","run","marker","runClearTimeout","Item","noop","nextTick","args","title","browser","env","argv","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask"],"mappings":"sDAAAA,EAAAC,EAAAC,EAAA,sBAAAC,IAAA,IAAAC,EAAAJ,EAAA,QAAAK,EAAAL,EAAA,QAwCIG,EAAgB,SAAWG,GAE9BC,KAAOC,KAAMC,KAAMH,IAIpBH,EAAcO,UAAYC,OAAOC,OAAQD,OAAOE,OAAQN,KAAOG,YAE9DI,YAAaX,EAEbY,KAAM,SAAWC,EAAKC,EAAQC,EAAYC,GAEzC,IAAIC,EAAQX,KAERY,EAAwB,KAAfD,EAAMC,KAAgBC,KAAYC,eAAgBP,GAAQI,EAAMC,KAEzEG,EAAS,IAAIC,IAAYL,EAAMd,SACnCkB,EAAOE,QAASN,EAAMC,MACtBG,EAAOG,iBAAkBP,EAAMQ,eAC/BJ,EAAOK,mBAAoBT,EAAMU,iBACjCN,EAAOT,KAAMC,EAAK,SAAWe,GAE5B,IAECd,EAAQG,EAAMY,MAAOD,EAAMV,IAE1B,MAAQY,GAEJd,EAEJA,EAASc,GAITC,QAAQC,MAAOF,GAIhBb,EAAMd,QAAQ8B,UAAWpB,KAIxBE,EAAYC,IAIhBkB,SAECC,kBAAmBC,GAElBL,QAAQM,KAAM,wGAMhBR,MAAO,SAAWD,EAAMV,GAEvB,SAASoB,EAAsBC,EAAKC,GAOnC,IAHA,IAAIC,KACAC,EAAaH,EAAIG,WAEXC,EAAI,EAAGC,EAAIF,EAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAErD,IAAIG,EAAQJ,EAAYC,GAEnBG,EAAMC,WAAaP,GAEvBC,EAAMO,KAAMF,GAMd,OAAOL,EAIR,SAASQ,EAAcrB,GAEtB,GAAqB,IAAhBA,EAAKiB,OAAe,SAKzB,IAHA,IAAIK,EAAQtB,EAAKuB,OAAOC,MAAO,OAC3BX,EAAQ,IAAIY,MAAOH,EAAML,QAEnBF,EAAI,EAAGC,EAAIM,EAAML,OAAQF,EAAIC,EAAGD,IAEzCF,EAAOE,GAAMO,EAAOP,GAIrB,OAAOF,EAIR,SAASa,EAAa1B,GAErB,GAAqB,IAAhBA,EAAKiB,OAAe,SAKzB,IAHA,IAAIK,EAAQtB,EAAKuB,OAAOC,MAAO,OAC3BX,EAAQ,IAAIY,MAAOH,EAAML,QAEnBF,EAAI,EAAGC,EAAIM,EAAML,OAAQF,EAAIC,EAAGD,IAEzCF,EAAOE,GAAMY,WAAYL,EAAOP,IAIjC,OAAOF,EAIR,SAASe,EAAW5B,GAEnB,GAAqB,IAAhBA,EAAKiB,OAAe,SAKzB,IAHA,IAAIK,EAAQtB,EAAKuB,OAAOC,MAAO,OAC3BX,EAAQ,IAAIY,MAAOH,EAAML,QAEnBF,EAAI,EAAGC,EAAIM,EAAML,OAAQF,EAAIC,EAAGD,IAEzCF,EAAOE,GAAMc,SAAUP,EAAOP,IAI/B,OAAOF,EAIR,SAASiB,EAAS9B,GAEjB,OAAOA,EAAK+B,UAAW,GAUxB,SAASC,EAASC,GAEjB,OAAwC,IAAjCrD,OAAOsD,KAAMD,GAAShB,OAqC9B,SAASkB,EAAcxB,EAAKyB,EAAajB,EAAUkB,GAElD,IAAIC,EAAU5B,EAAsBC,EAAKyB,GAAe,GAExD,QAAiBG,IAAZD,EAIJ,IAFA,IAAIE,EAAW9B,EAAsB4B,EAASnB,GAEpCJ,EAAI,EAAGA,EAAIyB,EAASvB,OAAQF,IAErCsB,EAAQG,EAAUzB,IAQrB,SAAS0B,EAAcC,EAAMC,GAE5B,IAAM,IAAI/B,KAAQ8B,EAAO,CAEXA,EAAM9B,GACZgC,MAAQD,EAASD,EAAM9B,KAQhC,SAASiC,EAAUH,EAAMC,GAExB,YAAoBJ,IAAfG,EAAKE,MAA6BF,EAAKE,OAE5CF,EAAKE,MAAQD,EAASD,GAEfA,EAAKE,OAgEb,SAASE,EAAuBnC,GAM/B,IAJA,IAAI+B,GACHK,WAGShC,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,QACJ,IAAI8B,EAAKnB,EAASZ,EAAMgC,aAAc,WAClCC,EAAWjC,EAAMgC,aAAc,YACnCR,EAAKK,OAAQI,GAAaF,GAO7B,OAAOP,EAIR,SAASU,EAAuBzC,GAE/B,IAAI+B,KAMApB,EAJSX,EAAIuC,aAAc,UAIZ1B,MAAO,KAEtByB,EAAK3B,EAAM+B,QACXC,EAAMhC,EAAM+B,QAIZE,GAAyC,IAAzBD,EAAIE,QAAS,KAC7BC,GAA0C,IAAzBH,EAAIE,QAAS,KAElC,GAAKC,EAKJH,GADAhC,EAAQgC,EAAI9B,MAAO,MACP6B,QACZX,EAAKgB,OAASpC,EAAM+B,aAEd,GAAKE,EAAc,CAIzB,IAAII,EAAUL,EAAI9B,MAAO,KACzB8B,EAAMK,EAAQN,QAEd,IAAM,IAAItC,EAAI,EAAGA,EAAI4C,EAAQ1C,OAAQF,IAEpC4C,EAAS5C,GAAMc,SAAU8B,EAAS5C,GAAI6C,QAAS,KAAM,KAItDlB,EAAKiB,QAAUA,EAYhB,OARAjB,EAAKO,GAAKA,EACVP,EAAKY,IAAMA,EAEXZ,EAAKa,YAAcA,EACnBb,EAAKe,aAAeA,EAEpBf,EAAKmB,QAAU/B,EAASnB,EAAIuC,aAAc,WAEnCR,EAIR,SAASoB,EAAgBpB,GAExB,IAAIqB,KAEAC,EAAWtB,EAAKsB,SAChBC,EAAWvB,EAAKuB,SAChBC,EAAUxB,EAAKwB,QAEnB,IAAM,IAAIC,KAAUH,EAEnB,GAAKA,EAASI,eAAgBD,GAAW,CAExC,IAAIE,EAAUL,EAAUG,GACpBN,EAAUI,EAAUI,EAAQR,SAE5BS,EAAUT,EAAQd,OAAOwB,MACzBC,EAAWX,EAAQd,OAAO0B,OAO9BC,EAFgBC,EAAuBN,EAHrBH,EAASI,GACRJ,EAASM,IAIKT,GAMnC,OAAOA,EAIR,SAASa,EAAc3B,GAEtB,OAAOJ,EAAUP,GAAQuC,WAAY5B,GAAMa,GAI5C,SAASa,EAAuBN,EAASS,EAAaC,GAErD,IAMIC,EAAMC,EACNlE,EAAGmE,EAAIC,EAAGC,EAPVC,EAAO/C,GAAQgD,MAAOjB,EAAQpB,IAC9BsC,EAAWC,GAASH,EAAKpC,IAEzBwC,EAAYJ,EAAKK,WAAYrB,EAAQf,KACrCqC,EAAgBN,EAAKO,OAAOC,QAAQC,YAKpCpD,KAKJ,OAAS+C,GAER,IAAK,SAEJ,IAAM1E,EAAI,EAAGmE,EAAKJ,EAAYjE,MAAMI,OAAQF,EAAImE,EAAInE,IAOnD,GALAiE,EAAOF,EAAYjE,MAAOE,GAC1BkE,EAASlE,EAAIgE,EAAaE,YAEJ1C,IAAjBG,EAAMsC,KAAuBtC,EAAMsC,QAEX,IAAxBX,EAAQd,YAAuB,CAEnC,IAAI/C,EAAQuE,EAAalE,MAAOoE,GAC5Bc,EAAQ1B,EAAQV,QAAS,GAAM,EAAIU,EAAQV,QAAS,GAExDjB,EAAMsC,GAAQe,GAAUvF,OAIxB,IAAM2E,EAAI,EAAGC,EAAKL,EAAaE,OAAQE,EAAIC,EAAID,IAE9CzC,EAAMsC,GAAQG,GAAMJ,EAAalE,MAAOoE,EAASE,GAQpD,MAED,IAAK,YAIL,IAAK,SAIL,IAAK,QACJhF,QAAQM,KAAM,0EAA2EgF,GAK3F,IAAIO,EAWL,SAA+BtD,EAAMiD,GAEpC,IAAIK,KAIJ,IAAM,IAAIhB,KAAQtC,EAEjBsD,EAAU5E,MAAQ4D,KAAMrD,WAAYqD,GAAQxE,MAAOkC,EAAMsC,KAM1DgB,EAAUC,KAcV,SAAoBC,EAAGC,GAEtB,OAAOD,EAAElB,KAAOmB,EAAEnB,OAZnB,IAAM,IAAIjE,EAAI,EAAGA,EAAI,GAAIA,IAExBqF,EAAwBJ,EAAWjF,EAAG4E,EAAcnD,SAAUzB,IAI/D,OAAOiF,EAnCSK,CAAsB3D,EAAMiD,GAO5C,OAJC/E,KAAM2E,EAASe,KACfN,UAAWA,GA2Cb,IAAIO,EAAW,IAAIC,MACfC,EAAQ,IAAID,MACZE,EAAa,IAAIC,MAErB,SAASjC,EAAsBkC,EAAW7C,GAUzC,IARA,IAAIiC,EAAYY,EAAUZ,UACtBpF,EAAOgG,EAAUhG,KAEjBiG,KACAC,KACAC,KACAC,KAEMjG,EAAI,EAAGC,EAAIgF,EAAU/E,OAAQF,EAAIC,EAAGD,IAAO,CAEpD,IAAIkG,EAAWjB,EAAWjF,GAEtBiE,EAAOiC,EAASjC,KAChBxE,EAAQyG,EAASzG,MAErBoF,GAAOsB,UAAW1G,GAAQsF,YAC1BF,GAAOuB,UAAWZ,EAAUG,EAAYD,GAExCI,EAAMzF,KAAM4D,GACZ8B,EAAa1F,KAAMmF,EAASa,EAAGb,EAASc,EAAGd,EAASe,GACpDP,EAAe3F,KAAMsF,EAAWU,EAAGV,EAAWW,EAAGX,EAAWY,EAAGZ,EAAWa,GAC1EP,EAAU5F,KAAMqF,EAAMW,EAAGX,EAAMY,EAAGZ,EAAMa,GAQzC,OAJKR,EAAa7F,OAAS,GAAI8C,EAAO3C,KAAM,IAAIoG,MAAqB5G,EAAO,YAAaiG,EAAOC,IAC3FC,EAAe9F,OAAS,GAAI8C,EAAO3C,KAAM,IAAIqG,MAAyB7G,EAAO,cAAeiG,EAAOE,IACnGC,EAAU/F,OAAS,GAAI8C,EAAO3C,KAAM,IAAIoG,MAAqB5G,EAAO,SAAUiG,EAAOG,IAEnFjD,EAIR,SAASqC,EAAwBJ,EAAW0B,EAAUC,GAErD,IAAIV,EAGAlG,EAAGC,EADH4G,GAAQ,EAKZ,IAAM7G,EAAI,EAAGC,EAAIgF,EAAU/E,OAAQF,EAAIC,EAAGD,SAILwB,KAFpC0E,EAAWjB,EAAWjF,IAERP,MAAOkH,GAEpBT,EAASzG,MAAOkH,GAAa,KAI7BE,GAAQ,EAMV,IAAe,IAAVA,EAIJ,IAAM7G,EAAI,EAAGC,EAAIgF,EAAU/E,OAAQF,EAAIC,EAAGD,KAEzCkG,EAAWjB,EAAWjF,IAEbP,MAAOkH,GAAaC,OAchC,SAAiC3B,EAAW0B,GAI3C,IAFA,IAAIG,EAAMC,EAEA/G,EAAI,EAAGC,EAAIgF,EAAU/E,OAAQF,EAAIC,EAAGD,IAAO,CAEpD,IAAIkG,EAAWjB,EAAWjF,GAE1B,GAAoC,OAA/BkG,EAASzG,MAAOkH,GAAsB,CAK1C,GAHAG,EAAOE,EAAS/B,EAAWjF,EAAG2G,GAC9BI,EAAOE,EAAShC,EAAWjF,EAAG2G,GAEhB,OAATG,EAAgB,CAEpBZ,EAASzG,MAAOkH,GAAaI,EAAKtH,MAAOkH,GACzC,SAID,GAAc,OAATI,EAAgB,CAEpBb,EAASzG,MAAOkH,GAAaG,EAAKrH,MAAOkH,GACzC,SAIDO,EAAahB,EAAUY,EAAMC,EAAMJ,KAjCpCQ,CAAwBlC,EAAW0B,GAyCrC,SAASK,EAAS/B,EAAWjF,EAAG2G,GAE/B,KAAQ3G,GAAK,GAAI,CAEhB,IAAIkG,EAAWjB,EAAWjF,GAE1B,GAAoC,OAA/BkG,EAASzG,MAAOkH,GAAsB,OAAOT,EAElDlG,IAID,OAAO,KAIR,SAASiH,EAAShC,EAAWjF,EAAG2G,GAE/B,KAAQ3G,EAAIiF,EAAU/E,QAAS,CAE9B,IAAIgG,EAAWjB,EAAWjF,GAE1B,GAAoC,OAA/BkG,EAASzG,MAAOkH,GAAsB,OAAOT,EAElDlG,IAID,OAAO,KAIR,SAASkH,EAAaE,EAAKN,EAAMC,EAAMJ,GAE/BI,EAAK9C,KAAO6C,EAAK7C,MAAW,EAOnCmD,EAAI3H,MAAOkH,IAAiBS,EAAInD,KAAO6C,EAAK7C,OAAW8C,EAAKtH,MAAOkH,GAAaG,EAAKrH,MAAOkH,KAAiBI,EAAK9C,KAAO6C,EAAK7C,MAAW6C,EAAKrH,MAAOkH,GALpJS,EAAI3H,MAAOkH,GAAaG,EAAKrH,MAAOkH,GAwCtC,SAASU,EAAoB1F,GAQ5B,IANA,IAAIqB,KAEAnD,EAAO8B,EAAK9B,KACZyH,EAAa3F,EAAK4F,IAAM5F,EAAK6F,QAAa,EAC1C1D,EAAanC,EAAKmC,WAEZ9D,EAAI,EAAGmE,EAAKL,EAAW5D,OAAQF,EAAImE,EAAInE,IAIhD,IAFA,IAAIyH,EAAkB5D,EAAcC,EAAY9D,IAEtCoE,EAAI,EAAGC,EAAKoD,EAAgBvH,OAAQkE,EAAIC,EAAID,IAErDpB,EAAO3C,KAAMoH,EAAiBrD,IAMhC,OAAO,IAAIsD,IAAe7H,EAAMyH,EAAUtE,GAI3C,SAAS2E,EAAkBzF,GAE1B,OAAOJ,EAAUP,GAAQqG,MAAO1F,GAAMmF,GAqCvC,SAASQ,EAAWjI,GAMnB,IAJA,IAAI+B,GACHwB,YAGSnD,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,oBACJuB,EAAKmG,gBAAkBnH,EAAaR,EAAM4H,aAC1C,MAED,IAAK,SACJ,IAAI7F,EAAK/B,EAAMgC,aAAc,MAC7BR,EAAKwB,QAASjB,GAAO8F,GAAa7H,GAClC,MAED,IAAK,SACJwB,EAAKsG,OAASC,EAAa/H,GAC3B,MAED,IAAK,iBACJwB,EAAKwG,cAAgBC,EAAoBjI,IAO5C,OAAOwB,EAIR,SAASuG,EAAatI,GAMrB,IAJA,IAAI+B,GACHK,WAGShC,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,QACJ,IAAIgC,EAAWjC,EAAMgC,aAAc,YAC/BD,EAAKnB,EAASZ,EAAMgC,aAAc,WACtCR,EAAKK,OAAQI,GAAaF,GAO7B,OAAOP,EAIR,SAASyG,EAAoBxI,GAM5B,IAJA,IAAI+B,GACHK,WAGShC,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,QACJ,IAAIgC,EAAWjC,EAAMgC,aAAc,YAC/BD,EAAKnB,EAASZ,EAAMgC,aAAc,WAClCkG,EAASvH,SAAUX,EAAMgC,aAAc,WAC3CR,EAAKK,OAAQI,IAAeF,GAAIA,EAAImG,OAAQA,GAC5C,MAED,IAAK,SACJ1G,EAAK2G,OAASzH,EAAWV,EAAM4H,aAC/B,MAED,IAAK,IACJpG,EAAK4G,EAAI1H,EAAWV,EAAM4H,cAO7B,OAAOpG,EAIR,SAAS6G,EAAiB7G,GAEzB,IAAIE,GACHK,GAAIP,EAAKO,IAGNuG,EAAWlH,GAAQmH,WAAY7G,EAAMK,IAazC,YAXmBV,IAAdG,EAAKgH,OAET9G,EAAM8G,KAaR,SAAoBhH,GAEnB,IA4BI3B,EAAGoE,EAAGnE,EA1BN4B,GACHoG,UACArF,SACC9C,SACAoE,OANe,GAQhB0E,SACC9I,SACAoE,OAVe,IAcbf,EAAUxB,EAAKwB,QACfgF,EAAgBxG,EAAKwG,cAErBG,EAASH,EAAcG,OACvBC,EAAIJ,EAAcI,EAClBM,EAAcV,EAAcnG,OAAO8G,MAAMT,OACzCU,EAAeZ,EAAcnG,OAAOgH,OAAOX,OAE3CY,EAActH,EAAKwB,QAASxB,EAAKsG,OAAOjG,OAAO8G,OAC/CI,EAAgBvH,EAAKwB,QAASxB,EAAKsG,OAAOjG,OAAOmH,iBAEjDP,EAAUzF,EAASgF,EAAcnG,OAAOgH,OAAO9G,IAAKpC,MACpDoE,EAAS,EAMb,IAAMlE,EAAI,EAAGC,EAAIqI,EAAOpI,OAAQF,EAAIC,EAAGD,IAAO,CAE7C,IAAIoJ,EAAad,EAAQtI,GACrBqJ,KAEJ,IAAMjF,EAAI,EAAGA,EAAIgF,EAAYhF,IAAO,CAEnC,IAAIkF,EAAYf,EAAGrE,EAAS2E,GACxBU,EAAWhB,EAAGrE,EAAS6E,GACvBS,EAAaZ,EAASW,GAE1BF,EAAehJ,MAAQ2E,MAAOsE,EAAWG,OAAQD,IAEjDtF,GAAU,EAYX,IALAmF,EAAenE,KAAMwE,GAKftF,EAAI,EAAGA,EAzDG,EAyDaA,IAAO,CAEnC,IAAIjH,EAAIkM,EAAgBjF,QAEb5C,IAANrE,GAEJ0E,EAAMe,QAAQ9C,MAAMO,KAAMlD,EAAE6H,OAC5BnD,EAAM+G,QAAQ9I,MAAMO,KAAMlD,EAAEsM,UAI5B5H,EAAMe,QAAQ9C,MAAMO,KAAM,GAC1BwB,EAAM+G,QAAQ9I,MAAMO,KAAM,KAUxBsB,EAAKmG,gBAETjG,EAAM8H,YAAa,IAAIC,OAAUzD,UAAWxE,EAAKmG,iBAAkB/C,YAInElD,EAAM8H,YAAa,IAAIC,OAAUC,WAMlC,IAAM7J,EAAI,EAAGC,EAAIgJ,EAAYnJ,MAAMI,OAAQF,EAAIC,EAAGD,IAAO,CAExD,IAAIH,EAAOoJ,EAAYnJ,MAAOE,GAC1B8J,GAAc,IAAIF,OAAUzD,UAAW+C,EAAcpJ,MAAOE,EAAIkJ,EAAchF,QAASa,YAE3FlD,EAAMoG,OAAO5H,MAAQR,KAAMA,EAAMiK,YAAaA,IAI/C,OAAOjI,EAIP,SAAS6H,EAAYvE,EAAGC,GAEvB,OAAOA,EAAEqE,OAAStE,EAAEsE,QAzHPM,CAAWpI,EAAKgH,MAI7BF,EAAStF,QAAQ6G,YAAcnI,EAAM8G,KAAK/F,QAC1C6F,EAAStF,QAAQ8G,YAAcpI,EAAM8G,KAAKC,SAIpC/G,EAwIR,SAASqI,EAAYvI,GAEpB,YAAoBH,IAAfG,EAAKE,MAA6BF,EAAKE,MAErCF,EAAKwI,UAIb,SAASC,EAAUlI,GAElB,IAAIP,EAAOJ,GAAQ8I,OAAQnI,GAE3B,YAAcV,IAATG,EAEGG,EAAUH,EAAMuI,IAIxB9K,QAAQM,KAAM,oDAAsDwC,GAE7D,MA8BR,SAASoI,EAA0B1K,GAOlC,IALA,IAAI+B,GACH4I,YACArH,aAGSlD,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,WACJoK,EAAqBrK,EAAOwB,GAC5B,MAED,IAAK,YACJA,EAAK8I,UAAYC,EAAsBvK,GACvC,MAED,IAAK,QACJwB,EAAKgJ,MAAQC,EAAkBzK,IAOlC,OAAOwB,EAIR,SAAS6I,EAAqB5K,EAAK+B,GAIlC,IAFA,IAAIY,EAAM3C,EAAIuC,aAAc,OAElBnC,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,UACJuB,EAAK4I,SAAUhI,GAAQsI,EAAoB1K,GAC3C,MAED,IAAK,YACJwB,EAAKuB,SAAUX,GAAQuI,EAAoB3K,KAS/C,SAAS0K,EAAoBjL,GAI5B,IAFA,IAAI+B,KAEM3B,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,YACJuB,EAAKwI,UAAYhK,EAAM4H,aAO1B,OAAOpG,EAIR,SAASmJ,EAAoBlL,GAI5B,IAFA,IAAI+B,KAEM3B,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,SACJuB,EAAKoJ,OAAS5K,EAAM4H,aAOvB,OAAOpG,EAIR,SAAS+I,EAAsB9K,GAI9B,IAFA,IAAI+B,KAEM3B,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,WACL,IAAK,UACL,IAAK,QACL,IAAK,QACJuB,EAAKqJ,KAAO7K,EAAMC,SAClBuB,EAAKsJ,WAAaC,EAAuB/K,IAO5C,OAAOwB,EAIR,SAASuJ,EAAuBtL,GAI/B,IAFA,IAAI+B,KAEM3B,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,WACL,IAAK,UACL,IAAK,WACL,IAAK,OACL,IAAK,UACL,IAAK,YACL,IAAK,eACJuB,EAAMxB,EAAMC,UAAa+K,EAAsBhL,GAC/C,MACD,IAAK,cACJwB,EAAMxB,EAAMC,WACXgL,OAAQjL,EAAMgC,aAAc,UAC5BR,KAAMwJ,EAAsBhL,KAQhC,OAAOwB,EAIR,SAASwJ,EAAsBvL,GAI9B,IAFA,IAAI+B,KAEM3B,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,QACJuB,EAAMxB,EAAMC,UAAaO,EAAaR,EAAM4H,aAC5C,MAED,IAAK,QACJpG,EAAMxB,EAAMC,UAAaQ,WAAYT,EAAM4H,aAC3C,MAED,IAAK,UACJpG,EAAMxB,EAAMC,WAAe8B,GAAI/B,EAAMgC,aAAc,WAAawI,MAAOU,EAA6BlL,KAOvG,OAAOwB,EAIR,SAAS0J,EAA6BzL,GAMrC,IAJA,IAAI+B,GACH8I,cAGSzK,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,QACJkL,EAAkCnL,EAAOwB,IAO5C,OAAOA,EAIR,SAAS2J,EAAkC1L,EAAK+B,GAE/C,IAAM,IAAI3B,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,YACJmL,EAA2CpL,EAAOwB,KAStD,SAAS4J,EAA2C3L,EAAK+B,GAExD,IAAM,IAAI3B,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,UACL,IAAK,UACL,IAAK,UACL,IAAK,UACJuB,EAAK8I,UAAWtK,EAAMC,UAAaQ,WAAYT,EAAM4H,aACrD,MAED,IAAK,QACL,IAAK,QAIqC,SAApC5H,EAAM4H,YAAYyD,cAEtB7J,EAAK8I,UAAWtK,EAAMC,UAAa,EAEY,UAApCD,EAAM4H,YAAYyD,cAE7B7J,EAAK8I,UAAWtK,EAAMC,UAAa,EAInCuB,EAAK8I,UAAWtK,EAAMC,UAAaU,SAAUX,EAAM4H,eAYxD,SAAS6C,EAAkBhL,GAI1B,IAFA,IAAI+B,KAEM3B,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,YACJuB,EAAK8I,UAAYgB,EAA2BtL,IAO/C,OAAOwB,EAIR,SAAS8J,EAA2B7L,GAInC,IAFA,IAAI+B,KAEM3B,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,eACJuB,EAAMxB,EAAMC,UAAaU,SAAUX,EAAM4H,cAO5C,OAAOpG,EAIR,SAAS+J,EAAa/J,GAErB,OAAOA,EA4DR,SAASgK,EAAehK,GAEvB,IA1DmBO,EA8Df0J,EAJAC,GA1De3J,EA0DKP,EAAKzD,IAxDtB4D,EAAUP,GAAQuK,QAAS5J,GAAMwJ,IAyDpCjB,EAAYoB,EAAOE,QAAQtB,UAC3BE,EAAQkB,EAAOE,QAAQpB,MAI3B,OAASF,EAAUO,MAElB,IAAK,QACL,IAAK,QACJY,EAAW,IAAII,MACf,MAED,IAAK,UACJJ,EAAW,IAAIK,MACf,MAED,QACCL,EAAW,IAAIM,MAOjB,SAASC,EAAYC,GAEpB,IAAItJ,EAAU+I,EAAOE,QAAQ7I,SAAUkJ,EAAclK,IACjDmK,EAAQ,UAIK7K,IAAZsB,EAGJuJ,EAAQjC,EADMyB,EAAOE,QAAQxB,SAAUzH,EAAQiI,QACrBZ,YAI1B/K,QAAQM,KAAM,+EACd2M,EAAQjC,EAAUgC,EAAclK,KAMjC,GAAe,OAAVmK,EAAiB,CAErB,IAAI3N,EAxEP,SAA2B2N,GAE1B,IAAI3N,EAEA4N,EAAYD,EAAME,MAAgD,GAAvCF,EAAMG,YAAa,KAAQ,IAAM,IAGhE,OAFAF,EAAYA,EAAUG,eAIrB,IAAK,MACJ/N,EAASgO,GACT,MAED,QACChO,EAASiO,GAIX,OAAOjO,EAsDQkO,CAAkBP,GAE/B,QAAgB7K,IAAX9C,EAAuB,CAE3B,IAAImO,EAAUnO,EAAOT,KAAMoO,GAEvB1B,EAAQyB,EAAczB,MAE1B,QAAenJ,IAAVmJ,QAA2CnJ,IAApBmJ,EAAMF,YAA0D,IAA/BxJ,EAAS0J,EAAMF,WAAwB,CAEnG,IAAIA,EAAYE,EAAMF,UAEtBoC,EAAQC,MAAQrC,EAAUsC,MAAQC,MAAiBC,IACnDJ,EAAQK,MAAQzC,EAAU0C,MAAQH,MAAiBC,IAEnDJ,EAAQxE,OAAO+E,IAAK3C,EAAU4C,SAAW,EAAG5C,EAAU6C,SAAW,GACjET,EAAQU,OAAOH,IAAK3C,EAAU+C,SAAW,EAAG/C,EAAUgD,SAAW,QAIjEZ,EAAQC,MAAQE,MAChBH,EAAQK,MAAQF,MAIjB,OAAOH,EAMP,OAFAzN,QAAQM,KAAM,wDAAyD2M,GAEhE,KAQR,OAFAjN,QAAQM,KAAM,wDAA0D0M,EAAclK,IAE/E,KAhET0J,EAAS/L,KAAO8B,EAAK9B,MAAQ,GAsE7B,IAAIoL,EAAaR,EAAUQ,WAE3B,IAAM,IAAI7D,KAAO6D,EAAa,CAE7B,IAAIyC,EAAYzC,EAAY7D,GAE5B,OAASA,GAER,IAAK,UACCsG,EAAUC,OAAQ/B,EAAS+B,MAAMxH,UAAWuH,EAAUC,OACtDD,EAAUb,UAAUjB,EAASgC,IAAMzB,EAAYuB,EAAUb,UAC9D,MACD,IAAK,WACCa,EAAUC,OAAS/B,EAASiC,UAAWjC,EAASiC,SAAS1H,UAAWuH,EAAUC,OAC9ED,EAAUb,UAAUjB,EAASkC,YAAc3B,EAAYuB,EAAUb,UACtE,MACD,IAAK,OACCa,EAAUb,UAAUjB,EAASmC,UAAY5B,EAAYuB,EAAUb,UACpE,MACD,IAAK,UACCa,EAAUb,UAAUjB,EAASoC,SAAW7B,EAAYuB,EAAUb,UACnE,MACD,IAAK,YACCa,EAAUO,OAASrC,EAASsC,YAAYtC,EAASsC,UAAYR,EAAUO,OAC5E,MACD,IAAK,WACCP,EAAUC,OAAS/B,EAASuC,UAAWvC,EAASuC,SAAShI,UAAWuH,EAAUC,OAC9ED,EAAUb,UAAUjB,EAASwC,YAAcjC,EAAYuB,EAAUb,WASzE,IAAIwB,EAAcpD,EAAA,YACdqD,EAAerD,EAAA,aAwBnB,QApBsBzJ,IAAjB8M,GAA8BD,IAElCC,GACCL,MAAO,SAOYzM,IAAhB6M,GAA6BC,IAEjCD,GACCjD,OAAQ,QACRzJ,MACCgM,OAAS,EAAG,EAAG,EAAG,MAKhBU,GAAeC,EAInB,GAAKD,EAAY1M,KAAKkL,QAIrBjB,EAASyC,aAAc,MAEjB,CAEN,IAAIV,EAAQU,EAAY1M,KAAKgM,MAE7B,OAASU,EAAYjD,QAEpB,IAAK,QACJQ,EAAS2C,QAAUZ,EAAO,GAAMW,EAAaL,MAC7C,MACD,IAAK,WACJrC,EAAS2C,QAAU,EAAMZ,EAAO,GAAMW,EAAaL,MACnD,MACD,IAAK,SACJrC,EAAS2C,QAAU,EAAMZ,EAAO,GAAMW,EAAaL,MACnD,MACD,IAAK,UACJrC,EAAS2C,QAAUZ,EAAO,GAAMW,EAAaL,MAC7C,MACD,QACC7O,QAAQM,KAAM,oEAAqE2O,EAAYjD,QAI5FQ,EAAS2C,QAAU,IAAI3C,EAASyC,aAAc,GAcrD,YANe7M,IAAVmJ,QAA2CnJ,IAApBmJ,EAAMF,WAA4D,IAAjCE,EAAMF,UAAU+D,eAE5E5C,EAAS6C,KAAOC,KAIV9C,EAIR,SAAS+C,EAAazM,GAErB,OAAOJ,EAAUP,GAAQqN,UAAW1M,GAAMyJ,GAgC3C,SAASkD,EAAmBjP,GAE3B,IAAM,IAAII,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,OAASG,EAAMC,UAEd,IAAK,mBACJ,OAAO0O,EAAsB3O,IAMhC,SAID,SAAS2O,EAAsBlP,GAI9B,IAFA,IAAI+B,KAEM3B,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,OAASG,EAAMC,UAEd,IAAK,cACL,IAAK,eAEJuB,EAAK8I,UAAYtK,EAAMC,SACvBuB,EAAKsJ,WAAa8D,EAAuB5O,IAQ5C,OAAOwB,EAIR,SAASoN,EAAuBnP,GAI/B,IAFA,IAAI+B,KAEM3B,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,OAASG,EAAMC,UAEd,IAAK,OACL,IAAK,OACL,IAAK,OACL,IAAK,OACL,IAAK,QACL,IAAK,OACL,IAAK,eACJuB,EAAMxB,EAAMC,UAAaQ,WAAYT,EAAM4H,cAO9C,OAAOpG,EAIR,SAASqN,EAAarN,GAErB,IAAIsN,EAEJ,OAAStN,EAAKuN,OAAOzE,WAEpB,IAAK,cACJwE,EAAS,IAAIE,MACZxN,EAAKuN,OAAOjE,WAAWmE,KACvBzN,EAAKuN,OAAOjE,WAAWoE,aACvB1N,EAAKuN,OAAOjE,WAAWqE,MACvB3N,EAAKuN,OAAOjE,WAAWsE,MAExB,MAED,IAAK,eACJ,IAAIC,EAAO7N,EAAKuN,OAAOjE,WAAWuE,KAC9BC,EAAO9N,EAAKuN,OAAOjE,WAAWwE,KAC9BC,EAAc/N,EAAKuN,OAAOjE,WAAWoE,aAEzCI,OAAkBjO,IAATiO,EAAyBD,EAAOE,EAAgBD,EACzDD,OAAkBhO,IAATgO,EAAyBC,EAAOC,EAAgBF,EAEzDC,GAAQ,GACRD,GAAQ,GAERP,EAAS,IAAIU,OACVF,EAAMA,EAAMD,GAAQA,EACtB7N,EAAKuN,OAAOjE,WAAWqE,MACvB3N,EAAKuN,OAAOjE,WAAWsE,MAExB,MAED,QACCN,EAAS,IAAIE,MAOf,OAFAF,EAAOpP,KAAO8B,EAAK9B,MAAQ,GAEpBoP,EAIR,SAASW,EAAW1N,GAEnB,IAAIP,EAAOJ,GAAQsO,QAAS3N,GAE5B,YAAcV,IAATG,EAEGG,EAAUH,EAAMqN,IAIxB5P,QAAQM,KAAM,qDAAuDwC,GAE9D,MA8BR,SAAS4N,GAAqBlQ,GAI7B,IAFA,IAAI+B,KAEM3B,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,cACL,IAAK,QACL,IAAK,OACL,IAAK,UAEJuB,EAAK8I,UAAYtK,EAAMC,SACvBuB,EAAKsJ,WAAa8E,GAAsB5P,IAM3C,OAAOwB,EAIR,SAASoO,GAAsBnQ,GAI9B,IAFA,IAAI+B,KAEM3B,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,QACJ,IAAIN,EAAQa,EAAaR,EAAM4H,aAC/BpG,EAAKgM,OAAQ,IAAIqC,KAAQ7J,UAAWrG,GACpC,MAED,IAAK,gBACJ6B,EAAKsO,aAAerP,WAAYT,EAAM4H,aACtC,MAED,IAAK,wBACJ,IAAImI,EAAItP,WAAYT,EAAM4H,aAC1BpG,EAAKwO,SAAWD,EAAIE,KAAKC,KAAM,EAAIH,GAAM,GAO5C,OAAOvO,EAIR,SAAS2O,GAAY3O,GAEpB,IAAI4O,EAEJ,OAAS5O,EAAK8I,WAEb,IAAK,cACJ8F,EAAQ,IAAIC,IACZ,MAED,IAAK,QACJD,EAAQ,IAAIE,MACZ,MAED,IAAK,OACJF,EAAQ,IAAIG,MACZ,MAED,IAAK,UACJH,EAAQ,IAAII,IAQd,OAHKhP,EAAKsJ,WAAW0C,OAAQ4C,EAAM5C,MAAMiD,KAAMjP,EAAKsJ,WAAW0C,OAC1DhM,EAAKsJ,WAAWkF,WAAWI,EAAMJ,SAAWxO,EAAKsJ,WAAWkF,UAE1DI,EAIR,SAASM,GAAU3O,GAElB,IAAIP,EAAOJ,GAAQuP,OAAQ5O,GAE3B,YAAcV,IAATG,EAEGG,EAAUH,EAAM2O,KAIxBlR,QAAQM,KAAM,oDAAsDwC,GAE7D,MA6DR,SAAS8F,GAAapI,GAOrB,IALA,IAAI+B,GACH7B,SACAoE,OAAQ,GAGClE,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,cACJuB,EAAK7B,MAAQa,EAAaR,EAAM4H,aAChC,MAED,IAAK,aACJpG,EAAK7B,MAAQQ,EAAcH,EAAM4H,aACjC,MAED,IAAK,mBACJ,IAAIgJ,EAAWpR,EAAsBQ,EAAO,YAAc,QAExCqB,IAAbuP,IAEJpP,EAAKuC,OAASpD,SAAUiQ,EAAS5O,aAAc,aAUnD,OAAOR,EAIR,SAASqP,GAAuBpR,GAI/B,IAFA,IAAI+B,KAEM3B,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAEJ,IAAnBG,EAAM8B,WAEXN,EAAMxB,EAAMgC,aAAc,aAAiBpB,EAASZ,EAAMgC,aAAc,YAIzE,OAAOR,EAIR,SAASsP,GAAwBrR,GAWhC,IATA,IAAIsR,GACHlG,KAAMpL,EAAIQ,SACVwL,SAAUhM,EAAIuC,aAAc,YAC5BgP,MAAOrQ,SAAUlB,EAAIuC,aAAc,UACnCH,UACAkC,OAAQ,EACRkN,OAAO,GAGEpR,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,QACJ,IAAI8B,EAAKnB,EAASZ,EAAMgC,aAAc,WAClCC,EAAWjC,EAAMgC,aAAc,YAC/BkG,EAASvH,SAAUX,EAAMgC,aAAc,WACvCiL,EAAMtM,SAAUX,EAAMgC,aAAc,QACpCkP,EAAcjE,EAAM,EAAIhL,EAAWgL,EAAMhL,EAC7C8O,EAAUlP,OAAQqP,IAAgBnP,GAAIA,EAAImG,OAAQA,GAClD6I,EAAUhN,OAASkM,KAAKkB,IAAKJ,EAAUhN,OAAQmE,EAAS,GACtC,aAAbjG,IAA0B8O,EAAUE,OAAQ,GACjD,MAED,IAAK,SACJF,EAAU5I,OAASzH,EAAWV,EAAM4H,aACpC,MAED,IAAK,IACJmJ,EAAUK,EAAI1Q,EAAWV,EAAM4H,cAOlC,OAAOmJ,EAsBR,SAASM,GAAoBC,GAI5B,IAFA,IAAIN,EAAQ,EAEFnR,EAAI,EAAGC,EAAIwR,EAAWvR,OAAQF,EAAIC,EAAGD,IAAO,EAI5B,IAFTyR,EAAYzR,GAEboR,OAEdD,IAMGA,EAAQ,GAAKA,EAAQM,EAAWvR,SAEpCuR,EAAWC,aAAc,GAM3B,SAASC,GAAehQ,GAEvB,IAAIE,KAEAsB,EAAUxB,EAAKwB,QACfyO,EAAWjQ,EAAKiQ,SAChBH,EAAa9P,EAAK8P,WAEtB,GAA2B,IAAtBA,EAAWvR,OAAe,SAK/B,IAAI2R,EAvDL,SAA0BJ,GAIzB,IAFA,IAAI5P,KAEM7B,EAAI,EAAGA,EAAIyR,EAAWvR,OAAQF,IAAO,CAE9C,IAAIkR,EAAYO,EAAYzR,QAEKwB,IAA5BK,EAAOqP,EAAUlG,QAAuBnJ,EAAOqP,EAAUlG,UAE9DnJ,EAAOqP,EAAUlG,MAAO3K,KAAM6Q,GAI/B,OAAOrP,EAyCiBiQ,CAAiBL,GAEzC,IAAM,IAAIzG,KAAQ6G,EAAoB,CAErC,IAAIE,EAAgBF,EAAmB7G,GAIvCwG,GAAoBO,GAIpBlQ,EAAOmJ,GAASgH,GAAmBD,EAAe5O,EAASyO,GAI5D,OAAO/P,EAIR,SAASmQ,GAAmBP,EAAYtO,EAASyO,GAmBhD,IAjBA,IAAI/P,KAEA2D,GAAa1F,SAAWoE,OAAQ,GAChC+N,GAAWnS,SAAWoE,OAAQ,GAC9BgO,GAAOpS,SAAWoE,OAAQ,GAC1BiO,GAAQrS,SAAWoE,OAAQ,GAC3ByJ,GAAU7N,SAAWoE,OAAQ,GAE7BoF,OAAiC,EACjCE,OAAkC,EAElCf,EAAW,IAAI2J,IAEfC,KAEA7K,EAAQ,EAEF+J,EAAI,EAAGA,EAAIE,EAAWvR,OAAQqR,IAAO,CAE9C,IAAIL,EAAYO,EAAYF,GACxBvP,EAASkP,EAAUlP,OAInBmP,EAAQ,EAEZ,OAASD,EAAUlG,MAElB,IAAK,QACL,IAAK,aACJmG,EAA0B,EAAlBD,EAAUC,MAClB,MAED,IAAK,YACJA,EAA0B,EAAlBD,EAAUC,MAClB,MAED,IAAK,WAEJ,IAAM,IAAImB,EAAI,EAAGA,EAAIpB,EAAUC,MAAOmB,IAAO,CAE5C,IAAIC,EAAKrB,EAAU5I,OAAQgK,GAE3B,OAASC,GAER,KAAK,EACJpB,GAAS,EACT,MAED,KAAK,EACJA,GAAS,EACT,MAED,QACCA,GAAsB,GAAXoB,EAAK,IAOnB,MAED,QACCnT,QAAQM,KAAM,8CAA+CwR,EAAUlG,MAiBzE,IAAM,IAAInL,KAbV4I,EAAS+J,SAAUhL,EAAO2J,EAAOI,GACjC/J,GAAS2J,EAIJD,EAAUtF,UAEdyG,EAAahS,KAAM6Q,EAAUtF,UAMZ5J,EAAS,CAE1B,IAAIyQ,EAAQzQ,EAAQnC,GAEpB,OAASA,GAER,IAAK,SACJ,IAAM,IAAIuH,KAAOwK,EAAW,CAE3B,IAAI1P,EAAK0P,EAAUxK,GAEnB,OAASA,GAER,IAAK,WACJ,IAAIsL,EAAalN,EAAS1F,MAAMI,OAahC,GAZAyS,GAAmBzB,EAAW/N,EAASjB,GAAMuQ,EAAMpK,OAAQ7C,EAAS1F,OACpE0F,EAAStB,OAASf,EAASjB,GAAKgC,OAE3Bf,EAAQ8G,aAAe9G,EAAQ6G,cAEnC2I,GAAmBzB,EAAW/N,EAAQ6G,YAAayI,EAAMpK,OAAQiB,GACjEqJ,GAAmBzB,EAAW/N,EAAQ8G,YAAawI,EAAMpK,OAAQmB,KAMzC,IAApB0H,EAAUE,QAA8C,IAA3BK,EAAWC,YAE5C,CAAIP,GAAU3L,EAAS1F,MAAMI,OAASwS,GAAelN,EAAStB,OAE9D,IAFA,IAEUlE,EAAI,EAAGA,EAAImR,EAAOnR,IAI3BkS,EAAGpS,MAAMO,KAAM,EAAG,GAMpB,MAED,IAAK,SACJsS,GAAmBzB,EAAW/N,EAASjB,GAAMuQ,EAAMpK,OAAQ4J,EAAOnS,OAClEmS,EAAO/N,OAASf,EAASjB,GAAKgC,OAC9B,MAED,IAAK,QACJyO,GAAmBzB,EAAW/N,EAASjB,GAAMuQ,EAAMpK,OAAQsF,EAAM7N,OACjE6N,EAAMzJ,OAASf,EAASjB,GAAKgC,OAC7B,MAED,IAAK,WACJyO,GAAmBzB,EAAW/N,EAASjB,GAAMuQ,EAAMpK,OAAQ6J,EAAGpS,OAC9DoS,EAAGhO,OAASf,EAASjB,GAAKgC,OAC1B,MAED,IAAK,YACJyO,GAAmBzB,EAAW/N,EAASjB,GAAMuQ,EAAMpK,OAAQ8J,EAAIrS,OAC/DoS,EAAGhO,OAASf,EAASjB,GAAKgC,OAC1B,MAED,QACC9E,QAAQM,KAAM,4EAA6E0H,IAM9F,MAED,IAAK,SACJuL,GAAmBzB,EAAW/N,EAASsP,EAAMvQ,IAAMuQ,EAAMpK,OAAQ4J,EAAOnS,OACxEmS,EAAO/N,OAASf,EAASsP,EAAMvQ,IAAKgC,OACpC,MAED,IAAK,QACJyO,GAAmBzB,EAAW/N,EAASsP,EAAMvQ,IAAMuQ,EAAMpK,OAAQsF,EAAM7N,OACvE6N,EAAMzJ,OAASf,EAASsP,EAAMvQ,IAAKgC,OACnC,MAED,IAAK,WACJyO,GAAmBzB,EAAW/N,EAASsP,EAAMvQ,IAAMuQ,EAAMpK,OAAQ6J,EAAGpS,OACpEoS,EAAGhO,OAASf,EAASsP,EAAMvQ,IAAKgC,OAChC,MAED,IAAK,YACJyO,GAAmBzB,EAAW/N,EAASsP,EAAMvQ,IAAMuQ,EAAMpK,OAAQ8J,EAAIrS,OACrEqS,EAAIjO,OAASf,EAASsP,EAAMvQ,IAAKgC,SAwBrC,OAbKsB,EAAS1F,MAAMI,OAAS,GAAIuI,EAASmK,aAAc,WAAY,IAAIC,IAAwBrN,EAAS1F,MAAO0F,EAAStB,SACpH+N,EAAOnS,MAAMI,OAAS,GAAIuI,EAASmK,aAAc,SAAU,IAAIC,IAAwBZ,EAAOnS,MAAOmS,EAAO/N,SAC5GyJ,EAAM7N,MAAMI,OAAS,GAAIuI,EAASmK,aAAc,QAAS,IAAIC,IAAwBlF,EAAM7N,MAAO6N,EAAMzJ,SACxGgO,EAAGpS,MAAMI,OAAS,GAAIuI,EAASmK,aAAc,KAAM,IAAIC,IAAwBX,EAAGpS,MAAOoS,EAAGhO,SAC5FiO,EAAIrS,MAAMI,OAAS,GAAIuI,EAASmK,aAAc,MAAO,IAAIC,IAAwBV,EAAIrS,MAAOqS,EAAIjO,SAEhGoF,EAAgBpJ,OAAS,GAAIuI,EAASmK,aAAc,YAAa,IAAIC,IAAwBvJ,EAAiBA,IAC9GE,EAAiBtJ,OAAS,GAAIuI,EAASmK,aAAc,aAAc,IAAIC,IAAwBrJ,EAAkBA,IAEtH3H,EAAMF,KAAO8G,EACb5G,EAAMmJ,KAAOyG,EAAY,GAAIzG,KAC7BnJ,EAAMwQ,aAAeA,EAEdxQ,EAIR,SAAS8Q,GAAmBzB,EAAWnG,EAAQ1C,EAAQvI,GAEtD,IAAI8C,EAAUsO,EAAUK,EACpBrN,EAASgN,EAAUhN,OACnBoE,EAAS4I,EAAU5I,OAEvB,SAASwK,EAAY9S,GAKpB,IAHA,IAAIgF,EAAQpC,EAAS5C,EAAIqI,GAAW0K,EAChC7S,EAAS8E,EAAQ+N,EAEb/N,EAAQ9E,EAAQ8E,IAEvBlF,EAAMO,KAAM2S,EAAahO,IAM3B,IAAIgO,EAAcjI,EAAOjL,MACrBiT,EAAehI,EAAO7G,OAE1B,QAA0B1C,IAArB0P,EAAU5I,OAId,IAFA,IAAItD,EAAQ,EAEFhF,EAAI,EAAGC,EAAIqI,EAAOpI,OAAQF,EAAIC,EAAGD,IAAO,CAEjD,IAAImR,EAAQ7I,EAAQtI,GAEpB,GAAe,IAAVmR,EAAc,CAElB,IACI/L,EAAIJ,EAAiB,EAATd,EACZ+O,EAAIjO,EAAiB,EAATd,EACZ/G,EAAI6H,EAAiB,EAATd,EAEhB4O,EALQ9N,EAAiB,EAATd,GAKC4O,EAAY1N,GAAK0N,EAAY3V,GAC9C2V,EAAY1N,GAAK0N,EAAYG,GAAKH,EAAY3V,QAExC,GAAe,IAAVgU,EAAc,CAGrB/L,EAAIJ,EAAiB,EAATd,EACZ+O,EAAIjO,EAAiB,EAATd,EAEhB4O,EAJQ9N,EAAiB,EAATd,GAIC4O,EAAY1N,GAAK0N,EAAYG,QAExC,GAAK9B,EAAQ,EAEnB,IAAM,IAAI+B,EAAI,EAAGC,EAAOhC,EAAQ,EAAK+B,GAAKC,EAAID,IAAO,CAGhD9N,EAAIJ,EAAQd,EAASgP,EACrBD,EAAIjO,EAAQd,GAAWgP,EAAI,GAE/BJ,EAJQ9N,EAAiB,EAATd,GAIC4O,EAAY1N,GAAK0N,EAAYG,GAMhDjO,GAASd,EAASiN,OAMnB,IAAUnR,EAAI,EAAGC,EAAI2C,EAAQ1C,OAAQF,EAAIC,EAAGD,GAAKkE,EAEhD4O,EAAY9S,GAQf,SAASoT,GAAalR,GAErB,OAAOJ,EAAUP,GAAQmH,WAAYxG,GAAMyP,IAkC5C,SAAS0B,GAAsB1R,GAE9B,YAAoBH,IAAfG,EAAKE,MAA6BF,EAAKE,MAErCF,EAUR,SAAS2R,GAAgC1T,EAAK+B,GAE7C,IAAM,IAAI3B,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,QACJuB,EAAKsG,OAAQ9H,EAAMgC,aAAc,QAAYoR,GAAsBpT,GACnE,MAED,IAAK,OACJwB,EAAK6R,MAAMnT,KAAMoT,GAAqBtT,MAS1C,SAASoT,GAAsB3T,GAI9B,IAFA,IAAI+B,EAEM3B,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,YACL,IAAK,WACJuB,EAAO+R,GAA+BvT,IAOzC,OAAOwB,EAIR,SAAS+R,GAA+B9T,EAAK+B,GAExCA,GACHY,IAAK3C,EAAIuC,aAAc,OACvBtC,KAAMD,EAAIuC,aAAc,SAAY,GACpCwR,KAAM,IAAIlO,MACVmO,QACCC,IAAK,EACLvC,IAAK,GAENtG,KAAMpL,EAAIQ,SACV0T,QAAQ,EACRC,aAAc,EACdC,eAAgB,GAGjB,IAdA,IAcUhU,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,OACJ,IAAIN,EAAQa,EAAaR,EAAM4H,aAC/BpG,EAAKgS,KAAKxN,UAAWrG,GACrB,MACD,IAAK,SACJ,IAAIwR,EAAMnR,EAAMR,qBAAsB,OAAS,GAC3CkU,EAAM1T,EAAMR,qBAAsB,OAAS,GAE/CgC,EAAKiS,OAAOtC,IAAM1Q,WAAY0Q,EAAIvJ,aAClCpG,EAAKiS,OAAOC,IAAMjT,WAAYiT,EAAI9L,cAmBrC,OAVKpG,EAAKiS,OAAOC,KAAOlS,EAAKiS,OAAOtC,MAEnC3P,EAAKmS,QAAS,GAMfnS,EAAKqS,gBAAmBrS,EAAKiS,OAAOC,IAAMlS,EAAKiS,OAAOtC,KAAQ,EAEvD3P,EAIR,SAAS8R,GAAqB7T,GAS7B,IAPA,IAAI+B,GACHY,IAAK3C,EAAIuC,aAAc,OACvBtC,KAAMD,EAAIuC,aAAc,SAAY,GACpC8R,eACAtP,eAGS3E,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,kBACJuB,EAAKsS,YAAY5T,KAAM6T,GAA2B/T,IAClD,MAED,IAAK,SACL,IAAK,YACL,IAAK,SACJwB,EAAKgD,WAAWtE,KAAM8T,GAA0BhU,KAOnD,OAAOwB,EAIR,SAASuS,GAA2BtU,GAQnC,IANA,IAAI+B,GACHyS,MAAOxU,EAAIuC,aAAc,SAAU1B,MAAO,KAAM4T,MAChD1P,cACA6O,UAGSxT,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,OACJuB,EAAK6R,MAAMnT,KAAMoT,GAAqBtT,IACtC,MAED,IAAK,SACL,IAAK,YACL,IAAK,SACJwB,EAAKgD,WAAWtE,KAAM8T,GAA0BhU,KAOnD,OAAOwB,EAIR,SAASwS,GAA0BvU,GAElC,IAAI+B,GACHqJ,KAAMpL,EAAIQ,UAGPN,EAAQa,EAAaf,EAAImI,aAE7B,OAASpG,EAAKqJ,MAEb,IAAK,SACJrJ,EAAK2S,IAAM,IAAI1K,MACfjI,EAAK2S,IAAInO,UAAWrG,GAAQiF,YAC5B,MAED,IAAK,YACJpD,EAAK2S,IAAM,IAAI7O,MACf9D,EAAK2S,IAAInO,UAAWrG,GACpB,MAED,IAAK,SACJ6B,EAAK2S,IAAM,IAAI7O,MACf9D,EAAK2S,IAAInO,UAAWrG,GACpB6B,EAAK4S,MAAQC,MAAUC,SAAU3U,EAAO,IAK1C,OAAO6B,EAkCR,SAAS+S,GAAuB9U,EAAK+B,GAEpC,IAAM,IAAI3B,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,mBACJuU,GAA6BxU,EAAOwB,KASxC,SAASgT,GAA6B/U,EAAK+B,GAE1C,IAAM,IAAI3B,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,UACJuB,EAAKiT,QAAUjU,EAAaR,EAAM4H,aAClC,MAED,IAAK,OACJpG,EAAKkT,KAAOlU,EAAaR,EAAM4H,aAAe,KAqClD,SAAS+M,GAA8BlV,GAMtC,IAJA,IAAI+B,GACHyB,OAAQxD,EAAIuC,aAAc,UAAW1B,MAAO,KAAM4T,OAGzCrU,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,OACJ,IAAI2U,EAAQ5U,EAAMR,qBAAsB,SAAW,GACnDgC,EAAKgS,KAAOoB,EAAMhN,YAClB,IAAIiN,EAAgBrT,EAAKgS,KAAKlT,MAAO,SAAU4T,MAAM5T,MAAO,QAAU,GACtEkB,EAAKsT,WAAaD,EAAcE,OAAQ,EAAGF,EAAc9U,OAAS,IAOrE,OAAOyB,EAIR,SAASwT,GAAsBxT,GAE9B,YAAoBH,IAAfG,EAAKE,MAA6BF,EAAKE,MAErCF,EAuQR,IAAIkD,GAAS,IAAI+E,MACbwL,GAAS,IAAI3P,MAEjB,SAAS4P,GAAWzV,GAiBnB,IAfA,IAAI+B,GACH9B,KAAMD,EAAIuC,aAAc,SAAY,GACpC6I,KAAMpL,EAAIuC,aAAc,QACxBD,GAAItC,EAAIuC,aAAc,MACtBI,IAAK3C,EAAIuC,aAAc,OACvB0C,OAAQ,IAAI+E,MACZrF,SACA+Q,mBACAC,uBACAC,kBACAC,sBACAC,iBACA/Q,eAGS3E,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,OACJuB,EAAK4C,MAAMlE,KAAMF,EAAMgC,aAAc,OACrCkT,GAAWlV,GACX,MAED,IAAK,kBACJwB,EAAK2T,gBAAgBjV,KAAMU,EAASZ,EAAMgC,aAAc,SACxD,MAED,IAAK,sBACJR,EAAK4T,oBAAoBlV,KAAMsV,GAAmBxV,IAClD,MAED,IAAK,iBACJwB,EAAK6T,eAAenV,KAAMU,EAASZ,EAAMgC,aAAc,SACvD,MAED,IAAK,oBACJR,EAAK8T,mBAAmBpV,KAAMsV,GAAmBxV,IACjD,MAED,IAAK,gBACJwB,EAAK+T,cAAcrV,KAAMU,EAASZ,EAAMgC,aAAc,SACtD,MAED,IAAK,SACJ,IAAIrC,EAAQa,EAAaR,EAAM4H,aAC/BpG,EAAKkD,OAAO+Q,SAAU/Q,GAAOsB,UAAWrG,GAAQiF,aAChDpD,EAAKgD,WAAYxE,EAAMgC,aAAc,QAAYhC,EAAMC,SACvD,MAED,IAAK,YACAN,EAAQa,EAAaR,EAAM4H,aAC/BqN,GAAOjP,UAAWrG,GAClB6B,EAAKkD,OAAO+Q,SAAU/Q,GAAOgR,gBAAiBT,GAAO/O,EAAG+O,GAAO9O,EAAG8O,GAAO7O,IACzE5E,EAAKgD,WAAYxE,EAAMgC,aAAc,QAAYhC,EAAMC,SACvD,MAED,IAAK,SACAN,EAAQa,EAAaR,EAAM4H,aAA/B,IACIwM,EAAQC,MAAUC,SAAU3U,EAAO,IACvC6B,EAAKkD,OAAO+Q,SAAU/Q,GAAOiR,iBAAkBV,GAAOjP,UAAWrG,GAASyU,IAC1E5S,EAAKgD,WAAYxE,EAAMgC,aAAc,QAAYhC,EAAMC,SACvD,MAED,IAAK,QACAN,EAAQa,EAAaR,EAAM4H,aAC/BpG,EAAKkD,OAAOa,MAAO0P,GAAOjP,UAAWrG,IACrC6B,EAAKgD,WAAYxE,EAAMgC,aAAc,QAAYhC,EAAMC,SACvD,MAED,IAAK,QACJ,MAED,QACChB,QAAQ2W,IAAK5V,IAgBhB,OAVK6V,GAASrU,EAAKO,IAElB9C,QAAQM,KAAM,yGAA0GiC,EAAKO,IAI7HX,GAAQgD,MAAO5C,EAAKO,IAAOP,EAIrBA,EAIR,SAASgU,GAAmB/V,GAQ3B,IANA,IAAI+B,GACHO,GAAInB,EAASnB,EAAIuC,aAAc,QAC/ByM,aACAqH,cAGSjW,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,OAASG,EAAMC,UAEd,IAAK,gBAGJ,IAFA,IAAI8V,EAAY/V,EAAMR,qBAAsB,qBAElCyE,EAAI,EAAGA,EAAI8R,EAAUhW,OAAQkE,IAAO,CAE7C,IAAI+R,EAAWD,EAAW9R,GACtBgS,EAASD,EAAShU,aAAc,UAChCiB,EAAS+S,EAAShU,aAAc,UAEpCR,EAAKiN,UAAWwH,GAAWrV,EAASqC,GAIrC,MAED,IAAK,WACJzB,EAAKsU,UAAU5V,KAAMU,EAASZ,EAAM4H,eAUvC,OAAOpG,EAIR,SAAS0U,GAAeJ,EAAWhO,GAElC,IAGIjI,EAAM2B,EAubcO,EA1bpBoU,KACAC,KAOJ,IAAMvW,EAAI,EAAGA,EAAIiW,EAAU/V,OAAQF,IAAO,CAEzC,IAAIwW,EAAWP,EAAWjW,GAI1B,GAAKgW,GAASQ,GAGbC,GADOhS,GAAS+R,GACUvO,EAAQqO,QAE5B,GAuagBpU,EAvaKsU,OAyaShV,IAA/BD,GAAQmV,aAAcxU,GAla3B,IAHA,IACIyU,EADcpV,GAAQmV,aAAcF,GACbG,SAEjBvS,EAAI,EAAGA,EAAIuS,EAASzW,OAAQkE,IAAO,CAE5C,IAAIjE,EAAQwW,EAAUvS,GAEtB,GAAoB,UAAfjE,EAAM6K,KAGVyL,GADWhS,GAAStE,EAAM+B,IACA+F,EAAQqO,QAQpClX,QAAQC,MAAO,qEAAsEmX,GAQvF,IAAMxW,EAAI,EAAGA,EAAIiI,EAAO/H,OAAQF,IAE/B,IAAMoE,EAAI,EAAGA,EAAIkS,EAASpW,OAAQkE,IAIjC,IAFAzC,EAAO2U,EAAUlS,IAEPwS,KAAK/W,OAASoI,EAAQjI,GAAIH,KAAO,CAE1C0W,EAAgBvW,GAAM2B,EACtBA,EAAKkV,WAAY,EACjB,MAUH,IAAM7W,EAAI,EAAGA,EAAIsW,EAASpW,OAAQF,KAIT,KAFxB2B,EAAO2U,EAAUtW,IAEP6W,YAETN,EAAelW,KAAMsB,GACrBA,EAAKkV,WAAY,GAQnB,IAAIC,KACAC,KAEJ,IAAM/W,EAAI,EAAGA,EAAIuW,EAAerW,OAAQF,IAEvC2B,EAAO4U,EAAgBvW,GAEvB8W,EAAMzW,KAAMsB,EAAKiV,MACjBG,EAAa1W,KAAMsB,EAAKmI,aAIzB,OAAO,IAAIkN,MAAUF,EAAOC,GAI7B,SAASN,GAAoBQ,EAAMhP,EAAQqO,GAI1CW,EAAKC,SAAU,SAAWhW,GAEzB,IAAuB,IAAlBA,EAAOiW,OAAkB,CAM7B,IAJA,IAAIrN,EAIM9J,EAAI,EAAGA,EAAIiI,EAAO/H,OAAQF,IAAO,CAE1C,IAAIoU,EAAQnM,EAAQjI,GAEpB,GAAKoU,EAAMvU,OAASqB,EAAOrB,KAAO,CAEjCiK,EAAcsK,EAAMtK,YACpB,YAMmBtI,IAAhBsI,IAQJA,EAAc,IAAIF,OAInB0M,EAASjW,MAAQuW,KAAM1V,EAAQ4I,YAAaA,EAAa+M,WAAW,OAQvE,SAASO,GAAWzV,GAenB,IAbA,IAj5EuBO,EAi5EnBmV,KAEAxS,EAASlD,EAAKkD,OACdN,EAAQ5C,EAAK4C,MACbyG,EAAOrJ,EAAKqJ,KACZsK,EAAkB3T,EAAK2T,gBACvBC,EAAsB5T,EAAK4T,oBAC3BC,EAAiB7T,EAAK6T,eACtBC,EAAqB9T,EAAK8T,mBAC1BC,EAAgB/T,EAAK+T,cAIf1V,EAAI,EAAGC,EAAIsE,EAAMrE,OAAQF,EAAIC,EAAGD,IAEzCqX,EAAQhX,KAAMoE,GAASF,EAAOvE,KAM/B,IAAUA,EAAI,EAAGC,EAAIqV,EAAgBpV,OAAQF,EAAIC,EAAGD,IAAO,CAE1D,IAAIsX,EAAiB1H,EAAW0F,EAAiBtV,IAEzB,OAAnBsX,GAEJD,EAAQhX,KAAMiX,EAAexS,SAQ/B,IAAU9E,EAAI,EAAGC,EAAIsV,EAAoBrV,OAAQF,EAAIC,EAAGD,IAYvD,IAVA,IAAImW,EAAWZ,EAAqBvV,GAChCuX,GAv7EkBrV,EAu7EUiU,EAASjU,GAr7EnCJ,EAAUP,GAAQiW,YAAatV,GAAMsG,IAu7EvCiP,EAAaC,GADAtE,GAAamE,EAAWrV,IACEiU,EAASvH,WAKhD4H,EAAWH,GAHCF,EAASF,UACZsB,EAAW5O,KAAKV,QAInB7D,EAAI,EAAGC,EAAKoT,EAAWvX,OAAQkE,EAAIC,EAAID,IAAO,CAEvD,IAAIlD,KAASuW,EAAYrT,IAEbuT,gBAEXzW,EAAO0W,KAAMpB,EAAUe,EAAW5O,KAAKgB,YACvCzI,EAAO2W,wBAIRR,EAAQhX,KAAMa,GAQhB,IAAUlB,EAAI,EAAGC,EAAIuV,EAAetV,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAI8X,EAAgBjH,GAAU2E,EAAgBxV,IAEvB,OAAlB8X,GAEJT,EAAQhX,KAAMyX,EAAchT,SAQ9B,IAAU9E,EAAI,EAAGC,EAAIwV,EAAmBvV,OAAQF,EAAIC,EAAGD,IAUtD,IAAUoE,EAAI,EAAGC,GAFboT,EAAaC,GADAtE,IALb+C,EAAWV,EAAoBzV,IAKIkC,IACIiU,EAASvH,YAEnB1O,OAAQkE,EAAIC,EAAID,IAEhDiT,EAAQhX,KAAMoX,EAAYrT,IAQ5B,IAAUpE,EAAI,EAAGC,EAAIyV,EAAcxV,OAAQF,EAAIC,EAAGD,IAEjDqX,EAAQhX,KAAMoE,GAASiR,EAAe1V,IAAM8E,SAM7C,GAAsB,IAAjBP,EAAMrE,QAAmC,IAAnBmX,EAAQnX,OAElCgB,EAASmW,EAAS,OAEZ,CAENnW,EAAoB,UAAT8J,EAAqB,IAAI+M,IAAS,IAAIC,IAEjD,IAAUhY,EAAI,EAAGA,EAAIqX,EAAQnX,OAAQF,IAEpCkB,EAAO+W,IAAKZ,EAASrX,IAUvB,OAJAkB,EAAOrB,KAAkB,UAATmL,EAAqBrJ,EAAKY,IAAMZ,EAAK9B,KACrDqB,EAAO2D,OAAO+L,KAAM/L,GACpB3D,EAAO2D,OAAOuB,UAAWlF,EAAOsE,SAAUtE,EAAOyE,WAAYzE,EAAOwE,OAE7DxE,EAIR,IAAIgX,GAAmB,IAAIhM,OAAqByB,MAAO,WAEvD,SAASwK,GAAwBhX,EAAMiX,GAItC,IAFA,IAAIxJ,KAEM5O,EAAI,EAAGC,EAAIkB,EAAKjB,OAAQF,EAAIC,EAAGD,IAAO,CAE/C,IAAIkC,EAAKkW,EAAmBjX,EAAMnB,SAEtBwB,IAAPU,GAEJ9C,QAAQM,KAAM,gFAAiFyB,EAAMnB,IACrG4O,EAAUvO,KAAM6X,KAIhBtJ,EAAUvO,KAAMsO,EAAazM,IAM/B,OAAO0M,EAIR,SAAS8I,GAAchP,EAAY0P,GAElC,IAAIf,KAEJ,IAAM,IAAIrM,KAAQtC,EAAa,CAE9B,IAAID,EAAWC,EAAYsC,GAEvB4D,EAAYuJ,GAAwB1P,EAAS4J,aAAc+F,GAIrC,IAArBxJ,EAAU1O,SAEA,UAAT8K,GAA6B,eAATA,EAExB4D,EAAUvO,KAAM,IAAIgY,MAIpBzJ,EAAUvO,KAAM,IAAI2L,QAQtB,IAAIsM,OAAoD9W,IAAvCiH,EAAS9G,KAAK4W,WAAWjP,UAE1C,GAAKgP,EAEJ,IAAM,IAAItY,EAAI,EAAGC,EAAI2O,EAAU1O,OAAQF,EAAIC,EAAGD,IAE7C4O,EAAW5O,GAAIsY,UAAW,EAQ5B,IAIIpX,EAJA0K,EAAkC,IAArBgD,EAAU1O,OAAiB0O,EAAW,GAAMA,EAM7D,OAAS5D,GAER,IAAK,QACJ9J,EAAS,IAAIsX,KAAc/P,EAAS9G,KAAMiK,GAC1C,MAED,IAAK,aACJ1K,EAAS,IAAIuX,IAAMhQ,EAAS9G,KAAMiK,GAClC,MAED,IAAK,YACL,IAAK,WAGH1K,EAFIoX,EAEK,IAAII,MAAajQ,EAAS9G,KAAMiK,GAIhC,IAAI+M,MAAMlQ,EAAS9G,KAAMiK,GAQrCyL,EAAQhX,KAAMa,GAIf,OAAOmW,EAIR,SAASrB,GAAS9T,GAEjB,YAA+BV,IAAxBD,GAAQgD,MAAOrC,GAIvB,SAASuC,GAASvC,GAEjB,OAAOJ,EAAUP,GAAQgD,MAAOrC,GAAMkV,IA2BvC,SAASwB,GAAkBjX,GAE1B,IAAIkX,EAAQ,IAAIb,IAChBa,EAAMhZ,KAAO8B,EAAK9B,KAIlB,IAFA,IAAI8W,EAAWhV,EAAKgV,SAEV3W,EAAI,EAAGA,EAAI2W,EAASzW,OAAQF,IAAO,CAE5C,IAAIG,EAAQwW,EAAU3W,GAEtB6Y,EAAMZ,IAAKxT,GAAStE,EAAM+B,KAI3B,OAAO2W,EAUR,SAASC,GAAgB5W,GAExB,OAAOJ,EAAUP,GAAQmV,aAAcxU,GAAM0W,IAkF9C,GAAqB,IAAhB3Z,EAAKiB,OAET,OAAS6Y,MAAO,IAAIC,OAIrB,IAAIpZ,IAAM,IAAIqZ,WAAYC,gBAAiBja,EAAM,mBAE7Cka,GAAUxZ,EAAsBC,GAAK,WAAa,GAElDwZ,GAAcxZ,GAAID,qBAAsB,eAAiB,GAC7D,QAAqB6B,IAAhB4X,GAA4B,CAIhC,IACIC,GADAC,GAAe3Z,EAAsByZ,GAAa,OAAS,GAe/D,OAVCC,GAFIC,GAEQA,GAAavR,YA9C3B,SAA4BqR,GAK3B,IAHA,IAAIG,EAAS,GACTC,GAAUJ,GAENI,EAAMtZ,QAAS,CAEtB,IAAIoE,EAAOkV,EAAMlX,QAEZgC,EAAKrC,WAAawX,KAAKC,UAE3BH,GAAUjV,EAAKyD,aAIfwR,GAAU,KACVC,EAAMnZ,KAAKsZ,MAAOH,EAAOlV,EAAKvE,aAMhC,OAAOwZ,EAAO/Y,OA4BDoZ,CAAmBR,IAIhCha,QAAQC,MAAO,uDAAwDga,IAEhE,KAMR,IAAIQ,GAAUV,GAAQhX,aAAc,WACpC/C,QAAQ2W,IAAK,oCAAqC8D,IAElD,IAIInN,GAJAoN,GAzpHJ,SAAqBla,GAEpB,OACCma,KAMF,SAAyBna,GAExB,YAAe4B,IAAR5B,IAAyD,IAAhCA,EAAIoa,aAAc,SAE1CpZ,WAAYhB,EAAIuC,aAAc,UAI9B,EAdD8X,CAAgBta,EAAsBC,EAAK,QAAU,IAC3Dsa,OAmBF,SAA2Bta,GAE1B,YAAe4B,IAAR5B,EAAoBA,EAAImI,YAAc,OArBpCoS,CAAkBxa,EAAsBC,EAAK,WAAa,KAqpHxDwa,CAAYza,EAAsBwZ,GAAS,SAAW,IAC9DxM,GAAgB,IAAI0N,MAAe1c,KAAKH,SAC5CmP,GAAc/N,QAASjB,KAAK2c,cAAgB/b,GAAOgc,eAAgB5c,KAAK6c,aAInEC,MAEJ/N,GAAY,IAAI+N,IAAW9c,KAAKH,UACtBoB,QAASjB,KAAK2c,cAAgB/b,GAMzC,IAAIuF,MACA4W,MACAvJ,GAAQ,EAIR5P,IACHuC,cACA8D,SACA4P,eACAnN,UACAyB,WACA8C,aACAiB,WACAiB,UACApI,cACAnE,SACAmS,gBACAiE,oBACAC,iBACAC,qBAGDzZ,EAAc+X,GAAS,qBAAsB,YArnH7C,SAAS2B,EAAgBlb,GAUxB,IARA,IAAI+B,GACHwB,WACAD,YACAD,aAGG8X,GAAc,EAER/a,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAIIkC,EAJA/B,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAIX,OAAS9B,EAAMC,UAEd,IAAK,SACJ8B,EAAK/B,EAAMgC,aAAc,MACzBR,EAAKwB,QAASjB,GAAO8F,GAAa7H,GAClC,MAED,IAAK,UACJ+B,EAAK/B,EAAMgC,aAAc,MACzBR,EAAKuB,SAAUhB,GAAOH,EAAuB5B,GAC7C,MAED,IAAK,UACJ+B,EAAK/B,EAAMgC,aAAc,UACzBR,EAAKsB,SAAUf,GAAOG,EAAuBlC,GAC7C,MAED,IAAK,YAEJ2a,EAAgB3a,GAChB4a,GAAc,EACd,MAED,QACC3b,QAAQ2W,IAAK5V,KAMK,IAAhB4a,IAIJxZ,GAAQuC,WAAYlE,EAAIuC,aAAc,OAAUqS,MAAUwG,gBAAmBrZ,KAkkH/EP,EAAc+X,GAAS,0BAA2B,iBA7qGlD,SAA6BvZ,GAS5B,IAPA,IAAI+B,GACH9B,KAAMD,EAAIuC,aAAc,OAAU,UAClCqF,MAAO5G,WAAYhB,EAAIuC,aAAc,UAAa,GAClDoF,IAAK3G,WAAYhB,EAAIuC,aAAc,QAAW,GAC9C2B,eAGS9D,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,qBACJuB,EAAKmC,WAAWzD,KAAMU,EAASZ,EAAMgC,aAAc,UAOtDZ,GAAQqG,MAAOhI,EAAIuC,aAAc,OAAWR,IAqpG7CP,EAAc+X,GAAS,sBAAuB,aAjnG9C,SAA0BvZ,GAIzB,IAFA,IAAI+B,KAEM3B,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,OAEJuB,EAAKO,GAAKnB,EAASZ,EAAMgC,aAAc,WACvCR,EAAKgH,KAAOd,EAAW1H,GACvB,MAED,IAAK,QACJwB,EAAKO,GAAKnB,EAASZ,EAAMgC,aAAc,WACvC/C,QAAQM,KAAM,mEAOjB6B,GAAQiW,YAAa5X,EAAIuC,aAAc,OAAWR,IAulGnDP,EAAc+X,GAAS,iBAAkB,QA11FzC,SAAqBvZ,GAEpB,IAAI+B,GACHwI,UAAWxK,EAAsBC,EAAK,aAAe,GAAImI,aAG1DxG,GAAQ8I,OAAQzK,EAAIuC,aAAc,OAAWR,IAq1F9CP,EAAc+X,GAAS,kBAAmB,SAvzF1C,SAAsBvZ,GAIrB,IAFA,IAAI+B,KAEM3B,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,iBACJuB,EAAKoK,QAAUzB,EAA0BnK,IAO5CoB,GAAQuK,QAASlM,EAAIuC,aAAc,OAAWR,IAoyF/CP,EAAc+X,GAAS,oBAAqB,WA37E5C,SAAwBvZ,GAMvB,IAJA,IAAI+B,GACH9B,KAAMD,EAAIuC,aAAc,SAGfnC,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,kBACJuB,EAAKzD,IAAM6C,EAASZ,EAAMgC,aAAc,SAO3CZ,GAAQqN,UAAWhP,EAAIuC,aAAc,OAAWR,IAs6EjDP,EAAc+X,GAAS,kBAAmB,SArrE1C,SAAsBvZ,GAMrB,IAJA,IAAI+B,GACH9B,KAAMD,EAAIuC,aAAc,SAGfnC,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,SACJuB,EAAKuN,OAASL,EAAmB1O,IAOpCoB,GAAQsO,QAASjQ,EAAIuC,aAAc,OAAWR,IAgqE/CP,EAAc+X,GAAS,iBAAkB,QAphEzC,SAAqBvZ,GAIpB,IAFA,IAAI+B,KAEM3B,EAAI,EAAGC,EAAIL,EAAIG,WAAWG,OAAQF,EAAIC,EAAGD,IAAO,CAEzD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,mBACJuB,EAAOmO,GAAqB3P,IAO/BoB,GAAQuP,OAAQlR,EAAIuC,aAAc,OAAWR,IAigE9CP,EAAc+X,GAAS,qBAAsB,WA94D7C,SAAwBvZ,GAEvB,IAAI+B,GACH9B,KAAMD,EAAIuC,aAAc,QACxBgB,WACAyO,YACAH,eAGGwJ,EAAOtb,EAAsBC,EAAK,QAAU,GAGhD,QAAc4B,IAATyZ,EAAL,CAEA,IAAM,IAAIjb,EAAI,EAAGA,EAAIib,EAAKlb,WAAWG,OAAQF,IAAO,CAEnD,IAAIG,EAAQ8a,EAAKlb,WAAYC,GAE7B,GAAwB,IAAnBG,EAAM8B,SAAX,CAEA,IAAIC,EAAK/B,EAAMgC,aAAc,MAE7B,OAAShC,EAAMC,UAEd,IAAK,SACJuB,EAAKwB,QAASjB,GAAO8F,GAAa7H,GAClC,MAED,IAAK,WAEJwB,EAAKiQ,SAAWZ,GAAuB7Q,GACvC,MAED,IAAK,WACJf,QAAQM,KAAM,oDAAqDS,EAAMC,UACzE,MAED,IAAK,QACL,IAAK,aACL,IAAK,WACL,IAAK,YACJuB,EAAK8P,WAAWpR,KAAM4Q,GAAwB9Q,IAC9C,MAED,QACCf,QAAQ2W,IAAK5V,KAMhBoB,GAAQmH,WAAY9I,EAAIuC,aAAc,OAAWR,KA41DlDP,EAAc+X,GAAS,gBAAiB,OAAQ9D,IAChDjU,EAAc+X,GAAS,wBAAyB,eAzNhD,SAA2BvZ,GAE1B,IAAI+B,GACH9B,KAAMD,EAAIuC,aAAc,QACxBwU,cA/jBF,SAAuB/W,GAMtB,IAJA,IAAI6B,EAAW7B,EAAID,qBAAsB,QAI/BK,EAAI,EAAGA,EAAIyB,EAASvB,OAAQF,IAAO,CAE5C,IAAIkb,EAAUzZ,EAAUzB,IAEc,IAAjCkb,EAAQlB,aAAc,OAE1BkB,EAAQtI,aAAc,KA78FjB,iBAAqBzB,OAmgH5BgK,CAAcvb,GAId,IAFA,IAAI6B,EAAW9B,EAAsBC,EAAK,QAEhCI,EAAI,EAAGA,EAAIyB,EAASvB,OAAQF,IAErC2B,EAAKgV,SAAStW,KAAMgV,GAAW5T,EAAUzB,KAI1CuB,GAAQmV,aAAc9W,EAAIuC,aAAc,OAAWR,IAyMpDP,EAAc+X,GAAS,4BAA6B,mBAv4CpD,SAA+BvZ,GAQ9B,IANA,IAAI+B,GACH9B,KAAMD,EAAIuC,aAAc,SAAY,GACpC8F,UACAuL,UAGSxT,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,mBACJkT,GAAgCnT,EAAOwB,IAO1CJ,GAAQoZ,iBAAkB/a,EAAIuC,aAAc,OAAWR,IAg3CxDP,EAAc+X,GAAS,yBAA0B,gBA9oCjD,SAA4BvZ,GAO3B,IALA,IAAI+B,GACH9B,KAAMD,EAAIuC,aAAc,SAAY,GACpCiZ,gBAGSpb,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,aACJuB,EAAKyZ,YAAajb,EAAMgC,aAAc,YACtCuS,GAAuBvU,EAAOwB,EAAKyZ,YAAajb,EAAMgC,aAAc,WAOvEZ,GAAQqZ,cAAehb,EAAIuC,aAAc,OAAWR,IAunCrDP,EAAc+X,GAAS,QAAS,4BArkChC,SAA+BvZ,GAM9B,IAJA,IAAI+B,GACH0Z,kBAGSrb,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,kBACJuB,EAAK0Z,cAAchb,KAAMyU,GAA8B3U,KAO1DoB,GAAQsZ,iBAAkB9Z,EAASnB,EAAIuC,aAAc,SAAcR,IAijCpED,EAAcH,GAAQuC,WAAYf,GAClCrB,EAAcH,GAAQqG,MAAOP,GAC7B3F,EAAcH,GAAQiW,YAAahP,GACnC9G,EAAcH,GAAQ8I,OAAQH,GAC9BxI,EAAcH,GAAQuK,QAASJ,GAC/BhK,EAAcH,GAAQqN,UAAWjD,GACjCjK,EAAcH,GAAQsO,QAASb,GAC/BtN,EAAcH,GAAQuP,OAAQR,IAC9B5O,EAAcH,GAAQmH,WAAYiJ,IAClCjQ,EAAcH,GAAQmV,aAAckC,IA1KpC,WAEC,IAAIhR,EAAQrG,GAAQqG,MAEpB,IAA0B,IAArB3G,EAAS2G,IAEb,IAAuC,IAAlC3G,EAASM,GAAQuC,YAAyB,CAI9C,IAAId,KAEJ,IAAM,IAAId,KAAMX,GAAQuC,WAIvB,IAFA,IAAI2D,EAAkB5D,EAAc3B,GAE1BlC,EAAI,EAAGC,EAAIwH,EAAgBvH,OAAQF,EAAIC,EAAGD,IAEnDgD,EAAO3C,KAAMoH,EAAiBzH,IAMhC8D,GAAWzD,KAAM,IAAIqH,IAAe,WAAa,EAAG1E,UAMrD,IAAM,IAAId,KAAM0F,EAEf9D,GAAWzD,KAAMsH,EAAkBzF,IA4ItCoZ,GA7gCA,WAEC,IAAIC,EAAoB1d,OAAOsD,KAAMI,GAAQoZ,kBAAoB,GAC7Da,EAAoB3d,OAAOsD,KAAMI,GAAQsZ,kBAAoB,GAC7DY,EAAgB5d,OAAOsD,KAAMI,GAAQmV,cAAgB,GAEzD,QAA2BlV,IAAtB+Z,QAAyD/Z,IAAtBga,EAAxC,CASA,IAPA,IA7W4BtZ,EA6WxBwZ,GA7WwBxZ,EA6WcqZ,EA3WnCzZ,EAAUP,GAAQoZ,iBAAkBzY,GAAMmR,KA4W7CsI,EAfL,SAA6BzZ,GAE5B,OAAOJ,EAAUP,GAAQsZ,iBAAkB3Y,GAAMiT,IAa3ByG,CAAoBJ,GACtCK,EAAc/C,GAAgB2C,GAE9BJ,EAAgBM,EAAgBN,cAChCS,KAEM9b,EAAI,EAAGC,EAAIob,EAAcnb,OAAQF,EAAIC,EAAGD,IAAO,CAExD,IAAI2T,EAAO0H,EAAerb,GAItB+b,EAAgB5C,GAAQ6C,cAAe,SAAWrI,EAAKvQ,OAAS,MAEpE,GAAK2Y,EAAgB,CAIpB,IAAIE,EAAsBF,EAAcG,cAIxCC,EAASxI,EAAKsB,WAAYgH,IA4B5B,IAAIG,EAAK,IAAIxS,MAEb8Q,IAECzS,OAAQyT,GAAmBA,EAAgBzT,OAE3CoU,cAAe,SAAWpH,GAEzB,IAAIqH,EAAYR,EAAU7G,GAE1B,GAAKqH,EAEJ,OAAOA,EAAU9W,SAIjBpG,QAAQM,KAAM,8BAAgCuV,EAAa,oBAM7DsH,cAAe,SAAWtH,EAAYxV,GAErC,IAAI6c,EAAYR,EAAU7G,GAE1B,GAAKqH,EAAY,CAEhB,IAAIlI,EAAQkI,EAAUlI,MAEtB,GAAK3U,EAAQ2U,EAAMR,OAAOtC,KAAO7R,EAAQ2U,EAAMR,OAAOC,IAErDzU,QAAQM,KAAM,8BAAgCuV,EAAa,UAAYxV,EAAQ,4BAA8B2U,EAAMR,OAAOC,IAAM,UAAYO,EAAMR,OAAOtC,IAAM,WAEzJ,GAAK8C,EAAMN,OAEjB1U,QAAQM,KAAM,8BAAgCuV,EAAa,mBAErD,CAEN,IAAI/T,EAASob,EAAUpb,OACnByS,EAAOS,EAAMT,KACbhP,EAAa2X,EAAU3X,WAE3BE,GAAOgF,WAIP,IAAM,IAAI7J,EAAI,EAAGA,EAAI2E,EAAWzE,OAAQF,IAAO,CAE9C,IAAI0E,EAAYC,EAAY3E,GAI5B,GAAK0E,EAAUnC,MAAiD,IAA1CmC,EAAUnC,IAAIE,QAASwS,GAE5C,OAASb,EAAMpJ,MAEd,IAAK,WACJnG,GAAO+Q,SAAUwG,EAAGtG,iBAAkBnC,EAAMa,MAAUC,SAAUhV,KAChE,MAED,IAAK,YACJoF,GAAO+Q,SAAUwG,EAAGvG,gBAAiBlC,EAAKtN,EAAI5G,EAAOkU,EAAKrN,EAAI7G,EAAOkU,EAAKpN,EAAI9G,IAC9E,MAED,QACCL,QAAQM,KAAM,4CAA8C0U,EAAMpJ,WAOpE,OAAStG,EAAUsG,MAElB,IAAK,SACJnG,GAAO+Q,SAAUlR,EAAU4P,KAC3B,MAED,IAAK,YACJzP,GAAO+Q,SAAUwG,EAAGvG,gBAAiBnR,EAAU4P,IAAIjO,EAAG3B,EAAU4P,IAAIhO,EAAG5B,EAAU4P,IAAI/N,IACrF,MAED,IAAK,QACJ1B,GAAOa,MAAOhB,EAAU4P,KACxB,MAED,IAAK,SACJzP,GAAO+Q,SAAUwG,EAAGtG,iBAAkBpR,EAAU4P,IAAK5P,EAAU6P,SASnErT,EAAO2D,OAAO+L,KAAM/L,IACpB3D,EAAO2D,OAAOuB,UAAWlF,EAAOsE,SAAUtE,EAAOyE,WAAYzE,EAAOwE,OAEpEoW,EAAU7G,GAAazP,SAAW/F,QAMnCL,QAAQ2W,IAAK,wBAA0Bd,EAAa,sBAjIvD,SAASkH,EAASlH,EAAYuH,GAE7B,IAAIC,EAAoBD,EAAcra,aAAc,QAChDiS,EAAQsH,EAAgBzT,OAAQgN,GAEpC4G,EAAY3E,SAAU,SAAWhW,GAE3BA,EAAOrB,OAAS4c,IAEpBX,EAAU7G,IACT/T,OAAQA,EACRyD,WAgIL,SAA6BL,GAM5B,IAJA,IAAIK,KAEA/E,EAAMuZ,GAAQ6C,cAAe,QAAU1X,EAAKpC,GAAK,MAE3ClC,EAAI,EAAGA,EAAIJ,EAAIG,WAAWG,OAAQF,IAAO,CAElD,IAAIG,EAAQP,EAAIG,WAAYC,GAE5B,GAAwB,IAAnBG,EAAM8B,SAEX,OAAS9B,EAAMC,UAEd,IAAK,SACJ,IAAIN,EAAQa,EAAaR,EAAM4H,aAC3BlD,GAAS,IAAI+E,OAAUzD,UAAWrG,GAAQiF,YAC9CJ,EAAWtE,MACVkC,IAAKpC,EAAMgC,aAAc,OACzB6I,KAAM7K,EAAMC,SACZkU,IAAKzP,IAEN,MAED,IAAK,YACL,IAAK,QACJ,IAAI/E,EAAQa,EAAaR,EAAM4H,aAC3BqN,GAAS,IAAI3P,OAAUU,UAAWrG,GACtC6E,EAAWtE,MACVkC,IAAKpC,EAAMgC,aAAc,OACzB6I,KAAM7K,EAAMC,SACZkU,IAAKc,IAEN,MAED,IAAK,SACJ,IAAItV,EAAQa,EAAaR,EAAM4H,aAC3BqN,GAAS,IAAI3P,OAAUU,UAAWrG,GAClCyU,EAAQC,MAAUC,SAAU3U,EAAO,IACvC6E,EAAWtE,MACVkC,IAAKpC,EAAMgC,aAAc,OACzB6I,KAAM7K,EAAMC,SACZkU,IAAKc,EACLb,MAAOA,KAQX,OAAO5P,EAnLS+X,CAAoBF,GAChCpI,MAAOA,EACP5O,SAAU4O,EAAML,kBA49BrB4I,GAEA,IAAI5D,GAtLJ,SAAqBnZ,GAGpB,OAAOkZ,GAAgB/X,EADRpB,EAAsBC,EAAK,yBAA2B,GAC5BuC,aAAc,SAmL5Cya,CAAYjd,EAAsBwZ,GAAS,SAAW,IAUlE,MARsB,SAAjBW,GAAMI,QAEVnB,GAAMpT,WAAWkX,aAAc,IAAIC,KAAS1M,KAAK2M,GAAK,EAAG,EAAG,IAI7DhE,GAAMrT,MAAMsX,eAAgBlD,GAAMC,OAGjCjW,WAAYA,GACZ4W,WAAYA,GACZnZ,QAASA,GACTwX,MAAOA,2SCz6HNkE,EAAO,WAAWtf,KAAKuf,WAAWvf,KAAKwf,6BAA6BF,EAAOrf,WAAWwf,OAAO,WAAW,OAAOvf,OAAOsD,KAAKxD,KAAKuf,SAAStP,IAAI,SAASyP,GAAG,OAAO1f,KAAKuf,QAAQG,IAAIzF,KAAKja,QAAQ2f,UAAU,WAAW3f,KAAKuf,YAAYjF,IAAI,SAASoF,GAAG1f,KAAKuf,QAAQG,EAAEE,SAASF,EAAE1f,KAAKwf,yBAAyBE,EAAEE,SAASF,GAAGG,OAAO,SAASH,UAAU1f,KAAKuf,QAAQG,EAAEE,gBAAgB5f,KAAKwf,yBAAyBE,EAAEE,UAAUE,OAAO,SAASJ,EAAEK,GAAG,IAAIve,EAAEtB,OAAOsD,KAAKxD,KAAKuf,SAAS,GAAG,IAAI/d,EAAEe,OAAO,OAAM,EAAG,IAAImd,OAAE,IAASA,EAAEA,EAAEM,EAAMC,MAAM,EAAEze,EAAEe,QAAQ,CAACvC,KAAKwf,4BAA4B,IAAI,IAAInd,EAAE,EAAEA,EAAEb,EAAEe,OAAOF,IAAI,CAAC,IAAI6d,EAAElgB,KAAKuf,QAAQ/d,EAAEa,IAAI6d,IAAG,IAAKA,EAAEJ,OAAOJ,KAAKQ,EAAEC,YAAW,EAAGJ,UAAU/f,KAAKuf,QAAQ/d,EAAEa,KAAKb,EAAEtB,OAAOsD,KAAKxD,KAAKwf,0BAA0B,OAAM,IAAK,IAA0tOE,EAA9Nrd,EAAx/N2d,EAAM,IAAIV,EAAOU,EAAM3F,MAAMiF,EAAOU,EAAMI,QAAQ,EAAEJ,EAAMK,OAAO,WAAW,OAAOL,EAAMI,WAAW,oBAAoBE,WAAM,IAAoBC,GAASA,EAAQC,OAAOR,EAAMC,IAAI,WAAW,IAAIP,EAAEa,EAAQC,SAAS,OAAO,IAAId,EAAE,GAAGA,EAAE,GAAG,KAAK,oBAAoBY,WAAM,IAASA,KAAKG,kBAAa,IAASH,KAAKG,YAAYR,IAAID,EAAMC,IAAIK,KAAKG,YAAYR,IAAIhG,KAAKqG,KAAKG,kBAAa,IAASC,KAAKT,IAAID,EAAMC,IAAIS,KAAKT,IAAID,EAAMC,IAAI,WAAW,OAAO,IAAIS,MAAMC,WAAWX,EAAMY,MAAM,SAASlB,EAAEK,GAAG/f,KAAK6gB,QAAQnB,EAAE1f,KAAK8gB,gBAAgB9gB,KAAK+gB,cAAc/gB,KAAKghB,sBAAsBhhB,KAAKihB,UAAU,IAAIjhB,KAAKkhB,QAAQ,EAAElhB,KAAKmhB,sBAAiB,EAAOnhB,KAAKohB,OAAM,EAAGphB,KAAKmgB,YAAW,EAAGngB,KAAKqhB,WAAU,EAAGrhB,KAAKshB,WAAW,EAAEthB,KAAKuhB,WAAW,KAAKvhB,KAAKwhB,gBAAgBxB,EAAMyB,OAAOC,OAAOC,KAAK3hB,KAAK4hB,uBAAuB5B,EAAM6B,cAAcH,OAAO1hB,KAAK8hB,kBAAkB9hB,KAAK+hB,iBAAiB,KAAK/hB,KAAKgiB,uBAAsB,EAAGhiB,KAAKiiB,kBAAkB,KAAKjiB,KAAKkiB,oBAAoB,KAAKliB,KAAKmiB,gBAAgB,KAAKniB,KAAKoiB,OAAOrC,GAAGC,EAAMhgB,KAAKqiB,IAAIrC,EAAMK,UAAUL,EAAMY,MAAM3gB,WAAW2f,MAAM,WAAW,OAAO5f,KAAKqiB,KAAKC,UAAU,WAAW,OAAOtiB,KAAKmgB,YAAYoC,GAAG,SAAS7C,EAAEK,GAAG,OAAO/f,KAAK+gB,WAAW7gB,OAAOE,OAAOsf,QAAG,IAASK,IAAI/f,KAAKihB,UAAUlB,GAAG/f,MAAM2J,SAAS,SAAS+V,GAAG,OAAO1f,KAAKihB,UAAUvB,EAAE1f,MAAM6J,MAAM,SAAS6V,GAAG,IAAI,IAAIK,KAAK/f,KAAKoiB,OAAO9H,IAAIta,MAAMA,KAAKmgB,YAAW,EAAGngB,KAAKgiB,uBAAsB,EAAGhiB,KAAKuhB,gBAAW,IAAS7B,EAAE,iBAAiBA,EAAEM,EAAMC,MAAMhd,WAAWyc,GAAGA,EAAEM,EAAMC,MAAMjgB,KAAKuhB,YAAYvhB,KAAKshB,WAAWthB,KAAK+gB,WAAW,CAAC,GAAG/gB,KAAK+gB,WAAWhB,aAAahd,MAAM,CAAC,GAAG,IAAI/C,KAAK+gB,WAAWhB,GAAGxd,OAAO,SAASvC,KAAK+gB,WAAWhB,IAAI/f,KAAK6gB,QAAQd,IAAIyC,OAAOxiB,KAAK+gB,WAAWhB,SAAI,IAAS/f,KAAK6gB,QAAQd,KAAK/f,KAAK8gB,aAAaf,GAAG/f,KAAK6gB,QAAQd,GAAG/f,KAAK8gB,aAAaf,aAAahd,OAAO,IAAK/C,KAAK8gB,aAAaf,IAAI,GAAG/f,KAAKghB,mBAAmBjB,GAAG/f,KAAK8gB,aAAaf,IAAI,GAAG,OAAO/f,MAAMyiB,KAAK,WAAW,OAAOziB,KAAKmgB,aAAangB,KAAKoiB,OAAOvC,OAAO7f,MAAMA,KAAKmgB,YAAW,EAAG,OAAOngB,KAAKmiB,iBAAiBniB,KAAKmiB,gBAAgBniB,KAAK6gB,SAAS7gB,KAAK0iB,qBAAqB1iB,MAAM4J,IAAI,WAAW,OAAO5J,KAAK8f,OAAO,KAAK9f,MAAM0iB,kBAAkB,WAAW,IAAI,IAAIhD,EAAE,EAAEK,EAAE/f,KAAK8hB,eAAevf,OAAOmd,EAAEK,EAAEL,IAAI1f,KAAK8hB,eAAepC,GAAG+C,QAAQvH,MAAM,SAASwE,GAAG,OAAO1f,KAAKoiB,OAAO1C,EAAE1f,MAAM2iB,MAAM,SAASjD,GAAG,OAAO1f,KAAKshB,WAAW5B,EAAE1f,MAAM4P,OAAO,SAAS8P,GAAG,OAAO1f,KAAKkhB,QAAQxB,EAAE1f,MAAM4iB,YAAY,SAASlD,GAAG,OAAO1f,KAAKmhB,iBAAiBzB,EAAE1f,MAAM6iB,KAAK,SAASnD,GAAG,OAAO1f,KAAKohB,MAAM1B,EAAE1f,MAAM8iB,OAAO,SAASpD,GAAG,OAAO1f,KAAKwhB,gBAAgB9B,EAAE1f,MAAM+iB,cAAc,SAASrD,GAAG,OAAO1f,KAAK4hB,uBAAuBlC,EAAE1f,MAAMgjB,MAAM,WAAW,OAAOhjB,KAAK8hB,eAAemB,UAAUjjB,MAAMkjB,QAAQ,SAASxD,GAAG,OAAO1f,KAAK+hB,iBAAiBrC,EAAE1f,MAAMmjB,SAAS,SAASzD,GAAG,OAAO1f,KAAKiiB,kBAAkBvC,EAAE1f,MAAMojB,WAAW,SAAS1D,GAAG,OAAO1f,KAAKkiB,oBAAoBxC,EAAE1f,MAAMqjB,OAAO,SAAS3D,GAAG,OAAO1f,KAAKmiB,gBAAgBzC,EAAE1f,MAAM8f,OAAO,SAASJ,GAAG,IAAIK,EAAEve,EAAEa,EAAE,GAAGqd,EAAE1f,KAAKuhB,WAAW,OAAM,EAAG,IAAIxB,KAAI,IAAK/f,KAAKgiB,wBAAwB,OAAOhiB,KAAK+hB,kBAAkB/hB,KAAK+hB,iBAAiB/hB,KAAK6gB,SAAS7gB,KAAKgiB,uBAAsB,GAAIxgB,GAAGke,EAAE1f,KAAKuhB,YAAYvhB,KAAKihB,UAAUzf,EAAE,IAAIxB,KAAKihB,WAAW,EAAEzf,EAAE,EAAEA,EAAEa,EAAErC,KAAKwhB,gBAAgBhgB,GAAGxB,KAAK+gB,WAAW,QAAG,IAAS/gB,KAAK8gB,aAAaf,GAAG,CAAC,IAAIG,EAAElgB,KAAK8gB,aAAaf,IAAI,EAAEvY,EAAExH,KAAK+gB,WAAWhB,GAAGvY,aAAazE,MAAM/C,KAAK6gB,QAAQd,GAAG/f,KAAK4hB,uBAAuBpa,EAAEnF,IAAI,iBAAiBmF,IAAIA,EAAE,MAAMA,EAAE8b,OAAO,IAAI,MAAM9b,EAAE8b,OAAO,GAAGpD,EAAEjd,WAAWuE,GAAGvE,WAAWuE,IAAI,iBAAiBA,IAAIxH,KAAK6gB,QAAQd,GAAGG,GAAG1Y,EAAE0Y,GAAG7d,IAAI,GAAG,OAAOrC,KAAKiiB,mBAAmBjiB,KAAKiiB,kBAAkBjiB,KAAK6gB,SAAS,IAAIrf,EAAE,OAAM,EAAG,GAAG,EAAExB,KAAKkhB,QAAQ,CAAC,IAAInB,KAAKwD,SAASvjB,KAAKkhB,UAAUlhB,KAAKkhB,UAAUlhB,KAAKghB,mBAAmB,CAAC,GAAG,iBAAiBhhB,KAAK+gB,WAAWhB,KAAK/f,KAAKghB,mBAAmBjB,GAAG/f,KAAKghB,mBAAmBjB,GAAG9c,WAAWjD,KAAK+gB,WAAWhB,KAAK/f,KAAKohB,MAAM,CAAC,IAAIoC,EAAExjB,KAAKghB,mBAAmBjB,GAAG/f,KAAKghB,mBAAmBjB,GAAG/f,KAAK+gB,WAAWhB,GAAG/f,KAAK+gB,WAAWhB,GAAGyD,EAAExjB,KAAK8gB,aAAaf,GAAG/f,KAAKghB,mBAAmBjB,GAAG,OAAO/f,KAAKohB,QAAQphB,KAAKqhB,WAAWrhB,KAAKqhB,gBAAW,IAASrhB,KAAKmhB,iBAAiBnhB,KAAKuhB,WAAW7B,EAAE1f,KAAKmhB,iBAAiBnhB,KAAKuhB,WAAW7B,EAAE1f,KAAKshB,YAAW,EAAG,OAAOthB,KAAKkiB,qBAAqBliB,KAAKkiB,oBAAoBliB,KAAK6gB,SAAS,IAAI,IAAI4C,EAAE,EAAEC,EAAE1jB,KAAK8hB,eAAevf,OAAOkhB,EAAEC,EAAED,IAAIzjB,KAAK8hB,eAAe2B,GAAG5Z,MAAM7J,KAAKuhB,WAAWvhB,KAAKihB,WAAW,OAAM,IAAKjB,EAAMyB,QAAQC,QAAQC,KAAK,SAASjC,GAAG,OAAOA,IAAIiE,WAAWC,GAAG,SAASlE,GAAG,OAAOA,EAAEA,GAAGmE,IAAI,SAASnE,GAAG,OAAOA,GAAG,EAAEA,IAAIoE,MAAM,SAASpE,GAAG,OAAOA,GAAG,GAAG,EAAE,GAAGA,EAAEA,GAAG,MAAMA,GAAGA,EAAE,GAAG,KAAKqE,OAAOH,GAAG,SAASlE,GAAG,OAAOA,EAAEA,EAAEA,GAAGmE,IAAI,SAASnE,GAAG,QAAQA,EAAEA,EAAEA,EAAE,GAAGoE,MAAM,SAASpE,GAAG,OAAOA,GAAG,GAAG,EAAE,GAAGA,EAAEA,EAAEA,EAAE,KAAKA,GAAG,GAAGA,EAAEA,EAAE,KAAKsE,SAASJ,GAAG,SAASlE,GAAG,OAAOA,EAAEA,EAAEA,EAAEA,GAAGmE,IAAI,SAASnE,GAAG,OAAO,KAAKA,EAAEA,EAAEA,EAAEA,GAAGoE,MAAM,SAASpE,GAAG,OAAOA,GAAG,GAAG,EAAE,GAAGA,EAAEA,EAAEA,EAAEA,GAAG,KAAKA,GAAG,GAAGA,EAAEA,EAAEA,EAAE,KAAKuE,SAASL,GAAG,SAASlE,GAAG,OAAOA,EAAEA,EAAEA,EAAEA,EAAEA,GAAGmE,IAAI,SAASnE,GAAG,QAAQA,EAAEA,EAAEA,EAAEA,EAAEA,EAAE,GAAGoE,MAAM,SAASpE,GAAG,OAAOA,GAAG,GAAG,EAAE,GAAGA,EAAEA,EAAEA,EAAEA,EAAEA,EAAE,KAAKA,GAAG,GAAGA,EAAEA,EAAEA,EAAEA,EAAE,KAAKwE,YAAYN,GAAG,SAASlE,GAAG,OAAO,EAAEjN,KAAK0R,IAAIzE,EAAEjN,KAAK2M,GAAG,IAAIyE,IAAI,SAASnE,GAAG,OAAOjN,KAAK2R,IAAI1E,EAAEjN,KAAK2M,GAAG,IAAI0E,MAAM,SAASpE,GAAG,MAAM,IAAI,EAAEjN,KAAK0R,IAAI1R,KAAK2M,GAAGM,MAAM2E,aAAaT,GAAG,SAASlE,GAAG,OAAO,IAAIA,EAAE,EAAEjN,KAAK6R,IAAI,KAAK5E,EAAE,IAAImE,IAAI,SAASnE,GAAG,OAAO,IAAIA,EAAE,EAAE,EAAEjN,KAAK6R,IAAI,GAAG,GAAG5E,IAAIoE,MAAM,SAASpE,GAAG,OAAO,IAAIA,EAAE,EAAE,IAAIA,EAAE,GAAGA,GAAG,GAAG,EAAE,GAAGjN,KAAK6R,IAAI,KAAK5E,EAAE,GAAG,IAAI,EAAEjN,KAAK6R,IAAI,GAAG,IAAI5E,EAAE,OAAO6E,UAAUX,GAAG,SAASlE,GAAG,OAAO,EAAEjN,KAAKC,KAAK,EAAEgN,EAAEA,IAAImE,IAAI,SAASnE,GAAG,OAAOjN,KAAKC,KAAK,KAAKgN,EAAEA,IAAIoE,MAAM,SAASpE,GAAG,OAAOA,GAAG,GAAG,GAAG,IAAIjN,KAAKC,KAAK,EAAEgN,EAAEA,GAAG,GAAG,IAAIjN,KAAKC,KAAK,GAAGgN,GAAG,GAAGA,GAAG,KAAK8E,SAASZ,GAAG,SAASlE,GAAG,OAAO,IAAIA,EAAE,EAAE,IAAIA,EAAE,GAAGjN,KAAK6R,IAAI,EAAE,IAAI5E,EAAE,IAAIjN,KAAK2R,IAAI,GAAG1E,EAAE,KAAKjN,KAAK2M,KAAKyE,IAAI,SAASnE,GAAG,OAAO,IAAIA,EAAE,EAAE,IAAIA,EAAE,EAAEjN,KAAK6R,IAAI,GAAG,GAAG5E,GAAGjN,KAAK2R,IAAI,GAAG1E,EAAE,IAAIjN,KAAK2M,IAAI,GAAG0E,MAAM,SAASpE,GAAG,OAAO,IAAIA,EAAE,EAAE,IAAIA,EAAE,GAAGA,GAAG,GAAG,GAAG,GAAGjN,KAAK6R,IAAI,EAAE,IAAI5E,EAAE,IAAIjN,KAAK2R,IAAI,GAAG1E,EAAE,KAAKjN,KAAK2M,IAAI,GAAG3M,KAAK6R,IAAI,GAAG,IAAI5E,EAAE,IAAIjN,KAAK2R,IAAI,GAAG1E,EAAE,KAAKjN,KAAK2M,IAAI,IAAIqF,MAAMb,GAAG,SAASlE,GAAG,OAAOA,EAAEA,GAAG,QAAQA,EAAE,UAAUmE,IAAI,SAASnE,GAAG,QAAQA,EAAEA,GAAG,QAAQA,EAAE,SAAS,GAAGoE,MAAM,SAASpE,GAAG,IAAIK,EAAE,UAAU,OAAOL,GAAG,GAAG,EAAEA,EAAEA,IAAI,EAAEK,GAAGL,EAAEK,GAAG,GAAG,KAAKL,GAAG,GAAGA,IAAI,EAAEK,GAAGL,EAAEK,GAAG,KAAK2E,QAAQd,GAAG,SAASlE,GAAG,OAAO,EAAEM,EAAMyB,OAAOiD,OAAOb,IAAI,EAAEnE,IAAImE,IAAI,SAASnE,GAAG,OAAOA,EAAE,EAAE,KAAK,OAAOA,EAAEA,EAAEA,EAAE,EAAE,KAAK,QAAQA,GAAG,IAAI,MAAMA,EAAE,IAAIA,EAAE,IAAI,KAAK,QAAQA,GAAG,KAAK,MAAMA,EAAE,MAAM,QAAQA,GAAG,MAAM,MAAMA,EAAE,SAASoE,MAAM,SAASpE,GAAG,OAAOA,EAAE,GAAG,GAAGM,EAAMyB,OAAOiD,OAAOd,GAAG,EAAElE,GAAG,GAAGM,EAAMyB,OAAOiD,OAAOb,IAAI,EAAEnE,EAAE,GAAG,MAAMM,EAAM6B,eAAeH,OAAO,SAAShC,EAAEK,GAAG,IAAIve,EAAEke,EAAEnd,OAAO,EAAEF,EAAEb,EAAEue,EAAEG,EAAEzN,KAAKkS,MAAMtiB,GAAGmF,EAAEwY,EAAM6B,cAAc+C,MAAMlD,OAAO,OAAO3B,EAAE,EAAEvY,EAAEkY,EAAE,GAAGA,EAAE,GAAGrd,GAAG,EAAE0d,EAAEvY,EAAEkY,EAAEle,GAAGke,EAAEle,EAAE,GAAGA,EAAEa,GAAGmF,EAAEkY,EAAEQ,GAAGR,EAAEle,EAAE0e,EAAE,EAAE1e,EAAE0e,EAAE,GAAG7d,EAAE6d,IAAI2E,OAAO,SAASnF,EAAEK,GAAG,IAAI,IAAIve,EAAE,EAAEa,EAAEqd,EAAEnd,OAAO,EAAE2d,EAAEzN,KAAK6R,IAAI9c,EAAEwY,EAAM6B,cAAc+C,MAAME,UAAUtB,EAAE,EAAEA,GAAGnhB,EAAEmhB,IAAIhiB,GAAG0e,EAAE,EAAEH,EAAE1d,EAAEmhB,GAAGtD,EAAEH,EAAEyD,GAAG9D,EAAE8D,GAAGhc,EAAEnF,EAAEmhB,GAAG,OAAOhiB,GAAGujB,WAAW,SAASrF,EAAEK,GAAG,IAAIve,EAAEke,EAAEnd,OAAO,EAAEF,EAAEb,EAAEue,EAAEG,EAAEzN,KAAKkS,MAAMtiB,GAAGmF,EAAEwY,EAAM6B,cAAc+C,MAAMG,WAAW,OAAOrF,EAAE,KAAKA,EAAEle,IAAIue,EAAE,IAAIG,EAAEzN,KAAKkS,MAAMtiB,EAAEb,GAAG,EAAEue,KAAKvY,EAAEkY,GAAGQ,EAAE,EAAE1e,GAAGA,GAAGke,EAAEQ,GAAGR,GAAGQ,EAAE,GAAG1e,GAAGke,GAAGQ,EAAE,GAAG1e,GAAGa,EAAE6d,IAAIH,EAAE,EAAEL,EAAE,IAAIlY,EAAEkY,EAAE,GAAGA,EAAE,GAAGA,EAAE,GAAGA,EAAE,IAAIrd,GAAGqd,EAAE,IAAI,EAAEK,EAAEL,EAAEle,IAAIgG,EAAEkY,EAAEle,GAAGke,EAAEle,GAAGke,EAAEle,EAAE,GAAGke,EAAEle,EAAE,GAAGa,EAAEb,GAAGke,EAAEle,IAAIgG,EAAEkY,EAAEQ,EAAEA,EAAE,EAAE,GAAGR,EAAEQ,GAAGR,EAAEle,EAAE0e,EAAE,EAAE1e,EAAE0e,EAAE,GAAGR,EAAEle,EAAE0e,EAAE,EAAE1e,EAAE0e,EAAE,GAAG7d,EAAE6d,IAAI0E,OAAOlD,OAAO,SAAShC,EAAEK,EAAEve,GAAG,OAAOue,EAAEL,GAAGle,EAAEke,GAAGoF,UAAU,SAASpF,EAAEK,GAAG,IAAIve,EAAEwe,EAAM6B,cAAc+C,MAAMI,UAAU,OAAOxjB,EAAEke,GAAGle,EAAEue,GAAGve,EAAEke,EAAEK,IAAIiF,WAAyB3iB,GAAG,GAAU,SAASqd,GAAG,IAAIK,EAAE,EAAE,GAAG1d,EAAEqd,GAAG,OAAOrd,EAAEqd,GAAG,IAAI,IAAIle,EAAEke,EAAE,EAAEle,EAAEA,IAAIue,GAAGve,EAAE,OAAOa,EAAEqd,GAAGK,IAAMgF,WAAW,SAASrF,EAAEK,EAAEve,EAAEa,EAAE6d,GAAG,IAAI1Y,EAAE,IAAIhG,EAAEke,GAAG8D,EAAE,IAAInhB,EAAE0d,GAAG0D,EAAEvD,EAAEA,EAAE,OAAO,EAAEH,EAAE,EAAEve,EAAEgG,EAAEgc,IAAItD,EAAEuD,KAAK,EAAE1D,EAAE,EAAEve,EAAE,EAAEgG,EAAEgc,GAAGC,EAAEjc,EAAE0Y,EAAEH,KAAcL,EAAoL1f,KAAjL,mBAAmBilB,QAAQA,UAAWA,UAAU,WAAW,OAAOjF,SAAQ,IAAoBkF,GAAQ,+BAAiBC,QAAjB,YAAAC,EAAiBD,UAAQD,EAAOC,QAAQnF,OAAM,IAASN,IAAIA,EAAEM,MAAMA,yKCWnnQqF,GACArhB,KADA,WAEA,OACAshB,UAAA,KACAC,MAAA,KACAjU,OAAA,KACA8J,MAAA,KACAoK,SAAA,KACAC,cAAA,KACAC,IAAA,KACA3I,WAAA,KACA4I,gBAAA,KACAC,mBACA7kB,OAAA,OAGA8kB,QAhBA,WAgBA,IAAAC,EAAA9lB,KACAA,KAAAe,OAAA,IAAArB,EAAA,EAEAM,KAAAe,OAAAT,KAAA,qDAAAkb,GACAsK,EAAAJ,IAAAlK,EAAAJ,MACA0K,EAAAJ,IAAAnM,SAAA,SAAA/W,GACAA,EAAAujB,SAEAvjB,EAAAyL,SAAA+X,aAAA,KAGAF,EAAAJ,IAAA3d,MAAAW,EAAAod,EAAAJ,IAAA3d,MAAAY,EAAAmd,EAAAJ,IAAA3d,MAAAa,EAAA,GACAkd,EAAAJ,IAAAO,eACAH,EAAA/I,WAAAvB,EAAAuB,WACA+I,EAAAI,OACAJ,EAAAK,aAGAC,SACAF,KADA,WAEAlmB,KAAAslB,UAAAe,SAAAC,cAAA,OACAD,SAAAE,uBAAA,4CAAAC,YAAAxmB,KAAAslB,WACAtlB,KAAAsR,OAAA,IAAAtR,KAAAymB,OAAAjV,kBAAA,GAAAxR,KAAA0mB,iBAAAC,OAAAC,YAAA,OACA5mB,KAAAsR,OAAAzJ,SAAA4H,IAAA,OACAzP,KAAAob,MAAA,IAAApb,KAAAymB,OAAApL,MAEA,IAAAwL,EAAA,IAAA7mB,KAAAymB,OAAAK,WAAA,uBACA9mB,KAAAob,MAAAd,IAAAuM,GAEA7mB,KAAAob,MAAAd,IAAAta,KAAA0lB,KACA1lB,KAAAylB,cAAA,IAAAzlB,KAAAymB,OAAAzL,KAAA,IAAAhb,KAAAymB,OAAAM,qBAAA,WAAA/mB,KAAAymB,OAAAlY,mBAAAyB,MAAA,YACAhQ,KAAAob,MAAAd,IAAAta,KAAAylB,eAEA,IAAA7S,EAAA,IAAA5S,KAAAymB,OAAAO,gBAAA,kBACAhnB,KAAAob,MAAAd,IAAA1H,GACA,IAAAqU,EAAA,IAAAjnB,KAAAymB,OAAA3T,WAAA,aACA9S,KAAAylB,cAAAnL,IAAA2M,GACAjnB,KAAAwlB,SAAA,IAAAxlB,KAAAymB,OAAAS,cACAlnB,KAAAwlB,SAAA2B,cAAAR,OAAAS,kBACApnB,KAAAwlB,SAAA6B,QAAArnB,KAAA0mB,iBAAAC,OAAAC,aACA5mB,KAAAslB,UAAAkB,YAAAxmB,KAAAwlB,SAAA8B,YACAtnB,KAAAulB,MAAA,IAAAvlB,KAAAunB,OACAvnB,KAAAulB,MAAAiC,IAAAC,MAAAC,KAAA,QACA1nB,KAAAslB,UAAAkB,YAAAxmB,KAAAulB,MAAAiC,KACAxnB,KAAA2nB,aAEAhB,OAAAiB,iBAAA,SAAA5nB,KAAA6nB,gBAAA,IAEAF,WA9BA,WA8BA,IAAAG,EAAA9nB,KACA2J,EAAA3J,KAAAymB,OAAA5P,UAAAkR,QAAA,SACAtiB,KACA,QAAAuiB,KAAAhoB,KAAA+c,WAAAzS,OACA,GAAAtK,KAAA+c,WAAAzS,OAAA5E,eAAAsiB,KACAhoB,KAAA+c,WAAAzS,OAAA0d,GAAA7R,OAAA,CACA,IAAAM,EAAAzW,KAAA+c,WAAAzS,OAAA0d,GACAC,EAAAjoB,KAAA4lB,gBAAAoC,GACAngB,EAAAogB,GAAAxR,EAAAL,aACApW,KAAA4lB,gBAAAoC,GAAAngB,EACApC,EAAAuiB,GAAAhoB,KAAAymB,OAAA5P,UAAAkR,QAAAtR,EAAAR,OAAAC,IAAAO,EAAAR,OAAAtC,KAIA3T,KAAA2lB,gBAAA,IAAAuC,EAAA,EAAAtH,MAAA5gB,KAAA4lB,iBAAArD,GAAA9c,EAAAkE,GAAAmZ,OAAAoF,EAAA,EAAAzG,OAAAkC,UAAAE,KACA7jB,KAAA2lB,gBAAAxC,SAAA,SAAA5f,GACA,QAAAykB,KAAAF,EAAA/K,WAAAzS,OACAwd,EAAA/K,WAAAzS,OAAA5E,eAAAsiB,KACAF,EAAA/K,WAAAzS,OAAA0d,GAAA7R,QACA2R,EAAA/K,WAAA6B,cAAAoJ,EAAAzkB,EAAAykB,OAKAhoB,KAAA2lB,gBAAA9b,QACAse,WAAAnoB,KAAA2nB,WAAAhe,IAEAke,eAzDA,WA0DA7nB,KAAAooB,gBAAApoB,KAAAsR,OAAAtR,KAAAwlB,WAEAW,QA5DA,WA6DAkC,sBAAAroB,KAAAmmB,SACAnmB,KAAAsoB,SACAtoB,KAAAulB,MAAAzF,SACYoI,EAAA,EAAZpI,UAEAwI,OAlEA,WAmEA,IAAAC,EAAA,KAAA7H,KAAAT,MACAjgB,KAAAsR,OAAAzJ,SAAAa,EAAA,GAAA+J,KAAA0R,IAAAoE,GACAvoB,KAAAsR,OAAAzJ,SAAAc,EAAA,GACA3I,KAAAsR,OAAAzJ,SAAAe,EAAA,GAAA6J,KAAA2R,IAAAmE,GACAvoB,KAAAsR,OAAAkX,OAAA,OACAxoB,KAAAylB,cAAA5d,SAAAa,EAAA,KAAA+J,KAAA2R,IAAA,EAAAmE,GACAvoB,KAAAylB,cAAA5d,SAAAc,EAAA,IAAA8J,KAAA0R,IAAA,EAAAoE,GACAvoB,KAAAylB,cAAA5d,SAAAe,EAAA,KAAA6J,KAAA0R,IAAA,EAAAoE,GACAvoB,KAAAwlB,SAAA8C,OAAAtoB,KAAAob,MAAApb,KAAAsR,WCtHemX,GADEH,OAFjB,WAA0BtoB,KAAa0oB,eAAb1oB,KAAuC2oB,MAAAC,GAAwB,OAA/D5oB,KAA+D6oB,GAAA,IAExEC,iBADjB,WAAoC,IAAaC,EAAb/oB,KAAa0oB,eAA0BE,EAAvC5oB,KAAuC2oB,MAAAC,IAAAG,EAAwB,OAAAH,EAAA,OAAiBI,YAAA,0CAAoDJ,EAAA,OAAYK,OAAO1kB,GAAA,UAAaqkB,EAAA,KAAUK,OAAOC,KAAA,sBAAAzjB,OAAA,SAAA0jB,IAAA,cAArLnpB,KAAsPopB,GAAA,cAAtPppB,KAAsPopB,GAAA,gCAAAR,EAAA,MAAtP5oB,KAAsPopB,GAAA,uBAAAR,EAAA,KAA6GK,OAAOC,KAAA,6CAAAzjB,OAAA,SAAA0jB,IAAA,cAA1WnpB,KAAkcopB,GAAA,2BCEte,IAcAC,EAdyB9pB,EAAQ,OAcjC+pB,CACEjE,EACAoD,GATF,EAVA,SAAAc,GACEhqB,EAAQ,SAaV,kBAEA,MAUeE,EAAA,QAAA4pB,EAAiB,4BCzBhC,IAOAG,EACAC,EARAlJ,EAAA2E,EAAAC,WAUA,SAAAuE,IACA,UAAAC,MAAA,mCAEA,SAAAC,IACA,UAAAD,MAAA,qCAsBA,SAAAE,EAAAC,GACA,GAAAN,IAAArB,WAEA,OAAAA,WAAA2B,EAAA,GAGA,IAAAN,IAAAE,IAAAF,IAAArB,WAEA,OADAqB,EAAArB,WACAA,WAAA2B,EAAA,GAEA,IAEA,OAAAN,EAAAM,EAAA,GACK,MAAAtoB,GACL,IAEA,OAAAgoB,EAAAzpB,KAAA,KAAA+pB,EAAA,GACS,MAAAtoB,GAET,OAAAgoB,EAAAzpB,KAAAC,KAAA8pB,EAAA,MAvCA,WACA,IAEAN,EADA,mBAAArB,WACAA,WAEAuB,EAEK,MAAAloB,GACLgoB,EAAAE,EAEA,IAEAD,EADA,mBAAAM,aACAA,aAEAH,EAEK,MAAApoB,GACLioB,EAAAG,GAjBA,GAwEA,IAEAI,EAFAC,KACAC,GAAA,EAEAC,GAAA,EAEA,SAAAC,IACAF,GAAAF,IAGAE,GAAA,EACAF,EAAAznB,OACA0nB,EAAAD,EAAAxH,OAAAyH,GAEAE,GAAA,EAEAF,EAAA1nB,QACA8nB,KAIA,SAAAA,IACA,IAAAH,EAAA,CAGA,IAAAI,EAAAT,EAAAO,GACAF,GAAA,EAGA,IADA,IAAAK,EAAAN,EAAA1nB,OACAgoB,GAAA,CAGA,IAFAP,EAAAC,EACAA,OACAE,EAAAI,GACAP,GACAA,EAAAG,GAAAK,MAGAL,GAAA,EACAI,EAAAN,EAAA1nB,OAEAynB,EAAA,KACAE,GAAA,EAnEA,SAAAO,GACA,GAAAhB,IAAAM,aAEA,OAAAA,aAAAU,GAGA,IAAAhB,IAAAG,IAAAH,IAAAM,aAEA,OADAN,EAAAM,aACAA,aAAAU,GAEA,IAEAhB,EAAAgB,GACK,MAAAjpB,GACL,IAEA,OAAAioB,EAAA1pB,KAAA,KAAA0qB,GACS,MAAAjpB,GAGT,OAAAioB,EAAA1pB,KAAAC,KAAAyqB,KAgDAC,CAAAJ,IAiBA,SAAAK,EAAAb,EAAA3nB,GACAnC,KAAA8pB,MACA9pB,KAAAmC,QAYA,SAAAyoB,KA5BArK,EAAAsK,SAAA,SAAAf,GACA,IAAAgB,EAAA,IAAA/nB,MAAAkgB,UAAA1gB,OAAA,GACA,GAAA0gB,UAAA1gB,OAAA,EACA,QAAAF,EAAA,EAAuBA,EAAA4gB,UAAA1gB,OAAsBF,IAC7CyoB,EAAAzoB,EAAA,GAAA4gB,UAAA5gB,GAGA4nB,EAAAvnB,KAAA,IAAAioB,EAAAb,EAAAgB,IACA,IAAAb,EAAA1nB,QAAA2nB,GACAL,EAAAQ,IASAM,EAAA1qB,UAAAuqB,IAAA,WACAxqB,KAAA8pB,IAAA9N,MAAA,KAAAhc,KAAAmC,QAEAoe,EAAAwK,MAAA,UACAxK,EAAAyK,SAAA,EACAzK,EAAA0K,OACA1K,EAAA2K,QACA3K,EAAArE,QAAA,GACAqE,EAAA4K,YAIA5K,EAAA6K,GAAAR,EACArK,EAAA8K,YAAAT,EACArK,EAAA+K,KAAAV,EACArK,EAAAgL,IAAAX,EACArK,EAAAiL,eAAAZ,EACArK,EAAAkL,mBAAAb,EACArK,EAAAmL,KAAAd,EACArK,EAAAoL,gBAAAf,EACArK,EAAAqL,oBAAAhB,EAEArK,EAAAsL,UAAA,SAAA3pB,GAAqC,UAErCqe,EAAAuL,QAAA,SAAA5pB,GACA,UAAAynB,MAAA,qCAGApJ,EAAAwL,IAAA,WAA2B,WAC3BxL,EAAAyL,MAAA,SAAAC,GACA,UAAAtC,MAAA,mCAEApJ,EAAA2L,MAAA,WAA4B","file":"static/js/1.e872f3f3b3c8aa510e20.js","sourcesContent":["import {\r\n\tAmbientLight,\r\n\tAnimationClip,\r\n\tBone,\r\n\tBufferGeometry,\r\n\tClampToEdgeWrapping,\r\n\tColor,\r\n\tDirectionalLight,\r\n\tDoubleSide,\r\n\tEuler,\r\n\tFileLoader,\r\n\tFloat32BufferAttribute,\r\n\tGroup,\r\n\tLine,\r\n\tLineBasicMaterial,\r\n\tLineSegments,\r\n\tLoader,\r\n\tLoaderUtils,\r\n\tMathUtils,\r\n\tMatrix4,\r\n\tMesh,\r\n\tMeshBasicMaterial,\r\n\tMeshLambertMaterial,\r\n\tMeshPhongMaterial,\r\n\tOrthographicCamera,\r\n\tPerspectiveCamera,\r\n\tPointLight,\r\n\tQuaternion,\r\n\tQuaternionKeyframeTrack,\r\n\tRepeatWrapping,\r\n\tScene,\r\n\tSkeleton,\r\n\tSkinnedMesh,\r\n\tSpotLight,\r\n\tTextureLoader,\r\n\tVector3,\r\n\tVectorKeyframeTrack\r\n} from \"@/components/build/three.module.js\";\r\nimport { TGALoader } from \"../loaders/TGALoader.js\";\r\n\r\nvar ColladaLoader = function ( manager ) {\r\n\r\n\tLoader.call( this, manager );\r\n\r\n};\r\n\r\nColladaLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\tconstructor: ColladaLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar path = ( scope.path === '' ) ? LoaderUtils.extractUrlBase( url ) : scope.path;\r\n\r\n\t\tvar loader = new FileLoader( scope.manager );\r\n\t\tloader.setPath( scope.path );\r\n\t\tloader.setRequestHeader( scope.requestHeader );\r\n\t\tloader.setWithCredentials( scope.withCredentials );\r\n\t\tloader.load( url, function ( text ) {\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\tonLoad( scope.parse( text, path ) );\r\n\r\n\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\tif ( onError ) {\r\n\r\n\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.manager.itemError( url );\r\n\r\n\t\t\t}\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\toptions: {\r\n\r\n\t\tset convertUpAxis( value ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.' );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tparse: function ( text, path ) {\r\n\r\n\t\tfunction getElementsByTagName( xml, name ) {\r\n\r\n\t\t\t// Non recursive xml.getElementsByTagName() ...\r\n\r\n\t\t\tvar array = [];\r\n\t\t\tvar childNodes = xml.childNodes;\r\n\r\n\t\t\tfor ( var i = 0, l = childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeName === name ) {\r\n\r\n\t\t\t\t\tarray.push( child );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn array;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseStrings( text ) {\r\n\r\n\t\t\tif ( text.length === 0 ) return [];\r\n\r\n\t\t\tvar parts = text.trim().split( /\\s+/ );\r\n\t\t\tvar array = new Array( parts.length );\r\n\r\n\t\t\tfor ( var i = 0, l = parts.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tarray[ i ] = parts[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn array;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseFloats( text ) {\r\n\r\n\t\t\tif ( text.length === 0 ) return [];\r\n\r\n\t\t\tvar parts = text.trim().split( /\\s+/ );\r\n\t\t\tvar array = new Array( parts.length );\r\n\r\n\t\t\tfor ( var i = 0, l = parts.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tarray[ i ] = parseFloat( parts[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn array;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseInts( text ) {\r\n\r\n\t\t\tif ( text.length === 0 ) return [];\r\n\r\n\t\t\tvar parts = text.trim().split( /\\s+/ );\r\n\t\t\tvar array = new Array( parts.length );\r\n\r\n\t\t\tfor ( var i = 0, l = parts.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tarray[ i ] = parseInt( parts[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn array;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseId( text ) {\r\n\r\n\t\t\treturn text.substring( 1 );\r\n\r\n\t\t}\r\n\r\n\t\tfunction generateId() {\r\n\r\n\t\t\treturn 'three_default_' + ( count ++ );\r\n\r\n\t\t}\r\n\r\n\t\tfunction isEmpty( object ) {\r\n\r\n\t\t\treturn Object.keys( object ).length === 0;\r\n\r\n\t\t}\r\n\r\n\t\t// asset\r\n\r\n\t\tfunction parseAsset( xml ) {\r\n\r\n\t\t\treturn {\r\n\t\t\t\tunit: parseAssetUnit( getElementsByTagName( xml, 'unit' )[ 0 ] ),\r\n\t\t\t\tupAxis: parseAssetUpAxis( getElementsByTagName( xml, 'up_axis' )[ 0 ] )\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseAssetUnit( xml ) {\r\n\r\n\t\t\tif ( ( xml !== undefined ) && ( xml.hasAttribute( 'meter' ) === true ) ) {\r\n\r\n\t\t\t\treturn parseFloat( xml.getAttribute( 'meter' ) );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn 1; // default 1 meter\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseAssetUpAxis( xml ) {\r\n\r\n\t\t\treturn xml !== undefined ? xml.textContent : 'Y_UP';\r\n\r\n\t\t}\r\n\r\n\t\t// library\r\n\r\n\t\tfunction parseLibrary( xml, libraryName, nodeName, parser ) {\r\n\r\n\t\t\tvar library = getElementsByTagName( xml, libraryName )[ 0 ];\r\n\r\n\t\t\tif ( library !== undefined ) {\r\n\r\n\t\t\t\tvar elements = getElementsByTagName( library, nodeName );\r\n\r\n\t\t\t\tfor ( var i = 0; i < elements.length; i ++ ) {\r\n\r\n\t\t\t\t\tparser( elements[ i ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildLibrary( data, builder ) {\r\n\r\n\t\t\tfor ( var name in data ) {\r\n\r\n\t\t\t\tvar object = data[ name ];\r\n\t\t\t\tobject.build = builder( data[ name ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// get\r\n\r\n\t\tfunction getBuild( data, builder ) {\r\n\r\n\t\t\tif ( data.build !== undefined ) return data.build;\r\n\r\n\t\t\tdata.build = builder( data );\r\n\r\n\t\t\treturn data.build;\r\n\r\n\t\t}\r\n\r\n\t\t// animation\r\n\r\n\t\tfunction parseAnimation( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tsources: {},\r\n\t\t\t\tsamplers: {},\r\n\t\t\t\tchannels: {}\r\n\t\t\t};\r\n\r\n\t\t\tvar hasChildren = false;\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tvar id;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'source':\r\n\t\t\t\t\t\tid = child.getAttribute( 'id' );\r\n\t\t\t\t\t\tdata.sources[ id ] = parseSource( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'sampler':\r\n\t\t\t\t\t\tid = child.getAttribute( 'id' );\r\n\t\t\t\t\t\tdata.samplers[ id ] = parseAnimationSampler( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'channel':\r\n\t\t\t\t\t\tid = child.getAttribute( 'target' );\r\n\t\t\t\t\t\tdata.channels[ id ] = parseAnimationChannel( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'animation':\r\n\t\t\t\t\t\t// hierarchy of related animations\r\n\t\t\t\t\t\tparseAnimation( child );\r\n\t\t\t\t\t\thasChildren = true;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.log( child );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasChildren === false ) {\r\n\r\n\t\t\t\t// since 'id' attributes can be optional, it's necessary to generate a UUID for unqiue assignment\r\n\r\n\t\t\t\tlibrary.animations[ xml.getAttribute( 'id' ) || MathUtils.generateUUID() ] = data;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseAnimationSampler( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tinputs: {},\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'input':\r\n\t\t\t\t\t\tvar id = parseId( child.getAttribute( 'source' ) );\r\n\t\t\t\t\t\tvar semantic = child.getAttribute( 'semantic' );\r\n\t\t\t\t\t\tdata.inputs[ semantic ] = id;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseAnimationChannel( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tvar target = xml.getAttribute( 'target' );\r\n\r\n\t\t\t// parsing SID Addressing Syntax\r\n\r\n\t\t\tvar parts = target.split( '/' );\r\n\r\n\t\t\tvar id = parts.shift();\r\n\t\t\tvar sid = parts.shift();\r\n\r\n\t\t\t// check selection syntax\r\n\r\n\t\t\tvar arraySyntax = ( sid.indexOf( '(' ) !== - 1 );\r\n\t\t\tvar memberSyntax = ( sid.indexOf( '.' ) !== - 1 );\r\n\r\n\t\t\tif ( memberSyntax ) {\r\n\r\n\t\t\t\t//  member selection access\r\n\r\n\t\t\t\tparts = sid.split( '.' );\r\n\t\t\t\tsid = parts.shift();\r\n\t\t\t\tdata.member = parts.shift();\r\n\r\n\t\t\t} else if ( arraySyntax ) {\r\n\r\n\t\t\t\t// array-access syntax. can be used to express fields in one-dimensional vectors or two-dimensional matrices.\r\n\r\n\t\t\t\tvar indices = sid.split( '(' );\r\n\t\t\t\tsid = indices.shift();\r\n\r\n\t\t\t\tfor ( var i = 0; i < indices.length; i ++ ) {\r\n\r\n\t\t\t\t\tindices[ i ] = parseInt( indices[ i ].replace( /\\)/, '' ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdata.indices = indices;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tdata.id = id;\r\n\t\t\tdata.sid = sid;\r\n\r\n\t\t\tdata.arraySyntax = arraySyntax;\r\n\t\t\tdata.memberSyntax = memberSyntax;\r\n\r\n\t\t\tdata.sampler = parseId( xml.getAttribute( 'source' ) );\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildAnimation( data ) {\r\n\r\n\t\t\tvar tracks = [];\r\n\r\n\t\t\tvar channels = data.channels;\r\n\t\t\tvar samplers = data.samplers;\r\n\t\t\tvar sources = data.sources;\r\n\r\n\t\t\tfor ( var target in channels ) {\r\n\r\n\t\t\t\tif ( channels.hasOwnProperty( target ) ) {\r\n\r\n\t\t\t\t\tvar channel = channels[ target ];\r\n\t\t\t\t\tvar sampler = samplers[ channel.sampler ];\r\n\r\n\t\t\t\t\tvar inputId = sampler.inputs.INPUT;\r\n\t\t\t\t\tvar outputId = sampler.inputs.OUTPUT;\r\n\r\n\t\t\t\t\tvar inputSource = sources[ inputId ];\r\n\t\t\t\t\tvar outputSource = sources[ outputId ];\r\n\r\n\t\t\t\t\tvar animation = buildAnimationChannel( channel, inputSource, outputSource );\r\n\r\n\t\t\t\t\tcreateKeyframeTracks( animation, tracks );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn tracks;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getAnimation( id ) {\r\n\r\n\t\t\treturn getBuild( library.animations[ id ], buildAnimation );\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildAnimationChannel( channel, inputSource, outputSource ) {\r\n\r\n\t\t\tvar node = library.nodes[ channel.id ];\r\n\t\t\tvar object3D = getNode( node.id );\r\n\r\n\t\t\tvar transform = node.transforms[ channel.sid ];\r\n\t\t\tvar defaultMatrix = node.matrix.clone().transpose();\r\n\r\n\t\t\tvar time, stride;\r\n\t\t\tvar i, il, j, jl;\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\t// the collada spec allows the animation of data in various ways.\r\n\t\t\t// depending on the transform type (matrix, translate, rotate, scale), we execute different logic\r\n\r\n\t\t\tswitch ( transform ) {\r\n\r\n\t\t\t\tcase 'matrix':\r\n\r\n\t\t\t\t\tfor ( i = 0, il = inputSource.array.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\ttime = inputSource.array[ i ];\r\n\t\t\t\t\t\tstride = i * outputSource.stride;\r\n\r\n\t\t\t\t\t\tif ( data[ time ] === undefined ) data[ time ] = {};\r\n\r\n\t\t\t\t\t\tif ( channel.arraySyntax === true ) {\r\n\r\n\t\t\t\t\t\t\tvar value = outputSource.array[ stride ];\r\n\t\t\t\t\t\t\tvar index = channel.indices[ 0 ] + 4 * channel.indices[ 1 ];\r\n\r\n\t\t\t\t\t\t\tdata[ time ][ index ] = value;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tfor ( j = 0, jl = outputSource.stride; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tdata[ time ][ j ] = outputSource.array[ stride + j ];\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'translate':\r\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.', transform );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'rotate':\r\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.', transform );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'scale':\r\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.', transform );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar keyframes = prepareAnimationData( data, defaultMatrix );\r\n\r\n\t\t\tvar animation = {\r\n\t\t\t\tname: object3D.uuid,\r\n\t\t\t\tkeyframes: keyframes\r\n\t\t\t};\r\n\r\n\t\t\treturn animation;\r\n\r\n\t\t}\r\n\r\n\t\tfunction prepareAnimationData( data, defaultMatrix ) {\r\n\r\n\t\t\tvar keyframes = [];\r\n\r\n\t\t\t// transfer data into a sortable array\r\n\r\n\t\t\tfor ( var time in data ) {\r\n\r\n\t\t\t\tkeyframes.push( { time: parseFloat( time ), value: data[ time ] } );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// ensure keyframes are sorted by time\r\n\r\n\t\t\tkeyframes.sort( ascending );\r\n\r\n\t\t\t// now we clean up all animation data, so we can use them for keyframe tracks\r\n\r\n\t\t\tfor ( var i = 0; i < 16; i ++ ) {\r\n\r\n\t\t\t\ttransformAnimationData( keyframes, i, defaultMatrix.elements[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn keyframes;\r\n\r\n\t\t\t// array sort function\r\n\r\n\t\t\tfunction ascending( a, b ) {\r\n\r\n\t\t\t\treturn a.time - b.time;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar position = new Vector3();\r\n\t\tvar scale = new Vector3();\r\n\t\tvar quaternion = new Quaternion();\r\n\r\n\t\tfunction createKeyframeTracks( animation, tracks ) {\r\n\r\n\t\t\tvar keyframes = animation.keyframes;\r\n\t\t\tvar name = animation.name;\r\n\r\n\t\t\tvar times = [];\r\n\t\t\tvar positionData = [];\r\n\t\t\tvar quaternionData = [];\r\n\t\t\tvar scaleData = [];\r\n\r\n\t\t\tfor ( var i = 0, l = keyframes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar keyframe = keyframes[ i ];\r\n\r\n\t\t\t\tvar time = keyframe.time;\r\n\t\t\t\tvar value = keyframe.value;\r\n\r\n\t\t\t\tmatrix.fromArray( value ).transpose();\r\n\t\t\t\tmatrix.decompose( position, quaternion, scale );\r\n\r\n\t\t\t\ttimes.push( time );\r\n\t\t\t\tpositionData.push( position.x, position.y, position.z );\r\n\t\t\t\tquaternionData.push( quaternion.x, quaternion.y, quaternion.z, quaternion.w );\r\n\t\t\t\tscaleData.push( scale.x, scale.y, scale.z );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( positionData.length > 0 ) tracks.push( new VectorKeyframeTrack( name + '.position', times, positionData ) );\r\n\t\t\tif ( quaternionData.length > 0 ) tracks.push( new QuaternionKeyframeTrack( name + '.quaternion', times, quaternionData ) );\r\n\t\t\tif ( scaleData.length > 0 ) tracks.push( new VectorKeyframeTrack( name + '.scale', times, scaleData ) );\r\n\r\n\t\t\treturn tracks;\r\n\r\n\t\t}\r\n\r\n\t\tfunction transformAnimationData( keyframes, property, defaultValue ) {\r\n\r\n\t\t\tvar keyframe;\r\n\r\n\t\t\tvar empty = true;\r\n\t\t\tvar i, l;\r\n\r\n\t\t\t// check, if values of a property are missing in our keyframes\r\n\r\n\t\t\tfor ( i = 0, l = keyframes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tkeyframe = keyframes[ i ];\r\n\r\n\t\t\t\tif ( keyframe.value[ property ] === undefined ) {\r\n\r\n\t\t\t\t\tkeyframe.value[ property ] = null; // mark as missing\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tempty = false;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( empty === true ) {\r\n\r\n\t\t\t\t// no values at all, so we set a default value\r\n\r\n\t\t\t\tfor ( i = 0, l = keyframes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\tkeyframe = keyframes[ i ];\r\n\r\n\t\t\t\t\tkeyframe.value[ property ] = defaultValue;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// filling gaps\r\n\r\n\t\t\t\tcreateMissingKeyframes( keyframes, property );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction createMissingKeyframes( keyframes, property ) {\r\n\r\n\t\t\tvar prev, next;\r\n\r\n\t\t\tfor ( var i = 0, l = keyframes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar keyframe = keyframes[ i ];\r\n\r\n\t\t\t\tif ( keyframe.value[ property ] === null ) {\r\n\r\n\t\t\t\t\tprev = getPrev( keyframes, i, property );\r\n\t\t\t\t\tnext = getNext( keyframes, i, property );\r\n\r\n\t\t\t\t\tif ( prev === null ) {\r\n\r\n\t\t\t\t\t\tkeyframe.value[ property ] = next.value[ property ];\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( next === null ) {\r\n\r\n\t\t\t\t\t\tkeyframe.value[ property ] = prev.value[ property ];\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tinterpolate( keyframe, prev, next, property );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction getPrev( keyframes, i, property ) {\r\n\r\n\t\t\twhile ( i >= 0 ) {\r\n\r\n\t\t\t\tvar keyframe = keyframes[ i ];\r\n\r\n\t\t\t\tif ( keyframe.value[ property ] !== null ) return keyframe;\r\n\r\n\t\t\t\ti --;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getNext( keyframes, i, property ) {\r\n\r\n\t\t\twhile ( i < keyframes.length ) {\r\n\r\n\t\t\t\tvar keyframe = keyframes[ i ];\r\n\r\n\t\t\t\tif ( keyframe.value[ property ] !== null ) return keyframe;\r\n\r\n\t\t\t\ti ++;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tfunction interpolate( key, prev, next, property ) {\r\n\r\n\t\t\tif ( ( next.time - prev.time ) === 0 ) {\r\n\r\n\t\t\t\tkey.value[ property ] = prev.value[ property ];\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tkey.value[ property ] = ( ( key.time - prev.time ) * ( next.value[ property ] - prev.value[ property ] ) / ( next.time - prev.time ) ) + prev.value[ property ];\r\n\r\n\t\t}\r\n\r\n\t\t// animation clips\r\n\r\n\t\tfunction parseAnimationClip( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tname: xml.getAttribute( 'id' ) || 'default',\r\n\t\t\t\tstart: parseFloat( xml.getAttribute( 'start' ) || 0 ),\r\n\t\t\t\tend: parseFloat( xml.getAttribute( 'end' ) || 0 ),\r\n\t\t\t\tanimations: []\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'instance_animation':\r\n\t\t\t\t\t\tdata.animations.push( parseId( child.getAttribute( 'url' ) ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlibrary.clips[ xml.getAttribute( 'id' ) ] = data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildAnimationClip( data ) {\r\n\r\n\t\t\tvar tracks = [];\r\n\r\n\t\t\tvar name = data.name;\r\n\t\t\tvar duration = ( data.end - data.start ) || - 1;\r\n\t\t\tvar animations = data.animations;\r\n\r\n\t\t\tfor ( var i = 0, il = animations.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar animationTracks = getAnimation( animations[ i ] );\r\n\r\n\t\t\t\tfor ( var j = 0, jl = animationTracks.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\ttracks.push( animationTracks[ j ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn new AnimationClip( name, duration, tracks );\r\n\r\n\t\t}\r\n\r\n\t\tfunction getAnimationClip( id ) {\r\n\r\n\t\t\treturn getBuild( library.clips[ id ], buildAnimationClip );\r\n\r\n\t\t}\r\n\r\n\t\t// controller\r\n\r\n\t\tfunction parseController( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'skin':\r\n\t\t\t\t\t\t// there is exactly one skin per controller\r\n\t\t\t\t\t\tdata.id = parseId( child.getAttribute( 'source' ) );\r\n\t\t\t\t\t\tdata.skin = parseSkin( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'morph':\r\n\t\t\t\t\t\tdata.id = parseId( child.getAttribute( 'source' ) );\r\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Morph target animation not supported yet.' );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlibrary.controllers[ xml.getAttribute( 'id' ) ] = data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseSkin( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tsources: {}\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'bind_shape_matrix':\r\n\t\t\t\t\t\tdata.bindShapeMatrix = parseFloats( child.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'source':\r\n\t\t\t\t\t\tvar id = child.getAttribute( 'id' );\r\n\t\t\t\t\t\tdata.sources[ id ] = parseSource( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'joints':\r\n\t\t\t\t\t\tdata.joints = parseJoints( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'vertex_weights':\r\n\t\t\t\t\t\tdata.vertexWeights = parseVertexWeights( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseJoints( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tinputs: {}\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'input':\r\n\t\t\t\t\t\tvar semantic = child.getAttribute( 'semantic' );\r\n\t\t\t\t\t\tvar id = parseId( child.getAttribute( 'source' ) );\r\n\t\t\t\t\t\tdata.inputs[ semantic ] = id;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseVertexWeights( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tinputs: {}\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'input':\r\n\t\t\t\t\t\tvar semantic = child.getAttribute( 'semantic' );\r\n\t\t\t\t\t\tvar id = parseId( child.getAttribute( 'source' ) );\r\n\t\t\t\t\t\tvar offset = parseInt( child.getAttribute( 'offset' ) );\r\n\t\t\t\t\t\tdata.inputs[ semantic ] = { id: id, offset: offset };\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'vcount':\r\n\t\t\t\t\t\tdata.vcount = parseInts( child.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'v':\r\n\t\t\t\t\t\tdata.v = parseInts( child.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildController( data ) {\r\n\r\n\t\t\tvar build = {\r\n\t\t\t\tid: data.id\r\n\t\t\t};\r\n\r\n\t\t\tvar geometry = library.geometries[ build.id ];\r\n\r\n\t\t\tif ( data.skin !== undefined ) {\r\n\r\n\t\t\t\tbuild.skin = buildSkin( data.skin );\r\n\r\n\t\t\t\t// we enhance the 'sources' property of the corresponding geometry with our skin data\r\n\r\n\t\t\t\tgeometry.sources.skinIndices = build.skin.indices;\r\n\t\t\t\tgeometry.sources.skinWeights = build.skin.weights;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn build;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildSkin( data ) {\r\n\r\n\t\t\tvar BONE_LIMIT = 4;\r\n\r\n\t\t\tvar build = {\r\n\t\t\t\tjoints: [], // this must be an array to preserve the joint order\r\n\t\t\t\tindices: {\r\n\t\t\t\t\tarray: [],\r\n\t\t\t\t\tstride: BONE_LIMIT\r\n\t\t\t\t},\r\n\t\t\t\tweights: {\r\n\t\t\t\t\tarray: [],\r\n\t\t\t\t\tstride: BONE_LIMIT\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tvar sources = data.sources;\r\n\t\t\tvar vertexWeights = data.vertexWeights;\r\n\r\n\t\t\tvar vcount = vertexWeights.vcount;\r\n\t\t\tvar v = vertexWeights.v;\r\n\t\t\tvar jointOffset = vertexWeights.inputs.JOINT.offset;\r\n\t\t\tvar weightOffset = vertexWeights.inputs.WEIGHT.offset;\r\n\r\n\t\t\tvar jointSource = data.sources[ data.joints.inputs.JOINT ];\r\n\t\t\tvar inverseSource = data.sources[ data.joints.inputs.INV_BIND_MATRIX ];\r\n\r\n\t\t\tvar weights = sources[ vertexWeights.inputs.WEIGHT.id ].array;\r\n\t\t\tvar stride = 0;\r\n\r\n\t\t\tvar i, j, l;\r\n\r\n\t\t\t// procces skin data for each vertex\r\n\r\n\t\t\tfor ( i = 0, l = vcount.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar jointCount = vcount[ i ]; // this is the amount of joints that affect a single vertex\r\n\t\t\t\tvar vertexSkinData = [];\r\n\r\n\t\t\t\tfor ( j = 0; j < jointCount; j ++ ) {\r\n\r\n\t\t\t\t\tvar skinIndex = v[ stride + jointOffset ];\r\n\t\t\t\t\tvar weightId = v[ stride + weightOffset ];\r\n\t\t\t\t\tvar skinWeight = weights[ weightId ];\r\n\r\n\t\t\t\t\tvertexSkinData.push( { index: skinIndex, weight: skinWeight } );\r\n\r\n\t\t\t\t\tstride += 2;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// we sort the joints in descending order based on the weights.\r\n\t\t\t\t// this ensures, we only procced the most important joints of the vertex\r\n\r\n\t\t\t\tvertexSkinData.sort( descending );\r\n\r\n\t\t\t\t// now we provide for each vertex a set of four index and weight values.\r\n\t\t\t\t// the order of the skin data matches the order of vertices\r\n\r\n\t\t\t\tfor ( j = 0; j < BONE_LIMIT; j ++ ) {\r\n\r\n\t\t\t\t\tvar d = vertexSkinData[ j ];\r\n\r\n\t\t\t\t\tif ( d !== undefined ) {\r\n\r\n\t\t\t\t\t\tbuild.indices.array.push( d.index );\r\n\t\t\t\t\t\tbuild.weights.array.push( d.weight );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tbuild.indices.array.push( 0 );\r\n\t\t\t\t\t\tbuild.weights.array.push( 0 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// setup bind matrix\r\n\r\n\t\t\tif ( data.bindShapeMatrix ) {\r\n\r\n\t\t\t\tbuild.bindMatrix = new Matrix4().fromArray( data.bindShapeMatrix ).transpose();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tbuild.bindMatrix = new Matrix4().identity();\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// process bones and inverse bind matrix data\r\n\r\n\t\t\tfor ( i = 0, l = jointSource.array.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar name = jointSource.array[ i ];\r\n\t\t\t\tvar boneInverse = new Matrix4().fromArray( inverseSource.array, i * inverseSource.stride ).transpose();\r\n\r\n\t\t\t\tbuild.joints.push( { name: name, boneInverse: boneInverse } );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn build;\r\n\r\n\t\t\t// array sort function\r\n\r\n\t\t\tfunction descending( a, b ) {\r\n\r\n\t\t\t\treturn b.weight - a.weight;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction getController( id ) {\r\n\r\n\t\t\treturn getBuild( library.controllers[ id ], buildController );\r\n\r\n\t\t}\r\n\r\n\t\t// image\r\n\r\n\t\tfunction parseImage( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tinit_from: getElementsByTagName( xml, 'init_from' )[ 0 ].textContent\r\n\t\t\t};\r\n\r\n\t\t\tlibrary.images[ xml.getAttribute( 'id' ) ] = data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildImage( data ) {\r\n\r\n\t\t\tif ( data.build !== undefined ) return data.build;\r\n\r\n\t\t\treturn data.init_from;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getImage( id ) {\r\n\r\n\t\t\tvar data = library.images[ id ];\r\n\r\n\t\t\tif ( data !== undefined ) {\r\n\r\n\t\t\t\treturn getBuild( data, buildImage );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t find image with ID:', id );\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\t// effect\r\n\r\n\t\tfunction parseEffect( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'profile_COMMON':\r\n\t\t\t\t\t\tdata.profile = parseEffectProfileCOMMON( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlibrary.effects[ xml.getAttribute( 'id' ) ] = data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseEffectProfileCOMMON( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tsurfaces: {},\r\n\t\t\t\tsamplers: {}\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'newparam':\r\n\t\t\t\t\t\tparseEffectNewparam( child, data );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'technique':\r\n\t\t\t\t\t\tdata.technique = parseEffectTechnique( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'extra':\r\n\t\t\t\t\t\tdata.extra = parseEffectExtra( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseEffectNewparam( xml, data ) {\r\n\r\n\t\t\tvar sid = xml.getAttribute( 'sid' );\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'surface':\r\n\t\t\t\t\t\tdata.surfaces[ sid ] = parseEffectSurface( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'sampler2D':\r\n\t\t\t\t\t\tdata.samplers[ sid ] = parseEffectSampler( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseEffectSurface( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'init_from':\r\n\t\t\t\t\t\tdata.init_from = child.textContent;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseEffectSampler( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'source':\r\n\t\t\t\t\t\tdata.source = child.textContent;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseEffectTechnique( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'constant':\r\n\t\t\t\t\tcase 'lambert':\r\n\t\t\t\t\tcase 'blinn':\r\n\t\t\t\t\tcase 'phong':\r\n\t\t\t\t\t\tdata.type = child.nodeName;\r\n\t\t\t\t\t\tdata.parameters = parseEffectParameters( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseEffectParameters( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'emission':\r\n\t\t\t\t\tcase 'diffuse':\r\n\t\t\t\t\tcase 'specular':\r\n\t\t\t\t\tcase 'bump':\r\n\t\t\t\t\tcase 'ambient':\r\n\t\t\t\t\tcase 'shininess':\r\n\t\t\t\t\tcase 'transparency':\r\n\t\t\t\t\t\tdata[ child.nodeName ] = parseEffectParameter( child );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transparent':\r\n\t\t\t\t\t\tdata[ child.nodeName ] = {\r\n\t\t\t\t\t\t\topaque: child.getAttribute( 'opaque' ),\r\n\t\t\t\t\t\t\tdata: parseEffectParameter( child )\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseEffectParameter( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'color':\r\n\t\t\t\t\t\tdata[ child.nodeName ] = parseFloats( child.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'float':\r\n\t\t\t\t\t\tdata[ child.nodeName ] = parseFloat( child.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'texture':\r\n\t\t\t\t\t\tdata[ child.nodeName ] = { id: child.getAttribute( 'texture' ), extra: parseEffectParameterTexture( child ) };\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseEffectParameterTexture( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\ttechnique: {}\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'extra':\r\n\t\t\t\t\t\tparseEffectParameterTextureExtra( child, data );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseEffectParameterTextureExtra( xml, data ) {\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'technique':\r\n\t\t\t\t\t\tparseEffectParameterTextureExtraTechnique( child, data );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseEffectParameterTextureExtraTechnique( xml, data ) {\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'repeatU':\r\n\t\t\t\t\tcase 'repeatV':\r\n\t\t\t\t\tcase 'offsetU':\r\n\t\t\t\t\tcase 'offsetV':\r\n\t\t\t\t\t\tdata.technique[ child.nodeName ] = parseFloat( child.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'wrapU':\r\n\t\t\t\t\tcase 'wrapV':\r\n\r\n\t\t\t\t\t\t// some files have values for wrapU/wrapV which become NaN via parseInt\r\n\r\n\t\t\t\t\t\tif ( child.textContent.toUpperCase() === 'TRUE' ) {\r\n\r\n\t\t\t\t\t\t\tdata.technique[ child.nodeName ] = 1;\r\n\r\n\t\t\t\t\t\t} else if ( child.textContent.toUpperCase() === 'FALSE' ) {\r\n\r\n\t\t\t\t\t\t\tdata.technique[ child.nodeName ] = 0;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tdata.technique[ child.nodeName ] = parseInt( child.textContent );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseEffectExtra( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'technique':\r\n\t\t\t\t\t\tdata.technique = parseEffectExtraTechnique( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseEffectExtraTechnique( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'double_sided':\r\n\t\t\t\t\t\tdata[ child.nodeName ] = parseInt( child.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildEffect( data ) {\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getEffect( id ) {\r\n\r\n\t\t\treturn getBuild( library.effects[ id ], buildEffect );\r\n\r\n\t\t}\r\n\r\n\t\t// material\r\n\r\n\t\tfunction parseMaterial( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tname: xml.getAttribute( 'name' )\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'instance_effect':\r\n\t\t\t\t\t\tdata.url = parseId( child.getAttribute( 'url' ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlibrary.materials[ xml.getAttribute( 'id' ) ] = data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getTextureLoader( image ) {\r\n\r\n\t\t\tvar loader;\r\n\r\n\t\t\tvar extension = image.slice( ( image.lastIndexOf( '.' ) - 1 >>> 0 ) + 2 ); // http://www.jstips.co/en/javascript/get-file-extension/\r\n\t\t\textension = extension.toLowerCase();\r\n\r\n\t\t\tswitch ( extension ) {\r\n\r\n\t\t\t\tcase 'tga':\r\n\t\t\t\t\tloader = tgaLoader;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tloader = textureLoader;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn loader;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildMaterial( data ) {\r\n\r\n\t\t\tvar effect = getEffect( data.url );\r\n\t\t\tvar technique = effect.profile.technique;\r\n\t\t\tvar extra = effect.profile.extra;\r\n\r\n\t\t\tvar material;\r\n\r\n\t\t\tswitch ( technique.type ) {\r\n\r\n\t\t\t\tcase 'phong':\r\n\t\t\t\tcase 'blinn':\r\n\t\t\t\t\tmaterial = new MeshPhongMaterial();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'lambert':\r\n\t\t\t\t\tmaterial = new MeshLambertMaterial();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tmaterial = new MeshBasicMaterial();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial.name = data.name || '';\r\n\r\n\t\t\tfunction getTexture( textureObject ) {\r\n\r\n\t\t\t\tvar sampler = effect.profile.samplers[ textureObject.id ];\r\n\t\t\t\tvar image = null;\r\n\r\n\t\t\t\t// get image\r\n\r\n\t\t\t\tif ( sampler !== undefined ) {\r\n\r\n\t\t\t\t\tvar surface = effect.profile.surfaces[ sampler.source ];\r\n\t\t\t\t\timage = getImage( surface.init_from );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530).' );\r\n\t\t\t\t\timage = getImage( textureObject.id );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// create texture if image is avaiable\r\n\r\n\t\t\t\tif ( image !== null ) {\r\n\r\n\t\t\t\t\tvar loader = getTextureLoader( image );\r\n\r\n\t\t\t\t\tif ( loader !== undefined ) {\r\n\r\n\t\t\t\t\t\tvar texture = loader.load( image );\r\n\r\n\t\t\t\t\t\tvar extra = textureObject.extra;\r\n\r\n\t\t\t\t\t\tif ( extra !== undefined && extra.technique !== undefined && isEmpty( extra.technique ) === false ) {\r\n\r\n\t\t\t\t\t\t\tvar technique = extra.technique;\r\n\r\n\t\t\t\t\t\t\ttexture.wrapS = technique.wrapU ? RepeatWrapping : ClampToEdgeWrapping;\r\n\t\t\t\t\t\t\ttexture.wrapT = technique.wrapV ? RepeatWrapping : ClampToEdgeWrapping;\r\n\r\n\t\t\t\t\t\t\ttexture.offset.set( technique.offsetU || 0, technique.offsetV || 0 );\r\n\t\t\t\t\t\t\ttexture.repeat.set( technique.repeatU || 1, technique.repeatV || 1 );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\ttexture.wrapS = RepeatWrapping;\r\n\t\t\t\t\t\t\ttexture.wrapT = RepeatWrapping;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn texture;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Loader for texture %s not found.', image );\r\n\r\n\t\t\t\t\t\treturn null;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t create texture with ID:', textureObject.id );\r\n\r\n\t\t\t\t\treturn null;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar parameters = technique.parameters;\r\n\r\n\t\t\tfor ( var key in parameters ) {\r\n\r\n\t\t\t\tvar parameter = parameters[ key ];\r\n\r\n\t\t\t\tswitch ( key ) {\r\n\r\n\t\t\t\t\tcase 'diffuse':\r\n\t\t\t\t\t\tif ( parameter.color ) material.color.fromArray( parameter.color );\r\n\t\t\t\t\t\tif ( parameter.texture ) material.map = getTexture( parameter.texture );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'specular':\r\n\t\t\t\t\t\tif ( parameter.color && material.specular ) material.specular.fromArray( parameter.color );\r\n\t\t\t\t\t\tif ( parameter.texture ) material.specularMap = getTexture( parameter.texture );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'bump':\r\n\t\t\t\t\t\tif ( parameter.texture ) material.normalMap = getTexture( parameter.texture );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'ambient':\r\n\t\t\t\t\t\tif ( parameter.texture ) material.lightMap = getTexture( parameter.texture );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'shininess':\r\n\t\t\t\t\t\tif ( parameter.float && material.shininess ) material.shininess = parameter.float;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'emission':\r\n\t\t\t\t\t\tif ( parameter.color && material.emissive ) material.emissive.fromArray( parameter.color );\r\n\t\t\t\t\t\tif ( parameter.texture ) material.emissiveMap = getTexture( parameter.texture );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tvar transparent = parameters[ 'transparent' ];\r\n\t\t\tvar transparency = parameters[ 'transparency' ];\r\n\r\n\t\t\t// <transparency> does not exist but <transparent>\r\n\r\n\t\t\tif ( transparency === undefined && transparent ) {\r\n\r\n\t\t\t\ttransparency = {\r\n\t\t\t\t\tfloat: 1\r\n\t\t\t\t};\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// <transparent> does not exist but <transparency>\r\n\r\n\t\t\tif ( transparent === undefined && transparency ) {\r\n\r\n\t\t\t\ttransparent = {\r\n\t\t\t\t\topaque: 'A_ONE',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tcolor: [ 1, 1, 1, 1 ]\r\n\t\t\t\t\t} };\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( transparent && transparency ) {\r\n\r\n\t\t\t\t// handle case if a texture exists but no color\r\n\r\n\t\t\t\tif ( transparent.data.texture ) {\r\n\r\n\t\t\t\t\t// we do not set an alpha map (see #13792)\r\n\r\n\t\t\t\t\tmaterial.transparent = true;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tvar color = transparent.data.color;\r\n\r\n\t\t\t\t\tswitch ( transparent.opaque ) {\r\n\r\n\t\t\t\t\t\tcase 'A_ONE':\r\n\t\t\t\t\t\t\tmaterial.opacity = color[ 3 ] * transparency.float;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'RGB_ZERO':\r\n\t\t\t\t\t\t\tmaterial.opacity = 1 - ( color[ 0 ] * transparency.float );\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'A_ZERO':\r\n\t\t\t\t\t\t\tmaterial.opacity = 1 - ( color[ 3 ] * transparency.float );\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'RGB_ONE':\r\n\t\t\t\t\t\t\tmaterial.opacity = color[ 0 ] * transparency.float;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Invalid opaque type \"%s\" of transparent tag.', transparent.opaque );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( material.opacity < 1 ) material.transparent = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tif ( extra !== undefined && extra.technique !== undefined && extra.technique.double_sided === 1 ) {\r\n\r\n\t\t\t\tmaterial.side = DoubleSide;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn material;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getMaterial( id ) {\r\n\r\n\t\t\treturn getBuild( library.materials[ id ], buildMaterial );\r\n\r\n\t\t}\r\n\r\n\t\t// camera\r\n\r\n\t\tfunction parseCamera( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tname: xml.getAttribute( 'name' )\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'optics':\r\n\t\t\t\t\t\tdata.optics = parseCameraOptics( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlibrary.cameras[ xml.getAttribute( 'id' ) ] = data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseCameraOptics( xml ) {\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'technique_common':\r\n\t\t\t\t\t\treturn parseCameraTechnique( child );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn {};\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseCameraTechnique( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'perspective':\r\n\t\t\t\t\tcase 'orthographic':\r\n\r\n\t\t\t\t\t\tdata.technique = child.nodeName;\r\n\t\t\t\t\t\tdata.parameters = parseCameraParameters( child );\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseCameraParameters( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'xfov':\r\n\t\t\t\t\tcase 'yfov':\r\n\t\t\t\t\tcase 'xmag':\r\n\t\t\t\t\tcase 'ymag':\r\n\t\t\t\t\tcase 'znear':\r\n\t\t\t\t\tcase 'zfar':\r\n\t\t\t\t\tcase 'aspect_ratio':\r\n\t\t\t\t\t\tdata[ child.nodeName ] = parseFloat( child.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildCamera( data ) {\r\n\r\n\t\t\tvar camera;\r\n\r\n\t\t\tswitch ( data.optics.technique ) {\r\n\r\n\t\t\t\tcase 'perspective':\r\n\t\t\t\t\tcamera = new PerspectiveCamera(\r\n\t\t\t\t\t\tdata.optics.parameters.yfov,\r\n\t\t\t\t\t\tdata.optics.parameters.aspect_ratio,\r\n\t\t\t\t\t\tdata.optics.parameters.znear,\r\n\t\t\t\t\t\tdata.optics.parameters.zfar\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'orthographic':\r\n\t\t\t\t\tvar ymag = data.optics.parameters.ymag;\r\n\t\t\t\t\tvar xmag = data.optics.parameters.xmag;\r\n\t\t\t\t\tvar aspectRatio = data.optics.parameters.aspect_ratio;\r\n\r\n\t\t\t\t\txmag = ( xmag === undefined ) ? ( ymag * aspectRatio ) : xmag;\r\n\t\t\t\t\tymag = ( ymag === undefined ) ? ( xmag / aspectRatio ) : ymag;\r\n\r\n\t\t\t\t\txmag *= 0.5;\r\n\t\t\t\t\tymag *= 0.5;\r\n\r\n\t\t\t\t\tcamera = new OrthographicCamera(\r\n\t\t\t\t\t\t- xmag, xmag, ymag, - ymag, // left, right, top, bottom\r\n\t\t\t\t\t\tdata.optics.parameters.znear,\r\n\t\t\t\t\t\tdata.optics.parameters.zfar\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tcamera = new PerspectiveCamera();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcamera.name = data.name || '';\r\n\r\n\t\t\treturn camera;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getCamera( id ) {\r\n\r\n\t\t\tvar data = library.cameras[ id ];\r\n\r\n\t\t\tif ( data !== undefined ) {\r\n\r\n\t\t\t\treturn getBuild( data, buildCamera );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t find camera with ID:', id );\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\t// light\r\n\r\n\t\tfunction parseLight( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'technique_common':\r\n\t\t\t\t\t\tdata = parseLightTechnique( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlibrary.lights[ xml.getAttribute( 'id' ) ] = data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseLightTechnique( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'directional':\r\n\t\t\t\t\tcase 'point':\r\n\t\t\t\t\tcase 'spot':\r\n\t\t\t\t\tcase 'ambient':\r\n\r\n\t\t\t\t\t\tdata.technique = child.nodeName;\r\n\t\t\t\t\t\tdata.parameters = parseLightParameters( child );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseLightParameters( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'color':\r\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\r\n\t\t\t\t\t\tdata.color = new Color().fromArray( array );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'falloff_angle':\r\n\t\t\t\t\t\tdata.falloffAngle = parseFloat( child.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'quadratic_attenuation':\r\n\t\t\t\t\t\tvar f = parseFloat( child.textContent );\r\n\t\t\t\t\t\tdata.distance = f ? Math.sqrt( 1 / f ) : 0;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildLight( data ) {\r\n\r\n\t\t\tvar light;\r\n\r\n\t\t\tswitch ( data.technique ) {\r\n\r\n\t\t\t\tcase 'directional':\r\n\t\t\t\t\tlight = new DirectionalLight();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'point':\r\n\t\t\t\t\tlight = new PointLight();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'spot':\r\n\t\t\t\t\tlight = new SpotLight();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'ambient':\r\n\t\t\t\t\tlight = new AmbientLight();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( data.parameters.color ) light.color.copy( data.parameters.color );\r\n\t\t\tif ( data.parameters.distance ) light.distance = data.parameters.distance;\r\n\r\n\t\t\treturn light;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getLight( id ) {\r\n\r\n\t\t\tvar data = library.lights[ id ];\r\n\r\n\t\t\tif ( data !== undefined ) {\r\n\r\n\t\t\t\treturn getBuild( data, buildLight );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t find light with ID:', id );\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\t// geometry\r\n\r\n\t\tfunction parseGeometry( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tname: xml.getAttribute( 'name' ),\r\n\t\t\t\tsources: {},\r\n\t\t\t\tvertices: {},\r\n\t\t\t\tprimitives: []\r\n\t\t\t};\r\n\r\n\t\t\tvar mesh = getElementsByTagName( xml, 'mesh' )[ 0 ];\r\n\r\n\t\t\t// the following tags inside geometry are not supported yet (see https://github.com/mrdoob/three.js/pull/12606): convex_mesh, spline, brep\r\n\t\t\tif ( mesh === undefined ) return;\r\n\r\n\t\t\tfor ( var i = 0; i < mesh.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = mesh.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tvar id = child.getAttribute( 'id' );\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'source':\r\n\t\t\t\t\t\tdata.sources[ id ] = parseSource( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'vertices':\r\n\t\t\t\t\t\t// data.sources[ id ] = data.sources[ parseId( getElementsByTagName( child, 'input' )[ 0 ].getAttribute( 'source' ) ) ];\r\n\t\t\t\t\t\tdata.vertices = parseGeometryVertices( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'polygons':\r\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Unsupported primitive type: ', child.nodeName );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'lines':\r\n\t\t\t\t\tcase 'linestrips':\r\n\t\t\t\t\tcase 'polylist':\r\n\t\t\t\t\tcase 'triangles':\r\n\t\t\t\t\t\tdata.primitives.push( parseGeometryPrimitive( child ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.log( child );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlibrary.geometries[ xml.getAttribute( 'id' ) ] = data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseSource( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tarray: [],\r\n\t\t\t\tstride: 3\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'float_array':\r\n\t\t\t\t\t\tdata.array = parseFloats( child.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'Name_array':\r\n\t\t\t\t\t\tdata.array = parseStrings( child.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'technique_common':\r\n\t\t\t\t\t\tvar accessor = getElementsByTagName( child, 'accessor' )[ 0 ];\r\n\r\n\t\t\t\t\t\tif ( accessor !== undefined ) {\r\n\r\n\t\t\t\t\t\t\tdata.stride = parseInt( accessor.getAttribute( 'stride' ) );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseGeometryVertices( xml ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tdata[ child.getAttribute( 'semantic' ) ] = parseId( child.getAttribute( 'source' ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseGeometryPrimitive( xml ) {\r\n\r\n\t\t\tvar primitive = {\r\n\t\t\t\ttype: xml.nodeName,\r\n\t\t\t\tmaterial: xml.getAttribute( 'material' ),\r\n\t\t\t\tcount: parseInt( xml.getAttribute( 'count' ) ),\r\n\t\t\t\tinputs: {},\r\n\t\t\t\tstride: 0,\r\n\t\t\t\thasUV: false\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0, l = xml.childNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'input':\r\n\t\t\t\t\t\tvar id = parseId( child.getAttribute( 'source' ) );\r\n\t\t\t\t\t\tvar semantic = child.getAttribute( 'semantic' );\r\n\t\t\t\t\t\tvar offset = parseInt( child.getAttribute( 'offset' ) );\r\n\t\t\t\t\t\tvar set = parseInt( child.getAttribute( 'set' ) );\r\n\t\t\t\t\t\tvar inputname = ( set > 0 ? semantic + set : semantic );\r\n\t\t\t\t\t\tprimitive.inputs[ inputname ] = { id: id, offset: offset };\r\n\t\t\t\t\t\tprimitive.stride = Math.max( primitive.stride, offset + 1 );\r\n\t\t\t\t\t\tif ( semantic === 'TEXCOORD' ) primitive.hasUV = true;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'vcount':\r\n\t\t\t\t\t\tprimitive.vcount = parseInts( child.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'p':\r\n\t\t\t\t\t\tprimitive.p = parseInts( child.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn primitive;\r\n\r\n\t\t}\r\n\r\n\t\tfunction groupPrimitives( primitives ) {\r\n\r\n\t\t\tvar build = {};\r\n\r\n\t\t\tfor ( var i = 0; i < primitives.length; i ++ ) {\r\n\r\n\t\t\t\tvar primitive = primitives[ i ];\r\n\r\n\t\t\t\tif ( build[ primitive.type ] === undefined ) build[ primitive.type ] = [];\r\n\r\n\t\t\t\tbuild[ primitive.type ].push( primitive );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn build;\r\n\r\n\t\t}\r\n\r\n\t\tfunction checkUVCoordinates( primitives ) {\r\n\r\n\t\t\tvar count = 0;\r\n\r\n\t\t\tfor ( var i = 0, l = primitives.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar primitive = primitives[ i ];\r\n\r\n\t\t\t\tif ( primitive.hasUV === true ) {\r\n\r\n\t\t\t\t\tcount ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( count > 0 && count < primitives.length ) {\r\n\r\n\t\t\t\tprimitives.uvsNeedsFix = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildGeometry( data ) {\r\n\r\n\t\t\tvar build = {};\r\n\r\n\t\t\tvar sources = data.sources;\r\n\t\t\tvar vertices = data.vertices;\r\n\t\t\tvar primitives = data.primitives;\r\n\r\n\t\t\tif ( primitives.length === 0 ) return {};\r\n\r\n\t\t\t// our goal is to create one buffer geometry for a single type of primitives\r\n\t\t\t// first, we group all primitives by their type\r\n\r\n\t\t\tvar groupedPrimitives = groupPrimitives( primitives );\r\n\r\n\t\t\tfor ( var type in groupedPrimitives ) {\r\n\r\n\t\t\t\tvar primitiveType = groupedPrimitives[ type ];\r\n\r\n\t\t\t\t// second, ensure consistent uv coordinates for each type of primitives (polylist,triangles or lines)\r\n\r\n\t\t\t\tcheckUVCoordinates( primitiveType );\r\n\r\n\t\t\t\t// third, create a buffer geometry for each type of primitives\r\n\r\n\t\t\t\tbuild[ type ] = buildGeometryType( primitiveType, sources, vertices );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn build;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildGeometryType( primitives, sources, vertices ) {\r\n\r\n\t\t\tvar build = {};\r\n\r\n\t\t\tvar position = { array: [], stride: 0 };\r\n\t\t\tvar normal = { array: [], stride: 0 };\r\n\t\t\tvar uv = { array: [], stride: 0 };\r\n\t\t\tvar uv2 = { array: [], stride: 0 };\r\n\t\t\tvar color = { array: [], stride: 0 };\r\n\r\n\t\t\tvar skinIndex = { array: [], stride: 4 };\r\n\t\t\tvar skinWeight = { array: [], stride: 4 };\r\n\r\n\t\t\tvar geometry = new BufferGeometry();\r\n\r\n\t\t\tvar materialKeys = [];\r\n\r\n\t\t\tvar start = 0;\r\n\r\n\t\t\tfor ( var p = 0; p < primitives.length; p ++ ) {\r\n\r\n\t\t\t\tvar primitive = primitives[ p ];\r\n\t\t\t\tvar inputs = primitive.inputs;\r\n\r\n\t\t\t\t// groups\r\n\r\n\t\t\t\tvar count = 0;\r\n\r\n\t\t\t\tswitch ( primitive.type ) {\r\n\r\n\t\t\t\t\tcase 'lines':\r\n\t\t\t\t\tcase 'linestrips':\r\n\t\t\t\t\t\tcount = primitive.count * 2;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'triangles':\r\n\t\t\t\t\t\tcount = primitive.count * 3;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'polylist':\r\n\r\n\t\t\t\t\t\tfor ( var g = 0; g < primitive.count; g ++ ) {\r\n\r\n\t\t\t\t\t\t\tvar vc = primitive.vcount[ g ];\r\n\r\n\t\t\t\t\t\t\tswitch ( vc ) {\r\n\r\n\t\t\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t\t\t\tcount += 3; // single triangle\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\t\t\t\tcount += 6; // quad, subdivided into two triangles\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\tcount += ( vc - 2 ) * 3; // polylist with more than four vertices\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Unknow primitive type:', primitive.type );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.addGroup( start, count, p );\r\n\t\t\t\tstart += count;\r\n\r\n\t\t\t\t// material\r\n\r\n\t\t\t\tif ( primitive.material ) {\r\n\r\n\t\t\t\t\tmaterialKeys.push( primitive.material );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// geometry data\r\n\r\n\t\t\t\tfor ( var name in inputs ) {\r\n\r\n\t\t\t\t\tvar input = inputs[ name ];\r\n\r\n\t\t\t\t\tswitch ( name )\t{\r\n\r\n\t\t\t\t\t\tcase 'VERTEX':\r\n\t\t\t\t\t\t\tfor ( var key in vertices ) {\r\n\r\n\t\t\t\t\t\t\t\tvar id = vertices[ key ];\r\n\r\n\t\t\t\t\t\t\t\tswitch ( key ) {\r\n\r\n\t\t\t\t\t\t\t\t\tcase 'POSITION':\r\n\t\t\t\t\t\t\t\t\t\tvar prevLength = position.array.length;\r\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, position.array );\r\n\t\t\t\t\t\t\t\t\t\tposition.stride = sources[ id ].stride;\r\n\r\n\t\t\t\t\t\t\t\t\t\tif ( sources.skinWeights && sources.skinIndices ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources.skinIndices, input.offset, skinIndex.array );\r\n\t\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources.skinWeights, input.offset, skinWeight.array );\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// see #3803\r\n\r\n\t\t\t\t\t\t\t\t\t\tif ( primitive.hasUV === false && primitives.uvsNeedsFix === true ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tvar count = ( position.array.length - prevLength ) / position.stride;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tfor ( var i = 0; i < count; i ++ ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t// fill missing uv coordinates\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tuv.array.push( 0, 0 );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\tcase 'NORMAL':\r\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, normal.array );\r\n\t\t\t\t\t\t\t\t\t\tnormal.stride = sources[ id ].stride;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\tcase 'COLOR':\r\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, color.array );\r\n\t\t\t\t\t\t\t\t\t\tcolor.stride = sources[ id ].stride;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\tcase 'TEXCOORD':\r\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, uv.array );\r\n\t\t\t\t\t\t\t\t\t\tuv.stride = sources[ id ].stride;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\tcase 'TEXCOORD1':\r\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, uv2.array );\r\n\t\t\t\t\t\t\t\t\t\tuv.stride = sources[ id ].stride;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Semantic \"%s\" not handled in geometry build process.', key );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'NORMAL':\r\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, normal.array );\r\n\t\t\t\t\t\t\tnormal.stride = sources[ input.id ].stride;\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'COLOR':\r\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, color.array );\r\n\t\t\t\t\t\t\tcolor.stride = sources[ input.id ].stride;\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'TEXCOORD':\r\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, uv.array );\r\n\t\t\t\t\t\t\tuv.stride = sources[ input.id ].stride;\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'TEXCOORD1':\r\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, uv2.array );\r\n\t\t\t\t\t\t\tuv2.stride = sources[ input.id ].stride;\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// build geometry\r\n\r\n\t\t\tif ( position.array.length > 0 ) geometry.setAttribute( 'position', new Float32BufferAttribute( position.array, position.stride ) );\r\n\t\t\tif ( normal.array.length > 0 ) geometry.setAttribute( 'normal', new Float32BufferAttribute( normal.array, normal.stride ) );\r\n\t\t\tif ( color.array.length > 0 ) geometry.setAttribute( 'color', new Float32BufferAttribute( color.array, color.stride ) );\r\n\t\t\tif ( uv.array.length > 0 ) geometry.setAttribute( 'uv', new Float32BufferAttribute( uv.array, uv.stride ) );\r\n\t\t\tif ( uv2.array.length > 0 ) geometry.setAttribute( 'uv2', new Float32BufferAttribute( uv2.array, uv2.stride ) );\r\n\r\n\t\t\tif ( skinIndex.array.length > 0 ) geometry.setAttribute( 'skinIndex', new Float32BufferAttribute( skinIndex.array, skinIndex.stride ) );\r\n\t\t\tif ( skinWeight.array.length > 0 ) geometry.setAttribute( 'skinWeight', new Float32BufferAttribute( skinWeight.array, skinWeight.stride ) );\r\n\r\n\t\t\tbuild.data = geometry;\r\n\t\t\tbuild.type = primitives[ 0 ].type;\r\n\t\t\tbuild.materialKeys = materialKeys;\r\n\r\n\t\t\treturn build;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildGeometryData( primitive, source, offset, array ) {\r\n\r\n\t\t\tvar indices = primitive.p;\r\n\t\t\tvar stride = primitive.stride;\r\n\t\t\tvar vcount = primitive.vcount;\r\n\r\n\t\t\tfunction pushVector( i ) {\r\n\r\n\t\t\t\tvar index = indices[ i + offset ] * sourceStride;\r\n\t\t\t\tvar length = index + sourceStride;\r\n\r\n\t\t\t\tfor ( ; index < length; index ++ ) {\r\n\r\n\t\t\t\t\tarray.push( sourceArray[ index ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar sourceArray = source.array;\r\n\t\t\tvar sourceStride = source.stride;\r\n\r\n\t\t\tif ( primitive.vcount !== undefined ) {\r\n\r\n\t\t\t\tvar index = 0;\r\n\r\n\t\t\t\tfor ( var i = 0, l = vcount.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\tvar count = vcount[ i ];\r\n\r\n\t\t\t\t\tif ( count === 4 ) {\r\n\r\n\t\t\t\t\t\tvar a = index + stride * 0;\r\n\t\t\t\t\t\tvar b = index + stride * 1;\r\n\t\t\t\t\t\tvar c = index + stride * 2;\r\n\t\t\t\t\t\tvar d = index + stride * 3;\r\n\r\n\t\t\t\t\t\tpushVector( a ); pushVector( b ); pushVector( d );\r\n\t\t\t\t\t\tpushVector( b ); pushVector( c ); pushVector( d );\r\n\r\n\t\t\t\t\t} else if ( count === 3 ) {\r\n\r\n\t\t\t\t\t\tvar a = index + stride * 0;\r\n\t\t\t\t\t\tvar b = index + stride * 1;\r\n\t\t\t\t\t\tvar c = index + stride * 2;\r\n\r\n\t\t\t\t\t\tpushVector( a ); pushVector( b ); pushVector( c );\r\n\r\n\t\t\t\t\t} else if ( count > 4 ) {\r\n\r\n\t\t\t\t\t\tfor ( var k = 1, kl = ( count - 2 ); k <= kl; k ++ ) {\r\n\r\n\t\t\t\t\t\t\tvar a = index + stride * 0;\r\n\t\t\t\t\t\t\tvar b = index + stride * k;\r\n\t\t\t\t\t\t\tvar c = index + stride * ( k + 1 );\r\n\r\n\t\t\t\t\t\t\tpushVector( a ); pushVector( b ); pushVector( c );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tindex += stride * count;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tfor ( var i = 0, l = indices.length; i < l; i += stride ) {\r\n\r\n\t\t\t\t\tpushVector( i );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction getGeometry( id ) {\r\n\r\n\t\t\treturn getBuild( library.geometries[ id ], buildGeometry );\r\n\r\n\t\t}\r\n\r\n\t\t// kinematics\r\n\r\n\t\tfunction parseKinematicsModel( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\r\n\t\t\t\tjoints: {},\r\n\t\t\t\tlinks: []\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'technique_common':\r\n\t\t\t\t\t\tparseKinematicsTechniqueCommon( child, data );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlibrary.kinematicsModels[ xml.getAttribute( 'id' ) ] = data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildKinematicsModel( data ) {\r\n\r\n\t\t\tif ( data.build !== undefined ) return data.build;\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getKinematicsModel( id ) {\r\n\r\n\t\t\treturn getBuild( library.kinematicsModels[ id ], buildKinematicsModel );\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseKinematicsTechniqueCommon( xml, data ) {\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'joint':\r\n\t\t\t\t\t\tdata.joints[ child.getAttribute( 'sid' ) ] = parseKinematicsJoint( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'link':\r\n\t\t\t\t\t\tdata.links.push( parseKinematicsLink( child ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseKinematicsJoint( xml ) {\r\n\r\n\t\t\tvar data;\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'prismatic':\r\n\t\t\t\t\tcase 'revolute':\r\n\t\t\t\t\t\tdata = parseKinematicsJointParameter( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseKinematicsJointParameter( xml, data ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tsid: xml.getAttribute( 'sid' ),\r\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\r\n\t\t\t\taxis: new Vector3(),\r\n\t\t\t\tlimits: {\r\n\t\t\t\t\tmin: 0,\r\n\t\t\t\t\tmax: 0\r\n\t\t\t\t},\r\n\t\t\t\ttype: xml.nodeName,\r\n\t\t\t\tstatic: false,\r\n\t\t\t\tzeroPosition: 0,\r\n\t\t\t\tmiddlePosition: 0\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'axis':\r\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\r\n\t\t\t\t\t\tdata.axis.fromArray( array );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'limits':\r\n\t\t\t\t\t\tvar max = child.getElementsByTagName( 'max' )[ 0 ];\r\n\t\t\t\t\t\tvar min = child.getElementsByTagName( 'min' )[ 0 ];\r\n\r\n\t\t\t\t\t\tdata.limits.max = parseFloat( max.textContent );\r\n\t\t\t\t\t\tdata.limits.min = parseFloat( min.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// if min is equal to or greater than max, consider the joint static\r\n\r\n\t\t\tif ( data.limits.min >= data.limits.max ) {\r\n\r\n\t\t\t\tdata.static = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// calculate middle position\r\n\r\n\t\t\tdata.middlePosition = ( data.limits.min + data.limits.max ) / 2.0;\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseKinematicsLink( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tsid: xml.getAttribute( 'sid' ),\r\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\r\n\t\t\t\tattachments: [],\r\n\t\t\t\ttransforms: []\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'attachment_full':\r\n\t\t\t\t\t\tdata.attachments.push( parseKinematicsAttachment( child ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'matrix':\r\n\t\t\t\t\tcase 'translate':\r\n\t\t\t\t\tcase 'rotate':\r\n\t\t\t\t\t\tdata.transforms.push( parseKinematicsTransform( child ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseKinematicsAttachment( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tjoint: xml.getAttribute( 'joint' ).split( '/' ).pop(),\r\n\t\t\t\ttransforms: [],\r\n\t\t\t\tlinks: []\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'link':\r\n\t\t\t\t\t\tdata.links.push( parseKinematicsLink( child ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'matrix':\r\n\t\t\t\t\tcase 'translate':\r\n\t\t\t\t\tcase 'rotate':\r\n\t\t\t\t\t\tdata.transforms.push( parseKinematicsTransform( child ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseKinematicsTransform( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\ttype: xml.nodeName\r\n\t\t\t};\r\n\r\n\t\t\tvar array = parseFloats( xml.textContent );\r\n\r\n\t\t\tswitch ( data.type ) {\r\n\r\n\t\t\t\tcase 'matrix':\r\n\t\t\t\t\tdata.obj = new Matrix4();\r\n\t\t\t\t\tdata.obj.fromArray( array ).transpose();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'translate':\r\n\t\t\t\t\tdata.obj = new Vector3();\r\n\t\t\t\t\tdata.obj.fromArray( array );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'rotate':\r\n\t\t\t\t\tdata.obj = new Vector3();\r\n\t\t\t\t\tdata.obj.fromArray( array );\r\n\t\t\t\t\tdata.angle = MathUtils.degToRad( array[ 3 ] );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\t// physics\r\n\r\n\t\tfunction parsePhysicsModel( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\r\n\t\t\t\trigidBodies: {}\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'rigid_body':\r\n\t\t\t\t\t\tdata.rigidBodies[ child.getAttribute( 'name' ) ] = {};\r\n\t\t\t\t\t\tparsePhysicsRigidBody( child, data.rigidBodies[ child.getAttribute( 'name' ) ] );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlibrary.physicsModels[ xml.getAttribute( 'id' ) ] = data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parsePhysicsRigidBody( xml, data ) {\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'technique_common':\r\n\t\t\t\t\t\tparsePhysicsTechniqueCommon( child, data );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction parsePhysicsTechniqueCommon( xml, data ) {\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'inertia':\r\n\t\t\t\t\t\tdata.inertia = parseFloats( child.textContent );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'mass':\r\n\t\t\t\t\t\tdata.mass = parseFloats( child.textContent )[ 0 ];\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// scene\r\n\r\n\t\tfunction parseKinematicsScene( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tbindJointAxis: []\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'bind_joint_axis':\r\n\t\t\t\t\t\tdata.bindJointAxis.push( parseKinematicsBindJointAxis( child ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlibrary.kinematicsScenes[ parseId( xml.getAttribute( 'url' ) ) ] = data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseKinematicsBindJointAxis( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\ttarget: xml.getAttribute( 'target' ).split( '/' ).pop()\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'axis':\r\n\t\t\t\t\t\tvar param = child.getElementsByTagName( 'param' )[ 0 ];\r\n\t\t\t\t\t\tdata.axis = param.textContent;\r\n\t\t\t\t\t\tvar tmpJointIndex = data.axis.split( 'inst_' ).pop().split( 'axis' )[ 0 ];\r\n\t\t\t\t\t\tdata.jointIndex = tmpJointIndex.substr( 0, tmpJointIndex.length - 1 );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildKinematicsScene( data ) {\r\n\r\n\t\t\tif ( data.build !== undefined ) return data.build;\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getKinematicsScene( id ) {\r\n\r\n\t\t\treturn getBuild( library.kinematicsScenes[ id ], buildKinematicsScene );\r\n\r\n\t\t}\r\n\r\n\t\tfunction setupKinematics() {\r\n\r\n\t\t\tvar kinematicsModelId = Object.keys( library.kinematicsModels )[ 0 ];\r\n\t\t\tvar kinematicsSceneId = Object.keys( library.kinematicsScenes )[ 0 ];\r\n\t\t\tvar visualSceneId = Object.keys( library.visualScenes )[ 0 ];\r\n\r\n\t\t\tif ( kinematicsModelId === undefined || kinematicsSceneId === undefined ) return;\r\n\r\n\t\t\tvar kinematicsModel = getKinematicsModel( kinematicsModelId );\r\n\t\t\tvar kinematicsScene = getKinematicsScene( kinematicsSceneId );\r\n\t\t\tvar visualScene = getVisualScene( visualSceneId );\r\n\r\n\t\t\tvar bindJointAxis = kinematicsScene.bindJointAxis;\r\n\t\t\tvar jointMap = {};\r\n\r\n\t\t\tfor ( var i = 0, l = bindJointAxis.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar axis = bindJointAxis[ i ];\r\n\r\n\t\t\t\t// the result of the following query is an element of type 'translate', 'rotate','scale' or 'matrix'\r\n\r\n\t\t\t\tvar targetElement = collada.querySelector( '[sid=\"' + axis.target + '\"]' );\r\n\r\n\t\t\t\tif ( targetElement ) {\r\n\r\n\t\t\t\t\t// get the parent of the transform element\r\n\r\n\t\t\t\t\tvar parentVisualElement = targetElement.parentElement;\r\n\r\n\t\t\t\t\t// connect the joint of the kinematics model with the element in the visual scene\r\n\r\n\t\t\t\t\tconnect( axis.jointIndex, parentVisualElement );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction connect( jointIndex, visualElement ) {\r\n\r\n\t\t\t\tvar visualElementName = visualElement.getAttribute( 'name' );\r\n\t\t\t\tvar joint = kinematicsModel.joints[ jointIndex ];\r\n\r\n\t\t\t\tvisualScene.traverse( function ( object ) {\r\n\r\n\t\t\t\t\tif ( object.name === visualElementName ) {\r\n\r\n\t\t\t\t\t\tjointMap[ jointIndex ] = {\r\n\t\t\t\t\t\t\tobject: object,\r\n\t\t\t\t\t\t\ttransforms: buildTransformList( visualElement ),\r\n\t\t\t\t\t\t\tjoint: joint,\r\n\t\t\t\t\t\t\tposition: joint.zeroPosition\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar m0 = new Matrix4();\r\n\r\n\t\t\tkinematics = {\r\n\r\n\t\t\t\tjoints: kinematicsModel && kinematicsModel.joints,\r\n\r\n\t\t\t\tgetJointValue: function ( jointIndex ) {\r\n\r\n\t\t\t\t\tvar jointData = jointMap[ jointIndex ];\r\n\r\n\t\t\t\t\tif ( jointData ) {\r\n\r\n\t\t\t\t\t\treturn jointData.position;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Joint ' + jointIndex + ' doesn\\'t exist.' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t},\r\n\r\n\t\t\t\tsetJointValue: function ( jointIndex, value ) {\r\n\r\n\t\t\t\t\tvar jointData = jointMap[ jointIndex ];\r\n\r\n\t\t\t\t\tif ( jointData ) {\r\n\r\n\t\t\t\t\t\tvar joint = jointData.joint;\r\n\r\n\t\t\t\t\t\tif ( value > joint.limits.max || value < joint.limits.min ) {\r\n\r\n\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Joint ' + jointIndex + ' value ' + value + ' outside of limits (min: ' + joint.limits.min + ', max: ' + joint.limits.max + ').' );\r\n\r\n\t\t\t\t\t\t} else if ( joint.static ) {\r\n\r\n\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Joint ' + jointIndex + ' is static.' );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tvar object = jointData.object;\r\n\t\t\t\t\t\t\tvar axis = joint.axis;\r\n\t\t\t\t\t\t\tvar transforms = jointData.transforms;\r\n\r\n\t\t\t\t\t\t\tmatrix.identity();\r\n\r\n\t\t\t\t\t\t\t// each update, we have to apply all transforms in the correct order\r\n\r\n\t\t\t\t\t\t\tfor ( var i = 0; i < transforms.length; i ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tvar transform = transforms[ i ];\r\n\r\n\t\t\t\t\t\t\t\t// if there is a connection of the transform node with a joint, apply the joint value\r\n\r\n\t\t\t\t\t\t\t\tif ( transform.sid && transform.sid.indexOf( jointIndex ) !== - 1 ) {\r\n\r\n\t\t\t\t\t\t\t\t\tswitch ( joint.type ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tcase 'revolute':\r\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeRotationAxis( axis, MathUtils.degToRad( value ) ) );\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\t\tcase 'prismatic':\r\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeTranslation( axis.x * value, axis.y * value, axis.z * value ) );\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Unknown joint type: ' + joint.type );\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\t\tswitch ( transform.type ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tcase 'matrix':\r\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( transform.obj );\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\t\tcase 'translate':\r\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeTranslation( transform.obj.x, transform.obj.y, transform.obj.z ) );\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\t\tcase 'scale':\r\n\t\t\t\t\t\t\t\t\t\t\tmatrix.scale( transform.obj );\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\t\tcase 'rotate':\r\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeRotationAxis( transform.obj, transform.angle ) );\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tobject.matrix.copy( matrix );\r\n\t\t\t\t\t\t\tobject.matrix.decompose( object.position, object.quaternion, object.scale );\r\n\r\n\t\t\t\t\t\t\tjointMap[ jointIndex ].position = value;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tconsole.log( 'THREE.ColladaLoader: ' + jointIndex + ' does not exist.' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildTransformList( node ) {\r\n\r\n\t\t\tvar transforms = [];\r\n\r\n\t\t\tvar xml = collada.querySelector( '[id=\"' + node.id + '\"]' );\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'matrix':\r\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\r\n\t\t\t\t\t\tvar matrix = new Matrix4().fromArray( array ).transpose();\r\n\t\t\t\t\t\ttransforms.push( {\r\n\t\t\t\t\t\t\tsid: child.getAttribute( 'sid' ),\r\n\t\t\t\t\t\t\ttype: child.nodeName,\r\n\t\t\t\t\t\t\tobj: matrix\r\n\t\t\t\t\t\t} );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'translate':\r\n\t\t\t\t\tcase 'scale':\r\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\r\n\t\t\t\t\t\tvar vector = new Vector3().fromArray( array );\r\n\t\t\t\t\t\ttransforms.push( {\r\n\t\t\t\t\t\t\tsid: child.getAttribute( 'sid' ),\r\n\t\t\t\t\t\t\ttype: child.nodeName,\r\n\t\t\t\t\t\t\tobj: vector\r\n\t\t\t\t\t\t} );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'rotate':\r\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\r\n\t\t\t\t\t\tvar vector = new Vector3().fromArray( array );\r\n\t\t\t\t\t\tvar angle = MathUtils.degToRad( array[ 3 ] );\r\n\t\t\t\t\t\ttransforms.push( {\r\n\t\t\t\t\t\t\tsid: child.getAttribute( 'sid' ),\r\n\t\t\t\t\t\t\ttype: child.nodeName,\r\n\t\t\t\t\t\t\tobj: vector,\r\n\t\t\t\t\t\t\tangle: angle\r\n\t\t\t\t\t\t} );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn transforms;\r\n\r\n\t\t}\r\n\r\n\t\t// nodes\r\n\r\n\t\tfunction prepareNodes( xml ) {\r\n\r\n\t\t\tvar elements = xml.getElementsByTagName( 'node' );\r\n\r\n\t\t\t// ensure all node elements have id attributes\r\n\r\n\t\t\tfor ( var i = 0; i < elements.length; i ++ ) {\r\n\r\n\t\t\t\tvar element = elements[ i ];\r\n\r\n\t\t\t\tif ( element.hasAttribute( 'id' ) === false ) {\r\n\r\n\t\t\t\t\telement.setAttribute( 'id', generateId() );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar matrix = new Matrix4();\r\n\t\tvar vector = new Vector3();\r\n\r\n\t\tfunction parseNode( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\r\n\t\t\t\ttype: xml.getAttribute( 'type' ),\r\n\t\t\t\tid: xml.getAttribute( 'id' ),\r\n\t\t\t\tsid: xml.getAttribute( 'sid' ),\r\n\t\t\t\tmatrix: new Matrix4(),\r\n\t\t\t\tnodes: [],\r\n\t\t\t\tinstanceCameras: [],\r\n\t\t\t\tinstanceControllers: [],\r\n\t\t\t\tinstanceLights: [],\r\n\t\t\t\tinstanceGeometries: [],\r\n\t\t\t\tinstanceNodes: [],\r\n\t\t\t\ttransforms: {}\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'node':\r\n\t\t\t\t\t\tdata.nodes.push( child.getAttribute( 'id' ) );\r\n\t\t\t\t\t\tparseNode( child );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'instance_camera':\r\n\t\t\t\t\t\tdata.instanceCameras.push( parseId( child.getAttribute( 'url' ) ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'instance_controller':\r\n\t\t\t\t\t\tdata.instanceControllers.push( parseNodeInstance( child ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'instance_light':\r\n\t\t\t\t\t\tdata.instanceLights.push( parseId( child.getAttribute( 'url' ) ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'instance_geometry':\r\n\t\t\t\t\t\tdata.instanceGeometries.push( parseNodeInstance( child ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'instance_node':\r\n\t\t\t\t\t\tdata.instanceNodes.push( parseId( child.getAttribute( 'url' ) ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'matrix':\r\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\r\n\t\t\t\t\t\tdata.matrix.multiply( matrix.fromArray( array ).transpose() );\r\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'translate':\r\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\r\n\t\t\t\t\t\tvector.fromArray( array );\r\n\t\t\t\t\t\tdata.matrix.multiply( matrix.makeTranslation( vector.x, vector.y, vector.z ) );\r\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'rotate':\r\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\r\n\t\t\t\t\t\tvar angle = MathUtils.degToRad( array[ 3 ] );\r\n\t\t\t\t\t\tdata.matrix.multiply( matrix.makeRotationAxis( vector.fromArray( array ), angle ) );\r\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'scale':\r\n\t\t\t\t\t\tvar array = parseFloats( child.textContent );\r\n\t\t\t\t\t\tdata.matrix.scale( vector.fromArray( array ) );\r\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'extra':\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.log( child );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasNode( data.id ) ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.', data.id );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tlibrary.nodes[ data.id ] = data;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseNodeInstance( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tid: parseId( xml.getAttribute( 'url' ) ),\r\n\t\t\t\tmaterials: {},\r\n\t\t\t\tskeletons: []\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = xml.childNodes[ i ];\r\n\r\n\t\t\t\tswitch ( child.nodeName ) {\r\n\r\n\t\t\t\t\tcase 'bind_material':\r\n\t\t\t\t\t\tvar instances = child.getElementsByTagName( 'instance_material' );\r\n\r\n\t\t\t\t\t\tfor ( var j = 0; j < instances.length; j ++ ) {\r\n\r\n\t\t\t\t\t\t\tvar instance = instances[ j ];\r\n\t\t\t\t\t\t\tvar symbol = instance.getAttribute( 'symbol' );\r\n\t\t\t\t\t\t\tvar target = instance.getAttribute( 'target' );\r\n\r\n\t\t\t\t\t\t\tdata.materials[ symbol ] = parseId( target );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'skeleton':\r\n\t\t\t\t\t\tdata.skeletons.push( parseId( child.textContent ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildSkeleton( skeletons, joints ) {\r\n\r\n\t\t\tvar boneData = [];\r\n\t\t\tvar sortedBoneData = [];\r\n\r\n\t\t\tvar i, j, data;\r\n\r\n\t\t\t// a skeleton can have multiple root bones. collada expresses this\r\n\t\t\t// situtation with multiple \"skeleton\" tags per controller instance\r\n\r\n\t\t\tfor ( i = 0; i < skeletons.length; i ++ ) {\r\n\r\n\t\t\t\tvar skeleton = skeletons[ i ];\r\n\r\n\t\t\t\tvar root;\r\n\r\n\t\t\t\tif ( hasNode( skeleton ) ) {\r\n\r\n\t\t\t\t\troot = getNode( skeleton );\r\n\t\t\t\t\tbuildBoneHierarchy( root, joints, boneData );\r\n\r\n\t\t\t\t} else if ( hasVisualScene( skeleton ) ) {\r\n\r\n\t\t\t\t\t// handle case where the skeleton refers to the visual scene (#13335)\r\n\r\n\t\t\t\t\tvar visualScene = library.visualScenes[ skeleton ];\r\n\t\t\t\t\tvar children = visualScene.children;\r\n\r\n\t\t\t\t\tfor ( var j = 0; j < children.length; j ++ ) {\r\n\r\n\t\t\t\t\t\tvar child = children[ j ];\r\n\r\n\t\t\t\t\t\tif ( child.type === 'JOINT' ) {\r\n\r\n\t\t\t\t\t\t\tvar root = getNode( child.id );\r\n\t\t\t\t\t\t\tbuildBoneHierarchy( root, joints, boneData );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.error( 'THREE.ColladaLoader: Unable to find root bone of skeleton with ID:', skeleton );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// sort bone data (the order is defined in the corresponding controller)\r\n\r\n\t\t\tfor ( i = 0; i < joints.length; i ++ ) {\r\n\r\n\t\t\t\tfor ( j = 0; j < boneData.length; j ++ ) {\r\n\r\n\t\t\t\t\tdata = boneData[ j ];\r\n\r\n\t\t\t\t\tif ( data.bone.name === joints[ i ].name ) {\r\n\r\n\t\t\t\t\t\tsortedBoneData[ i ] = data;\r\n\t\t\t\t\t\tdata.processed = true;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// add unprocessed bone data at the end of the list\r\n\r\n\t\t\tfor ( i = 0; i < boneData.length; i ++ ) {\r\n\r\n\t\t\t\tdata = boneData[ i ];\r\n\r\n\t\t\t\tif ( data.processed === false ) {\r\n\r\n\t\t\t\t\tsortedBoneData.push( data );\r\n\t\t\t\t\tdata.processed = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// setup arrays for skeleton creation\r\n\r\n\t\t\tvar bones = [];\r\n\t\t\tvar boneInverses = [];\r\n\r\n\t\t\tfor ( i = 0; i < sortedBoneData.length; i ++ ) {\r\n\r\n\t\t\t\tdata = sortedBoneData[ i ];\r\n\r\n\t\t\t\tbones.push( data.bone );\r\n\t\t\t\tboneInverses.push( data.boneInverse );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn new Skeleton( bones, boneInverses );\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildBoneHierarchy( root, joints, boneData ) {\r\n\r\n\t\t\t// setup bone data from visual scene\r\n\r\n\t\t\troot.traverse( function ( object ) {\r\n\r\n\t\t\t\tif ( object.isBone === true ) {\r\n\r\n\t\t\t\t\tvar boneInverse;\r\n\r\n\t\t\t\t\t// retrieve the boneInverse from the controller data\r\n\r\n\t\t\t\t\tfor ( var i = 0; i < joints.length; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar joint = joints[ i ];\r\n\r\n\t\t\t\t\t\tif ( joint.name === object.name ) {\r\n\r\n\t\t\t\t\t\t\tboneInverse = joint.boneInverse;\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( boneInverse === undefined ) {\r\n\r\n\t\t\t\t\t\t// Unfortunately, there can be joints in the visual scene that are not part of the\r\n\t\t\t\t\t\t// corresponding controller. In this case, we have to create a dummy boneInverse matrix\r\n\t\t\t\t\t\t// for the respective bone. This bone won't affect any vertices, because there are no skin indices\r\n\t\t\t\t\t\t// and weights defined for it. But we still have to add the bone to the sorted bone list in order to\r\n\t\t\t\t\t\t// ensure a correct animation of the model.\r\n\r\n\t\t\t\t\t\tboneInverse = new Matrix4();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tboneData.push( { bone: object, boneInverse: boneInverse, processed: false } );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildNode( data ) {\r\n\r\n\t\t\tvar objects = [];\r\n\r\n\t\t\tvar matrix = data.matrix;\r\n\t\t\tvar nodes = data.nodes;\r\n\t\t\tvar type = data.type;\r\n\t\t\tvar instanceCameras = data.instanceCameras;\r\n\t\t\tvar instanceControllers = data.instanceControllers;\r\n\t\t\tvar instanceLights = data.instanceLights;\r\n\t\t\tvar instanceGeometries = data.instanceGeometries;\r\n\t\t\tvar instanceNodes = data.instanceNodes;\r\n\r\n\t\t\t// nodes\r\n\r\n\t\t\tfor ( var i = 0, l = nodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tobjects.push( getNode( nodes[ i ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// instance cameras\r\n\r\n\t\t\tfor ( var i = 0, l = instanceCameras.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar instanceCamera = getCamera( instanceCameras[ i ] );\r\n\r\n\t\t\t\tif ( instanceCamera !== null ) {\r\n\r\n\t\t\t\t\tobjects.push( instanceCamera.clone() );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// instance controllers\r\n\r\n\t\t\tfor ( var i = 0, l = instanceControllers.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar instance = instanceControllers[ i ];\r\n\t\t\t\tvar controller = getController( instance.id );\r\n\t\t\t\tvar geometries = getGeometry( controller.id );\r\n\t\t\t\tvar newObjects = buildObjects( geometries, instance.materials );\r\n\r\n\t\t\t\tvar skeletons = instance.skeletons;\r\n\t\t\t\tvar joints = controller.skin.joints;\r\n\r\n\t\t\t\tvar skeleton = buildSkeleton( skeletons, joints );\r\n\r\n\t\t\t\tfor ( var j = 0, jl = newObjects.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tvar object = newObjects[ j ];\r\n\r\n\t\t\t\t\tif ( object.isSkinnedMesh ) {\r\n\r\n\t\t\t\t\t\tobject.bind( skeleton, controller.skin.bindMatrix );\r\n\t\t\t\t\t\tobject.normalizeSkinWeights();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tobjects.push( object );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// instance lights\r\n\r\n\t\t\tfor ( var i = 0, l = instanceLights.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar instanceLight = getLight( instanceLights[ i ] );\r\n\r\n\t\t\t\tif ( instanceLight !== null ) {\r\n\r\n\t\t\t\t\tobjects.push( instanceLight.clone() );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// instance geometries\r\n\r\n\t\t\tfor ( var i = 0, l = instanceGeometries.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar instance = instanceGeometries[ i ];\r\n\r\n\t\t\t\t// a single geometry instance in collada can lead to multiple object3Ds.\r\n\t\t\t\t// this is the case when primitives are combined like triangles and lines\r\n\r\n\t\t\t\tvar geometries = getGeometry( instance.id );\r\n\t\t\t\tvar newObjects = buildObjects( geometries, instance.materials );\r\n\r\n\t\t\t\tfor ( var j = 0, jl = newObjects.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tobjects.push( newObjects[ j ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// instance nodes\r\n\r\n\t\t\tfor ( var i = 0, l = instanceNodes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tobjects.push( getNode( instanceNodes[ i ] ).clone() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar object;\r\n\r\n\t\t\tif ( nodes.length === 0 && objects.length === 1 ) {\r\n\r\n\t\t\t\tobject = objects[ 0 ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tobject = ( type === 'JOINT' ) ? new Bone() : new Group();\r\n\r\n\t\t\t\tfor ( var i = 0; i < objects.length; i ++ ) {\r\n\r\n\t\t\t\t\tobject.add( objects[ i ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tobject.name = ( type === 'JOINT' ) ? data.sid : data.name;\r\n\t\t\tobject.matrix.copy( matrix );\r\n\t\t\tobject.matrix.decompose( object.position, object.quaternion, object.scale );\r\n\r\n\t\t\treturn object;\r\n\r\n\t\t}\r\n\r\n\t\tvar fallbackMaterial = new MeshBasicMaterial( { color: 0xff00ff } );\r\n\r\n\t\tfunction resolveMaterialBinding( keys, instanceMaterials ) {\r\n\r\n\t\t\tvar materials = [];\r\n\r\n\t\t\tfor ( var i = 0, l = keys.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar id = instanceMaterials[ keys[ i ] ];\r\n\r\n\t\t\t\tif ( id === undefined ) {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Material with key %s not found. Apply fallback material.', keys[ i ] );\r\n\t\t\t\t\tmaterials.push( fallbackMaterial );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tmaterials.push( getMaterial( id ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn materials;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildObjects( geometries, instanceMaterials ) {\r\n\r\n\t\t\tvar objects = [];\r\n\r\n\t\t\tfor ( var type in geometries ) {\r\n\r\n\t\t\t\tvar geometry = geometries[ type ];\r\n\r\n\t\t\t\tvar materials = resolveMaterialBinding( geometry.materialKeys, instanceMaterials );\r\n\r\n\t\t\t\t// handle case if no materials are defined\r\n\r\n\t\t\t\tif ( materials.length === 0 ) {\r\n\r\n\t\t\t\t\tif ( type === 'lines' || type === 'linestrips' ) {\r\n\r\n\t\t\t\t\t\tmaterials.push( new LineBasicMaterial() );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tmaterials.push( new MeshPhongMaterial() );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// regard skinning\r\n\r\n\t\t\t\tvar skinning = ( geometry.data.attributes.skinIndex !== undefined );\r\n\r\n\t\t\t\tif ( skinning ) {\r\n\r\n\t\t\t\t\tfor ( var i = 0, l = materials.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\t\tmaterials[ i ].skinning = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// choose between a single or multi materials (material array)\r\n\r\n\t\t\t\tvar material = ( materials.length === 1 ) ? materials[ 0 ] : materials;\r\n\r\n\t\t\t\t// now create a specific 3D object\r\n\r\n\t\t\t\tvar object;\r\n\r\n\t\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\t\tcase 'lines':\r\n\t\t\t\t\t\tobject = new LineSegments( geometry.data, material );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'linestrips':\r\n\t\t\t\t\t\tobject = new Line( geometry.data, material );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'triangles':\r\n\t\t\t\t\tcase 'polylist':\r\n\t\t\t\t\t\tif ( skinning ) {\r\n\r\n\t\t\t\t\t\t\tobject = new SkinnedMesh( geometry.data, material );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tobject = new Mesh( geometry.data, material );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tobjects.push( object );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn objects;\r\n\r\n\t\t}\r\n\r\n\t\tfunction hasNode( id ) {\r\n\r\n\t\t\treturn library.nodes[ id ] !== undefined;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getNode( id ) {\r\n\r\n\t\t\treturn getBuild( library.nodes[ id ], buildNode );\r\n\r\n\t\t}\r\n\r\n\t\t// visual scenes\r\n\r\n\t\tfunction parseVisualScene( xml ) {\r\n\r\n\t\t\tvar data = {\r\n\t\t\t\tname: xml.getAttribute( 'name' ),\r\n\t\t\t\tchildren: []\r\n\t\t\t};\r\n\r\n\t\t\tprepareNodes( xml );\r\n\r\n\t\t\tvar elements = getElementsByTagName( xml, 'node' );\r\n\r\n\t\t\tfor ( var i = 0; i < elements.length; i ++ ) {\r\n\r\n\t\t\t\tdata.children.push( parseNode( elements[ i ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlibrary.visualScenes[ xml.getAttribute( 'id' ) ] = data;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildVisualScene( data ) {\r\n\r\n\t\t\tvar group = new Group();\r\n\t\t\tgroup.name = data.name;\r\n\r\n\t\t\tvar children = data.children;\r\n\r\n\t\t\tfor ( var i = 0; i < children.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = children[ i ];\r\n\r\n\t\t\t\tgroup.add( getNode( child.id ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn group;\r\n\r\n\t\t}\r\n\r\n\t\tfunction hasVisualScene( id ) {\r\n\r\n\t\t\treturn library.visualScenes[ id ] !== undefined;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getVisualScene( id ) {\r\n\r\n\t\t\treturn getBuild( library.visualScenes[ id ], buildVisualScene );\r\n\r\n\t\t}\r\n\r\n\t\t// scenes\r\n\r\n\t\tfunction parseScene( xml ) {\r\n\r\n\t\t\tvar instance = getElementsByTagName( xml, 'instance_visual_scene' )[ 0 ];\r\n\t\t\treturn getVisualScene( parseId( instance.getAttribute( 'url' ) ) );\r\n\r\n\t\t}\r\n\r\n\t\tfunction setupAnimations() {\r\n\r\n\t\t\tvar clips = library.clips;\r\n\r\n\t\t\tif ( isEmpty( clips ) === true ) {\r\n\r\n\t\t\t\tif ( isEmpty( library.animations ) === false ) {\r\n\r\n\t\t\t\t\t// if there are animations but no clips, we create a default clip for playback\r\n\r\n\t\t\t\t\tvar tracks = [];\r\n\r\n\t\t\t\t\tfor ( var id in library.animations ) {\r\n\r\n\t\t\t\t\t\tvar animationTracks = getAnimation( id );\r\n\r\n\t\t\t\t\t\tfor ( var i = 0, l = animationTracks.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\t\t\ttracks.push( animationTracks[ i ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tanimations.push( new AnimationClip( 'default', - 1, tracks ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tfor ( var id in clips ) {\r\n\r\n\t\t\t\t\tanimations.push( getAnimationClip( id ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// convert the parser error element into text with each child elements text\r\n\t\t// separated by new lines.\r\n\r\n\t\tfunction parserErrorToText( parserError ) {\r\n\r\n\t\t\tvar result = '';\r\n\t\t\tvar stack = [ parserError ];\r\n\r\n\t\t\twhile ( stack.length ) {\r\n\r\n\t\t\t\tvar node = stack.shift();\r\n\r\n\t\t\t\tif ( node.nodeType === Node.TEXT_NODE ) {\r\n\r\n\t\t\t\t\tresult += node.textContent;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tresult += '\\n';\r\n\t\t\t\t\tstack.push.apply( stack, node.childNodes );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn result.trim();\r\n\r\n\t\t}\r\n\r\n\t\tif ( text.length === 0 ) {\r\n\r\n\t\t\treturn { scene: new Scene() };\r\n\r\n\t\t}\r\n\r\n\t\tvar xml = new DOMParser().parseFromString( text, 'application/xml' );\r\n\r\n\t\tvar collada = getElementsByTagName( xml, 'COLLADA' )[ 0 ];\r\n\r\n\t\tvar parserError = xml.getElementsByTagName( 'parsererror' )[ 0 ];\r\n\t\tif ( parserError !== undefined ) {\r\n\r\n\t\t\t// Chrome will return parser error with a div in it\r\n\r\n\t\t\tvar errorElement = getElementsByTagName( parserError, 'div' )[ 0 ];\r\n\t\t\tvar errorText;\r\n\r\n\t\t\tif ( errorElement ) {\r\n\r\n\t\t\t\terrorText = errorElement.textContent;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\terrorText = parserErrorToText( parserError );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconsole.error( 'THREE.ColladaLoader: Failed to parse collada file.\\n', errorText );\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\t// metadata\r\n\r\n\t\tvar version = collada.getAttribute( 'version' );\r\n\t\tconsole.log( 'THREE.ColladaLoader: File version', version );\r\n\r\n\t\tvar asset = parseAsset( getElementsByTagName( collada, 'asset' )[ 0 ] );\r\n\t\tvar textureLoader = new TextureLoader( this.manager );\r\n\t\ttextureLoader.setPath( this.resourcePath || path ).setCrossOrigin( this.crossOrigin );\r\n\r\n\t\tvar tgaLoader;\r\n\r\n\t\tif ( TGALoader ) {\r\n\r\n\t\t\ttgaLoader = new TGALoader( this.manager );\r\n\t\t\ttgaLoader.setPath( this.resourcePath || path );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tvar animations = [];\r\n\t\tvar kinematics = {};\r\n\t\tvar count = 0;\r\n\r\n\t\t//\r\n\r\n\t\tvar library = {\r\n\t\t\tanimations: {},\r\n\t\t\tclips: {},\r\n\t\t\tcontrollers: {},\r\n\t\t\timages: {},\r\n\t\t\teffects: {},\r\n\t\t\tmaterials: {},\r\n\t\t\tcameras: {},\r\n\t\t\tlights: {},\r\n\t\t\tgeometries: {},\r\n\t\t\tnodes: {},\r\n\t\t\tvisualScenes: {},\r\n\t\t\tkinematicsModels: {},\r\n\t\t\tphysicsModels: {},\r\n\t\t\tkinematicsScenes: {}\r\n\t\t};\r\n\r\n\t\tparseLibrary( collada, 'library_animations', 'animation', parseAnimation );\r\n\t\tparseLibrary( collada, 'library_animation_clips', 'animation_clip', parseAnimationClip );\r\n\t\tparseLibrary( collada, 'library_controllers', 'controller', parseController );\r\n\t\tparseLibrary( collada, 'library_images', 'image', parseImage );\r\n\t\tparseLibrary( collada, 'library_effects', 'effect', parseEffect );\r\n\t\tparseLibrary( collada, 'library_materials', 'material', parseMaterial );\r\n\t\tparseLibrary( collada, 'library_cameras', 'camera', parseCamera );\r\n\t\tparseLibrary( collada, 'library_lights', 'light', parseLight );\r\n\t\tparseLibrary( collada, 'library_geometries', 'geometry', parseGeometry );\r\n\t\tparseLibrary( collada, 'library_nodes', 'node', parseNode );\r\n\t\tparseLibrary( collada, 'library_visual_scenes', 'visual_scene', parseVisualScene );\r\n\t\tparseLibrary( collada, 'library_kinematics_models', 'kinematics_model', parseKinematicsModel );\r\n\t\tparseLibrary( collada, 'library_physics_models', 'physics_model', parsePhysicsModel );\r\n\t\tparseLibrary( collada, 'scene', 'instance_kinematics_scene', parseKinematicsScene );\r\n\r\n\t\tbuildLibrary( library.animations, buildAnimation );\r\n\t\tbuildLibrary( library.clips, buildAnimationClip );\r\n\t\tbuildLibrary( library.controllers, buildController );\r\n\t\tbuildLibrary( library.images, buildImage );\r\n\t\tbuildLibrary( library.effects, buildEffect );\r\n\t\tbuildLibrary( library.materials, buildMaterial );\r\n\t\tbuildLibrary( library.cameras, buildCamera );\r\n\t\tbuildLibrary( library.lights, buildLight );\r\n\t\tbuildLibrary( library.geometries, buildGeometry );\r\n\t\tbuildLibrary( library.visualScenes, buildVisualScene );\r\n\r\n\t\tsetupAnimations();\r\n\t\tsetupKinematics();\r\n\r\n\t\tvar scene = parseScene( getElementsByTagName( collada, 'scene' )[ 0 ] );\r\n\r\n\t\tif ( asset.upAxis === 'Z_UP' ) {\r\n\r\n\t\t\tscene.quaternion.setFromEuler( new Euler( - Math.PI / 2, 0, 0 ) );\r\n\r\n\t\t}\r\n\r\n\t\tscene.scale.multiplyScalar( asset.unit );\r\n\r\n\t\treturn {\r\n\t\t\tanimations: animations,\r\n\t\t\tkinematics: kinematics,\r\n\t\t\tlibrary: library,\r\n\t\t\tscene: scene\r\n\t\t};\r\n\r\n\t}\r\n\r\n} );\r\n\r\nexport { ColladaLoader };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/loaders/ColladaLoader.js","// tween.js 17.3.5 - https://github.com/tweenjs/tween.js\r\nvar _Group=function(){this._tweens={},this._tweensAddedDuringUpdate={}};_Group.prototype={getAll:function(){return Object.keys(this._tweens).map(function(t){return this._tweens[t]}.bind(this))},removeAll:function(){this._tweens={}},add:function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},remove:function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},update:function(t,n){var e=Object.keys(this._tweens);if(0===e.length)return!1;for(t=void 0!==t?t:TWEEN.now();0<e.length;){this._tweensAddedDuringUpdate={};for(var i=0;i<e.length;i++){var r=this._tweens[e[i]];r&&!1===r.update(t)&&(r._isPlaying=!1,n||delete this._tweens[e[i]])}e=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var TWEEN=new _Group;TWEEN.Group=_Group,TWEEN._nextId=0,TWEEN.nextId=function(){return TWEEN._nextId++},\"undefined\"==typeof self&&\"undefined\"!=typeof process&&process.hrtime?TWEEN.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:\"undefined\"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?TWEEN.now=self.performance.now.bind(self.performance):void 0!==Date.now?TWEEN.now=Date.now:TWEEN.now=function(){return(new Date).getTime()},TWEEN.Tween=function(t,n){this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=TWEEN.Easing.Linear.None,this._interpolationFunction=TWEEN.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=n||TWEEN,this._id=TWEEN.nextId()},TWEEN.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(t,n){return this._valuesEnd=Object.create(t),void 0!==n&&(this._duration=n),this},duration:function(t){return this._duration=t,this},start:function(t){for(var n in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==t?\"string\"==typeof t?TWEEN.now()+parseFloat(t):t:TWEEN.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[n]instanceof Array){if(0===this._valuesEnd[n].length)continue;this._valuesEnd[n]=[this._object[n]].concat(this._valuesEnd[n])}void 0!==this._object[n]&&(this._valuesStart[n]=this._object[n],this._valuesStart[n]instanceof Array==!1&&(this._valuesStart[n]*=1),this._valuesStartRepeat[n]=this._valuesStart[n]||0)}return this},stop:function(){return this._isPlaying&&(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens()),this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var t=0,n=this._chainedTweens.length;t<n;t++)this._chainedTweens[t].stop()},group:function(t){return this._group=t,this},delay:function(t){return this._delayTime=t,this},repeat:function(t){return this._repeat=t,this},repeatDelay:function(t){return this._repeatDelayTime=t,this},yoyo:function(t){return this._yoyo=t,this},easing:function(t){return this._easingFunction=t,this},interpolation:function(t){return this._interpolationFunction=t,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(t){return this._onStartCallback=t,this},onUpdate:function(t){return this._onUpdateCallback=t,this},onComplete:function(t){return this._onCompleteCallback=t,this},onStop:function(t){return this._onStopCallback=t,this},update:function(t){var n,e,i;if(t<this._startTime)return!0;for(n in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),e=(t-this._startTime)/this._duration,e=0===this._duration||1<e?1:e,i=this._easingFunction(e),this._valuesEnd)if(void 0!==this._valuesStart[n]){var r=this._valuesStart[n]||0,a=this._valuesEnd[n];a instanceof Array?this._object[n]=this._interpolationFunction(a,i):(\"string\"==typeof a&&(a=\"+\"===a.charAt(0)||\"-\"===a.charAt(0)?r+parseFloat(a):parseFloat(a)),\"number\"==typeof a&&(this._object[n]=r+(a-r)*i))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1!==e)return!0;if(0<this._repeat){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if(\"string\"==typeof this._valuesEnd[n]&&(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo){var s=this._valuesStartRepeat[n];this._valuesStartRepeat[n]=this._valuesEnd[n],this._valuesEnd[n]=s}this._valuesStart[n]=this._valuesStartRepeat[n]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,u=this._chainedTweens.length;o<u;o++)this._chainedTweens[o].start(this._startTime+this._duration);return!1}},TWEEN.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){return t*t*(2.70158*t-1.70158)},Out:function(t){return--t*t*(2.70158*t+1.70158)+1},InOut:function(t){var n=2.5949095;return(t*=2)<1?t*t*((1+n)*t-n)*.5:.5*((t-=2)*t*((1+n)*t+n)+2)}},Bounce:{In:function(t){return 1-TWEEN.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*TWEEN.Easing.Bounce.In(2*t):.5*TWEEN.Easing.Bounce.Out(2*t-1)+.5}}},TWEEN.Interpolation={Linear:function(t,n){var e=t.length-1,i=e*n,r=Math.floor(i),a=TWEEN.Interpolation.Utils.Linear;return n<0?a(t[0],t[1],i):1<n?a(t[e],t[e-1],e-i):a(t[r],t[e<r+1?e:r+1],i-r)},Bezier:function(t,n){for(var e=0,i=t.length-1,r=Math.pow,a=TWEEN.Interpolation.Utils.Bernstein,s=0;s<=i;s++)e+=r(1-n,i-s)*r(n,s)*t[s]*a(i,s);return e},CatmullRom:function(t,n){var e=t.length-1,i=e*n,r=Math.floor(i),a=TWEEN.Interpolation.Utils.CatmullRom;return t[0]===t[e]?(n<0&&(r=Math.floor(i=e*(1+n))),a(t[(r-1+e)%e],t[r],t[(r+1)%e],t[(r+2)%e],i-r)):n<0?t[0]-(a(t[0],t[0],t[1],t[1],-i)-t[0]):1<n?t[e]-(a(t[e],t[e],t[e-1],t[e-1],i-e)-t[e]):a(t[r?r-1:0],t[r],t[e<r+1?e:r+1],t[e<r+2?e:r+2],i-r)},Utils:{Linear:function(t,n,e){return(n-t)*e+t},Bernstein:function(t,n){var e=TWEEN.Interpolation.Utils.Factorial;return e(t)/e(n)/e(t-n)},Factorial:function(){var i=[1];return function(t){var n=1;if(i[t])return i[t];for(var e=t;1<e;e--)n*=e;return i[t]=n}}(),CatmullRom:function(t,n,e,i,r){var a=.5*(e-t),s=.5*(i-n),o=r*r;return(2*n-2*e+a+s)*(r*o)+(-3*n+3*e-2*a-s)*o+a*r+n}}},function(t){\"function\"==typeof define&&define.amd?define([],function(){return TWEEN}):\"undefined\"!=typeof module&&\"object\"==typeof exports?module.exports=TWEEN:void 0!==t&&(t.TWEEN=TWEEN)}(this);\r\nexport {TWEEN};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/libs/tween.module.min.js","<template>\r\n    <div class=\"webglLoaderColladaKnematics-container\">\r\n        <div id=\"info\">\r\n\t\t\t<a href=\"https://threejs.org\" target=\"_blank\" rel=\"noopener\">three.js</a> collada loader - kinematics<br/>\r\n\t\t\trobot from <a href=\"https://github.com/rdiankov/collada_robots\" target=\"_blank\" rel=\"noopener\">collada robots</a>\r\n\t\t</div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { TWEEN } from '@/components/jsm/libs/tween.module.min.js'\r\nimport { ColladaLoader } from '@/components/jsm/loaders/ColladaLoader.js'\r\nexport default {\r\n    data() {\r\n        return {\r\n            container: null,\r\n            stats: null,\r\n            camera: null,\r\n            scene: null,\r\n            renderer: null,\r\n\t\t\tparticleLight: null,\r\n\t\t\tdae: null,\r\n\t\t\tkinematics: null,\r\n\t\t\tkinematicsTween: null,\r\n\t\t\ttweenParameters: {},\r\n\t\t\tloader: null,\r\n        }\r\n    },\r\n    mounted() {\r\n        this.loader = new ColladaLoader()\r\n        // loader.load('./models/collada/kawada-hironx.dae', function (collada) {\r\n        this.loader.load('static/models/collada/abb_irb52_7_120.dae', (collada) => {\r\n            this.dae = collada.scene\r\n            this.dae.traverse(function (child) {\r\n                if (child.isMesh) {\r\n                    // model does not have normals\r\n                    child.material.flatShading = true\r\n                }\r\n            })\r\n            this.dae.scale.x = this.dae.scale.y = this.dae.scale.z = 10.0\r\n            this.dae.updateMatrix()\r\n            this.kinematics = collada.kinematics\r\n            this.init()\r\n            this.animate()\r\n        })\r\n    },\r\n    methods: {\r\n        init() {\r\n            this.container = document.createElement('div')\r\n            document.getElementsByClassName('webglLoaderColladaKnematics-container')[0].appendChild(this.container)\r\n            this.camera = new this.$THREE.PerspectiveCamera(45, this.$webglInnerWidth / window.innerHeight, 1, 2000)\r\n            this.camera.position.set(2, 2, 3)\r\n            this.scene = new this.$THREE.Scene()\r\n            // Grid\r\n            var grid = new this.$THREE.GridHelper(20, 20, 0x888888, 0x444444)\r\n            this.scene.add(grid)\r\n            // Add the COLLADA\r\n            this.scene.add(this.dae)\r\n            this.particleLight = new this.$THREE.Mesh(new this.$THREE.SphereBufferGeometry(4, 8, 8), new this.$THREE.MeshBasicMaterial({ color: 0xffffff }))\r\n            this.scene.add(this.particleLight)\r\n            // Lights\r\n            var light = new this.$THREE.HemisphereLight(0xffeeee, 0x111122)\r\n            this.scene.add(light)\r\n            var pointLight = new this.$THREE.PointLight(0xffffff, 0.3)\r\n            this.particleLight.add(pointLight)\r\n            this.renderer = new this.$THREE.WebGLRenderer()\r\n            this.renderer.setPixelRatio(window.devicePixelRatio)\r\n            this.renderer.setSize(this.$webglInnerWidth, window.innerHeight)\r\n            this.container.appendChild(this.renderer.domElement)\r\n            this.stats = new this.$Stats()\r\n            this.stats.dom.style.left = '280px'\r\n            this.container.appendChild(this.stats.dom)\r\n            this.setupTween()\r\n            //\r\n            window.addEventListener('resize', this.onWindowResize, false)\r\n        },\r\n        setupTween() {\r\n            var duration = this.$THREE.MathUtils.randInt(1000, 5000)\r\n            var target = {}\r\n            for (var prop in this.kinematics.joints) {\r\n                if (this.kinematics.joints.hasOwnProperty(prop)) {\r\n                    if (! this.kinematics.joints[ prop ].static) {\r\n                        var joint = this.kinematics.joints[ prop ]\r\n                        var old = this.tweenParameters[ prop ]\r\n                        var position = old ? old : joint.zeroPosition\r\n                        this.tweenParameters[ prop ] = position\r\n                        target[ prop ] = this.$THREE.MathUtils.randInt(joint.limits.min, joint.limits.max)\r\n                    }\r\n                }\r\n            }\r\n            this.kinematicsTween = new TWEEN.Tween(this.tweenParameters).to(target, duration).easing(TWEEN.Easing.Quadratic.Out)\r\n            this.kinematicsTween.onUpdate((object) => {\r\n                for (var prop in this.kinematics.joints) {\r\n                    if (this.kinematics.joints.hasOwnProperty(prop)) {\r\n                        if (! this.kinematics.joints[ prop ].static) {\r\n                            this.kinematics.setJointValue(prop, object[ prop ])\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n            this.kinematicsTween.start()\r\n            setTimeout(this.setupTween, duration)\r\n        },\r\n        onWindowResize() {\r\n            this.$onWindowResize(this.camera, this.renderer)\r\n        },\r\n        animate() {\r\n            requestAnimationFrame(this.animate)\r\n            this.render()\r\n            this.stats.update()\r\n            TWEEN.update()\r\n        },\r\n        render() {\r\n            var timer = Date.now() * 0.0001\r\n            this.camera.position.x = Math.cos(timer) * 20\r\n            this.camera.position.y = 10\r\n            this.camera.position.z = Math.sin(timer) * 20\r\n            this.camera.lookAt(0, 5, 0)\r\n            this.particleLight.position.x = Math.sin(timer * 4) * 3009\r\n            this.particleLight.position.y = Math.cos(timer * 5) * 4000\r\n            this.particleLight.position.z = Math.cos(timer * 4) * 3009\r\n            this.renderer.render(this.scene, this.camera)\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.webglLoaderColladaKnematics-container {\r\n    width: 100%;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/views/loader/webglLoaderColladaKnematics.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"webglLoaderColladaKnematics-container\"},[_c('div',{attrs:{\"id\":\"info\"}},[_c('a',{attrs:{\"href\":\"https://threejs.org\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"three.js\")]),_vm._v(\" collada loader - kinematics\"),_c('br'),_vm._v(\"\\n\\t\\t\\trobot from \"),_c('a',{attrs:{\"href\":\"https://github.com/rdiankov/collada_robots\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"collada robots\")])])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-112779d2\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/loader/webglLoaderColladaKnematics.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-112779d2\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./webglLoaderColladaKnematics.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglLoaderColladaKnematics.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglLoaderColladaKnematics.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-112779d2\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./webglLoaderColladaKnematics.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-112779d2\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/loader/webglLoaderColladaKnematics.vue\n// module id = null\n// module chunks = ","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/process/browser.js\n// module id = W2nU\n// module chunks = 1 4"],"sourceRoot":""}