webpackJsonp([117],{f9FO:function(t,e){},y2L2:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("wIBv"),r=i("zCdm"),a=i("gu+9"),s={data:function(){return{RADIUS:75,lights:[],State:null,lightBounds:null,container:null,camera:null,scene:null,renderer:null,renderTarget:null,bloom:null,stats:null,controls:null,materials:[],Heads:null,loader:null}},mounted:function(){var t=this;this.$THREE.ShaderChunk.lights_pars_begin+=["","#if defined TILED_FORWARD","uniform vec4 tileData;","uniform sampler2D tileTexture;","uniform sampler2D lightTexture;","#endif"].join("\n"),this.$THREE.ShaderChunk.lights_fragment_end+=["","#if defined TILED_FORWARD","vec2 tUv = floor(gl_FragCoord.xy / tileData.xy * 32.) / 32. + tileData.zw;","vec4 tile = texture2D(tileTexture, tUv);","for (int i=0; i < 4; i++) {","\tfloat tileVal = tile.x * 255.;","  \ttile.xyzw = tile.yzwx;","\tif(tileVal == 0.){ continue; }","  \tfloat tileDiv = 128.;","\tfor (int j=0; j < 8; j++) {","  \t\tif (tileVal < tileDiv) {  tileDiv *= 0.5; continue; }","\t\ttileVal -= tileDiv;","\t\ttileDiv *= 0.5;","  \t\tPointLight pointlight;","\t\tfloat uvx = (float(8 * i + j) + 0.5) / 32.;","  \t\tvec4 lightData = texture2D(lightTexture, vec2(uvx, 0.));","  \t\tvec4 lightColor = texture2D(lightTexture, vec2(uvx, 1.));","  \t\tpointlight.position = lightData.xyz;","  \t\tpointlight.distance = lightData.w;","  \t\tpointlight.color = lightColor.rgb;","  \t\tpointlight.decay = lightColor.a;","  \t\tgetPointDirectLightIrradiance(pointlight, geometry, directLight);","\t\tRE_Direct(directLight, geometry, material, reflectedLight);","\t}","}","#endif"].join("\n"),this.State={rows:0,cols:0,width:0,height:0,tileData:{value:null},tileTexture:{value:null},lightTexture:{value:new this.$THREE.DataTexture(new Float32Array(256),32,2,this.$THREE.RGBAFormat,this.$THREE.FloatType)}},this.lightBounds=function(){var e=new t.$THREE.Vector3;return function(i,n,r){for(var a=t.State.width,s=0,o=t.State.height,h=0,l=t.State.width/2,d=t.State.height/2,u=0;u<8;u++){e.copy(n),e.x+=1&u?r:-r,e.y+=2&u?r:-r,e.z+=4&u?r:-r;var c=e.project(i),f=c.x*l+l,g=c.y*d+d;a=Math.min(a,f),s=Math.max(s,f),o=Math.min(o,g),h=Math.max(h,g)}return[a,s,o,h]}},this.lightBounds(),this.container=document.createElement("div"),document.getElementsByClassName("webglTiledForward-container")[0].appendChild(this.container),this.camera=new this.$THREE.PerspectiveCamera(40,this.$webglInnerWidth/window.innerHeight,1,2e3),this.camera.position.set(0,0,240),this.scene=new this.$THREE.Scene,this.scene.background=new this.$THREE.Color(1118481),this.renderer=new this.$THREE.WebGLRenderer,this.renderer.toneMapping=this.$THREE.NoToneMapping,this.container.appendChild(this.renderer.domElement),this.renderTarget=new this.$THREE.WebGLRenderTarget,this.scene.add(new this.$THREE.AmbientLight(16777215,.33)),this.scene.add(new this.$THREE.PointLight(16711680,.1,.1)),this.bloom=new a.a(new this.$THREE.Vector2(this.$webglInnerWidth,window.innerHeight),.8,.6,.8),this.bloom.renderToScreen=!0,this.stats=new this.$Stats,this.stats.dom.style.left="280px",this.container.appendChild(this.stats.dom),this.controls=new n.a(this.camera,this.renderer.domElement),this.controls.minDistance=120,this.controls.maxDistance=320,this.Heads=[{type:"physical",uniforms:{diffuse:8947848,metalness:1,roughness:.66},defines:{}},{type:"standard",uniforms:{diffuse:6710886,metalness:.1,roughness:.33},defines:{}},{type:"phong",uniforms:{diffuse:7829367,shininess:20},defines:{}},{type:"phong",uniforms:{diffuse:5592405,shininess:10},defines:{TOON:1}}],this.scene.onBeforeRender=this.tileLights,this.scene.onAfterRender=this.postEffect,this.loader=new r.a,this.loader.load("static/models/obj/walt/WaltHead.obj",function(e){var i=e.children[0].geometry;window.addEventListener("resize",t.resize),t.init(i),t.resize(),t.renderer.setAnimationLoop(function(e){t.update(e/1e3),t.stats.begin(),t.renderer.setRenderTarget(t.renderTarget),t.renderer.render(t.scene,t.camera),t.stats.end()})})},methods:{resizeTiles:function(){var t=window.innerWidth-281,e=window.innerHeight;this.State.width=t,this.State.height=e,this.State.cols=Math.ceil(t/32),this.State.rows=Math.ceil(e/32),this.State.tileData.value=[t,e,.5/Math.ceil(t/32),.5/Math.ceil(e/32)],this.State.tileTexture.value=new this.$THREE.DataTexture(new Uint8Array(this.State.cols*this.State.rows*4),this.State.cols,this.State.rows)},tileLights:function(t,e,i){var n=this;if(i.projectionMatrix){var r=this.State.tileTexture.value.image.data,a=this.State.lightTexture.value.image.data,s=i.matrixWorldInverse;r.fill(0);var o=new this.$THREE.Vector3;this.lights.forEach(function(t,e){o.setFromMatrixPosition(t.matrixWorld);var h=n.lightBounds(i,o,t._light.radius);if(o.applyMatrix4(s),o.toArray(a,4*e),a[4*e+3]=t._light.radius,t._light.color.toArray(a,128+4*e),a[128+4*e+3]=t._light.decay,!(h[1]<0||h[0]>n.State.width||h[3]<0||h[2]>n.State.height)){h[0]<0&&(h[0]=0),h[1]>n.State.width&&(h[1]=n.State.width),h[2]<0&&(h[2]=0),h[3]>n.State.height&&(h[3]=n.State.height);for(var l=Math.floor(e/8),d=7-e%8,u=Math.floor(h[2]/32);u<=Math.ceil(h[3]/32);u++)for(var c=Math.floor(h[0]/32);c<=Math.ceil(h[1]/32);c++)r[4*(n.State.cols*u+c)+l]|=1<<d}}),this.State.tileTexture.value.needsUpdate=!0,this.State.lightTexture.value.needsUpdate=!0}},init:function(t){var e=this,i=new this.$THREE.SphereBufferGeometry(.5,32,32),n=Math.round(3*Math.random());Object.keys(this.Heads).forEach(function(r,a){var s=new e.$THREE.Group,o=e.Heads[r],h=e.$THREE.ShaderLib[o.type],l=new e.$THREE.ShaderMaterial({lights:!0,fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:e.$THREE.UniformsUtils.clone(h.uniforms),defines:o.defines,transparent:n===a});for(var d in l.extensions.derivatives=!0,l.uniforms.opacity.value=n===a?.9:1,l.uniforms.tileData=e.State.tileData,l.uniforms.tileTexture=e.State.tileTexture,l.uniforms.lightTexture=e.State.lightTexture,o.uniforms){var u=o.uniforms[d];l.uniforms[d].value.set?l.uniforms[d].value.set(u):l.uniforms[d].value=u}l.defines.TILED_FORWARD=1,e.materials.push(l);var c=new e.$THREE.Mesh(t,l);c.position.y=-37,l.side=n===a?e.$THREE.FrontSide:e.$THREE.DoubleSide,s.rotation.y=a*Math.PI/2,s.position.x=Math.sin(a*Math.PI/2)*e.RADIUS,s.position.z=Math.cos(a*Math.PI/2)*e.RADIUS,s.add(c);for(var f=0;f<8;f++){var g=(new e.$THREE.Color).setHSL(Math.random(),1,.5),m=new e.$THREE.Group;m.add(new e.$THREE.Mesh(i,new e.$THREE.MeshBasicMaterial({color:g}))),m.add(new e.$THREE.Mesh(i,new e.$THREE.MeshBasicMaterial({color:g,transparent:!0,opacity:.033}))),m.children[1].scale.set(6.66,6.66,6.66),m._light={color:g,radius:e.RADIUS,decay:1,sy:Math.random(),sr:Math.random(),sc:Math.random(),py:Math.random()*Math.PI,pr:Math.random()*Math.PI,pc:Math.random()*Math.PI,dir:Math.random()>.5?1:-1},e.lights.push(m),s.add(m)}e.scene.add(s)})},update:function(t){var e=this;this.lights.forEach(function(i){var n=i._light,r=.8+.2*Math.sin(n.pr+(.6+.3*n.sr)*t);i.position.x=Math.sin(n.pc+(.8+.2*n.sc)*t*n.dir)*r*e.RADIUS,i.position.z=Math.cos(n.pc+(.8+.2*n.sc)*t*n.dir)*r*e.RADIUS,i.position.y=Math.sin(n.py+(.8+.2*n.sy)*t)*r*32})},resize:function(){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderTarget.setSize(window.innerWidth-281,window.innerHeight),this.bloom.setSize(window.innerWidth-281,window.innerHeight),this.$onWindowResize(this.camera,this.renderer),this.resizeTiles()},postEffect:function(t){this.bloom.render(t,null,this.renderTarget)}}},o={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"webglTiledForward-container"},[e("div",{attrs:{id:"info"}},[e("a",{attrs:{href:"https://threejs.org",target:"_blank",rel:"noopener"}},[this._v("threejs")]),this._v(" - Tiled forward lighting"),e("br"),this._v("\n\t\t\tCreated by "),e("a",{attrs:{href:"https://github.com/wizgrav",target:"_blank",rel:"noopener"}},[this._v("wizgrav")]),this._v(".\n\t\t")])])}]};var h=i("VU/8")(s,o,!1,function(t){i("f9FO")},"data-v-620106e1",null);e.default=h.exports}});
//# sourceMappingURL=117.9971875f4bf461ec6dfa.js.map