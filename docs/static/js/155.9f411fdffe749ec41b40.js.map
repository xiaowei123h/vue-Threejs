{"version":3,"sources":["webpack:///./src/components/jsm/libs/gunzip.module.min.js","webpack:///./src/components/jsm/misc/VolumeSlice.js","webpack:///./src/components/jsm/misc/Volume.js","webpack:///./src/components/jsm/loaders/NRRDLoader.js","webpack:///./src/components/jsm/loaders/VTKLoader.js","webpack:///src/views/loader/webglLoaderNrrd.vue","webpack:///./src/views/loader/webglLoaderNrrd.vue?e997","webpack:///./src/views/loader/webglLoaderNrrd.vue"],"names":["n","e","q","aa","r","c","a","d","split","b","execScript","length","shift","v","u","Uint8Array","Uint16Array","Uint32Array","DataView","Array","w","x","f","z","A","B","D","g","k","m","p","t","h","l","y","Number","POSITIVE_INFINITY","prototype","getName","this","name","getData","data","H","I","F","E","push","ca","G","i","j","input","o","index","bufferSize","bufferType","resize","Error","J","set","subarray","da","ea","fa","W","ia","K","L","N","O","P","Q","R","ga","ha","U","V","Y","ja","X","Z","call","$","s","slice","buffer","Date","String","fromCharCode","join","C","toString","M","S","T","concat","apply","Zlib","VolumeSlice","volume","axis","Object","defineProperty","get","value","geometryNeedsUpdate","canvas","document","createElement","canvasBuffer","updateGeometry","canvasMap","Texture","minFilter","LinearFilter","wrapS","wrapT","ClampToEdgeWrapping","material","MeshBasicMaterial","map","side","DoubleSide","transparent","mesh","Mesh","geometry","matrixAutoUpdate","repaint","constructor","iLength","jLength","sliceAccess","ctx","ctxBuffer","imgData","getImageData","volumeData","upperThreshold","lowerThreshold","windowLow","windowHigh","pixelCount","dataType","label","colorMap","color","alpha","Math","floor","putImageData","drawImage","width","height","needsUpdate","extracted","extractPerpendicularPlane","matrix","planeWidth","planeHeight","getContext","dispose","PlaneBufferGeometry","identity","applyMatrix4","Volume","xLength","yLength","zLength","type","arrayBuffer","arguments","Int8Array","Int16Array","Int32Array","Float32Array","Float64Array","spacing","offset","Matrix3","Infinity","sliceList","forEach","access","reverseAccess","functionToMap","context","RASIndex","firstSpacing","secondSpacing","positionOffset","IJKIndex","planeMatrix","Matrix4","axisInIJK","Vector3","firstDirection","secondDirection","dimensions","multiply","makeRotationY","PI","RASDimensions","setPosition","makeRotationX","inverseMatrix","normalize","argVar","abs","dot","round","base","iDirection","find","jDirection","kDirection","si","sj","sk","accessI","accessJ","accessK","extractSlice","repaintAllSlices","computeMinMax","min","max","datasize","isNaN","NRRDLoader","manager","Loader","assign","create","load","url","onLoad","onProgress","onError","scope","loader","FileLoader","setPath","path","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","parse","console","error","itemError","_data","_dataPointer","_nativeLittleEndian","_littleEndian","headerObject","_bytes","chunks","undefined","_chunkSize","_array_type","array","chunkSize","u8","byteOffset","byteLength","tmp","flipEndianness","scan","_length","_header","_data_start","parseChars","header","field","fn","lines","_i","_len","match","isNrrd","trim","fieldFunctions","encoding","vectors","spacings","multiplyScalar","parseHeader","inflate","Gunzip","decompress","start","end","number","lengthOfTheResult","sizes","reduce","previous","current","result","__array","resultIndex","parsingFunction","parseInt","parseFloat","parseDataAsText","_copy","min_max","spacingX","spacingY","spacingZ","_spaceX","_spaceY","space","copy","invert","toArray","output","endian","dimension","dim","_ref","_results","space origin","space_origin","space directions","parts","_j","_len2","_results2","VTKLoader","text","Int32Concat","first","second","firstLength","meta","LoaderUtils","decodeText","indexOf","stringFile","Base64toByteArray","b64","placeHolders","arr","Arr","lookup","revLookup","code","len","charCodeAt","parseDataArray","ele","compressed","numBytes","json","attributes","header_type","format","byteData","blocks","cSizeStart","headerSize","dataOffsets","currentOffset","txt","currentBlockSize","content","Inflate","verify","filter","el","idx","dom","window","DOMParser","parseFromString","ActiveXObject","async","loadXML","parseError","reason","srcText","xmlToJson","xml","obj","nodeType","attribute","item","nodeName","nodeValue","hasChildNodes","childNodes","old","documentElement","points","normals","indices","PolyData","piece","Piece","hasOwnProperty","sections","sectionIndex","numberOfSections","section","DataArray","dataArrayIndex","numberOfDataArrays","numberOfPoints","NumberOfPoints","normalsName","Normals","Name","components","NumberOfComponents","numberOfStrips","NumberOfStrips","connectivity","size","indicesIndex","strip","len1","len0","numberOfPolys","NumberOfPolys","connectivityIndex","poly","BufferGeometry","setIndex","BufferAttribute","setAttribute","parseXML","includes","positions","colors","patWord","pat3Floats","patConnectivity","patPOINTS","patPOLYGONS","patTRIANGLE_STRIPS","patPOINT_DATA","patCELL_DATA","patCOLOR_SCALARS","patNORMALS","inPointsSection","inPolygonsSection","inTriangleStripSection","inPointDataSection","inCellDataSection","inColorSection","inNormalsSection","line","dataset","exec","numVertices","inds","i0","i1","i2","nx","ny","nz","Float32BufferAttribute","numTriangles","toNonIndexed","position","count","newColors","parseASCII","pointIndex","state","dataView","vtk","findString","next","parsedString","getFloat32","indexCount","getInt32","parseBinary","webglLoaderNrrd","container","stats","camera","controls","scene","renderer","container2","renderer2","camera2","axes2","scene2","gui","mounted","init","animate","beforeDestroy","hide","methods","_this","$THREE","PerspectiveCamera","$webglInnerWidth","innerHeight","Scene","add","hemiLight","HemisphereLight","dirLight","DirectionalLight","NRRDLoader_NRRDLoader","BoxBufferGeometry","cube","visible","box","BoxHelper","sliceZ","sliceY","sliceX","onChange","vtkmaterial","MeshLambertMaterial","wireframe","morphTargets","VTKLoader_VTKLoader","computeVertexNormals","visibilityControl","render","WebGLRenderer","setPixelRatio","devicePixelRatio","setSize","getElementsByClassName","appendChild","domElement","TrackballControls","minDistance","maxDistance","rotateSpeed","zoomSpeed","panSpeed","$Stats","style","left","dat_gui_module","setupInset","addEventListener","onWindowResize","$onWindowResize","handleResize","requestAnimationFrame","update","sub","target","setLength","lookAt","getElementById","setClearColor","insetWidth","up","AxesHelper","loader_webglLoaderNrrd","$createElement","_self","_c","_m","staticRenderFns","_h","staticClass","attrs","id","href","rel","_v","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":";yFAAyF,SAASA,EAAEC,GAAG,MAAMA,EAAG,IAAIC,OAAE,EAAOC,KAAM,SAASC,EAAEH,EAAEI,GAAG,IAAqFC,EAAjFC,EAAEN,EAAEO,MAAM,KAAKC,EAAEN,IAAKI,EAAE,KAAKE,IAAIA,EAAEC,YAAYD,EAAEC,WAAW,OAAOH,EAAE,IAAI,KAAUA,EAAEI,SAASL,EAAEC,EAAEK,UAAWL,EAAEI,QAAQN,IAAIH,EAASO,EAAEA,EAAEH,GAAGG,EAAEH,GAAGG,EAAEH,MAArBG,EAAEH,GAAGD,EAAuB,IAA2KQ,EAAvKC,EAAE,oBAAqBC,YAAY,oBAAqBC,aAAa,oBAAqBC,aAAa,oBAAqBC,SAA6C,IAApC,IAAKJ,EAAEC,WAAWI,OAAO,KAAeN,EAAE,EAAE,IAAIA,IAAIA,EAAE,IAAI,IAAaO,GAATA,EAAEP,KAAa,EAAEO,EAAEA,KAAK,EAAE,EAAK,SAASC,EAAEpB,EAAEI,EAAEE,GAAG,IAAIE,EAAEH,EAAE,iBAAkBD,EAAEA,EAAEA,EAAE,EAAEiB,EAAE,iBAAkBf,EAAEA,EAAEN,EAAEU,OAAY,IAALF,GAAG,EAAMH,EAAI,EAAFgB,EAAIhB,MAAMD,EAAEI,EAAEA,IAAI,EAAEc,EAAW,KAARd,EAAER,EAAEI,KAAS,IAAIC,EAAEgB,GAAG,EAAEhB,IAAID,GAAG,EAAsLI,GAA1BA,GAA1BA,GAA1BA,GAA1BA,GAA1BA,GAA1BA,GAAxBA,EAAEA,IAAI,EAAEc,EAAW,KAARd,EAAER,EAAEI,QAAe,EAAEkB,EAAa,KAAVd,EAAER,EAAEI,EAAE,QAAe,EAAEkB,EAAa,KAAVd,EAAER,EAAEI,EAAE,QAAe,EAAEkB,EAAa,KAAVd,EAAER,EAAEI,EAAE,QAAe,EAAEkB,EAAa,KAAVd,EAAER,EAAEI,EAAE,QAAe,EAAEkB,EAAa,KAAVd,EAAER,EAAEI,EAAE,QAAe,EAAEkB,EAAa,KAAVd,EAAER,EAAEI,EAAE,QAAe,EAAEkB,EAAa,KAAVd,EAAER,EAAEI,EAAE,KAAS,OAAS,WAAFI,KAAgB,EACn5B,IAAIe,GAAG,EAAE,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,WAAW,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAC9e,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,WAAW,SAAS,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAC9e,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,WAAW,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,WAAW,SAAS,WAAW,WAAW,WAAW,SAAS,WAAW,WAAW,WAAW,UAAU,WAAW,WAC9e,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,WAAW,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAC/e,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,WAAW,SAAS,WAAW,WAAW,WAAW,SAAS,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,WAAW,WAAW,WAAW,WAC9e,SAAS,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU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","file":"static/js/155.9f411fdffe749ec41b40.js","sourcesContent":["/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */function n(e){throw e;}var q=void 0,aa={};function r(e,c){var d=e.split(\".\"),b=aa;!(d[0]in b)&&b.execScript&&b.execScript(\"var \"+d[0]);for(var a;d.length&&(a=d.shift());)!d.length&&c!==q?b[a]=c:b=b[a]?b[a]:b[a]={}};var u=\"undefined\"!==typeof Uint8Array&&\"undefined\"!==typeof Uint16Array&&\"undefined\"!==typeof Uint32Array&&\"undefined\"!==typeof DataView;new (u?Uint8Array:Array)(256);var v;for(v=0;256>v;++v)for(var w=v,ba=7,w=w>>>1;w;w>>>=1)--ba;function x(e,c,d){var b,a=\"number\"===typeof c?c:c=0,f=\"number\"===typeof d?d:e.length;b=-1;for(a=f&7;a--;++c)b=b>>>8^z[(b^e[c])&255];for(a=f>>3;a--;c+=8)b=b>>>8^z[(b^e[c])&255],b=b>>>8^z[(b^e[c+1])&255],b=b>>>8^z[(b^e[c+2])&255],b=b>>>8^z[(b^e[c+3])&255],b=b>>>8^z[(b^e[c+4])&255],b=b>>>8^z[(b^e[c+5])&255],b=b>>>8^z[(b^e[c+6])&255],b=b>>>8^z[(b^e[c+7])&255];return(b^4294967295)>>>0}\r\nvar A=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,\r\n2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,\r\n2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,\r\n2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,\r\n3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,\r\n936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],z=u?new Uint32Array(A):A;function B(){}B.prototype.getName=function(){return this.name};B.prototype.getData=function(){return this.data};B.prototype.H=function(){return this.I};r(\"Zlib.GunzipMember\",B);r(\"Zlib.GunzipMember.prototype.getName\",B.prototype.getName);r(\"Zlib.GunzipMember.prototype.getData\",B.prototype.getData);r(\"Zlib.GunzipMember.prototype.getMtime\",B.prototype.H);function D(e){var c=e.length,d=0,b=Number.POSITIVE_INFINITY,a,f,g,k,m,p,t,h,l,y;for(h=0;h<c;++h)e[h]>d&&(d=e[h]),e[h]<b&&(b=e[h]);a=1<<d;f=new (u?Uint32Array:Array)(a);g=1;k=0;for(m=2;g<=d;){for(h=0;h<c;++h)if(e[h]===g){p=0;t=k;for(l=0;l<g;++l)p=p<<1|t&1,t>>=1;y=g<<16|h;for(l=p;l<a;l+=m)f[l]=y;++k}++g;k<<=1;m<<=1}return[f,d,b]};var E=[],F;for(F=0;288>F;F++)switch(!0){case 143>=F:E.push([F+48,8]);break;case 255>=F:E.push([F-144+400,9]);break;case 279>=F:E.push([F-256+0,7]);break;case 287>=F:E.push([F-280+192,8]);break;default:n(\"invalid literal: \"+F)}\r\nvar ca=function(){function e(a){switch(!0){case 3===a:return[257,a-3,0];case 4===a:return[258,a-4,0];case 5===a:return[259,a-5,0];case 6===a:return[260,a-6,0];case 7===a:return[261,a-7,0];case 8===a:return[262,a-8,0];case 9===a:return[263,a-9,0];case 10===a:return[264,a-10,0];case 12>=a:return[265,a-11,1];case 14>=a:return[266,a-13,1];case 16>=a:return[267,a-15,1];case 18>=a:return[268,a-17,1];case 22>=a:return[269,a-19,2];case 26>=a:return[270,a-23,2];case 30>=a:return[271,a-27,2];case 34>=a:return[272,\r\na-31,2];case 42>=a:return[273,a-35,3];case 50>=a:return[274,a-43,3];case 58>=a:return[275,a-51,3];case 66>=a:return[276,a-59,3];case 82>=a:return[277,a-67,4];case 98>=a:return[278,a-83,4];case 114>=a:return[279,a-99,4];case 130>=a:return[280,a-115,4];case 162>=a:return[281,a-131,5];case 194>=a:return[282,a-163,5];case 226>=a:return[283,a-195,5];case 257>=a:return[284,a-227,5];case 258===a:return[285,a-258,0];default:n(\"invalid length: \"+a)}}var c=[],d,b;for(d=3;258>=d;d++)b=e(d),c[d]=b[2]<<24|b[1]<<\r\n16|b[0];return c}();u&&new Uint32Array(ca);function G(e,c){this.i=[];this.j=32768;this.d=this.f=this.c=this.n=0;this.input=u?new Uint8Array(e):e;this.o=!1;this.k=H;this.z=!1;if(c||!(c={}))c.index&&(this.c=c.index),c.bufferSize&&(this.j=c.bufferSize),c.bufferType&&(this.k=c.bufferType),c.resize&&(this.z=c.resize);switch(this.k){case I:this.a=32768;this.b=new (u?Uint8Array:Array)(32768+this.j+258);break;case H:this.a=0;this.b=new (u?Uint8Array:Array)(this.j);this.e=this.F;this.q=this.B;this.l=this.D;break;default:n(Error(\"invalid inflate mode\"))}}\r\nvar I=0,H=1;\r\nG.prototype.g=function(){for(;!this.o;){var e=J(this,3);e&1&&(this.o=!0);e>>>=1;switch(e){case 0:var c=this.input,d=this.c,b=this.b,a=this.a,f=c.length,g=q,k=q,m=b.length,p=q;this.d=this.f=0;d+1>=f&&n(Error(\"invalid uncompressed block header: LEN\"));g=c[d++]|c[d++]<<8;d+1>=f&&n(Error(\"invalid uncompressed block header: NLEN\"));k=c[d++]|c[d++]<<8;g===~k&&n(Error(\"invalid uncompressed block header: length verify\"));d+g>c.length&&n(Error(\"input buffer is broken\"));switch(this.k){case I:for(;a+g>b.length;){p=\r\nm-a;g-=p;if(u)b.set(c.subarray(d,d+p),a),a+=p,d+=p;else for(;p--;)b[a++]=c[d++];this.a=a;b=this.e();a=this.a}break;case H:for(;a+g>b.length;)b=this.e({t:2});break;default:n(Error(\"invalid inflate mode\"))}if(u)b.set(c.subarray(d,d+g),a),a+=g,d+=g;else for(;g--;)b[a++]=c[d++];this.c=d;this.a=a;this.b=b;break;case 1:this.l(da,ea);break;case 2:fa(this);break;default:n(Error(\"unknown BTYPE: \"+e))}}return this.q()};\r\nvar K=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],L=u?new Uint16Array(K):K,N=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],O=u?new Uint16Array(N):N,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],Q=u?new Uint8Array(P):P,R=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],ga=u?new Uint16Array(R):R,ha=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,\r\n13,13],U=u?new Uint8Array(ha):ha,V=new (u?Uint8Array:Array)(288),W,ia;W=0;for(ia=V.length;W<ia;++W)V[W]=143>=W?8:255>=W?9:279>=W?7:8;var da=D(V),X=new (u?Uint8Array:Array)(30),Y,ja;Y=0;for(ja=X.length;Y<ja;++Y)X[Y]=5;var ea=D(X);function J(e,c){for(var d=e.f,b=e.d,a=e.input,f=e.c,g=a.length,k;b<c;)f>=g&&n(Error(\"input buffer is broken\")),d|=a[f++]<<b,b+=8;k=d&(1<<c)-1;e.f=d>>>c;e.d=b-c;e.c=f;return k}\r\nfunction Z(e,c){for(var d=e.f,b=e.d,a=e.input,f=e.c,g=a.length,k=c[0],m=c[1],p,t;b<m&&!(f>=g);)d|=a[f++]<<b,b+=8;p=k[d&(1<<m)-1];t=p>>>16;e.f=d>>t;e.d=b-t;e.c=f;return p&65535}\r\nfunction fa(e){function c(a,c,b){var d,e=this.w,f,g;for(g=0;g<a;)switch(d=Z(this,c),d){case 16:for(f=3+J(this,2);f--;)b[g++]=e;break;case 17:for(f=3+J(this,3);f--;)b[g++]=0;e=0;break;case 18:for(f=11+J(this,7);f--;)b[g++]=0;e=0;break;default:e=b[g++]=d}this.w=e;return b}var d=J(e,5)+257,b=J(e,5)+1,a=J(e,4)+4,f=new (u?Uint8Array:Array)(L.length),g,k,m,p;for(p=0;p<a;++p)f[L[p]]=J(e,3);if(!u){p=a;for(a=f.length;p<a;++p)f[L[p]]=0}g=D(f);k=new (u?Uint8Array:Array)(d);m=new (u?Uint8Array:Array)(b);e.w=\r\n0;e.l(D(c.call(e,d,g,k)),D(c.call(e,b,g,m)))}G.prototype.l=function(e,c){var d=this.b,b=this.a;this.r=e;for(var a=d.length-258,f,g,k,m;256!==(f=Z(this,e));)if(256>f)b>=a&&(this.a=b,d=this.e(),b=this.a),d[b++]=f;else{g=f-257;m=O[g];0<Q[g]&&(m+=J(this,Q[g]));f=Z(this,c);k=ga[f];0<U[f]&&(k+=J(this,U[f]));b>=a&&(this.a=b,d=this.e(),b=this.a);for(;m--;)d[b]=d[b++-k]}for(;8<=this.d;)this.d-=8,this.c--;this.a=b};\r\nG.prototype.D=function(e,c){var d=this.b,b=this.a;this.r=e;for(var a=d.length,f,g,k,m;256!==(f=Z(this,e));)if(256>f)b>=a&&(d=this.e(),a=d.length),d[b++]=f;else{g=f-257;m=O[g];0<Q[g]&&(m+=J(this,Q[g]));f=Z(this,c);k=ga[f];0<U[f]&&(k+=J(this,U[f]));b+m>a&&(d=this.e(),a=d.length);for(;m--;)d[b]=d[b++-k]}for(;8<=this.d;)this.d-=8,this.c--;this.a=b};\r\nG.prototype.e=function(){var e=new (u?Uint8Array:Array)(this.a-32768),c=this.a-32768,d,b,a=this.b;if(u)e.set(a.subarray(32768,e.length));else{d=0;for(b=e.length;d<b;++d)e[d]=a[d+32768]}this.i.push(e);this.n+=e.length;if(u)a.set(a.subarray(c,c+32768));else for(d=0;32768>d;++d)a[d]=a[c+d];this.a=32768;return a};\r\nG.prototype.F=function(e){var c,d=this.input.length/this.c+1|0,b,a,f,g=this.input,k=this.b;e&&(\"number\"===typeof e.t&&(d=e.t),\"number\"===typeof e.A&&(d+=e.A));2>d?(b=(g.length-this.c)/this.r[2],f=258*(b/2)|0,a=f<k.length?k.length+f:k.length<<1):a=k.length*d;u?(c=new Uint8Array(a),c.set(k)):c=k;return this.b=c};\r\nG.prototype.q=function(){var e=0,c=this.b,d=this.i,b,a=new (u?Uint8Array:Array)(this.n+(this.a-32768)),f,g,k,m;if(0===d.length)return u?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);f=0;for(g=d.length;f<g;++f){b=d[f];k=0;for(m=b.length;k<m;++k)a[e++]=b[k]}f=32768;for(g=this.a;f<g;++f)a[e++]=c[f];this.i=[];return this.buffer=a};\r\nG.prototype.B=function(){var e,c=this.a;u?this.z?(e=new Uint8Array(c),e.set(this.b.subarray(0,c))):e=this.b.subarray(0,c):(this.b.length>c&&(this.b.length=c),e=this.b);return this.buffer=e};function $(e){this.input=e;this.c=0;this.m=[];this.s=!1}$.prototype.G=function(){this.s||this.g();return this.m.slice()};\r\n$.prototype.g=function(){for(var e=this.input.length;this.c<e;){var c=new B,d=q,b=q,a=q,f=q,g=q,k=q,m=q,p=q,t=q,h=this.input,l=this.c;c.u=h[l++];c.v=h[l++];(31!==c.u||139!==c.v)&&n(Error(\"invalid file signature:\"+c.u+\",\"+c.v));c.p=h[l++];switch(c.p){case 8:break;default:n(Error(\"unknown compression method: \"+c.p))}c.h=h[l++];p=h[l++]|h[l++]<<8|h[l++]<<16|h[l++]<<24;c.I=new Date(1E3*p);c.O=h[l++];c.N=h[l++];0<(c.h&4)&&(c.J=h[l++]|h[l++]<<8,l+=c.J);if(0<(c.h&8)){m=[];for(k=0;0<(g=h[l++]);)m[k++]=String.fromCharCode(g);\r\nc.name=m.join(\"\")}if(0<(c.h&16)){m=[];for(k=0;0<(g=h[l++]);)m[k++]=String.fromCharCode(g);c.K=m.join(\"\")}0<(c.h&2)&&(c.C=x(h,0,l)&65535,c.C!==(h[l++]|h[l++]<<8)&&n(Error(\"invalid header crc16\")));d=h[h.length-4]|h[h.length-3]<<8|h[h.length-2]<<16|h[h.length-1]<<24;h.length-l-4-4<512*d&&(f=d);b=new G(h,{index:l,bufferSize:f});c.data=a=b.g();l=b.c;c.L=t=(h[l++]|h[l++]<<8|h[l++]<<16|h[l++]<<24)>>>0;x(a,q,q)!==t&&n(Error(\"invalid CRC-32 checksum: 0x\"+x(a,q,q).toString(16)+\" / 0x\"+t.toString(16)));c.M=\r\nd=(h[l++]|h[l++]<<8|h[l++]<<16|h[l++]<<24)>>>0;(a.length&4294967295)!==d&&n(Error(\"invalid input size: \"+(a.length&4294967295)+\" / \"+d));this.m.push(c);this.c=l}this.s=!0;var y=this.m,s,M,S=0,T=0,C;s=0;for(M=y.length;s<M;++s)T+=y[s].data.length;if(u){C=new Uint8Array(T);for(s=0;s<M;++s)C.set(y[s].data,S),S+=y[s].data.length}else{C=[];for(s=0;s<M;++s)C[s]=y[s].data;C=Array.prototype.concat.apply([],C)}return C};r(\"Zlib.Gunzip\",$);r(\"Zlib.Gunzip.prototype.decompress\",$.prototype.g);r(\"Zlib.Gunzip.prototype.getMembers\",$.prototype.G);\r\nvar Zlib=aa.Zlib;\r\nexport { Zlib }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/libs/gunzip.module.min.js","import {\r\n\tClampToEdgeWrapping,\r\n\tDoubleSide,\r\n\tLinearFilter,\r\n\tMesh,\r\n\tMeshBasicMaterial,\r\n\tPlaneBufferGeometry,\r\n\tTexture\r\n} from \"@/components/build/three.module.js\";\r\n\r\n/**\r\n * This class has been made to hold a slice of a volume data\r\n * @class\r\n * @param   {Volume} volume    The associated volume\r\n * @param   {number}       [index=0] The index of the slice\r\n * @param   {string}       [axis='z']      For now only 'x', 'y' or 'z' but later it will change to a normal vector\r\n * @see Volume\r\n */\r\nvar VolumeSlice = function ( volume, index, axis ) {\r\n\r\n\tvar slice = this;\r\n\t/**\r\n\t * @member {Volume} volume The associated volume\r\n\t */\r\n\tthis.volume = volume;\r\n\t/**\r\n\t * @member {Number} index The index of the slice, if changed, will automatically call updateGeometry at the next repaint\r\n\t */\r\n\tindex = index || 0;\r\n\tObject.defineProperty( this, 'index', {\r\n\t\tget: function () {\r\n\r\n\t\t\treturn index;\r\n\r\n\t\t},\r\n\t\tset: function ( value ) {\r\n\r\n\t\t\tindex = value;\r\n\t\t\tslice.geometryNeedsUpdate = true;\r\n\t\t\treturn index;\r\n\r\n\t\t}\r\n\t} );\r\n\t/**\r\n\t * @member {String} axis The normal axis\r\n\t */\r\n\tthis.axis = axis || 'z';\r\n\r\n\t/**\r\n\t * @member {HTMLCanvasElement} canvas The final canvas used for the texture\r\n\t */\r\n\t/**\r\n\t * @member {CanvasRenderingContext2D} ctx Context of the canvas\r\n\t */\r\n\tthis.canvas = document.createElement( 'canvas' );\r\n\t/**\r\n\t * @member {HTMLCanvasElement} canvasBuffer The intermediary canvas used to paint the data\r\n\t */\r\n\t/**\r\n\t * @member {CanvasRenderingContext2D} ctxBuffer Context of the canvas buffer\r\n\t */\r\n\tthis.canvasBuffer = document.createElement( 'canvas' );\r\n\tthis.updateGeometry();\r\n\r\n\r\n\tvar canvasMap = new Texture( this.canvas );\r\n\tcanvasMap.minFilter = LinearFilter;\r\n\tcanvasMap.wrapS = canvasMap.wrapT = ClampToEdgeWrapping;\r\n\tvar material = new MeshBasicMaterial( { map: canvasMap, side: DoubleSide, transparent: true } );\r\n\t/**\r\n\t * @member {Mesh} mesh The mesh ready to get used in the scene\r\n\t */\r\n\tthis.mesh = new Mesh( this.geometry, material );\r\n\tthis.mesh.matrixAutoUpdate = false;\r\n\t/**\r\n\t * @member {Boolean} geometryNeedsUpdate If set to true, updateGeometry will be triggered at the next repaint\r\n\t */\r\n\tthis.geometryNeedsUpdate = true;\r\n\tthis.repaint();\r\n\r\n\t/**\r\n\t * @member {Number} iLength Width of slice in the original coordinate system, corresponds to the width of the buffer canvas\r\n\t */\r\n\r\n\t/**\r\n\t * @member {Number} jLength Height of slice in the original coordinate system, corresponds to the height of the buffer canvas\r\n\t */\r\n\r\n\t/**\r\n\t * @member {Function} sliceAccess Function that allow the slice to access right data\r\n\t * @see Volume.extractPerpendicularPlane\r\n\t * @param {Number} i The first coordinate\r\n\t * @param {Number} j The second coordinate\r\n\t * @returns {Number} the index corresponding to the voxel in volume.data of the given position in the slice\r\n\t */\r\n\r\n\r\n};\r\n\r\nVolumeSlice.prototype = {\r\n\r\n\tconstructor: VolumeSlice,\r\n\r\n\t/**\r\n\t * @member {Function} repaint Refresh the texture and the geometry if geometryNeedsUpdate is set to true\r\n\t * @memberof VolumeSlice\r\n\t */\r\n\trepaint: function () {\r\n\r\n\t\tif ( this.geometryNeedsUpdate ) {\r\n\r\n\t\t\tthis.updateGeometry();\r\n\r\n\t\t}\r\n\r\n\t\tvar iLength = this.iLength,\r\n\t\t\tjLength = this.jLength,\r\n\t\t\tsliceAccess = this.sliceAccess,\r\n\t\t\tvolume = this.volume,\r\n\t\t\tcanvas = this.canvasBuffer,\r\n\t\t\tctx = this.ctxBuffer;\r\n\r\n\r\n\t\t// get the imageData and pixel array from the canvas\r\n\t\tvar imgData = ctx.getImageData( 0, 0, iLength, jLength );\r\n\t\tvar data = imgData.data;\r\n\t\tvar volumeData = volume.data;\r\n\t\tvar upperThreshold = volume.upperThreshold;\r\n\t\tvar lowerThreshold = volume.lowerThreshold;\r\n\t\tvar windowLow = volume.windowLow;\r\n\t\tvar windowHigh = volume.windowHigh;\r\n\r\n\t\t// manipulate some pixel elements\r\n\t\tvar pixelCount = 0;\r\n\r\n\t\tif ( volume.dataType === 'label' ) {\r\n\r\n\t\t\t//this part is currently useless but will be used when colortables will be handled\r\n\t\t\tfor ( var j = 0; j < jLength; j ++ ) {\r\n\r\n\t\t\t\tfor ( var i = 0; i < iLength; i ++ ) {\r\n\r\n\t\t\t\t\tvar label = volumeData[ sliceAccess( i, j ) ];\r\n\t\t\t\t\tlabel = label >= this.colorMap.length ? ( label % this.colorMap.length ) + 1 : label;\r\n\t\t\t\t\tvar color = this.colorMap[ label ];\r\n\t\t\t\t\tdata[ 4 * pixelCount ] = ( color >> 24 ) & 0xff;\r\n\t\t\t\t\tdata[ 4 * pixelCount + 1 ] = ( color >> 16 ) & 0xff;\r\n\t\t\t\t\tdata[ 4 * pixelCount + 2 ] = ( color >> 8 ) & 0xff;\r\n\t\t\t\t\tdata[ 4 * pixelCount + 3 ] = color & 0xff;\r\n\t\t\t\t\tpixelCount ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tfor ( var j = 0; j < jLength; j ++ ) {\r\n\r\n\t\t\t\tfor ( var i = 0; i < iLength; i ++ ) {\r\n\r\n\t\t\t\t\tvar value = volumeData[ sliceAccess( i, j ) ];\r\n\t\t\t\t\tvar alpha = 0xff;\r\n\t\t\t\t\t//apply threshold\r\n\t\t\t\t\talpha = upperThreshold >= value ? ( lowerThreshold <= value ? alpha : 0 ) : 0;\r\n\t\t\t\t\t//apply window level\r\n\t\t\t\t\tvalue = Math.floor( 255 * ( value - windowLow ) / ( windowHigh - windowLow ) );\r\n\t\t\t\t\tvalue = value > 255 ? 255 : ( value < 0 ? 0 : value | 0 );\r\n\r\n\t\t\t\t\tdata[ 4 * pixelCount ] = value;\r\n\t\t\t\t\tdata[ 4 * pixelCount + 1 ] = value;\r\n\t\t\t\t\tdata[ 4 * pixelCount + 2 ] = value;\r\n\t\t\t\t\tdata[ 4 * pixelCount + 3 ] = alpha;\r\n\t\t\t\t\tpixelCount ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tctx.putImageData( imgData, 0, 0 );\r\n\t\tthis.ctx.drawImage( canvas, 0, 0, iLength, jLength, 0, 0, this.canvas.width, this.canvas.height );\r\n\r\n\r\n\t\tthis.mesh.material.map.needsUpdate = true;\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * @member {Function} Refresh the geometry according to axis and index\r\n\t * @see Volume.extractPerpendicularPlane\r\n\t * @memberof VolumeSlice\r\n\t */\r\n\tupdateGeometry: function () {\r\n\r\n\t\tvar extracted = this.volume.extractPerpendicularPlane( this.axis, this.index );\r\n\t\tthis.sliceAccess = extracted.sliceAccess;\r\n\t\tthis.jLength = extracted.jLength;\r\n\t\tthis.iLength = extracted.iLength;\r\n\t\tthis.matrix = extracted.matrix;\r\n\r\n\t\tthis.canvas.width = extracted.planeWidth;\r\n\t\tthis.canvas.height = extracted.planeHeight;\r\n\t\tthis.canvasBuffer.width = this.iLength;\r\n\t\tthis.canvasBuffer.height = this.jLength;\r\n\t\tthis.ctx = this.canvas.getContext( '2d' );\r\n\t\tthis.ctxBuffer = this.canvasBuffer.getContext( '2d' );\r\n\r\n\t\tif ( this.geometry ) this.geometry.dispose(); // dispose existing geometry\r\n\r\n\t\tthis.geometry = new PlaneBufferGeometry( extracted.planeWidth, extracted.planeHeight );\r\n\r\n\t\tif ( this.mesh ) {\r\n\r\n\t\t\tthis.mesh.geometry = this.geometry;\r\n\t\t\t//reset mesh matrix\r\n\t\t\tthis.mesh.matrix.identity();\r\n\t\t\tthis.mesh.applyMatrix4( this.matrix );\r\n\r\n\t\t}\r\n\r\n\t\tthis.geometryNeedsUpdate = false;\r\n\r\n\t}\r\n\r\n};\r\n\r\nexport { VolumeSlice };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/misc/VolumeSlice.js","import {\r\n\tMatrix3,\r\n\tMatrix4,\r\n\tVector3\r\n} from \"@/components/build/three.module.js\";\r\nimport { VolumeSlice } from \"../misc/VolumeSlice.js\";\r\n\r\n/**\r\n * This class had been written to handle the output of the NRRD loader.\r\n * It contains a volume of data and informations about it.\r\n * For now it only handles 3 dimensional data.\r\n * See the webgl_loader_nrrd.html example and the loaderNRRD.js file to see how to use this class.\r\n * @class\r\n * @param   {number}        xLength         Width of the volume\r\n * @param   {number}        yLength         Length of the volume\r\n * @param   {number}        zLength         Depth of the volume\r\n * @param   {string}        type            The type of data (uint8, uint16, ...)\r\n * @param   {ArrayBuffer}   arrayBuffer     The buffer with volume data\r\n */\r\nvar Volume = function ( xLength, yLength, zLength, type, arrayBuffer ) {\r\n\r\n\tif ( arguments.length > 0 ) {\r\n\r\n\t\t/**\r\n\t\t * @member {number} xLength Width of the volume in the IJK coordinate system\r\n\t\t */\r\n\t\tthis.xLength = Number( xLength ) || 1;\r\n\t\t/**\r\n\t\t * @member {number} yLength Height of the volume in the IJK coordinate system\r\n\t\t */\r\n\t\tthis.yLength = Number( yLength ) || 1;\r\n\t\t/**\r\n\t\t * @member {number} zLength Depth of the volume in the IJK coordinate system\r\n\t\t */\r\n\t\tthis.zLength = Number( zLength ) || 1;\r\n\r\n\t\t/**\r\n\t\t * @member {TypedArray} data Data of the volume\r\n\t\t */\r\n\r\n\t\tswitch ( type ) {\r\n\r\n\t\t\tcase 'Uint8' :\r\n\t\t\tcase 'uint8' :\r\n\t\t\tcase 'uchar' :\r\n\t\t\tcase 'unsigned char' :\r\n\t\t\tcase 'uint8_t' :\r\n\t\t\t\tthis.data = new Uint8Array( arrayBuffer );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Int8' :\r\n\t\t\tcase 'int8' :\r\n\t\t\tcase 'signed char' :\r\n\t\t\tcase 'int8_t' :\r\n\t\t\t\tthis.data = new Int8Array( arrayBuffer );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Int16' :\r\n\t\t\tcase 'int16' :\r\n\t\t\tcase 'short' :\r\n\t\t\tcase 'short int' :\r\n\t\t\tcase 'signed short' :\r\n\t\t\tcase 'signed short int' :\r\n\t\t\tcase 'int16_t' :\r\n\t\t\t\tthis.data = new Int16Array( arrayBuffer );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Uint16' :\r\n\t\t\tcase 'uint16' :\r\n\t\t\tcase 'ushort' :\r\n\t\t\tcase 'unsigned short' :\r\n\t\t\tcase 'unsigned short int' :\r\n\t\t\tcase 'uint16_t' :\r\n\t\t\t\tthis.data = new Uint16Array( arrayBuffer );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Int32' :\r\n\t\t\tcase 'int32' :\r\n\t\t\tcase 'int' :\r\n\t\t\tcase 'signed int' :\r\n\t\t\tcase 'int32_t' :\r\n\t\t\t\tthis.data = new Int32Array( arrayBuffer );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Uint32' :\r\n\t\t\tcase 'uint32' :\r\n\t\t\tcase 'uint' :\r\n\t\t\tcase 'unsigned int' :\r\n\t\t\tcase 'uint32_t' :\r\n\t\t\t\tthis.data = new Uint32Array( arrayBuffer );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'longlong' :\r\n\t\t\tcase 'long long' :\r\n\t\t\tcase 'long long int' :\r\n\t\t\tcase 'signed long long' :\r\n\t\t\tcase 'signed long long int' :\r\n\t\t\tcase 'int64' :\r\n\t\t\tcase 'int64_t' :\r\n\t\t\tcase 'ulonglong' :\r\n\t\t\tcase 'unsigned long long' :\r\n\t\t\tcase 'unsigned long long int' :\r\n\t\t\tcase 'uint64' :\r\n\t\t\tcase 'uint64_t' :\r\n\t\t\t\tthrow 'Error in Volume constructor : this type is not supported in JavaScript';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Float32' :\r\n\t\t\tcase 'float32' :\r\n\t\t\tcase 'float' :\r\n\t\t\t\tthis.data = new Float32Array( arrayBuffer );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Float64' :\r\n\t\t\tcase 'float64' :\r\n\t\t\tcase 'double' :\r\n\t\t\t\tthis.data = new Float64Array( arrayBuffer );\r\n\t\t\t\tbreak;\r\n\t\t\tdefault :\r\n\t\t\t\tthis.data = new Uint8Array( arrayBuffer );\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.data.length !== this.xLength * this.yLength * this.zLength ) {\r\n\r\n\t\t\tthrow 'Error in Volume constructor, lengths are not matching arrayBuffer size';\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @member {Array}  spacing Spacing to apply to the volume from IJK to RAS coordinate system\r\n\t */\r\n\tthis.spacing = [ 1, 1, 1 ];\r\n\t/**\r\n\t * @member {Array}  offset Offset of the volume in the RAS coordinate system\r\n\t */\r\n\tthis.offset = [ 0, 0, 0 ];\r\n\t/**\r\n\t * @member {Martrix3} matrix The IJK to RAS matrix\r\n\t */\r\n\tthis.matrix = new Matrix3();\r\n\tthis.matrix.identity();\r\n\t/**\r\n\t * @member {Martrix3} inverseMatrix The RAS to IJK matrix\r\n\t */\r\n\t/**\r\n\t * @member {number} lowerThreshold The voxels with values under this threshold won't appear in the slices.\r\n\t *                      If changed, geometryNeedsUpdate is automatically set to true on all the slices associated to this volume\r\n\t */\r\n\tvar lowerThreshold = - Infinity;\r\n\tObject.defineProperty( this, 'lowerThreshold', {\r\n\t\tget: function () {\r\n\r\n\t\t\treturn lowerThreshold;\r\n\r\n\t\t},\r\n\t\tset: function ( value ) {\r\n\r\n\t\t\tlowerThreshold = value;\r\n\t\t\tthis.sliceList.forEach( function ( slice ) {\r\n\r\n\t\t\t\tslice.geometryNeedsUpdate = true;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\t} );\r\n\t/**\r\n\t * @member {number} upperThreshold The voxels with values over this threshold won't appear in the slices.\r\n\t *                      If changed, geometryNeedsUpdate is automatically set to true on all the slices associated to this volume\r\n\t */\r\n\tvar upperThreshold = Infinity;\r\n\tObject.defineProperty( this, 'upperThreshold', {\r\n\t\tget: function () {\r\n\r\n\t\t\treturn upperThreshold;\r\n\r\n\t\t},\r\n\t\tset: function ( value ) {\r\n\r\n\t\t\tupperThreshold = value;\r\n\t\t\tthis.sliceList.forEach( function ( slice ) {\r\n\r\n\t\t\t\tslice.geometryNeedsUpdate = true;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\t} );\r\n\r\n\r\n\t/**\r\n\t * @member {Array} sliceList The list of all the slices associated to this volume\r\n\t */\r\n\tthis.sliceList = [];\r\n\r\n\r\n\t/**\r\n\t * @member {Array} RASDimensions This array holds the dimensions of the volume in the RAS space\r\n\t */\r\n\r\n};\r\n\r\nVolume.prototype = {\r\n\r\n\tconstructor: Volume,\r\n\r\n\t/**\r\n\t * @member {Function} getData Shortcut for data[access(i,j,k)]\r\n\t * @memberof Volume\r\n\t * @param {number} i    First coordinate\r\n\t * @param {number} j    Second coordinate\r\n\t * @param {number} k    Third coordinate\r\n\t * @returns {number}  value in the data array\r\n\t */\r\n\tgetData: function ( i, j, k ) {\r\n\r\n\t\treturn this.data[ k * this.xLength * this.yLength + j * this.xLength + i ];\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * @member {Function} access compute the index in the data array corresponding to the given coordinates in IJK system\r\n\t * @memberof Volume\r\n\t * @param {number} i    First coordinate\r\n\t * @param {number} j    Second coordinate\r\n\t * @param {number} k    Third coordinate\r\n\t * @returns {number}  index\r\n\t */\r\n\taccess: function ( i, j, k ) {\r\n\r\n\t\treturn k * this.xLength * this.yLength + j * this.xLength + i;\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * @member {Function} reverseAccess Retrieve the IJK coordinates of the voxel corresponding of the given index in the data\r\n\t * @memberof Volume\r\n\t * @param {number} index index of the voxel\r\n\t * @returns {Array}  [x,y,z]\r\n\t */\r\n\treverseAccess: function ( index ) {\r\n\r\n\t\tvar z = Math.floor( index / ( this.yLength * this.xLength ) );\r\n\t\tvar y = Math.floor( ( index - z * this.yLength * this.xLength ) / this.xLength );\r\n\t\tvar x = index - z * this.yLength * this.xLength - y * this.xLength;\r\n\t\treturn [ x, y, z ];\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * @member {Function} map Apply a function to all the voxels, be careful, the value will be replaced\r\n\t * @memberof Volume\r\n\t * @param {Function} functionToMap A function to apply to every voxel, will be called with the following parameters :\r\n\t *                                 value of the voxel\r\n\t *                                 index of the voxel\r\n\t *                                 the data (TypedArray)\r\n\t * @param {Object}   context    You can specify a context in which call the function, default if this Volume\r\n\t * @returns {Volume}   this\r\n\t */\r\n\tmap: function ( functionToMap, context ) {\r\n\r\n\t\tvar length = this.data.length;\r\n\t\tcontext = context || this;\r\n\r\n\t\tfor ( var i = 0; i < length; i ++ ) {\r\n\r\n\t\t\tthis.data[ i ] = functionToMap.call( context, this.data[ i ], i, this.data );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * @member {Function} extractPerpendicularPlane Compute the orientation of the slice and returns all the information relative to the geometry such as sliceAccess, the plane matrix (orientation and position in RAS coordinate) and the dimensions of the plane in both coordinate system.\r\n\t * @memberof Volume\r\n\t * @param {string}            axis  the normal axis to the slice 'x' 'y' or 'z'\r\n\t * @param {number}            index the index of the slice\r\n\t * @returns {Object} an object containing all the usefull information on the geometry of the slice\r\n\t */\r\n\textractPerpendicularPlane: function ( axis, RASIndex ) {\r\n\r\n\t\tvar iLength,\r\n\t\t\tjLength,\r\n\t\t\tsliceAccess,\r\n\t\t\tplaneMatrix = ( new Matrix4() ).identity(),\r\n\t\t\tvolume = this,\r\n\t\t\tplaneWidth,\r\n\t\t\tplaneHeight,\r\n\t\t\tfirstSpacing,\r\n\t\t\tsecondSpacing,\r\n\t\t\tpositionOffset,\r\n\t\t\tIJKIndex;\r\n\r\n\t\tvar axisInIJK = new Vector3(),\r\n\t\t\tfirstDirection = new Vector3(),\r\n\t\t\tsecondDirection = new Vector3();\r\n\r\n\t\tvar dimensions = new Vector3( this.xLength, this.yLength, this.zLength );\r\n\r\n\r\n\t\tswitch ( axis ) {\r\n\r\n\t\t\tcase 'x' :\r\n\t\t\t\taxisInIJK.set( 1, 0, 0 );\r\n\t\t\t\tfirstDirection.set( 0, 0, - 1 );\r\n\t\t\t\tsecondDirection.set( 0, - 1, 0 );\r\n\t\t\t\tfirstSpacing = this.spacing[ 2 ];\r\n\t\t\t\tsecondSpacing = this.spacing[ 1 ];\r\n\t\t\t\tIJKIndex = new Vector3( RASIndex, 0, 0 );\r\n\r\n\t\t\t\tplaneMatrix.multiply( ( new Matrix4() ).makeRotationY( Math.PI / 2 ) );\r\n\t\t\t\tpositionOffset = ( volume.RASDimensions[ 0 ] - 1 ) / 2;\r\n\t\t\t\tplaneMatrix.setPosition( new Vector3( RASIndex - positionOffset, 0, 0 ) );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'y' :\r\n\t\t\t\taxisInIJK.set( 0, 1, 0 );\r\n\t\t\t\tfirstDirection.set( 1, 0, 0 );\r\n\t\t\t\tsecondDirection.set( 0, 0, 1 );\r\n\t\t\t\tfirstSpacing = this.spacing[ 0 ];\r\n\t\t\t\tsecondSpacing = this.spacing[ 2 ];\r\n\t\t\t\tIJKIndex = new Vector3( 0, RASIndex, 0 );\r\n\r\n\t\t\t\tplaneMatrix.multiply( ( new Matrix4() ).makeRotationX( - Math.PI / 2 ) );\r\n\t\t\t\tpositionOffset = ( volume.RASDimensions[ 1 ] - 1 ) / 2;\r\n\t\t\t\tplaneMatrix.setPosition( new Vector3( 0, RASIndex - positionOffset, 0 ) );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'z' :\r\n\t\t\tdefault :\r\n\t\t\t\taxisInIJK.set( 0, 0, 1 );\r\n\t\t\t\tfirstDirection.set( 1, 0, 0 );\r\n\t\t\t\tsecondDirection.set( 0, - 1, 0 );\r\n\t\t\t\tfirstSpacing = this.spacing[ 0 ];\r\n\t\t\t\tsecondSpacing = this.spacing[ 1 ];\r\n\t\t\t\tIJKIndex = new Vector3( 0, 0, RASIndex );\r\n\r\n\t\t\t\tpositionOffset = ( volume.RASDimensions[ 2 ] - 1 ) / 2;\r\n\t\t\t\tplaneMatrix.setPosition( new Vector3( 0, 0, RASIndex - positionOffset ) );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tfirstDirection.applyMatrix4( volume.inverseMatrix ).normalize();\r\n\t\tfirstDirection.argVar = 'i';\r\n\t\tsecondDirection.applyMatrix4( volume.inverseMatrix ).normalize();\r\n\t\tsecondDirection.argVar = 'j';\r\n\t\taxisInIJK.applyMatrix4( volume.inverseMatrix ).normalize();\r\n\t\tiLength = Math.floor( Math.abs( firstDirection.dot( dimensions ) ) );\r\n\t\tjLength = Math.floor( Math.abs( secondDirection.dot( dimensions ) ) );\r\n\t\tplaneWidth = Math.abs( iLength * firstSpacing );\r\n\t\tplaneHeight = Math.abs( jLength * secondSpacing );\r\n\r\n\t\tIJKIndex = Math.abs( Math.round( IJKIndex.applyMatrix4( volume.inverseMatrix ).dot( axisInIJK ) ) );\r\n\t\tvar base = [ new Vector3( 1, 0, 0 ), new Vector3( 0, 1, 0 ), new Vector3( 0, 0, 1 ) ];\r\n\t\tvar iDirection = [ firstDirection, secondDirection, axisInIJK ].find( function ( x ) {\r\n\r\n\t\t\treturn Math.abs( x.dot( base[ 0 ] ) ) > 0.9;\r\n\r\n\t\t} );\r\n\t\tvar jDirection = [ firstDirection, secondDirection, axisInIJK ].find( function ( x ) {\r\n\r\n\t\t\treturn Math.abs( x.dot( base[ 1 ] ) ) > 0.9;\r\n\r\n\t\t} );\r\n\t\tvar kDirection = [ firstDirection, secondDirection, axisInIJK ].find( function ( x ) {\r\n\r\n\t\t\treturn Math.abs( x.dot( base[ 2 ] ) ) > 0.9;\r\n\r\n\t\t} );\r\n\r\n\t\tsliceAccess = function ( i, j ) {\r\n\r\n\t\t\tvar accessI, accessJ, accessK;\r\n\r\n\t\t\tvar si = ( iDirection === axisInIJK ) ? IJKIndex : ( iDirection.argVar === 'i' ? i : j );\r\n\t\t\tvar sj = ( jDirection === axisInIJK ) ? IJKIndex : ( jDirection.argVar === 'i' ? i : j );\r\n\t\t\tvar sk = ( kDirection === axisInIJK ) ? IJKIndex : ( kDirection.argVar === 'i' ? i : j );\r\n\r\n\t\t\t// invert indices if necessary\r\n\r\n\t\t\tvar accessI = ( iDirection.dot( base[ 0 ] ) > 0 ) ? si : ( volume.xLength - 1 ) - si;\r\n\t\t\tvar accessJ = ( jDirection.dot( base[ 1 ] ) > 0 ) ? sj : ( volume.yLength - 1 ) - sj;\r\n\t\t\tvar accessK = ( kDirection.dot( base[ 2 ] ) > 0 ) ? sk : ( volume.zLength - 1 ) - sk;\r\n\r\n\t\t\treturn volume.access( accessI, accessJ, accessK );\r\n\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\tiLength: iLength,\r\n\t\t\tjLength: jLength,\r\n\t\t\tsliceAccess: sliceAccess,\r\n\t\t\tmatrix: planeMatrix,\r\n\t\t\tplaneWidth: planeWidth,\r\n\t\t\tplaneHeight: planeHeight\r\n\t\t};\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * @member {Function} extractSlice Returns a slice corresponding to the given axis and index\r\n\t *                        The coordinate are given in the Right Anterior Superior coordinate format\r\n\t * @memberof Volume\r\n\t * @param {string}            axis  the normal axis to the slice 'x' 'y' or 'z'\r\n\t * @param {number}            index the index of the slice\r\n\t * @returns {VolumeSlice} the extracted slice\r\n\t */\r\n\textractSlice: function ( axis, index ) {\r\n\r\n\t\tvar slice = new VolumeSlice( this, index, axis );\r\n\t\tthis.sliceList.push( slice );\r\n\t\treturn slice;\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * @member {Function} repaintAllSlices Call repaint on all the slices extracted from this volume\r\n\t * @see VolumeSlice.repaint\r\n\t * @memberof Volume\r\n\t * @returns {Volume} this\r\n\t */\r\n\trepaintAllSlices: function () {\r\n\r\n\t\tthis.sliceList.forEach( function ( slice ) {\r\n\r\n\t\t\tslice.repaint();\r\n\r\n\t\t} );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * @member {Function} computeMinMax Compute the minimum and the maximum of the data in the volume\r\n\t * @memberof Volume\r\n\t * @returns {Array} [min,max]\r\n\t */\r\n\tcomputeMinMax: function () {\r\n\r\n\t\tvar min = Infinity;\r\n\t\tvar max = - Infinity;\r\n\r\n\t\t// buffer the length\r\n\t\tvar datasize = this.data.length;\r\n\r\n\t\tvar i = 0;\r\n\r\n\t\tfor ( i = 0; i < datasize; i ++ ) {\r\n\r\n\t\t\tif ( ! isNaN( this.data[ i ] ) ) {\r\n\r\n\t\t\t\tvar value = this.data[ i ];\r\n\t\t\t\tmin = Math.min( min, value );\r\n\t\t\t\tmax = Math.max( max, value );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.min = min;\r\n\t\tthis.max = max;\r\n\r\n\t\treturn [ min, max ];\r\n\r\n\t}\r\n\r\n};\r\n\r\nexport { Volume };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/misc/Volume.js","import {\r\n\tFileLoader,\r\n\tLoader,\r\n\tMatrix4,\r\n\tVector3\r\n} from \"@/components/build/three.module.js\";\r\nimport { Zlib } from \"../libs/gunzip.module.min.js\";\r\nimport { Volume } from \"../misc/Volume.js\";\r\n\r\nvar NRRDLoader = function ( manager ) {\r\n\r\n\tLoader.call( this, manager );\r\n\r\n};\r\n\r\nNRRDLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\tconstructor: NRRDLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar loader = new FileLoader( scope.manager );\r\n\t\tloader.setPath( scope.path );\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\t\tloader.setRequestHeader( scope.requestHeader );\r\n\t\tloader.setWithCredentials( scope.withCredentials );\r\n\t\tloader.load( url, function ( data ) {\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\tonLoad( scope.parse( data ) );\r\n\r\n\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\tif ( onError ) {\r\n\r\n\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.manager.itemError( url );\r\n\r\n\t\t\t}\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tparse: function ( data ) {\r\n\r\n\t\t// this parser is largely inspired from the XTK NRRD parser : https://github.com/xtk/X\r\n\r\n\t\tvar _data = data;\r\n\r\n\t\tvar _dataPointer = 0;\r\n\r\n\t\tvar _nativeLittleEndian = new Int8Array( new Int16Array( [ 1 ] ).buffer )[ 0 ] > 0;\r\n\r\n\t\tvar _littleEndian = true;\r\n\r\n\t\tvar headerObject = {};\r\n\r\n\t\tfunction scan( type, chunks ) {\r\n\r\n\t\t\tif ( chunks === undefined || chunks === null ) {\r\n\r\n\t\t\t\tchunks = 1;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar _chunkSize = 1;\r\n\t\t\tvar _array_type = Uint8Array;\r\n\r\n\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\t// 1 byte data types\r\n\t\t\t\tcase 'uchar':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'schar':\r\n\t\t\t\t\t_array_type = Int8Array;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\t// 2 byte data types\r\n\t\t\t\tcase 'ushort':\r\n\t\t\t\t\t_array_type = Uint16Array;\r\n\t\t\t\t\t_chunkSize = 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'sshort':\r\n\t\t\t\t\t_array_type = Int16Array;\r\n\t\t\t\t\t_chunkSize = 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\t// 4 byte data types\r\n\t\t\t\tcase 'uint':\r\n\t\t\t\t\t_array_type = Uint32Array;\r\n\t\t\t\t\t_chunkSize = 4;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'sint':\r\n\t\t\t\t\t_array_type = Int32Array;\r\n\t\t\t\t\t_chunkSize = 4;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'float':\r\n\t\t\t\t\t_array_type = Float32Array;\r\n\t\t\t\t\t_chunkSize = 4;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'complex':\r\n\t\t\t\t\t_array_type = Float64Array;\r\n\t\t\t\t\t_chunkSize = 8;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'double':\r\n\t\t\t\t\t_array_type = Float64Array;\r\n\t\t\t\t\t_chunkSize = 8;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// increase the data pointer in-place\r\n\t\t\tvar _bytes = new _array_type( _data.slice( _dataPointer,\r\n\t\t\t\t_dataPointer += chunks * _chunkSize ) );\r\n\r\n\t\t\t// if required, flip the endianness of the bytes\r\n\t\t\tif ( _nativeLittleEndian != _littleEndian ) {\r\n\r\n\t\t\t\t// we need to flip here since the format doesn't match the native endianness\r\n\t\t\t\t_bytes = flipEndianness( _bytes, _chunkSize );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( chunks == 1 ) {\r\n\r\n\t\t\t\t// if only one chunk was requested, just return one value\r\n\t\t\t\treturn _bytes[ 0 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// return the byte array\r\n\t\t\treturn _bytes;\r\n\r\n\t\t}\r\n\r\n\t\t//Flips typed array endianness in-place. Based on https://github.com/kig/DataStream.js/blob/master/DataStream.js.\r\n\r\n\t\tfunction flipEndianness( array, chunkSize ) {\r\n\r\n\t\t\tvar u8 = new Uint8Array( array.buffer, array.byteOffset, array.byteLength );\r\n\t\t\tfor ( var i = 0; i < array.byteLength; i += chunkSize ) {\r\n\r\n\t\t\t\tfor ( var j = i + chunkSize - 1, k = i; j > k; j --, k ++ ) {\r\n\r\n\t\t\t\t\tvar tmp = u8[ k ];\r\n\t\t\t\t\tu8[ k ] = u8[ j ];\r\n\t\t\t\t\tu8[ j ] = tmp;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn array;\r\n\r\n\t\t}\r\n\r\n\t\t//parse the header\r\n\t\tfunction parseHeader( header ) {\r\n\r\n\t\t\tvar data, field, fn, i, l, lines, m, _i, _len;\r\n\t\t\tlines = header.split( /\\r?\\n/ );\r\n\t\t\tfor ( _i = 0, _len = lines.length; _i < _len; _i ++ ) {\r\n\r\n\t\t\t\tl = lines[ _i ];\r\n\t\t\t\tif ( l.match( /NRRD\\d+/ ) ) {\r\n\r\n\t\t\t\t\theaderObject.isNrrd = true;\r\n\r\n\t\t\t\t} else if ( l.match( /^#/ ) ) {\r\n\t\t\t\t} else if ( m = l.match( /(.*):(.*)/ ) ) {\r\n\r\n\t\t\t\t\tfield = m[ 1 ].trim();\r\n\t\t\t\t\tdata = m[ 2 ].trim();\r\n\t\t\t\t\tfn = NRRDLoader.prototype.fieldFunctions[ field ];\r\n\t\t\t\t\tif ( fn ) {\r\n\r\n\t\t\t\t\t\tfn.call( headerObject, data );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\theaderObject[ field ] = data;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! headerObject.isNrrd ) {\r\n\r\n\t\t\t\tthrow new Error( 'Not an NRRD file' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( headerObject.encoding === 'bz2' || headerObject.encoding === 'bzip2' ) {\r\n\r\n\t\t\t\tthrow new Error( 'Bzip is not supported' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! headerObject.vectors ) {\r\n\r\n\t\t\t\t//if no space direction is set, let's use the identity\r\n\t\t\t\theaderObject.vectors = [ new Vector3( 1, 0, 0 ), new Vector3( 0, 1, 0 ), new Vector3( 0, 0, 1 ) ];\r\n\t\t\t\t//apply spacing if defined\r\n\t\t\t\tif ( headerObject.spacings ) {\r\n\r\n\t\t\t\t\tfor ( i = 0; i <= 2; i ++ ) {\r\n\r\n\t\t\t\t\t\tif ( ! isNaN( headerObject.spacings[ i ] ) ) {\r\n\r\n\t\t\t\t\t\t\theaderObject.vectors[ i ].multiplyScalar( headerObject.spacings[ i ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t//parse the data when registred as one of this type : 'text', 'ascii', 'txt'\r\n\t\tfunction parseDataAsText( data, start, end ) {\r\n\r\n\t\t\tvar number = '';\r\n\t\t\tstart = start || 0;\r\n\t\t\tend = end || data.length;\r\n\t\t\tvar value;\r\n\t\t\t//length of the result is the product of the sizes\r\n\t\t\tvar lengthOfTheResult = headerObject.sizes.reduce( function ( previous, current ) {\r\n\r\n\t\t\t\treturn previous * current;\r\n\r\n\t\t\t}, 1 );\r\n\r\n\t\t\tvar base = 10;\r\n\t\t\tif ( headerObject.encoding === 'hex' ) {\r\n\r\n\t\t\t\tbase = 16;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar result = new headerObject.__array( lengthOfTheResult );\r\n\t\t\tvar resultIndex = 0;\r\n\t\t\tvar parsingFunction = parseInt;\r\n\t\t\tif ( headerObject.__array === Float32Array || headerObject.__array === Float64Array ) {\r\n\r\n\t\t\t\tparsingFunction = parseFloat;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var i = start; i < end; i ++ ) {\r\n\r\n\t\t\t\tvalue = data[ i ];\r\n\t\t\t\t//if value is not a space\r\n\t\t\t\tif ( ( value < 9 || value > 13 ) && value !== 32 ) {\r\n\r\n\t\t\t\t\tnumber += String.fromCharCode( value );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( number !== '' ) {\r\n\r\n\t\t\t\t\t\tresult[ resultIndex ] = parsingFunction( number, base );\r\n\t\t\t\t\t\tresultIndex ++;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnumber = '';\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( number !== '' ) {\r\n\r\n\t\t\t\tresult[ resultIndex ] = parsingFunction( number, base );\r\n\t\t\t\tresultIndex ++;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\r\n\t\t}\r\n\r\n\t\tvar _bytes = scan( 'uchar', data.byteLength );\r\n\t\tvar _length = _bytes.length;\r\n\t\tvar _header = null;\r\n\t\tvar _data_start = 0;\r\n\t\tvar i;\r\n\t\tfor ( i = 1; i < _length; i ++ ) {\r\n\r\n\t\t\tif ( _bytes[ i - 1 ] == 10 && _bytes[ i ] == 10 ) {\r\n\r\n\t\t\t\t// we found two line breaks in a row\r\n\t\t\t\t// now we know what the header is\r\n\t\t\t\t_header = this.parseChars( _bytes, 0, i - 2 );\r\n\t\t\t\t// this is were the data starts\r\n\t\t\t\t_data_start = i + 1;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// parse the header\r\n\t\tparseHeader( _header );\r\n\r\n\t\tvar _data = _bytes.subarray( _data_start ); // the data without header\r\n\t\tif ( headerObject.encoding === 'gzip' || headerObject.encoding === 'gz' ) {\r\n\r\n\t\t\t// we need to decompress the datastream\r\n\t\t\t// here we start the unzipping and get a typed Uint8Array back\r\n\t\t\tvar inflate = new Zlib.Gunzip( new Uint8Array( _data ) ); // eslint-disable-line no-undef\r\n\t\t\t_data = inflate.decompress();\r\n\r\n\t\t} else if ( headerObject.encoding === 'ascii' || headerObject.encoding === 'text' || headerObject.encoding === 'txt' || headerObject.encoding === 'hex' ) {\r\n\r\n\t\t\t_data = parseDataAsText( _data );\r\n\r\n\t\t} else if ( headerObject.encoding === 'raw' ) {\r\n\r\n\t\t\t//we need to copy the array to create a new array buffer, else we retrieve the original arraybuffer with the header\r\n\t\t\tvar _copy = new Uint8Array( _data.length );\r\n\r\n\t\t\tfor ( var i = 0; i < _data.length; i ++ ) {\r\n\r\n\t\t\t\t_copy[ i ] = _data[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_data = _copy;\r\n\r\n\t\t}\r\n\r\n\t\t// .. let's use the underlying array buffer\r\n\t\t_data = _data.buffer;\r\n\r\n\t\tvar volume = new Volume();\r\n\t\tvolume.header = headerObject;\r\n\t\t//\r\n\t\t// parse the (unzipped) data to a datastream of the correct type\r\n\t\t//\r\n\t\tvolume.data = new headerObject.__array( _data );\r\n\t\t// get the min and max intensities\r\n\t\tvar min_max = volume.computeMinMax();\r\n\t\tvar min = min_max[ 0 ];\r\n\t\tvar max = min_max[ 1 ];\r\n\t\t// attach the scalar range to the volume\r\n\t\tvolume.windowLow = min;\r\n\t\tvolume.windowHigh = max;\r\n\r\n\t\t// get the image dimensions\r\n\t\tvolume.dimensions = [ headerObject.sizes[ 0 ], headerObject.sizes[ 1 ], headerObject.sizes[ 2 ] ];\r\n\t\tvolume.xLength = volume.dimensions[ 0 ];\r\n\t\tvolume.yLength = volume.dimensions[ 1 ];\r\n\t\tvolume.zLength = volume.dimensions[ 2 ];\r\n\t\t// spacing\r\n\t\tvar spacingX = ( new Vector3( headerObject.vectors[ 0 ][ 0 ], headerObject.vectors[ 0 ][ 1 ],\r\n\t\t\theaderObject.vectors[ 0 ][ 2 ] ) ).length();\r\n\t\tvar spacingY = ( new Vector3( headerObject.vectors[ 1 ][ 0 ], headerObject.vectors[ 1 ][ 1 ],\r\n\t\t\theaderObject.vectors[ 1 ][ 2 ] ) ).length();\r\n\t\tvar spacingZ = ( new Vector3( headerObject.vectors[ 2 ][ 0 ], headerObject.vectors[ 2 ][ 1 ],\r\n\t\t\theaderObject.vectors[ 2 ][ 2 ] ) ).length();\r\n\t\tvolume.spacing = [ spacingX, spacingY, spacingZ ];\r\n\r\n\r\n\t\t// Create IJKtoRAS matrix\r\n\t\tvolume.matrix = new Matrix4();\r\n\r\n\t\tvar _spaceX = 1;\r\n\t\tvar _spaceY = 1;\r\n\t\tvar _spaceZ = 1;\r\n\r\n\t\tif ( headerObject.space == \"left-posterior-superior\" ) {\r\n\r\n\t\t\t_spaceX = - 1;\r\n\t\t\t_spaceY = - 1;\r\n\r\n\t\t} else if ( headerObject.space === 'left-anterior-superior' ) {\r\n\r\n\t\t\t_spaceX = - 1;\r\n\r\n\t\t}\r\n\r\n\r\n\t\tif ( ! headerObject.vectors ) {\r\n\r\n\t\t\tvolume.matrix.set(\r\n\t\t\t\t_spaceX, 0, 0, 0,\r\n\t\t\t\t0, _spaceY, 0, 0,\r\n\t\t\t\t0, 0, _spaceZ, 0,\r\n\t\t\t\t0, 0, 0, 1 );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar v = headerObject.vectors;\r\n\r\n\t\t\tvolume.matrix.set(\r\n\t\t\t\t_spaceX * v[ 0 ][ 0 ], _spaceX * v[ 1 ][ 0 ], _spaceX * v[ 2 ][ 0 ], 0,\r\n\t\t\t\t_spaceY * v[ 0 ][ 1 ], _spaceY * v[ 1 ][ 1 ], _spaceY * v[ 2 ][ 1 ], 0,\r\n\t\t\t\t_spaceZ * v[ 0 ][ 2 ], _spaceZ * v[ 1 ][ 2 ], _spaceZ * v[ 2 ][ 2 ], 0,\r\n\t\t\t\t0, 0, 0, 1 );\r\n\r\n\t\t}\r\n\r\n\t\tvolume.inverseMatrix = new Matrix4();\r\n\t\tvolume.inverseMatrix.copy( volume.matrix ).invert();\r\n\t\tvolume.RASDimensions = ( new Vector3( volume.xLength, volume.yLength, volume.zLength ) ).applyMatrix4( volume.matrix ).round().toArray().map( Math.abs );\r\n\r\n\t\t// .. and set the default threshold\r\n\t\t// only if the threshold was not already set\r\n\t\tif ( volume.lowerThreshold === - Infinity ) {\r\n\r\n\t\t\tvolume.lowerThreshold = min;\r\n\r\n\t\t}\r\n\r\n\t\tif ( volume.upperThreshold === Infinity ) {\r\n\r\n\t\t\tvolume.upperThreshold = max;\r\n\r\n\t\t}\r\n\r\n\t\treturn volume;\r\n\r\n\t},\r\n\r\n\tparseChars: function ( array, start, end ) {\r\n\r\n\t\t// without borders, use the whole array\r\n\t\tif ( start === undefined ) {\r\n\r\n\t\t\tstart = 0;\r\n\r\n\t\t}\r\n\r\n\t\tif ( end === undefined ) {\r\n\r\n\t\t\tend = array.length;\r\n\r\n\t\t}\r\n\r\n\t\tvar output = '';\r\n\t\t// create and append the chars\r\n\t\tvar i = 0;\r\n\t\tfor ( i = start; i < end; ++ i ) {\r\n\r\n\t\t\toutput += String.fromCharCode( array[ i ] );\r\n\r\n\t\t}\r\n\r\n\t\treturn output;\r\n\r\n\t},\r\n\r\n\tfieldFunctions: {\r\n\r\n\t\ttype: function ( data ) {\r\n\r\n\t\t\tswitch ( data ) {\r\n\r\n\t\t\t\tcase 'uchar':\r\n\t\t\t\tcase 'unsigned char':\r\n\t\t\t\tcase 'uint8':\r\n\t\t\t\tcase 'uint8_t':\r\n\t\t\t\t\tthis.__array = Uint8Array;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'signed char':\r\n\t\t\t\tcase 'int8':\r\n\t\t\t\tcase 'int8_t':\r\n\t\t\t\t\tthis.__array = Int8Array;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'short':\r\n\t\t\t\tcase 'short int':\r\n\t\t\t\tcase 'signed short':\r\n\t\t\t\tcase 'signed short int':\r\n\t\t\t\tcase 'int16':\r\n\t\t\t\tcase 'int16_t':\r\n\t\t\t\t\tthis.__array = Int16Array;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'ushort':\r\n\t\t\t\tcase 'unsigned short':\r\n\t\t\t\tcase 'unsigned short int':\r\n\t\t\t\tcase 'uint16':\r\n\t\t\t\tcase 'uint16_t':\r\n\t\t\t\t\tthis.__array = Uint16Array;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'int':\r\n\t\t\t\tcase 'signed int':\r\n\t\t\t\tcase 'int32':\r\n\t\t\t\tcase 'int32_t':\r\n\t\t\t\t\tthis.__array = Int32Array;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'uint':\r\n\t\t\t\tcase 'unsigned int':\r\n\t\t\t\tcase 'uint32':\r\n\t\t\t\tcase 'uint32_t':\r\n\t\t\t\t\tthis.__array = Uint32Array;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'float':\r\n\t\t\t\t\tthis.__array = Float32Array;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'double':\r\n\t\t\t\t\tthis.__array = Float64Array;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow new Error( 'Unsupported NRRD data type: ' + data );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn this.type = data;\r\n\r\n\t\t},\r\n\r\n\t\tendian: function ( data ) {\r\n\r\n\t\t\treturn this.endian = data;\r\n\r\n\t\t},\r\n\r\n\t\tencoding: function ( data ) {\r\n\r\n\t\t\treturn this.encoding = data;\r\n\r\n\t\t},\r\n\r\n\t\tdimension: function ( data ) {\r\n\r\n\t\t\treturn this.dim = parseInt( data, 10 );\r\n\r\n\t\t},\r\n\r\n\t\tsizes: function ( data ) {\r\n\r\n\t\t\tvar i;\r\n\t\t\treturn this.sizes = ( function () {\r\n\r\n\t\t\t\tvar _i, _len, _ref, _results;\r\n\t\t\t\t_ref = data.split( /\\s+/ );\r\n\t\t\t\t_results = [];\r\n\r\n\t\t\t\tfor ( _i = 0, _len = _ref.length; _i < _len; _i ++ ) {\r\n\r\n\t\t\t\t\ti = _ref[ _i ];\r\n\t\t\t\t\t_results.push( parseInt( i, 10 ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn _results;\r\n\r\n\t\t\t} )();\r\n\r\n\t\t},\r\n\r\n\t\tspace: function ( data ) {\r\n\r\n\t\t\treturn this.space = data;\r\n\r\n\t\t},\r\n\r\n\t\t'space origin': function ( data ) {\r\n\r\n\t\t\treturn this.space_origin = data.split( \"(\" )[ 1 ].split( \")\" )[ 0 ].split( \",\" );\r\n\r\n\t\t},\r\n\r\n\t\t'space directions': function ( data ) {\r\n\r\n\t\t\tvar f, parts, v;\r\n\t\t\tparts = data.match( /\\(.*?\\)/g );\r\n\t\t\treturn this.vectors = ( function () {\r\n\r\n\t\t\t\tvar _i, _len, _results;\r\n\t\t\t\t_results = [];\r\n\r\n\t\t\t\tfor ( _i = 0, _len = parts.length; _i < _len; _i ++ ) {\r\n\r\n\t\t\t\t\tv = parts[ _i ];\r\n\t\t\t\t\t_results.push( ( function () {\r\n\r\n\t\t\t\t\t\tvar _j, _len2, _ref, _results2;\r\n\t\t\t\t\t\t_ref = v.slice( 1, - 1 ).split( /,/ );\r\n\t\t\t\t\t\t_results2 = [];\r\n\r\n\t\t\t\t\t\tfor ( _j = 0, _len2 = _ref.length; _j < _len2; _j ++ ) {\r\n\r\n\t\t\t\t\t\t\tf = _ref[ _j ];\r\n\t\t\t\t\t\t\t_results2.push( parseFloat( f ) );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn _results2;\r\n\r\n\t\t\t\t\t} )() );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn _results;\r\n\r\n\t\t\t} )();\r\n\r\n\t\t},\r\n\r\n\t\tspacings: function ( data ) {\r\n\r\n\t\t\tvar f, parts;\r\n\t\t\tparts = data.split( /\\s+/ );\r\n\t\t\treturn this.spacings = ( function () {\r\n\r\n\t\t\t\tvar _i, _len, _results = [];\r\n\r\n\t\t\t\tfor ( _i = 0, _len = parts.length; _i < _len; _i ++ ) {\r\n\r\n\t\t\t\t\tf = parts[ _i ];\r\n\t\t\t\t\t_results.push( parseFloat( f ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn _results;\r\n\r\n\t\t\t} )();\r\n\r\n\t\t}\r\n\t}\r\n\r\n} );\r\n\r\nexport { NRRDLoader };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/loaders/NRRDLoader.js","import {\r\n\tBufferAttribute,\r\n\tBufferGeometry,\r\n\tFileLoader,\r\n\tFloat32BufferAttribute,\r\n\tLoader,\r\n\tLoaderUtils\r\n} from \"@/components/build/three.module.js\";\r\nimport { Inflate } from \"../libs/inflate.module.min.js\";\r\n\r\nvar VTKLoader = function ( manager ) {\r\n\r\n\tLoader.call( this, manager );\r\n\r\n};\r\n\r\nVTKLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\tconstructor: VTKLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar loader = new FileLoader( scope.manager );\r\n\t\tloader.setPath( scope.path );\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\t\tloader.setRequestHeader( scope.requestHeader );\r\n\t\tloader.setWithCredentials( scope.withCredentials );\r\n\t\tloader.load( url, function ( text ) {\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\tonLoad( scope.parse( text ) );\r\n\r\n\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\tif ( onError ) {\r\n\r\n\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.manager.itemError( url );\r\n\r\n\t\t\t}\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tparse: function ( data ) {\r\n\r\n\t\tfunction parseASCII( data ) {\r\n\r\n\t\t\t// connectivity of the triangles\r\n\t\t\tvar indices = [];\r\n\r\n\t\t\t// triangles vertices\r\n\t\t\tvar positions = [];\r\n\r\n\t\t\t// red, green, blue colors in the range 0 to 1\r\n\t\t\tvar colors = [];\r\n\r\n\t\t\t// normal vector, one per vertex\r\n\t\t\tvar normals = [];\r\n\r\n\t\t\tvar result;\r\n\r\n\t\t\t// pattern for detecting the end of a number sequence\r\n\t\t\tvar patWord = /^[^\\d.\\s-]+/;\r\n\r\n\t\t\t// pattern for reading vertices, 3 floats or integers\r\n\t\t\tvar pat3Floats = /(\\-?\\d+\\.?[\\d\\-\\+e]*)\\s+(\\-?\\d+\\.?[\\d\\-\\+e]*)\\s+(\\-?\\d+\\.?[\\d\\-\\+e]*)/g;\r\n\r\n\t\t\t// pattern for connectivity, an integer followed by any number of ints\r\n\t\t\t// the first integer is the number of polygon nodes\r\n\t\t\tvar patConnectivity = /^(\\d+)\\s+([\\s\\d]*)/;\r\n\r\n\t\t\t// indicates start of vertex data section\r\n\t\t\tvar patPOINTS = /^POINTS /;\r\n\r\n\t\t\t// indicates start of polygon connectivity section\r\n\t\t\tvar patPOLYGONS = /^POLYGONS /;\r\n\r\n\t\t\t// indicates start of triangle strips section\r\n\t\t\tvar patTRIANGLE_STRIPS = /^TRIANGLE_STRIPS /;\r\n\r\n\t\t\t// POINT_DATA number_of_values\r\n\t\t\tvar patPOINT_DATA = /^POINT_DATA[ ]+(\\d+)/;\r\n\r\n\t\t\t// CELL_DATA number_of_polys\r\n\t\t\tvar patCELL_DATA = /^CELL_DATA[ ]+(\\d+)/;\r\n\r\n\t\t\t// Start of color section\r\n\t\t\tvar patCOLOR_SCALARS = /^COLOR_SCALARS[ ]+(\\w+)[ ]+3/;\r\n\r\n\t\t\t// NORMALS Normals float\r\n\t\t\tvar patNORMALS = /^NORMALS[ ]+(\\w+)[ ]+(\\w+)/;\r\n\r\n\t\t\tvar inPointsSection = false;\r\n\t\t\tvar inPolygonsSection = false;\r\n\t\t\tvar inTriangleStripSection = false;\r\n\t\t\tvar inPointDataSection = false;\r\n\t\t\tvar inCellDataSection = false;\r\n\t\t\tvar inColorSection = false;\r\n\t\t\tvar inNormalsSection = false;\r\n\r\n\t\t\tvar lines = data.split( '\\n' );\r\n\r\n\t\t\tfor ( var i in lines ) {\r\n\r\n\t\t\t\tvar line = lines[ i ].trim();\r\n\r\n\t\t\t\tif ( line.indexOf( 'DATASET' ) === 0 ) {\r\n\r\n\t\t\t\t\tvar dataset = line.split( ' ' )[ 1 ];\r\n\r\n\t\t\t\t\tif ( dataset !== 'POLYDATA' ) throw new Error( 'Unsupported DATASET type: ' + dataset );\r\n\r\n\t\t\t\t} else if ( inPointsSection ) {\r\n\r\n\t\t\t\t\t// get the vertices\r\n\t\t\t\t\twhile ( ( result = pat3Floats.exec( line ) ) !== null ) {\r\n\r\n\t\t\t\t\t\tif ( patWord.exec( line ) !== null ) break;\r\n\r\n\t\t\t\t\t\tvar x = parseFloat( result[ 1 ] );\r\n\t\t\t\t\t\tvar y = parseFloat( result[ 2 ] );\r\n\t\t\t\t\t\tvar z = parseFloat( result[ 3 ] );\r\n\t\t\t\t\t\tpositions.push( x, y, z );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( inPolygonsSection ) {\r\n\r\n\t\t\t\t\tif ( ( result = patConnectivity.exec( line ) ) !== null ) {\r\n\r\n\t\t\t\t\t\t// numVertices i0 i1 i2 ...\r\n\t\t\t\t\t\tvar numVertices = parseInt( result[ 1 ] );\r\n\t\t\t\t\t\tvar inds = result[ 2 ].split( /\\s+/ );\r\n\r\n\t\t\t\t\t\tif ( numVertices >= 3 ) {\r\n\r\n\t\t\t\t\t\t\tvar i0 = parseInt( inds[ 0 ] );\r\n\t\t\t\t\t\t\tvar i1, i2;\r\n\t\t\t\t\t\t\tvar k = 1;\r\n\t\t\t\t\t\t\t// split the polygon in numVertices - 2 triangles\r\n\t\t\t\t\t\t\tfor ( var j = 0; j < numVertices - 2; ++ j ) {\r\n\r\n\t\t\t\t\t\t\t\ti1 = parseInt( inds[ k ] );\r\n\t\t\t\t\t\t\t\ti2 = parseInt( inds[ k + 1 ] );\r\n\t\t\t\t\t\t\t\tindices.push( i0, i1, i2 );\r\n\t\t\t\t\t\t\t\tk ++;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( inTriangleStripSection ) {\r\n\r\n\t\t\t\t\tif ( ( result = patConnectivity.exec( line ) ) !== null ) {\r\n\r\n\t\t\t\t\t\t// numVertices i0 i1 i2 ...\r\n\t\t\t\t\t\tvar numVertices = parseInt( result[ 1 ] );\r\n\t\t\t\t\t\tvar inds = result[ 2 ].split( /\\s+/ );\r\n\r\n\t\t\t\t\t\tif ( numVertices >= 3 ) {\r\n\r\n\t\t\t\t\t\t\tvar i0, i1, i2;\r\n\t\t\t\t\t\t\t// split the polygon in numVertices - 2 triangles\r\n\t\t\t\t\t\t\tfor ( var j = 0; j < numVertices - 2; j ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tif ( j % 2 === 1 ) {\r\n\r\n\t\t\t\t\t\t\t\t\ti0 = parseInt( inds[ j ] );\r\n\t\t\t\t\t\t\t\t\ti1 = parseInt( inds[ j + 2 ] );\r\n\t\t\t\t\t\t\t\t\ti2 = parseInt( inds[ j + 1 ] );\r\n\t\t\t\t\t\t\t\t\tindices.push( i0, i1, i2 );\r\n\r\n\t\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\t\ti0 = parseInt( inds[ j ] );\r\n\t\t\t\t\t\t\t\t\ti1 = parseInt( inds[ j + 1 ] );\r\n\t\t\t\t\t\t\t\t\ti2 = parseInt( inds[ j + 2 ] );\r\n\t\t\t\t\t\t\t\t\tindices.push( i0, i1, i2 );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( inPointDataSection || inCellDataSection ) {\r\n\r\n\t\t\t\t\tif ( inColorSection ) {\r\n\r\n\t\t\t\t\t\t// Get the colors\r\n\r\n\t\t\t\t\t\twhile ( ( result = pat3Floats.exec( line ) ) !== null ) {\r\n\r\n\t\t\t\t\t\t\tif ( patWord.exec( line ) !== null ) break;\r\n\r\n\t\t\t\t\t\t\tvar r = parseFloat( result[ 1 ] );\r\n\t\t\t\t\t\t\tvar g = parseFloat( result[ 2 ] );\r\n\t\t\t\t\t\t\tvar b = parseFloat( result[ 3 ] );\r\n\t\t\t\t\t\t\tcolors.push( r, g, b );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( inNormalsSection ) {\r\n\r\n\t\t\t\t\t\t// Get the normal vectors\r\n\r\n\t\t\t\t\t\twhile ( ( result = pat3Floats.exec( line ) ) !== null ) {\r\n\r\n\t\t\t\t\t\t\tif ( patWord.exec( line ) !== null ) break;\r\n\r\n\t\t\t\t\t\t\tvar nx = parseFloat( result[ 1 ] );\r\n\t\t\t\t\t\t\tvar ny = parseFloat( result[ 2 ] );\r\n\t\t\t\t\t\t\tvar nz = parseFloat( result[ 3 ] );\r\n\t\t\t\t\t\t\tnormals.push( nx, ny, nz );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( patPOLYGONS.exec( line ) !== null ) {\r\n\r\n\t\t\t\t\tinPolygonsSection = true;\r\n\t\t\t\t\tinPointsSection = false;\r\n\t\t\t\t\tinTriangleStripSection = false;\r\n\r\n\t\t\t\t} else if ( patPOINTS.exec( line ) !== null ) {\r\n\r\n\t\t\t\t\tinPolygonsSection = false;\r\n\t\t\t\t\tinPointsSection = true;\r\n\t\t\t\t\tinTriangleStripSection = false;\r\n\r\n\t\t\t\t} else if ( patTRIANGLE_STRIPS.exec( line ) !== null ) {\r\n\r\n\t\t\t\t\tinPolygonsSection = false;\r\n\t\t\t\t\tinPointsSection = false;\r\n\t\t\t\t\tinTriangleStripSection = true;\r\n\r\n\t\t\t\t} else if ( patPOINT_DATA.exec( line ) !== null ) {\r\n\r\n\t\t\t\t\tinPointDataSection = true;\r\n\t\t\t\t\tinPointsSection = false;\r\n\t\t\t\t\tinPolygonsSection = false;\r\n\t\t\t\t\tinTriangleStripSection = false;\r\n\r\n\t\t\t\t} else if ( patCELL_DATA.exec( line ) !== null ) {\r\n\r\n\t\t\t\t\tinCellDataSection = true;\r\n\t\t\t\t\tinPointsSection = false;\r\n\t\t\t\t\tinPolygonsSection = false;\r\n\t\t\t\t\tinTriangleStripSection = false;\r\n\r\n\t\t\t\t} else if ( patCOLOR_SCALARS.exec( line ) !== null ) {\r\n\r\n\t\t\t\t\tinColorSection = true;\r\n\t\t\t\t\tinNormalsSection = false;\r\n\t\t\t\t\tinPointsSection = false;\r\n\t\t\t\t\tinPolygonsSection = false;\r\n\t\t\t\t\tinTriangleStripSection = false;\r\n\r\n\t\t\t\t} else if ( patNORMALS.exec( line ) !== null ) {\r\n\r\n\t\t\t\t\tinNormalsSection = true;\r\n\t\t\t\t\tinColorSection = false;\r\n\t\t\t\t\tinPointsSection = false;\r\n\t\t\t\t\tinPolygonsSection = false;\r\n\t\t\t\t\tinTriangleStripSection = false;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar geometry = new BufferGeometry();\r\n\t\t\tgeometry.setIndex( indices );\r\n\t\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( positions, 3 ) );\r\n\r\n\t\t\tif ( normals.length === positions.length ) {\r\n\r\n\t\t\t\tgeometry.setAttribute( 'normal', new Float32BufferAttribute( normals, 3 ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( colors.length !== indices.length ) {\r\n\r\n\t\t\t\t// stagger\r\n\r\n\t\t\t\tif ( colors.length === positions.length ) {\r\n\r\n\t\t\t\t\tgeometry.setAttribute( 'color', new Float32BufferAttribute( colors, 3 ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// cell\r\n\r\n\t\t\t\tgeometry = geometry.toNonIndexed();\r\n\t\t\t\tvar numTriangles = geometry.attributes.position.count / 3;\r\n\r\n\t\t\t\tif ( colors.length === ( numTriangles * 3 ) ) {\r\n\r\n\t\t\t\t\tvar newColors = [];\r\n\r\n\t\t\t\t\tfor ( var i = 0; i < numTriangles; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar r = colors[ 3 * i + 0 ];\r\n\t\t\t\t\t\tvar g = colors[ 3 * i + 1 ];\r\n\t\t\t\t\t\tvar b = colors[ 3 * i + 2 ];\r\n\r\n\t\t\t\t\t\tnewColors.push( r, g, b );\r\n\t\t\t\t\t\tnewColors.push( r, g, b );\r\n\t\t\t\t\t\tnewColors.push( r, g, b );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tgeometry.setAttribute( 'color', new Float32BufferAttribute( newColors, 3 ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn geometry;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseBinary( data ) {\r\n\r\n\t\t\tvar count, pointIndex, i, numberOfPoints, s;\r\n\t\t\tvar buffer = new Uint8Array( data );\r\n\t\t\tvar dataView = new DataView( data );\r\n\r\n\t\t\t// Points and normals, by default, are empty\r\n\t\t\tvar points = [];\r\n\t\t\tvar normals = [];\r\n\t\t\tvar indices = [];\r\n\r\n\t\t\t// Going to make a big array of strings\r\n\t\t\tvar vtk = [];\r\n\t\t\tvar index = 0;\r\n\r\n\t\t\tfunction findString( buffer, start ) {\r\n\r\n\t\t\t\tvar index = start;\r\n\t\t\t\tvar c = buffer[ index ];\r\n\t\t\t\tvar s = [];\r\n\t\t\t\twhile ( c !== 10 ) {\r\n\r\n\t\t\t\t\ts.push( String.fromCharCode( c ) );\r\n\t\t\t\t\tindex ++;\r\n\t\t\t\t\tc = buffer[ index ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn { start: start,\r\n\t\t\t\t\tend: index,\r\n\t\t\t\t\tnext: index + 1,\r\n\t\t\t\t\tparsedString: s.join( '' ) };\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar state, line;\r\n\r\n\t\t\twhile ( true ) {\r\n\r\n\t\t\t\t// Get a string\r\n\t\t\t\tstate = findString( buffer, index );\r\n\t\t\t\tline = state.parsedString;\r\n\r\n\t\t\t\tif ( line.indexOf( 'DATASET' ) === 0 ) {\r\n\r\n\t\t\t\t\tvar dataset = line.split( ' ' )[ 1 ];\r\n\r\n\t\t\t\t\tif ( dataset !== 'POLYDATA' ) throw new Error( 'Unsupported DATASET type: ' + dataset );\r\n\r\n\t\t\t\t} else if ( line.indexOf( 'POINTS' ) === 0 ) {\r\n\r\n\t\t\t\t\tvtk.push( line );\r\n\t\t\t\t\t// Add the points\r\n\t\t\t\t\tnumberOfPoints = parseInt( line.split( ' ' )[ 1 ], 10 );\r\n\r\n\t\t\t\t\t// Each point is 3 4-byte floats\r\n\t\t\t\t\tcount = numberOfPoints * 4 * 3;\r\n\r\n\t\t\t\t\tpoints = new Float32Array( numberOfPoints * 3 );\r\n\r\n\t\t\t\t\tpointIndex = state.next;\r\n\t\t\t\t\tfor ( i = 0; i < numberOfPoints; i ++ ) {\r\n\r\n\t\t\t\t\t\tpoints[ 3 * i ] = dataView.getFloat32( pointIndex, false );\r\n\t\t\t\t\t\tpoints[ 3 * i + 1 ] = dataView.getFloat32( pointIndex + 4, false );\r\n\t\t\t\t\t\tpoints[ 3 * i + 2 ] = dataView.getFloat32( pointIndex + 8, false );\r\n\t\t\t\t\t\tpointIndex = pointIndex + 12;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// increment our next pointer\r\n\t\t\t\t\tstate.next = state.next + count + 1;\r\n\r\n\t\t\t\t} else if ( line.indexOf( 'TRIANGLE_STRIPS' ) === 0 ) {\r\n\r\n\t\t\t\t\tvar numberOfStrips = parseInt( line.split( ' ' )[ 1 ], 10 );\r\n\t\t\t\t\tvar size = parseInt( line.split( ' ' )[ 2 ], 10 );\r\n\t\t\t\t\t// 4 byte integers\r\n\t\t\t\t\tcount = size * 4;\r\n\r\n\t\t\t\t\tindices = new Uint32Array( 3 * size - 9 * numberOfStrips );\r\n\t\t\t\t\tvar indicesIndex = 0;\r\n\r\n\t\t\t\t\tpointIndex = state.next;\r\n\t\t\t\t\tfor ( i = 0; i < numberOfStrips; i ++ ) {\r\n\r\n\t\t\t\t\t\t// For each strip, read the first value, then record that many more points\r\n\t\t\t\t\t\tvar indexCount = dataView.getInt32( pointIndex, false );\r\n\t\t\t\t\t\tvar strip = [];\r\n\t\t\t\t\t\tpointIndex += 4;\r\n\t\t\t\t\t\tfor ( s = 0; s < indexCount; s ++ ) {\r\n\r\n\t\t\t\t\t\t\tstrip.push( dataView.getInt32( pointIndex, false ) );\r\n\t\t\t\t\t\t\tpointIndex += 4;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// retrieves the n-2 triangles from the triangle strip\r\n\t\t\t\t\t\tfor ( var j = 0; j < indexCount - 2; j ++ ) {\r\n\r\n\t\t\t\t\t\t\tif ( j % 2 ) {\r\n\r\n\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ j ];\r\n\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ j + 2 ];\r\n\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ j + 1 ];\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\r\n\r\n\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ j ];\r\n\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ j + 1 ];\r\n\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ j + 2 ];\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// increment our next pointer\r\n\t\t\t\t\tstate.next = state.next + count + 1;\r\n\r\n\t\t\t\t} else if ( line.indexOf( 'POLYGONS' ) === 0 ) {\r\n\r\n\t\t\t\t\tvar numberOfStrips = parseInt( line.split( ' ' )[ 1 ], 10 );\r\n\t\t\t\t\tvar size = parseInt( line.split( ' ' )[ 2 ], 10 );\r\n\t\t\t\t\t// 4 byte integers\r\n\t\t\t\t\tcount = size * 4;\r\n\r\n\t\t\t\t\tindices = new Uint32Array( 3 * size - 9 * numberOfStrips );\r\n\t\t\t\t\tvar indicesIndex = 0;\r\n\r\n\t\t\t\t\tpointIndex = state.next;\r\n\t\t\t\t\tfor ( i = 0; i < numberOfStrips; i ++ ) {\r\n\r\n\t\t\t\t\t\t// For each strip, read the first value, then record that many more points\r\n\t\t\t\t\t\tvar indexCount = dataView.getInt32( pointIndex, false );\r\n\t\t\t\t\t\tvar strip = [];\r\n\t\t\t\t\t\tpointIndex += 4;\r\n\t\t\t\t\t\tfor ( s = 0; s < indexCount; s ++ ) {\r\n\r\n\t\t\t\t\t\t\tstrip.push( dataView.getInt32( pointIndex, false ) );\r\n\t\t\t\t\t\t\tpointIndex += 4;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// divide the polygon in n-2 triangle\r\n\t\t\t\t\t\tfor ( var j = 1; j < indexCount - 1; j ++ ) {\r\n\r\n\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ 0 ];\r\n\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ j ];\r\n\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ j + 1 ];\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// increment our next pointer\r\n\t\t\t\t\tstate.next = state.next + count + 1;\r\n\r\n\t\t\t\t} else if ( line.indexOf( 'POINT_DATA' ) === 0 ) {\r\n\r\n\t\t\t\t\tnumberOfPoints = parseInt( line.split( ' ' )[ 1 ], 10 );\r\n\r\n\t\t\t\t\t// Grab the next line\r\n\t\t\t\t\tstate = findString( buffer, state.next );\r\n\r\n\t\t\t\t\t// Now grab the binary data\r\n\t\t\t\t\tcount = numberOfPoints * 4 * 3;\r\n\r\n\t\t\t\t\tnormals = new Float32Array( numberOfPoints * 3 );\r\n\t\t\t\t\tpointIndex = state.next;\r\n\t\t\t\t\tfor ( i = 0; i < numberOfPoints; i ++ ) {\r\n\r\n\t\t\t\t\t\tnormals[ 3 * i ] = dataView.getFloat32( pointIndex, false );\r\n\t\t\t\t\t\tnormals[ 3 * i + 1 ] = dataView.getFloat32( pointIndex + 4, false );\r\n\t\t\t\t\t\tnormals[ 3 * i + 2 ] = dataView.getFloat32( pointIndex + 8, false );\r\n\t\t\t\t\t\tpointIndex += 12;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Increment past our data\r\n\t\t\t\t\tstate.next = state.next + count;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Increment index\r\n\t\t\t\tindex = state.next;\r\n\r\n\t\t\t\tif ( index >= buffer.byteLength ) {\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar geometry = new BufferGeometry();\r\n\t\t\tgeometry.setIndex( new BufferAttribute( indices, 1 ) );\r\n\t\t\tgeometry.setAttribute( 'position', new BufferAttribute( points, 3 ) );\r\n\r\n\t\t\tif ( normals.length === points.length ) {\r\n\r\n\t\t\t\tgeometry.setAttribute( 'normal', new BufferAttribute( normals, 3 ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn geometry;\r\n\r\n\t\t}\r\n\r\n\t\tfunction Float32Concat( first, second ) {\r\n\r\n\t\t    var firstLength = first.length, result = new Float32Array( firstLength + second.length );\r\n\r\n\t\t    result.set( first );\r\n\t\t    result.set( second, firstLength );\r\n\r\n\t\t    return result;\r\n\r\n\t\t}\r\n\r\n\t\tfunction Int32Concat( first, second ) {\r\n\r\n\t\t    var firstLength = first.length, result = new Int32Array( firstLength + second.length );\r\n\r\n\t\t    result.set( first );\r\n\t\t    result.set( second, firstLength );\r\n\r\n\t\t    return result;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseXML( stringFile ) {\r\n\r\n\t\t\t// Changes XML to JSON, based on https://davidwalsh.name/convert-xml-json\r\n\r\n\t\t\tfunction xmlToJson( xml ) {\r\n\r\n\t\t\t\t// Create the return object\r\n\t\t\t\tvar obj = {};\r\n\r\n\t\t\t\tif ( xml.nodeType === 1 ) { // element\r\n\r\n\t\t\t\t\t// do attributes\r\n\r\n\t\t\t\t\tif ( xml.attributes ) {\r\n\r\n\t\t\t\t\t\tif ( xml.attributes.length > 0 ) {\r\n\r\n\t\t\t\t\t\t\tobj[ 'attributes' ] = {};\r\n\r\n\t\t\t\t\t\t\tfor ( var j = 0; j < xml.attributes.length; j ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tvar attribute = xml.attributes.item( j );\r\n\t\t\t\t\t\t\t\tobj[ 'attributes' ][ attribute.nodeName ] = attribute.nodeValue.trim();\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( xml.nodeType === 3 ) { // text\r\n\r\n\t\t\t\t\tobj = xml.nodeValue.trim();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// do children\r\n\t\t\t\tif ( xml.hasChildNodes() ) {\r\n\r\n\t\t\t\t\tfor ( var i = 0; i < xml.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar item = xml.childNodes.item( i );\r\n\t\t\t\t\t\tvar nodeName = item.nodeName;\r\n\r\n\t\t\t\t\t\tif ( typeof obj[ nodeName ] === 'undefined' ) {\r\n\r\n\t\t\t\t\t\t\tvar tmp = xmlToJson( item );\r\n\r\n\t\t\t\t\t\t\tif ( tmp !== '' ) obj[ nodeName ] = tmp;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tif ( typeof obj[ nodeName ].push === 'undefined' ) {\r\n\r\n\t\t\t\t\t\t\t\tvar old = obj[ nodeName ];\r\n\t\t\t\t\t\t\t\tobj[ nodeName ] = [ old ];\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tvar tmp = xmlToJson( item );\r\n\r\n\t\t\t\t\t\t\tif ( tmp !== '' ) obj[ nodeName ].push( tmp );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn obj;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Taken from Base64-js\r\n\t\t\tfunction Base64toByteArray( b64 ) {\r\n\r\n\t\t\t\tvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array;\r\n\t\t\t\tvar i;\r\n\t\t\t\tvar lookup = [];\r\n\t\t\t\tvar revLookup = [];\r\n\t\t\t\tvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\r\n\t\t\t\tvar len = code.length;\r\n\r\n\t\t\t\tfor ( i = 0; i < len; i ++ ) {\r\n\r\n\t\t\t\t\tlookup[ i ] = code[ i ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( i = 0; i < len; ++ i ) {\r\n\r\n\t\t\t\t\trevLookup[ code.charCodeAt( i ) ] = i;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\trevLookup[ '-'.charCodeAt( 0 ) ] = 62;\r\n\t\t\t\trevLookup[ '_'.charCodeAt( 0 ) ] = 63;\r\n\r\n\t\t\t\tvar j, l, tmp, placeHolders, arr;\r\n\t\t\t\tvar len = b64.length;\r\n\r\n\t\t\t\tif ( len % 4 > 0 ) {\r\n\r\n\t\t\t\t\tthrow new Error( 'Invalid string. Length must be a multiple of 4' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tplaceHolders = b64[ len - 2 ] === '=' ? 2 : b64[ len - 1 ] === '=' ? 1 : 0;\r\n\t\t\t\tarr = new Arr( len * 3 / 4 - placeHolders );\r\n\t\t\t\tl = placeHolders > 0 ? len - 4 : len;\r\n\r\n\t\t\t\tvar L = 0;\r\n\r\n\t\t\t\tfor ( i = 0, j = 0; i < l; i += 4, j += 3 ) {\r\n\r\n\t\t\t\t\ttmp = ( revLookup[ b64.charCodeAt( i ) ] << 18 ) | ( revLookup[ b64.charCodeAt( i + 1 ) ] << 12 ) | ( revLookup[ b64.charCodeAt( i + 2 ) ] << 6 ) | revLookup[ b64.charCodeAt( i + 3 ) ];\r\n\t\t\t\t\tarr[ L ++ ] = ( tmp & 0xFF0000 ) >> 16;\r\n\t\t\t\t\tarr[ L ++ ] = ( tmp & 0xFF00 ) >> 8;\r\n\t\t\t\t\tarr[ L ++ ] = tmp & 0xFF;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( placeHolders === 2 ) {\r\n\r\n\t\t\t\t\ttmp = ( revLookup[ b64.charCodeAt( i ) ] << 2 ) | ( revLookup[ b64.charCodeAt( i + 1 ) ] >> 4 );\r\n\t\t\t\t\tarr[ L ++ ] = tmp & 0xFF;\r\n\r\n\t\t\t\t} else if ( placeHolders === 1 ) {\r\n\r\n\t\t\t\t\ttmp = ( revLookup[ b64.charCodeAt( i ) ] << 10 ) | ( revLookup[ b64.charCodeAt( i + 1 ) ] << 4 ) | ( revLookup[ b64.charCodeAt( i + 2 ) ] >> 2 );\r\n\t\t\t\t\tarr[ L ++ ] = ( tmp >> 8 ) & 0xFF;\r\n\t\t\t\t\tarr[ L ++ ] = tmp & 0xFF;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn arr;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction parseDataArray( ele, compressed ) {\r\n\r\n\t\t\t\tvar numBytes = 0;\r\n\r\n\t\t\t\tif ( json.attributes.header_type === 'UInt64' ) {\r\n\r\n\t\t\t\t\tnumBytes = 8;\r\n\r\n\t\t\t\t}\telse if ( json.attributes.header_type === 'UInt32' ) {\r\n\r\n\t\t\t\t\tnumBytes = 4;\r\n\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\t// Check the format\r\n\t\t\t\tif ( ele.attributes.format === 'binary' && compressed ) {\r\n\r\n\t\t\t\t\tvar rawData, content, byteData, blocks, cSizeStart, headerSize, padding, dataOffsets, currentOffset;\r\n\r\n\t\t\t\t\tif ( ele.attributes.type === 'Float32' ) {\r\n\r\n\t\t\t\t\t\tvar txt = new Float32Array( );\r\n\r\n\t\t\t\t\t} else if ( ele.attributes.type === 'Int64' ) {\r\n\r\n\t\t\t\t\t\tvar txt = new Int32Array( );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// VTP data with the header has the following structure:\r\n\t\t\t\t\t// [#blocks][#u-size][#p-size][#c-size-1][#c-size-2]...[#c-size-#blocks][DATA]\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// Each token is an integer value whose type is specified by \"header_type\" at the top of the file (UInt32 if no type specified). The token meanings are:\r\n\t\t\t\t\t// [#blocks] = Number of blocks\r\n\t\t\t\t\t// [#u-size] = Block size before compression\r\n\t\t\t\t\t// [#p-size] = Size of last partial block (zero if it not needed)\r\n\t\t\t\t\t// [#c-size-i] = Size in bytes of block i after compression\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// The [DATA] portion stores contiguously every block appended together. The offset from the beginning of the data section to the beginning of a block is\r\n\t\t\t\t\t// computed by summing the compressed block sizes from preceding blocks according to the header.\r\n\r\n\t\t\t\t\trawData = ele[ '#text' ];\r\n\r\n\t\t\t\t\tbyteData = Base64toByteArray( rawData );\r\n\r\n\t\t\t\t\tblocks = byteData[ 0 ];\r\n\t\t\t\t\tfor ( var i = 1; i < numBytes - 1; i ++ ) {\r\n\r\n\t\t\t\t\t\tblocks = blocks | ( byteData[ i ] << ( i * numBytes ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\theaderSize = ( blocks + 3 ) * numBytes;\r\n\t\t\t\t\tpadding = ( ( headerSize % 3 ) > 0 ) ? 3 - ( headerSize % 3 ) : 0;\r\n\t\t\t\t\theaderSize = headerSize + padding;\r\n\r\n\t\t\t\t\tdataOffsets = [];\r\n\t\t\t\t\tcurrentOffset = headerSize;\r\n\t\t\t\t\tdataOffsets.push( currentOffset );\r\n\r\n\t\t\t\t\t// Get the blocks sizes after the compression.\r\n\t\t\t\t\t// There are three blocks before c-size-i, so we skip 3*numBytes\r\n\t\t\t\t\tcSizeStart = 3 * numBytes;\r\n\r\n\t\t\t\t\tfor ( var i = 0; i < blocks; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar currentBlockSize = byteData[ i * numBytes + cSizeStart ];\r\n\r\n\t\t\t\t\t\tfor ( var j = 1; j < numBytes - 1; j ++ ) {\r\n\r\n\t\t\t\t\t\t\t// Each data point consists of 8 bytes regardless of the header type\r\n\t\t\t\t\t\t\tcurrentBlockSize = currentBlockSize | ( byteData[ i * numBytes + cSizeStart + j ] << ( j * 8 ) );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcurrentOffset = currentOffset + currentBlockSize;\r\n\t\t\t\t\t\tdataOffsets.push( currentOffset );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var i = 0; i < dataOffsets.length - 1; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar inflate = new Inflate( byteData.slice( dataOffsets[ i ], dataOffsets[ i + 1 ] ), { resize: true, verify: true } ); // eslint-disable-line no-undef\r\n\t\t\t\t\t\tcontent = inflate.decompress();\r\n\t\t\t\t\t\tcontent = content.buffer;\r\n\r\n\t\t\t\t\t\tif ( ele.attributes.type === 'Float32' ) {\r\n\r\n\t\t\t\t\t\t\tcontent = new Float32Array( content );\r\n\t\t\t\t\t\t\ttxt = Float32Concat( txt, content );\r\n\r\n\t\t\t\t\t\t} else if ( ele.attributes.type === 'Int64' ) {\r\n\r\n\t\t\t\t\t\t\tcontent = new Int32Array( content );\r\n\t\t\t\t\t\t\ttxt = Int32Concat( txt, content );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdelete ele[ '#text' ];\r\n\r\n\t\t\t\t\tif ( ele.attributes.type === 'Int64' ) {\r\n\r\n\t\t\t\t\t\tif ( ele.attributes.format === 'binary' ) {\r\n\r\n\t\t\t\t\t\t\ttxt = txt.filter( function ( el, idx ) {\r\n\r\n\t\t\t\t\t\t\t\tif ( idx % 2 !== 1 ) return true;\r\n\r\n\t\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( ele.attributes.format === 'binary' && ! compressed ) {\r\n\r\n\t\t\t\t\t\tvar content = Base64toByteArray( ele[ '#text' ] );\r\n\r\n\t\t\t\t\t\t//  VTP data for the uncompressed case has the following structure:\r\n\t\t\t\t\t\t// [#bytes][DATA]\r\n\t\t\t\t\t\t// where \"[#bytes]\" is an integer value specifying the number of bytes in the block of data following it.\r\n\t\t\t\t\t\tcontent = content.slice( numBytes ).buffer;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tif ( ele[ '#text' ] ) {\r\n\r\n\t\t\t\t\t\t\tvar content = ele[ '#text' ].split( /\\s+/ ).filter( function ( el ) {\r\n\r\n\t\t\t\t\t\t\t\tif ( el !== '' ) return el;\r\n\r\n\t\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tvar content = new Int32Array( 0 ).buffer;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdelete ele[ '#text' ];\r\n\r\n\t\t\t\t\t// Get the content and optimize it\r\n\t\t\t\t\tif ( ele.attributes.type === 'Float32' ) {\r\n\r\n\t\t\t\t\t\tvar txt = new Float32Array( content );\r\n\r\n\t\t\t\t\t} else if ( ele.attributes.type === 'Int32' ) {\r\n\r\n\t\t\t\t\t\tvar txt = new Int32Array( content );\r\n\r\n\t\t\t\t\t} else if ( ele.attributes.type === 'Int64' ) {\r\n\r\n\t\t\t\t\t\tvar txt = new Int32Array( content );\r\n\r\n\t\t\t\t\t\tif ( ele.attributes.format === 'binary' ) {\r\n\r\n\t\t\t\t\t\t\ttxt = txt.filter( function ( el, idx ) {\r\n\r\n\t\t\t\t\t\t\t\tif ( idx % 2 !== 1 ) return true;\r\n\r\n\t\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} // endif ( ele.attributes.format === 'binary' && compressed )\r\n\r\n\t\t\t\treturn txt;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Main part\r\n\t\t\t// Get Dom\r\n\t\t\tvar dom = null;\r\n\r\n\t\t\tif ( window.DOMParser ) {\r\n\r\n\t\t\t\ttry {\r\n\r\n\t\t\t\t\tdom = ( new DOMParser() ).parseFromString( stringFile, 'text/xml' );\r\n\r\n\t\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\t\tdom = null;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( window.ActiveXObject ) {\r\n\r\n\t\t\t\ttry {\r\n\r\n\t\t\t\t\tdom = new ActiveXObject( 'Microsoft.XMLDOM' ); // eslint-disable-line no-undef\r\n\t\t\t\t\tdom.async = false;\r\n\r\n\t\t\t\t\tif ( ! dom.loadXML( /* xml */ ) ) {\r\n\r\n\t\t\t\t\t\tthrow new Error( dom.parseError.reason + dom.parseError.srcText );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\t\tdom = null;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthrow new Error( 'Cannot parse xml string!' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Get the doc\r\n\t\t\tvar doc = dom.documentElement;\r\n\t\t\t// Convert to json\r\n\t\t\tvar json = xmlToJson( doc );\r\n\t\t\tvar points = [];\r\n\t\t\tvar normals = [];\r\n\t\t\tvar indices = [];\r\n\r\n\t\t\tif ( json.PolyData ) {\r\n\r\n\t\t\t\tvar piece = json.PolyData.Piece;\r\n\t\t\t\tvar compressed = json.attributes.hasOwnProperty( 'compressor' );\r\n\r\n\t\t\t\t// Can be optimized\r\n\t\t\t\t// Loop through the sections\r\n\t\t\t\tvar sections = [ 'PointData', 'Points', 'Strips', 'Polys' ];// +['CellData', 'Verts', 'Lines'];\r\n\t\t\t\tvar sectionIndex = 0, numberOfSections = sections.length;\r\n\r\n\t\t\t\twhile ( sectionIndex < numberOfSections ) {\r\n\r\n\t\t\t\t\tvar section = piece[ sections[ sectionIndex ] ];\r\n\r\n\t\t\t\t\t// If it has a DataArray in it\r\n\r\n\t\t\t\t\tif ( section && section.DataArray ) {\r\n\r\n\t\t\t\t\t\t// Depending on the number of DataArrays\r\n\r\n\t\t\t\t\t\tif ( Object.prototype.toString.call( section.DataArray ) === '[object Array]' ) {\r\n\r\n\t\t\t\t\t\t\tvar arr = section.DataArray;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tvar arr = [ section.DataArray ];\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar dataArrayIndex = 0, numberOfDataArrays = arr.length;\r\n\r\n\t\t\t\t\t\twhile ( dataArrayIndex < numberOfDataArrays ) {\r\n\r\n\t\t\t\t\t\t\t// Parse the DataArray\r\n\t\t\t\t\t\t\tif ( ( '#text' in arr[ dataArrayIndex ] ) && ( arr[ dataArrayIndex ][ '#text' ].length > 0 ) ) {\r\n\r\n\t\t\t\t\t\t\t\tarr[ dataArrayIndex ].text = parseDataArray( arr[ dataArrayIndex ], compressed );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tdataArrayIndex ++;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tswitch ( sections[ sectionIndex ] ) {\r\n\r\n\t\t\t\t\t\t\t// if iti is point data\r\n\t\t\t\t\t\t\tcase 'PointData':\r\n\r\n\t\t\t\t\t\t\t\tvar numberOfPoints = parseInt( piece.attributes.NumberOfPoints );\r\n\t\t\t\t\t\t\t\tvar normalsName = section.attributes.Normals;\r\n\r\n\t\t\t\t\t\t\t\tif ( numberOfPoints > 0 ) {\r\n\r\n\t\t\t\t\t\t\t\t\tfor ( var i = 0, len = arr.length; i < len; i ++ ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tif ( normalsName === arr[ i ].attributes.Name ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tvar components = arr[ i ].attributes.NumberOfComponents;\r\n\t\t\t\t\t\t\t\t\t\t\tnormals = new Float32Array( numberOfPoints * components );\r\n\t\t\t\t\t\t\t\t\t\t\tnormals.set( arr[ i ].text, 0 );\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t// if it is points\r\n\t\t\t\t\t\t\tcase 'Points':\r\n\r\n\t\t\t\t\t\t\t\tvar numberOfPoints = parseInt( piece.attributes.NumberOfPoints );\r\n\r\n\t\t\t\t\t\t\t\tif ( numberOfPoints > 0 ) {\r\n\r\n\t\t\t\t\t\t\t\t\tvar components = section.DataArray.attributes.NumberOfComponents;\r\n\t\t\t\t\t\t\t\t\tpoints = new Float32Array( numberOfPoints * components );\r\n\t\t\t\t\t\t\t\t\tpoints.set( section.DataArray.text, 0 );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t// if it is strips\r\n\t\t\t\t\t\t\tcase 'Strips':\r\n\r\n\t\t\t\t\t\t\t\tvar numberOfStrips = parseInt( piece.attributes.NumberOfStrips );\r\n\r\n\t\t\t\t\t\t\t\tif ( numberOfStrips > 0 ) {\r\n\r\n\t\t\t\t\t\t\t\t\tvar connectivity = new Int32Array( section.DataArray[ 0 ].text.length );\r\n\t\t\t\t\t\t\t\t\tvar offset = new Int32Array( section.DataArray[ 1 ].text.length );\r\n\t\t\t\t\t\t\t\t\tconnectivity.set( section.DataArray[ 0 ].text, 0 );\r\n\t\t\t\t\t\t\t\t\toffset.set( section.DataArray[ 1 ].text, 0 );\r\n\r\n\t\t\t\t\t\t\t\t\tvar size = numberOfStrips + connectivity.length;\r\n\t\t\t\t\t\t\t\t\tindices = new Uint32Array( 3 * size - 9 * numberOfStrips );\r\n\r\n\t\t\t\t\t\t\t\t\tvar indicesIndex = 0;\r\n\r\n\t\t\t\t\t\t\t\t\tfor ( var i = 0, len = numberOfStrips; i < len; i ++ ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tvar strip = [];\r\n\r\n\t\t\t\t\t\t\t\t\t\tfor ( var s = 0, len1 = offset[ i ], len0 = 0; s < len1 - len0; s ++ ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tstrip.push( connectivity[ s ] );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif ( i > 0 ) len0 = offset[ i - 1 ];\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tfor ( var j = 0, len1 = offset[ i ], len0 = 0; j < len1 - len0 - 2; j ++ ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif ( j % 2 ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ j ];\r\n\t\t\t\t\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ j + 2 ];\r\n\t\t\t\t\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ j + 1 ];\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ j ];\r\n\t\t\t\t\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ j + 1 ];\r\n\t\t\t\t\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = strip[ j + 2 ];\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif ( i > 0 ) len0 = offset[ i - 1 ];\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t// if it is polys\r\n\t\t\t\t\t\t\tcase 'Polys':\r\n\r\n\t\t\t\t\t\t\t\tvar numberOfPolys = parseInt( piece.attributes.NumberOfPolys );\r\n\r\n\t\t\t\t\t\t\t\tif ( numberOfPolys > 0 ) {\r\n\r\n\t\t\t\t\t\t\t\t\tvar connectivity = new Int32Array( section.DataArray[ 0 ].text.length );\r\n\t\t\t\t\t\t\t\t\tvar offset = new Int32Array( section.DataArray[ 1 ].text.length );\r\n\t\t\t\t\t\t\t\t\tconnectivity.set( section.DataArray[ 0 ].text, 0 );\r\n\t\t\t\t\t\t\t\t\toffset.set( section.DataArray[ 1 ].text, 0 );\r\n\r\n\t\t\t\t\t\t\t\t\tvar size = numberOfPolys + connectivity.length;\r\n\t\t\t\t\t\t\t\t\tindices = new Uint32Array( 3 * size - 9 * numberOfPolys );\r\n\t\t\t\t\t\t\t\t\tvar indicesIndex = 0, connectivityIndex = 0;\r\n\t\t\t\t\t\t\t\t\tvar i = 0, len = numberOfPolys, len0 = 0;\r\n\r\n\t\t\t\t\t\t\t\t\twhile ( i < len ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tvar poly = [];\r\n\t\t\t\t\t\t\t\t\t\tvar s = 0, len1 = offset[ i ];\r\n\r\n\t\t\t\t\t\t\t\t\t\twhile ( s < len1 - len0 ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tpoly.push( connectivity[ connectivityIndex ++ ] );\r\n\t\t\t\t\t\t\t\t\t\t\ts ++;\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tvar j = 1;\r\n\r\n\t\t\t\t\t\t\t\t\t\twhile ( j < len1 - len0 - 1 ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = poly[ 0 ];\r\n\t\t\t\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = poly[ j ];\r\n\t\t\t\t\t\t\t\t\t\t\tindices[ indicesIndex ++ ] = poly[ j + 1 ];\r\n\t\t\t\t\t\t\t\t\t\t\tj ++;\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\ti ++;\r\n\t\t\t\t\t\t\t\t\t\tlen0 = offset[ i - 1 ];\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsectionIndex ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar geometry = new BufferGeometry();\r\n\t\t\t\tgeometry.setIndex( new BufferAttribute( indices, 1 ) );\r\n\t\t\t\tgeometry.setAttribute( 'position', new BufferAttribute( points, 3 ) );\r\n\r\n\t\t\t\tif ( normals.length === points.length ) {\r\n\r\n\t\t\t\t\tgeometry.setAttribute( 'normal', new BufferAttribute( normals, 3 ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn geometry;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthrow new Error( 'Unsupported DATASET type' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// get the 5 first lines of the files to check if there is the key word binary\r\n\t\tvar meta = LoaderUtils.decodeText( new Uint8Array( data, 0, 250 ) ).split( '\\n' );\r\n\r\n\t\tif ( meta[ 0 ].indexOf( 'xml' ) !== - 1 ) {\r\n\r\n\t\t\treturn parseXML( LoaderUtils.decodeText( data ) );\r\n\r\n\t\t} else if ( meta[ 2 ].includes( 'ASCII' ) ) {\r\n\r\n\t\t\treturn parseASCII( LoaderUtils.decodeText( data ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn parseBinary( data );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n} );\r\n\r\nexport { VTKLoader };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/loaders/VTKLoader.js","<template>\r\n    <div class=\"webglLoaderNrrd-container\">\r\n        <div id=\"info\">\r\n\t\t\t<a href=\"https://threejs.org\" target=\"_blank\" rel=\"noopener\">three.js</a> -\r\n\t\t\tNRRD format loader test\r\n\t\t</div>\r\n\t\t<div id=\"inset\"></div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { GUI } from '@/components/jsm/libs/dat.gui.module.js'\r\nimport { TrackballControls } from '@/components/jsm/controls/TrackballControls.js'\r\nimport { NRRDLoader } from '@/components/jsm/loaders/NRRDLoader.js'\r\nimport { VTKLoader } from '@/components/jsm/loaders/VTKLoader.js'\r\nexport default {\r\n    data() {\r\n        return {\r\n            container: null,\r\n            stats: null,\r\n            camera: null,\r\n            controls: null,\r\n            scene: null,\r\n            renderer: null,\r\n            container2: null,\r\n            renderer2: null,\r\n            camera2: null,\r\n            axes2: null,\r\n            scene2: null,\r\n            gui: null,\r\n        }\r\n    },\r\n    mounted() {\r\n        this.init()\r\n\t\tthis.animate()\r\n    },\r\n    beforeDestroy() {\r\n        this.gui.hide()\r\n    },\r\n    methods: {\r\n        init() {\r\n            this.camera = new this.$THREE.PerspectiveCamera(60, this.$webglInnerWidth / window.innerHeight, 0.01, 1e10)\r\n            this.camera.position.z = 300\r\n            this.scene = new this.$THREE.Scene()\r\n            this.scene.add(this.camera)\r\n            // light\r\n            var hemiLight = new this.$THREE.HemisphereLight(0xffffff, 0x000000, 1)\r\n            this.scene.add(hemiLight)\r\n            var dirLight = new this.$THREE.DirectionalLight(0xffffff, 0.5)\r\n            dirLight.position.set(200, 200, 200)\r\n            this.scene.add(dirLight)\r\n            var loader = new NRRDLoader()\r\n            loader.load(\"static/models/nrrd/I.nrrd\", (volume) => {\r\n                //box helper to see the extend of the volume\r\n                var geometry = new this.$THREE.BoxBufferGeometry(volume.xLength, volume.yLength, volume.zLength)\r\n                var material = new this.$THREE.MeshBasicMaterial({ color: 0x00ff00 })\r\n                var cube = new this.$THREE.Mesh(geometry, material)\r\n                cube.visible = false\r\n                var box = new this.$THREE.BoxHelper(cube)\r\n                this.scene.add(box)\r\n                box.applyMatrix4(volume.matrix)\r\n                this.scene.add(cube)\r\n                //z plane\r\n                var sliceZ = volume.extractSlice('z', Math.floor(volume.RASDimensions[ 2 ] / 4))\r\n                this.scene.add(sliceZ.mesh)\r\n                //y plane\r\n                var sliceY = volume.extractSlice('y', Math.floor(volume.RASDimensions[ 1 ] / 2))\r\n                this.scene.add(sliceY.mesh)\r\n                //x plane\r\n                var sliceX = volume.extractSlice('x', Math.floor(volume.RASDimensions[ 0 ] / 2))\r\n                this.scene.add(sliceX.mesh)\r\n                this.gui.add(sliceX, \"index\", 0, volume.RASDimensions[ 0 ], 1).name(\"indexX\").onChange(() => {\r\n                    sliceX.repaint.call(sliceX)\r\n                })\r\n                this.gui.add(sliceY, \"index\", 0, volume.RASDimensions[ 1 ], 1).name(\"indexY\").onChange(() => {\r\n                    sliceY.repaint.call(sliceY)\r\n                })\r\n                this.gui.add(sliceZ, \"index\", 0, volume.RASDimensions[ 2 ], 1).name(\"indexZ\").onChange(() => {\r\n                    sliceZ.repaint.call(sliceZ)\r\n                })\r\n                this.gui.add(volume, \"lowerThreshold\", volume.min, volume.max, 1).name(\"Lower Threshold\").onChange(() => {\r\n                    volume.repaintAllSlices()\r\n                })\r\n                this.gui.add(volume, \"upperThreshold\", volume.min, volume.max, 1).name(\"Upper Threshold\").onChange(() => {\r\n                    volume.repaintAllSlices()\r\n                })\r\n                this.gui.add(volume, \"windowLow\", volume.min, volume.max, 1).name(\"Window Low\").onChange(() => {\r\n                    volume.repaintAllSlices()\r\n                })\r\n                this.gui.add(volume, \"windowHigh\", volume.min, volume.max, 1).name(\"Window High\").onChange(() => {\r\n                    volume.repaintAllSlices()\r\n                })\r\n            })\r\n            var vtkmaterial = new this.$THREE.MeshLambertMaterial({ wireframe: false, morphTargets: false, side: this.$THREE.DoubleSide, color: 0xff0000 })\r\n            var vtkloader = new VTKLoader()\r\n            vtkloader.load(\"static/models/vtk/liver.vtk\", (geometry) => {\r\n                geometry.computeVertexNormals()\r\n                var mesh = new this.$THREE.Mesh(geometry, vtkmaterial)\r\n                this.scene.add(mesh)\r\n                var visibilityControl = {\r\n                    visible: true\r\n                }\r\n                this.gui.add(visibilityControl, \"visible\").name(\"Model Visible\").onChange(() => {\r\n                    mesh.visible = visibilityControl.visible\r\n                    this.renderer.render(this.scene, this.camera)\r\n                })\r\n            })\r\n            // renderer\r\n            this.renderer = new this.$THREE.WebGLRenderer()\r\n            this.renderer.setPixelRatio(window.devicePixelRatio)\r\n            this.renderer.setSize(this.$webglInnerWidth, window.innerHeight)\r\n            this.container = document.createElement('div')\r\n            document.getElementsByClassName('webglLoaderNrrd-container')[0].appendChild(this.container)\r\n            this.container.appendChild(this.renderer.domElement)\r\n            this.controls = new TrackballControls(this.camera, this.renderer.domElement)\r\n            this.controls.minDistance = 100\r\n            this.controls.maxDistance = 500\r\n            this.controls.rotateSpeed = 5.0\r\n            this.controls.zoomSpeed = 5\r\n            this.controls.panSpeed = 2\r\n            this.stats = new this.$Stats()\r\n            this.stats.dom.style.left = '280px'\r\n            this.container.appendChild(this.stats.dom)\r\n            this.gui = new GUI()\r\n            this.setupInset()\r\n            window.addEventListener('resize', this.onWindowResize, false)\r\n        },\r\n        onWindowResize() {\r\n            this.$onWindowResize(this.camera, this.renderer)\r\n            this.controls.handleResize()\r\n        },\r\n        animate() {\r\n            requestAnimationFrame(this.animate)\r\n            this.controls.update()\r\n            //copy position of the camera into inset\r\n            this.camera2.position.copy(this.camera.position)\r\n            this.camera2.position.sub(this.controls.target)\r\n            this.camera2.position.setLength(300)\r\n            this.camera2.lookAt(this.scene2.position)\r\n            this.renderer.render(this.scene, this.camera)\r\n            this.renderer2.render(this.scene2, this.camera2)\r\n            this.stats.update()\r\n        },\r\n        setupInset() {\r\n            var insetWidth = 150, insetHeight = 150\r\n            this.container2 = document.getElementById('inset')\r\n            this.container2.width = insetWidth\r\n            this.container2.height = insetHeight\r\n            // this.renderer\r\n            this.renderer2 = new this.$THREE.WebGLRenderer({ alpha: true })\r\n            this.renderer2.setClearColor(0x000000, 0)\r\n            this.renderer2.setSize(insetWidth, insetHeight)\r\n            this.container2.appendChild(this.renderer2.domElement)\r\n            // this.scene\r\n            this.scene2 = new this.$THREE.Scene()\r\n            // camera\r\n            this.camera2 = new this.$THREE.PerspectiveCamera(50, insetWidth / insetHeight, 1, 1000)\r\n            this.camera2.up = this.camera.up // important!\r\n            // axes\r\n            this.axes2 = new this.$THREE.AxesHelper(100)\r\n            this.scene2.add(this.axes2)\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.webglLoaderNrrd-container {\r\n    width: 100%;\r\n}\r\n#inset {\r\n    width: 150px;\r\n    height: 150px;\r\n    background-color: transparent; /* or transparent; will show through only if renderer alpha: true */\r\n    border: none; /* or none; */\r\n    margin: 0;\r\n    padding: 0px;\r\n    position: absolute;\r\n    left: 20px;\r\n    bottom: 20px;\r\n    z-index: 100;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/views/loader/webglLoaderNrrd.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"webglLoaderNrrd-container\"},[_c('div',{attrs:{\"id\":\"info\"}},[_c('a',{attrs:{\"href\":\"https://threejs.org\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"three.js\")]),_vm._v(\" -\\n\\t\\t\\tNRRD format loader test\\n\\t\\t\")]),_vm._v(\" \"),_c('div',{attrs:{\"id\":\"inset\"}})])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-065a4538\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/loader/webglLoaderNrrd.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-065a4538\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./webglLoaderNrrd.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglLoaderNrrd.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglLoaderNrrd.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-065a4538\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./webglLoaderNrrd.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-065a4538\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/loader/webglLoaderNrrd.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}