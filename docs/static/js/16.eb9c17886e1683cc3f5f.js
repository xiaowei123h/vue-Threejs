webpackJsonp([16],{IPvw:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={};o.d(i,"Node",function(){return a}),o.d(i,"TempNode",function(){return u}),o.d(i,"InputNode",function(){return c}),o.d(i,"ConstNode",function(){return p}),o.d(i,"VarNode",function(){return l}),o.d(i,"StructNode",function(){return f}),o.d(i,"AttributeNode",function(){return y}),o.d(i,"FunctionNode",function(){return x}),o.d(i,"ExpressionNode",function(){return b}),o.d(i,"FunctionCallNode",function(){return S}),o.d(i,"NodeLib",function(){return m}),o.d(i,"NodeUtils",function(){return V}),o.d(i,"NodeFrame",function(){return F}),o.d(i,"NodeUniform",function(){return j}),o.d(i,"NodeBuilder",function(){return nt}),o.d(i,"BoolNode",function(){return st}),o.d(i,"IntNode",function(){return at}),o.d(i,"FloatNode",function(){return G}),o.d(i,"Vector2Node",function(){return I}),o.d(i,"Vector3Node",function(){return B}),o.d(i,"Vector4Node",function(){return U}),o.d(i,"ColorNode",function(){return ut}),o.d(i,"Matrix3Node",function(){return ct}),o.d(i,"Matrix4Node",function(){return ht}),o.d(i,"TextureNode",function(){return q}),o.d(i,"CubeTextureNode",function(){return K}),o.d(i,"ScreenNode",function(){return pt}),o.d(i,"ReflectorNode",function(){return lt}),o.d(i,"PropertyNode",function(){return dt}),o.d(i,"RTTNode",function(){return yt}),o.d(i,"UVNode",function(){return k}),o.d(i,"ColorsNode",function(){return xt}),o.d(i,"PositionNode",function(){return X}),o.d(i,"NormalNode",function(){return W}),o.d(i,"CameraNode",function(){return bt}),o.d(i,"LightNode",function(){return St}),o.d(i,"ReflectNode",function(){return Y}),o.d(i,"ScreenUVNode",function(){return Tt}),o.d(i,"ResolutionNode",function(){return wt}),o.d(i,"MathNode",function(){return Z}),o.d(i,"OperatorNode",function(){return $}),o.d(i,"CondNode",function(){return Ot}),o.d(i,"NoiseNode",function(){return _t}),o.d(i,"CheckerNode",function(){return Lt}),o.d(i,"TextureCubeUVNode",function(){return Q}),o.d(i,"TextureCubeNode",function(){return tt}),o.d(i,"NormalMapNode",function(){return Rt}),o.d(i,"BumpMapNode",function(){return Ct}),o.d(i,"BypassNode",function(){return Jt}),o.d(i,"JoinNode",function(){return Mt}),o.d(i,"SwitchNode",function(){return At}),o.d(i,"TimerNode",function(){return Pt}),o.d(i,"VelocityNode",function(){return zt}),o.d(i,"UVTransformNode",function(){return Vt}),o.d(i,"MaxMIPLevelNode",function(){return Ft}),o.d(i,"SpecularMIPLevelNode",function(){return jt}),o.d(i,"ColorSpaceNode",function(){return H}),o.d(i,"SubSlotNode",function(){return It}),o.d(i,"BlurNode",function(){return Bt}),o.d(i,"ColorAdjustmentNode",function(){return kt}),o.d(i,"LuminanceNode",function(){return Ut}),o.d(i,"RawNode",function(){return vt}),o.d(i,"BasicNode",function(){return Gt}),o.d(i,"SpriteNode",function(){return Ht}),o.d(i,"PhongNode",function(){return qt}),o.d(i,"StandardNode",function(){return Xt}),o.d(i,"MeshStandardNode",function(){return Wt}),o.d(i,"NodeMaterial",function(){return ft}),o.d(i,"BasicNodeMaterial",function(){return Yt}),o.d(i,"SpriteNodeMaterial",function(){return Kt}),o.d(i,"PhongNodeMaterial",function(){return $t}),o.d(i,"StandardNodeMaterial",function(){return Zt}),o.d(i,"MeshStandardNodeMaterial",function(){return Qt}),o.d(i,"NodePostProcessing",function(){return te});var r=o("QEtz"),n=o("wIBv"),s=o("6+nK");function a(t){this.uuid=s._12.generateUUID(),this.name="",this.type=t,this.userData={}}function u(t,e){a.call(this,t),e=e||{},this.shared=void 0===e.shared||e.shared,this.unique=void 0!==e.unique&&e.unique}function c(t,e){(e=e||{}).shared=void 0!==e.shared&&e.shared,u.call(this,t,e),this.readonly=!1}a.prototype={constructor:a,isNode:!0,hashProperties:void 0,analyze:function(t,e){e=e||{},t.analyzing=!0,this.build(t.addFlow(e.slot,e.cache,e.context),"v4"),t.clearVertexNodeCode(),t.clearFragmentNodeCode(),t.removeFlow(),t.analyzing=!1},analyzeAndFlow:function(t,e,o){return o=o||{},this.analyze(t,o),this.flow(t,e,o)},flow:function(t,e,o){o=o||{},t.addFlow(o.slot,o.cache,o.context);var i={};return i.result=this.build(t,e),i.code=t.clearNodeCode(),i.extra=t.context.extra,t.removeFlow(),i},build:function(t,e,o){e=e||this.getType(t,e);var i=t.getNodeData(o||this);return t.analyzing&&this.appendDepsNode(t,i,e),-1===t.nodes.indexOf(this)&&t.nodes.push(this),void 0!==this.updateFrame&&-1===t.updaters.indexOf(this)&&t.updaters.push(this),this.generate(t,e,o)},generate:function(){},getHash:function(){var t,e,o="{";for(t in this)(e=this[t])instanceof a&&(o+='"'+t+'":'+e.getHash()+",");if(this.hashProperties)for(var i=0;i<this.hashProperties.length;i++)e=this[t=this.hashProperties[i]],o+='"'+t+'":"'+String(e)+'",';return o+='"id":"'+this.uuid+'"}'},appendDepsNode:function(t,e,o){e.deps=(e.deps||0)+1;var i=t.getTypeLength(o);(i>(e.outputMax||0)||this.getType(t,o))&&(e.outputMax=i,e.output=o)},setName:function(t){return this.name=t,this},getName:function(){return this.name},getType:function(t,e){return"sampler2D"===e||"samplerCube"===e?e:this.type},getJSONNode:function(t){if(!(void 0===t||"string"==typeof t)&&void 0!==t.nodes[this.uuid])return t.nodes[this.uuid]},copy:function(t){return void 0!==t.name&&(this.name=t.name),void 0!==t.userData&&(this.userData=JSON.parse(JSON.stringify(t.userData))),this},createJSONNode:function(t){var e=void 0===t||"string"==typeof t,o={};if("string"!=typeof this.nodeType)throw new Error("Node does not allow serialization.");return o.uuid=this.uuid,o.nodeType=this.nodeType,""!==this.name&&(o.name=this.name),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),e||(t.nodes[this.uuid]=o),o},toJSON:function(t){return this.getJSONNode(t)||this.createJSONNode(t)}},u.prototype=Object.create(a.prototype),u.prototype.constructor=u,u.prototype.build=function(t,e,o,i){if(e=e||this.getType(t),this.getShared(t,e)){var r=this.getUnique(t,e);r&&void 0===this.constructor.uuid&&(this.constructor.uuid=s._12.generateUUID()),o=t.getUuid(o||this.getUuid(),!r);var n=t.getNodeData(o),c=n.output||this.getType(t);if(t.analyzing)return(n.deps||0)>0||this.getLabel()?(this.appendDepsNode(t,n,e),this.generate(t,e,o)):a.prototype.build.call(this,t,e,o);if(r)return n.name=n.name||a.prototype.build.call(this,t,e,o),n.name;if(!this.getLabel()&&(!this.getShared(t,c)||t.context.ignoreCache||1===n.deps))return a.prototype.build.call(this,t,e,o);o=this.getUuid(!1);var h=this.getTemp(t,o);if(h)return t.format(h,c,e);h=u.prototype.generate.call(this,t,e,o,n.output,i);var p=this.generate(t,c,o);return t.addNodeCode(h+" = "+p+";"),t.format(h,c,e)}return a.prototype.build.call(this,t,e,o)},u.prototype.getShared=function(t,e){return"sampler2D"!==e&&"samplerCube"!==e&&this.shared},u.prototype.getUnique=function(){return this.unique},u.prototype.setLabel=function(t){return this.label=t,this},u.prototype.getLabel=function(){return this.label},u.prototype.getUuid=function(t){var e=(t||void 0==t)&&this.constructor.uuid||this.uuid;return"string"==typeof this.scope&&(e=this.scope+"-"+e),e},u.prototype.getTemp=function(t,e){e=e||this.uuid;var o=t.getVars()[e];return o?o.name:void 0},u.prototype.generate=function(t,e,o,i,r){return this.getShared(t,e)||console.error("THREE.TempNode is not shared!"),o=o||this.uuid,t.getTempVar(o,i||this.getType(t),r,this.getLabel()).name},c.prototype=Object.create(u.prototype),c.prototype.constructor=c,c.prototype.setReadonly=function(t){return this.readonly=t,this.hashProperties=this.readonly?["value"]:void 0,this},c.prototype.getReadonly=function(){return this.readonly},c.prototype.copy=function(t){return u.prototype.copy.call(this,t),void 0!==t.readonly&&(this.readonly=t.readonly),this},c.prototype.createJSONNode=function(t){var e=u.prototype.createJSONNode.call(this,t);return!0===this.readonly&&(e.readonly=this.readonly),e},c.prototype.generate=function(t,e,o,i,r,n){o=t.getUuid(o||this.getUuid()),i=i||this.getType(t);var s=t.getNodeData(o);return this.getReadonly(t)&&void 0!==this.generateReadonly?this.generateReadonly(t,e,o,i,r,n):t.isShader("vertex")?(s.vertex||(s.vertex=t.createVertexUniform(i,this,r,n,this.getLabel())),t.format(s.vertex.name,i,e)):(s.fragment||(s.fragment=t.createFragmentUniform(i,this,r,n,this.getLabel())),t.format(s.fragment.name,i,e))};var h=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i;function p(t,e){u.call(this),this.parse(t||p.PI,e)}function l(t,e){a.call(this,t),this.value=e}p.PI="PI",p.PI2="PI2",p.RECIPROCAL_PI="RECIPROCAL_PI",p.RECIPROCAL_PI2="RECIPROCAL_PI2",p.LOG2="LOG2",p.EPSILON="EPSILON",p.prototype=Object.create(u.prototype),p.prototype.constructor=p,p.prototype.nodeType="Const",p.prototype.getType=function(t){return t.getTypeByFormat(this.type)},p.prototype.parse=function(t,e){this.src=t||"";var o,i,r="",n=this.src.match(h);this.useDefine=e||"#"===this.src.charAt(0),n&&n.length>1?(i=n[1],o=n[2],r=n[3]):(o=this.src,i="f"),this.name=o,this.type=i,this.value=r},p.prototype.build=function(t,e){return"source"!==e?(t.include(this),t.format(this.name,this.getType(t),e)):this.value?this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";":this.useDefine?this.src:void 0},p.prototype.generate=function(t,e){return t.format(this.name,this.getType(t),e)},p.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.parse(t.src,t.useDefine),this},p.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).src=this.src,!0===e.useDefine&&(e.useDefine=!0)),e},l.prototype=Object.create(a.prototype),l.prototype.constructor=l,l.prototype.nodeType="Var",l.prototype.getType=function(t){return t.getTypeByFormat(this.type)},l.prototype.generate=function(t,e){var o=t.getVar(this.uuid,this.type);return this.value&&t.isShader("vertex")&&t.addNodeCode(o.name+" = "+this.value.build(t,this.getType(t))+";"),t.format(o.name,this.getType(t),e)},l.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.type=t.type,this.value=t.value,this},l.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).type=this.type,this.value&&(e.value=this.value.toJSON(t).uuid)),e};var d=/^struct\s*([a-z_0-9]+)\s*{\s*((.|\n)*?)}/gim,v=/\s*(\w*?)\s*(\w*?)(\=|\;)/gim;function f(t){u.call(this),this.parse(t)}function y(t,e){a.call(this,e),this.name=t}f.prototype=Object.create(u.prototype),f.prototype.constructor=f,f.prototype.nodeType="Struct",f.prototype.getType=function(t){return t.getTypeByFormat(this.name)},f.prototype.getInputByName=function(t){for(var e=this.inputs.length;e--;)if(this.inputs[e].name===t)return this.inputs[e]},f.prototype.generate=function(t,e){return"source"===e?this.src+";":t.format("( "+this.src+" )",this.getType(t),e)},f.prototype.parse=function(t){this.src=t||"",this.inputs=[];var e=d.exec(this.src);if(e){for(var o,i=e[2];o=v.exec(i);)this.inputs.push({type:o[1],name:o[2]});this.name=e[1]}else this.name="";this.type=this.name},f.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).src=this.src),e},y.prototype=Object.create(a.prototype),y.prototype.constructor=y,y.prototype.nodeType="Attribute",y.prototype.getAttributeType=function(t){return"number"==typeof this.type?t.getConstructorFromLength(this.type):this.type},y.prototype.getType=function(t){var e=this.getAttributeType(t);return t.getTypeByFormat(e)},y.prototype.generate=function(t,e){var o=this.getAttributeType(t),i=t.getAttribute(this.name,o),r=t.isShader("vertex")?this.name:i.varying.name;return t.format(r,this.getType(t),e)},y.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.type=t.type,this},y.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).type=this.type),e};var m={nodes:{},keywords:{},add:function(t){this.nodes[t.name]=t},addKeyword:function(t,e,o){o=void 0===o||o,this.keywords[t]={callback:e,cache:o}},remove:function(t){delete this.nodes[t.name]},removeKeyword:function(t){delete this.keywords[t]},get:function(t){return this.nodes[t]},getKeyword:function(t,e){return this.keywords[t].callback.call(this,e)},getKeywordData:function(t){return this.keywords[t]},contains:function(t){return void 0!==this.nodes[t]},containsKeyword:function(t){return void 0!==this.keywords[t]}},g=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,N=/[a-z_0-9]+/gi;function x(t,e,o,i,r){this.isMethod=void 0===r,this.isInterface=!1,u.call(this,r),this.parse(t,e,o,i)}function b(t,e,o,i,r){x.call(this,t,r,i,o,e)}function S(t,e){u.call(this),this.setFunction(t,e)}x.prototype=Object.create(u.prototype),x.prototype.constructor=x,x.prototype.nodeType="Function",x.prototype.useKeywords=!0,x.prototype.getShared=function(){return!this.isMethod},x.prototype.getType=function(t){return t.getTypeByFormat(this.type)},x.prototype.getInputByName=function(t){for(var e=this.inputs.length;e--;)if(this.inputs[e].name===t)return this.inputs[e]},x.prototype.getIncludeByName=function(t){for(var e=this.includes.length;e--;)if(this.includes[e].name===t)return this.includes[e]},x.prototype.generate=function(t,e){for(var o=0,i=this.src,r=0;r<this.includes.length;r++)t.include(this.includes[r],this);for(var n in this.extensions)t.extensions[n]=!0;for(var s=[];a=N.exec(this.src);)s.push(a);for(r=0;r<s.length;r++){var a,u=(a=s[r])[0],c=!this.isMethod||!this.getInputByName(u),h=u;if(this.keywords[u]||this.useKeywords&&c&&m.containsKeyword(u)){var p=this.keywords[u];if(!p){var l=m.getKeywordData(u);l.cache&&(p=t.keywords[u]),p=p||m.getKeyword(u,t),l.cache&&(t.keywords[u]=p)}h=p.build(t)}u!==h&&(i=i.substring(0,a.index+o)+h+i.substring(a.index+u.length+o),o+=h.length-u.length),void 0===this.getIncludeByName(h)&&m.contains(h)&&t.include(m.get(h))}return"source"===e?i:this.isMethod?(this.isInterface||t.include(this,!1,i),this.name):t.format("( "+i+" )",this.getType(t),e)},x.prototype.parse=function(t,e,o,i){if(this.src=t||"",this.includes=e||[],this.extensions=o||{},this.keywords=i||{},this.isMethod){var r=this.src.match(g);if(this.inputs=[],r&&4==r.length){this.type=r[1],this.name=r[2];var n=r[3].match(N);if(n)for(var s=0;s<n.length;){var a,u,c=n[s++];"in"===c||"out"===c||"inout"===c?a=n[s++]:(a=c,c=""),u=n[s++],this.inputs.push({name:u,type:a,qualifier:c})}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}},x.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.isMethod=t.isMethod,this.useKeywords=t.useKeywords,this.parse(t.src,t.includes,t.extensions,t.keywords),void 0!==t.type&&(this.type=t.type),this},x.prototype.toJSON=function(t){var e=this.getJSONNode(t);if(!e){for(var o in(e=this.createJSONNode(t)).src=this.src,e.isMethod=this.isMethod,e.useKeywords=this.useKeywords,this.isMethod||(e.type=this.type),e.extensions=JSON.parse(JSON.stringify(this.extensions)),e.keywords={},this.keywords)e.keywords[o]=this.keywords[o].toJSON(t).uuid;if(this.includes.length){e.includes=[];for(var i=0;i<this.includes.length;i++)e.includes.push(this.includes[i].toJSON(t).uuid)}}return e},b.prototype=Object.create(x.prototype),b.prototype.constructor=b,b.prototype.nodeType="Expression",S.prototype=Object.create(u.prototype),S.prototype.constructor=S,S.prototype.nodeType="FunctionCall",S.prototype.setFunction=function(t,e){this.value=t,this.inputs=e||[]},S.prototype.getFunction=function(){return this.value},S.prototype.getType=function(t){return this.value.getType(t)},S.prototype.generate=function(t,e){for(var o=this.getType(t),i=this.value,r=i.build(t,e)+"( ",n=[],s=0;s<i.inputs.length;s++){var a=i.inputs[s],u=this.inputs[s]||this.inputs[a.name];n.push(u.build(t,t.getTypeByFormat(a.type)))}return r+=n.join(", ")+" )",t.format(r,o,e)},S.prototype.copy=function(t){for(var e in u.prototype.copy.call(this,t),t.inputs)this.inputs[e]=t.inputs[e];return this.value=t.value,this},S.prototype.toJSON=function(t){var e=this.getJSONNode(t);if(!e){var o=this.value;if((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,o.inputs.length){e.inputs={};for(var i=0;i<o.inputs.length;i++){var r=o.inputs[i],n=this.inputs[i]||this.inputs[r.name];e.inputs[r.name]=n.toJSON(t).uuid}}}return e};var w,T,O,_,L,R,C,J,E,D,M,A,P,z,V={elements:["x","y","z","w"],addShortcuts:function(){function t(t,e,o){return o?{get:function(){return this[t][e][o]},set:function(i){this[t][e][o]=i}}:{get:function(){return this[t][e]},set:function(o){this[t][e]=o}}}return function(e,o,i){for(var r={},n=0;n<i.length;++n){var s=i[n].split("."),a=s[0],u=s[1];r[a]=t(o,a,u)}Object.defineProperties(e,r)}}()};function F(t){this.time=void 0!==t?t:0,this.id=0}function j(t){t=t||{},this.name=t.name,this.type=t.type,this.node=t.node,this.needsUpdate=t.needsUpdate}function I(t,e){c.call(this,"v2"),this.value=t instanceof s._81?t:new s._81(t,e)}function B(t,e,o){c.call(this,"v3"),this.value=t instanceof s._82?t:new s._82(t,e,o)}function U(t,e,o,i){c.call(this,"v4"),this.value=t instanceof s._83?t:new s._83(t,e,o,i)}function k(t){u.call(this,"v2",{shared:!1}),this.index=t||0}function G(t){c.call(this,"f"),this.value=t||0}function H(t,e){u.call(this,"v4"),this.input=t,this.method=e||H.LINEAR_TO_LINEAR}function q(t,e,o,i){c.call(this,"v4",{shared:!0}),this.value=t,this.uv=e||new k,this.bias=o,this.project=void 0!==i&&i}function X(t){u.call(this,"v3"),this.scope=t||X.LOCAL}function W(t){u.call(this,"v3"),this.scope=t||W.VIEW}function Y(t){u.call(this,"v3"),this.scope=t||Y.CUBE}function K(t,e,o){c.call(this,"v4",{shared:!0}),this.value=t,this.uv=e||new Y,this.bias=o}function $(t,e,o){u.call(this),this.a=t,this.b=e,this.op=o}function Z(t,e,o,i){u.call(this),this.a=t,"string"!=typeof e?this.b=e:i=e,"string"!=typeof o?this.c=o:i=o,this.method=i}function Q(t,e,o){u.call(this,"v4"),this.value=t,this.uv=e,this.bias=o}function tt(t,e,o){u.call(this,"v4"),this.value=t,this.radianceNode=new Q(this.value,e||new Y(Y.VECTOR),o),this.irradianceNode=new Q(this.value,new W(W.WORLD),new G(1).setReadonly(!0))}F.prototype={constructor:F,update:function(t){return++this.id,this.time+=t,this.delta=t,this},setRenderer:function(t){return this.renderer=t,this},setRenderTexture:function(t){return this.renderTexture=t,this},updateNode:function(t){return t.frameId===this.id?this:(t.updateFrame(this),t.frameId=this.id,this)}},Object.defineProperties(j.prototype,{value:{get:function(){return this.node.value},set:function(t){this.node.value=t}}}),I.prototype=Object.create(c.prototype),I.prototype.constructor=I,I.prototype.nodeType="Vector2",V.addShortcuts(I.prototype,"value",["x","y"]),I.prototype.generateReadonly=function(t,e,o,i){return t.format("vec2( "+this.x+", "+this.y+" )",i,e)},I.prototype.copy=function(t){return c.prototype.copy.call(this,t),this.value.copy(t),this},I.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,!0===this.readonly&&(e.readonly=!0)),e},B.prototype=Object.create(c.prototype),B.prototype.constructor=B,B.prototype.nodeType="Vector3",V.addShortcuts(B.prototype,"value",["x","y","z"]),B.prototype.generateReadonly=function(t,e,o,i){return t.format("vec3( "+this.x+", "+this.y+", "+this.z+" )",i,e)},B.prototype.copy=function(t){return c.prototype.copy.call(this,t),this.value.copy(t),this},B.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,e.z=this.z,!0===this.readonly&&(e.readonly=!0)),e},U.prototype=Object.create(c.prototype),U.prototype.constructor=U,U.prototype.nodeType="Vector4",V.addShortcuts(U.prototype,"value",["x","y","z","w"]),U.prototype.generateReadonly=function(t,e,o,i){return t.format("vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )",i,e)},U.prototype.copy=function(t){return c.prototype.copy.call(this,t),this.value.copy(t),this},U.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,!0===this.readonly&&(e.readonly=!0)),e},k.prototype=Object.create(u.prototype),k.prototype.constructor=k,k.prototype.nodeType="UV",k.prototype.generate=function(t,e){t.requires.uv[this.index]=!0;var o=this.index>0?this.index+1:"",i=t.isShader("vertex")?"uv"+o:"vUv"+o;return t.format(i,this.getType(t),e)},k.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.index=t.index,this},k.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).index=this.index),e},m.addKeyword("uv",function(){return new k}),m.addKeyword("uv2",function(){return new k(1)}),G.prototype=Object.create(c.prototype),G.prototype.constructor=G,G.prototype.nodeType="Float",G.prototype.generateReadonly=function(t,e,o,i){return t.format(this.value+(this.value%1?"":".0"),i,e)},G.prototype.copy=function(t){return c.prototype.copy.call(this,t),this.value=t.value,this},G.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value,!0===this.readonly&&(e.readonly=!0)),e},H.Nodes=(w=new x(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),T=new x(["vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {","\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );","}"].join("\n")),O=new x(["vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {","\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );","}"].join("\n")),_=new x(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),L=new x(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n")),R=new x(["vec4 RGBEToLinear( in vec4 value ) {","\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );","}"].join("\n")),C=new x(["vec4 LinearToRGBE( in vec4 value ) {","\tfloat maxComponent = max( max( value.r, value.g ), value.b );","\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );","\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );","}"].join("\n")),J=new x(["vec3 RGBMToLinear( in vec4 value, in float maxRange ) {","\treturn vec4( value.xyz * value.w * maxRange, 1.0 );","}"].join("\n")),E=new x(["vec3 LinearToRGBM( in vec4 value, in float maxRange ) {","\tfloat maxRGB = max( value.x, max( value.g, value.b ) );","\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );","\tM            = ceil( M * 255.0 ) / 255.0;","\treturn vec4( value.rgb / ( M * maxRange ), M );","}"].join("\n")),D=new x(["vec3 RGBDToLinear( in vec4 value, in float maxRange ) {","\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );","}"].join("\n")),M=new x(["vec3 LinearToRGBD( in vec4 value, in float maxRange ) {","\tfloat maxRGB = max( value.x, max( value.g, value.b ) );","\tfloat D      = max( maxRange / maxRGB, 1.0 );","\tD            = clamp( floor( D ) / 255.0, 0.0, 1.0 );","\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );","}"].join("\n")),A=new p("const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );"),P=new x(["vec4 LinearToLogLuv( in vec4 value ) {","\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;","\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));","\tvec4 vResult;","\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;","\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;","\tvResult.w = fract(Le);","\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;","\treturn vResult;","}"].join("\n"),[A]),z=new p("const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );"),{LinearToLinear:w,GammaToLinear:T,LinearToGamma:O,sRGBToLinear:_,LinearTosRGB:L,RGBEToLinear:R,LinearToRGBE:C,RGBMToLinear:J,LinearToRGBM:E,RGBDToLinear:D,LinearToRGBD:M,cLogLuvM:A,LinearToLogLuv:P,cLogLuvInverseM:z,LogLuvToLinear:new x(["vec4 LogLuvToLinear( in vec4 value ) {","\tfloat Le = value.z * 255.0 + value.w;","\tvec3 Xp_Y_XYZp;","\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);","\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;","\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;","\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;","\treturn vec4( max(vRGB, 0.0), 1.0 );","}"].join("\n"),[z])}),H.LINEAR_TO_LINEAR="LinearToLinear",H.GAMMA_TO_LINEAR="GammaToLinear",H.LINEAR_TO_GAMMA="LinearToGamma",H.SRGB_TO_LINEAR="sRGBToLinear",H.LINEAR_TO_SRGB="LinearTosRGB",H.RGBE_TO_LINEAR="RGBEToLinear",H.LINEAR_TO_RGBE="LinearToRGBE",H.RGBM_TO_LINEAR="RGBMToLinear",H.LINEAR_TO_RGBM="LinearToRGBM",H.RGBD_TO_LINEAR="RGBDToLinear",H.LINEAR_TO_RGBD="LinearToRGBD",H.LINEAR_TO_LOG_LUV="LinearToLogLuv",H.LOG_LUV_TO_LINEAR="LogLuvToLinear",H.getEncodingComponents=function(t){switch(t){case s._3:return["Linear"];case s._87:return["sRGB"];case s._47:return["RGBE"];case s._51:return["RGBM",new G(7).setReadonly(!0)];case s._50:return["RGBM",new G(16).setReadonly(!0)];case s._46:return["RGBD",new G(256).setReadonly(!0)];case s.K:return["Gamma",new b("float( GAMMA_FACTOR )","f")]}},H.prototype=Object.create(u.prototype),H.prototype.constructor=H,H.prototype.nodeType="ColorSpace",H.prototype.hashProperties=["method"],H.prototype.generate=function(t,e){var o=this.input.build(t,"v4"),i=this.getType(t),r=H.Nodes[this.method],n=t.include(r);if(n===H.LINEAR_TO_LINEAR)return t.format(o,i,e);if(2===r.inputs.length){var s=this.factor.build(t,"f");return t.format(n+"( "+o+", "+s+" )",i,e)}return t.format(n+"( "+o+" )",i,e)},H.prototype.fromEncoding=function(t){var e=H.getEncodingComponents(t);this.method="LinearTo"+e[0],this.factor=e[1]},H.prototype.fromDecoding=function(t){var e=H.getEncodingComponents(t);this.method=e[0]+"ToLinear",this.factor=e[1]},H.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.input=t.input,this.method=t.method,this},H.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).input=this.input.toJSON(t).uuid,e.method=this.method),e},q.prototype=Object.create(c.prototype),q.prototype.constructor=q,q.prototype.nodeType="Texture",q.prototype.getTexture=function(t,e){return c.prototype.generate.call(this,t,e,this.value.uuid,"t")},q.prototype.generate=function(t,e){if("sampler2D"===e)return this.getTexture(t,e);var o,i,r=this.getTexture(t,e),n=this.uv.build(t,this.project?"v4":"v2"),s=this.bias?this.bias.build(t,"f"):void 0;void 0===s&&t.context.bias&&(s=t.context.bias.setTexture(this).build(t,"f")),o=this.project?"texture2DProj":s?"tex2DBias":"tex2D",i=s?o+"( "+r+", "+n+", "+s+" )":o+"( "+r+", "+n+" )";var a={include:t.isShader("vertex"),ignoreCache:!0},u=this.getType(t);return t.addContext(a),this.colorSpace=this.colorSpace||new H(new b("",u)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(i),i=this.colorSpace.build(t,u),t.removeContext(),t.format(i,u,e)},q.prototype.copy=function(t){return c.prototype.copy.call(this,t),t.value&&(this.value=t.value),this.uv=t.uv,t.bias&&(this.bias=t.bias),void 0!==t.project&&(this.project=t.project),this},q.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.value&&(e.value=this.value.uuid),e.uv=this.uv.toJSON(t).uuid,e.project=this.project,this.bias&&(e.bias=this.bias.toJSON(t).uuid)),e},X.LOCAL="local",X.WORLD="world",X.VIEW="view",X.PROJECTION="projection",X.prototype=Object.create(u.prototype),X.prototype.constructor=X,X.prototype.nodeType="Position",X.prototype.getType=function(){switch(this.scope){case X.PROJECTION:return"v4"}return this.type},X.prototype.getShared=function(){switch(this.scope){case X.LOCAL:case X.WORLD:return!1}return!0},X.prototype.generate=function(t,e){var o;switch(this.scope){case X.LOCAL:t.isShader("vertex")?o="transformed":(t.requires.position=!0,o="vPosition");break;case X.WORLD:if(t.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";t.requires.worldPosition=!0,o="vWPosition";break;case X.VIEW:o=t.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case X.PROJECTION:o=t.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return t.format(o,this.getType(t),e)},X.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.scope=t.scope,this},X.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e},m.addKeyword("position",function(){return new X}),m.addKeyword("worldPosition",function(){return new X(X.WORLD)}),m.addKeyword("viewPosition",function(){return new X(X.VIEW)}),W.LOCAL="local",W.WORLD="world",W.VIEW="view",W.prototype=Object.create(u.prototype),W.prototype.constructor=W,W.prototype.nodeType="Normal",W.prototype.getShared=function(){return this.scope===W.WORLD},W.prototype.build=function(t,e,o,i){var r=t.context[this.scope+"Normal"];return r?r.build(t,e,o,i):u.prototype.build.call(this,t,e,o)},W.prototype.generate=function(t,e){var o;switch(this.scope){case W.VIEW:o=t.isShader("vertex")?"transformedNormal":"geometryNormal";break;case W.LOCAL:t.isShader("vertex")?o="objectNormal":(t.requires.normal=!0,o="vObjectNormal");break;case W.WORLD:t.isShader("vertex")?o="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(t.requires.worldNormal=!0,o="vWNormal")}return t.format(o,this.getType(t),e)},W.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.scope=t.scope,this},W.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e},m.addKeyword("viewNormal",function(){return new W(W.VIEW)}),m.addKeyword("localNormal",function(){return new W(W.NORMAL)}),m.addKeyword("worldNormal",function(){return new W(W.WORLD)}),Y.CUBE="cube",Y.SPHERE="sphere",Y.VECTOR="vector",Y.prototype=Object.create(u.prototype),Y.prototype.constructor=Y,Y.prototype.nodeType="Reflect",Y.prototype.getUnique=function(t){return!t.context.viewNormal},Y.prototype.getType=function(){switch(this.scope){case Y.SPHERE:return"v2"}return this.type},Y.prototype.generate=function(t,e){var o=this.getUnique(t);if(t.isShader("fragment")){var i;switch(this.scope){case Y.VECTOR:var r=new W(W.VIEW),n=t.context.roughness,s=r.build(t,"v3"),a=new X(X.VIEW).build(t,"v3"),u=n?n.build(t,"f"):void 0,c="reflect( -normalize( "+a+" ), "+s+" )";u&&(c="normalize( mix( "+c+", "+s+", "+u+" * "+u+" ) )");var h="inverseTransformDirection( "+c+", viewMatrix )";o?(t.addNodeCode("vec3 reflectVec = "+h+";"),i="reflectVec"):i=h;break;case Y.CUBE:h="vec3( -"+(p=new Y(Y.VECTOR).build(t,"v3"))+".x, "+p+".yz )";o?(t.addNodeCode("vec3 reflectCubeVec = "+h+";"),i="reflectCubeVec"):i=h;break;case Y.SPHERE:var p;h="normalize( ( viewMatrix * vec4( "+(p=new Y(Y.VECTOR).build(t,"v3"))+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";o?(t.addNodeCode("vec2 reflectSphereVec = "+h+";"),i="reflectSphereVec"):i=h}return t.format(i,this.getType(t),e)}return console.warn("THREE.ReflectNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.type,e)},Y.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e},K.prototype=Object.create(c.prototype),K.prototype.constructor=K,K.prototype.nodeType="CubeTexture",K.prototype.getTexture=function(t,e){return c.prototype.generate.call(this,t,e,this.value.uuid,"tc")},K.prototype.generate=function(t,e){if("samplerCube"===e)return this.getTexture(t,e);var o,i=this.getTexture(t,e),r=this.uv.build(t,"v3"),n=this.bias?this.bias.build(t,"f"):void 0;void 0===n&&t.context.bias&&(n=t.context.bias.setTexture(this).build(t,"f")),o=n?"texCubeBias( "+i+", "+r+", "+n+" )":"texCube( "+i+", "+r+" )";var s={include:t.isShader("vertex"),ignoreCache:!0},a=this.getType(t);return t.addContext(s),this.colorSpace=this.colorSpace||new H(new b("",a)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(o),o=this.colorSpace.build(t,a),t.removeContext(),t.format(o,a,e)},K.prototype.copy=function(t){return c.prototype.copy.call(this,t),t.value&&(this.value=t.value),this.uv=t.uv,t.bias&&(this.bias=t.bias),this},K.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.uuid,e.uv=this.uv.toJSON(t).uuid,this.bias&&(e.bias=this.bias.toJSON(t).uuid)),e},$.ADD="+",$.SUB="-",$.MUL="*",$.DIV="/",$.prototype=Object.create(u.prototype),$.prototype.constructor=$,$.prototype.nodeType="Operator",$.prototype.getType=function(t){var e=this.a.getType(t),o=this.b.getType(t);return t.isTypeMatrix(e)?"v4":t.getTypeLength(o)>t.getTypeLength(e)?o:e},$.prototype.generate=function(t,e){var o=this.getType(t),i=this.a.build(t,o),r=this.b.build(t,o);return t.format("( "+i+" "+this.op+" "+r+" )",o,e)},$.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.a=t.a,this.b=t.b,this.op=t.op,this},$.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.op=this.op),e},Z.RAD="radians",Z.DEG="degrees",Z.EXP="exp",Z.EXP2="exp2",Z.LOG="log",Z.LOG2="log2",Z.SQRT="sqrt",Z.INV_SQRT="inversesqrt",Z.FLOOR="floor",Z.CEIL="ceil",Z.NORMALIZE="normalize",Z.FRACT="fract",Z.SATURATE="saturate",Z.SIN="sin",Z.COS="cos",Z.TAN="tan",Z.ASIN="asin",Z.ACOS="acos",Z.ARCTAN="atan",Z.ABS="abs",Z.SIGN="sign",Z.LENGTH="length",Z.NEGATE="negate",Z.INVERT="invert",Z.MIN="min",Z.MAX="max",Z.MOD="mod",Z.STEP="step",Z.REFLECT="reflect",Z.DISTANCE="distance",Z.DOT="dot",Z.CROSS="cross",Z.POW="pow",Z.MIX="mix",Z.CLAMP="clamp",Z.REFRACT="refract",Z.SMOOTHSTEP="smoothstep",Z.FACEFORWARD="faceforward",Z.prototype=Object.create(u.prototype),Z.prototype.constructor=Z,Z.prototype.nodeType="Math",Z.prototype.hashProperties=["method"],Z.prototype.getNumInputs=function(){switch(this.method){case Z.MIX:case Z.CLAMP:case Z.REFRACT:case Z.SMOOTHSTEP:case Z.FACEFORWARD:return 3;case Z.MIN:case Z.MAX:case Z.MOD:case Z.STEP:case Z.REFLECT:case Z.DISTANCE:case Z.DOT:case Z.CROSS:case Z.POW:return 2;default:return 1}},Z.prototype.getInputType=function(t){var e=t.getTypeLength(this.a.getType(t)),o=this.b?t.getTypeLength(this.b.getType(t)):0,i=this.c?t.getTypeLength(this.c.getType(t)):0;return e>o&&e>i?this.a.getType(t):o>i?this.b.getType(t):this.c.getType(t)},Z.prototype.getType=function(t){switch(this.method){case Z.LENGTH:case Z.DISTANCE:case Z.DOT:return"f";case Z.CROSS:return"v3"}return this.getInputType(t)},Z.prototype.generate=function(t,e){var o,i,r,n=this.a?t.getTypeLength(this.a.getType(t)):0,s=this.b?t.getTypeLength(this.b.getType(t)):0,a=this.c?t.getTypeLength(this.c.getType(t)):0,u=this.getInputType(t),c=this.getType(t);switch(this.method){case Z.NEGATE:return t.format("( -"+this.a.build(t,u)+" )",u,e);case Z.INVERT:return t.format("( 1.0 - "+this.a.build(t,u)+" )",u,e);case Z.CROSS:o=this.a.build(t,"v3"),i=this.b.build(t,"v3");break;case Z.STEP:o=this.a.build(t,1===n?"f":u),i=this.b.build(t,u);break;case Z.MIN:case Z.MAX:case Z.MOD:o=this.a.build(t,u),i=this.b.build(t,1===s?"f":u);break;case Z.REFRACT:o=this.a.build(t,u),i=this.b.build(t,u),r=this.c.build(t,"f");break;case Z.MIX:o=this.a.build(t,u),i=this.b.build(t,u),r=this.c.build(t,1===a?"f":u);break;default:o=this.a.build(t,u),this.b&&(i=this.b.build(t,u)),this.c&&(r=this.c.build(t,u))}var h=[];h.push(o),i&&h.push(i),r&&h.push(r);var p=this.getNumInputs(t);if(h.length!==p)throw Error('Arguments not match used in "'+this.method+'". Require '+p+", currently "+h.length+".");return t.format(this.method+"( "+h.join(", ")+" )",c,e)},Z.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.a=t.a,this.b=t.b,this.c=t.c,this.method=t.method,this},Z.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,this.b&&(e.b=this.b.toJSON(t).uuid),this.c&&(e.c=this.c.toJSON(t).uuid),e.method=this.method),e},Q.Nodes=function(){var t=new f("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),e=new p("float cubeUV_maxMipLevel 8.0",!0),o=new p("float cubeUV_minMipLevel 4.0",!0),i=new p("float cubeUV_maxTileSize 256.0",!0),r=new p("float cubeUV_minTileSize 16.0",!0),n=new x("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");n.useKeywords=!1;var s=new x("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");s.useKeywords=!1;var a=new x("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[t,n,s,e,o,i,r]);a.useKeywords=!1;var u=new p("float r0 1.0",!0),c=new p("float v0 0.339",!0),h=new p("float m0 -2.0",!0);return{bilinearCubeUV:a,roughnessToMip:new x("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[u,c,h,new p("float r1 0.8",!0),new p("float v1 0.276",!0),new p("float m1 -1.0",!0),new p("float r4 0.4",!0),new p("float v4 0.046",!0),new p("float m4 2.0",!0),new p("float r5 0.305",!0),new p("float v5 0.016",!0),new p("float m5 3.0",!0),new p("float r6 0.21",!0),new p("float v6 0.0038",!0),new p("float m6 4.0",!0)]),m0:h,cubeUV_maxMipLevel:e}}(),Q.prototype=Object.create(u.prototype),Q.prototype.constructor=Q,Q.prototype.nodeType="TextureCubeUV",Q.prototype.bilinearCubeUV=function(t,e,o,i){var r=new S(Q.Nodes.bilinearCubeUV,[e,o,i]);this.colorSpaceTL=this.colorSpaceTL||new H(new b("","v4")),this.colorSpaceTL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(r.build(t)+".tl"),this.colorSpaceTR=this.colorSpaceTR||new H(new b("","v4")),this.colorSpaceTR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(r.build(t)+".tr"),this.colorSpaceBL=this.colorSpaceBL||new H(new b("","v4")),this.colorSpaceBL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(r.build(t)+".bl"),this.colorSpaceBR=this.colorSpaceBR||new H(new b("","v4")),this.colorSpaceBR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(r.build(t)+".br");var n={include:t.isShader("vertex"),ignoreCache:!0};t.addContext(n),this.colorSpaceTLExp=new b(this.colorSpaceTL.build(t,"v4"),"v4"),this.colorSpaceTRExp=new b(this.colorSpaceTR.build(t,"v4"),"v4"),this.colorSpaceBLExp=new b(this.colorSpaceBL.build(t,"v4"),"v4"),this.colorSpaceBRExp=new b(this.colorSpaceBR.build(t,"v4"),"v4"),t.removeContext();var s=new b("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return s.keywords.cubeUV_TL=this.colorSpaceTLExp,s.keywords.cubeUV_TR=this.colorSpaceTRExp,s.keywords.cubeUV_BL=this.colorSpaceBLExp,s.keywords.cubeUV_BR=this.colorSpaceBRExp,s.keywords.cubeUV=r,s},Q.prototype.generate=function(t,e){if(t.isShader("fragment")){var o=this.uv,i=this.bias||t.context.roughness,r=new Z(new S(Q.Nodes.roughnessToMip,[i]),Q.Nodes.m0,Q.Nodes.cubeUV_maxMipLevel,Z.CLAMP),n=new Z(r,Z.FLOOR),s=new Z(r,Z.FRACT),a=new Z(this.bilinearCubeUV(t,this.value,o,n),this.bilinearCubeUV(t,this.value,o,new $(n,new G(1).setReadonly(!0),$.ADD)),s,Z.MIX);return t.format(a.build(t),"v4",e)}return console.warn("THREE.TextureCubeUVNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)},Q.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.uv=this.uv.toJSON(t).uuid,e.bias=this.bias.toJSON(t).uuid),e},tt.prototype=Object.create(u.prototype),tt.prototype.constructor=tt,tt.prototype.nodeType="TextureCube",tt.prototype.generate=function(t,e){return t.isShader("fragment")?(t.require("irradiance"),t.context.bias&&t.context.bias.setTexture(this.value),("irradiance"===t.slot?this.irradianceNode:this.radianceNode).build(t,e)):(console.warn("THREE.TextureCubeNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e))},tt.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.value=t.value,this},tt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid),e};var et=V.elements,ot=["float","vec2","vec3","vec4"],it={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b"},rt={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4"};function nt(){this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.requires={uv:[],color:[],lights:!1,fog:!1,transparent:!1,irradiance:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:"",fragment:""},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={},this.updaters=[],this.nodes=[],this.analyzing=!1}function st(t){c.call(this,"b"),this.value=Boolean(t)}function at(t){c.call(this,"i"),this.value=Math.floor(t||0)}function ut(t,e,o){c.call(this,"c"),this.value=t instanceof s.o?t:new s.o(t||0,e,o)}function ct(t){c.call(this,"m3"),this.value=t||new s._13}function ht(t){c.call(this,"m4"),this.value=t||new s._14}function pt(t){q.call(this,void 0,t)}function lt(t){u.call(this,"v4"),t&&this.setMirror(t)}function dt(t,e,o){c.call(this,o),this.object=t,this.property=e}function vt(t){a.call(this,"v4"),this.value=t}function ft(t,e){s._59.call(this),this.vertex=t||new vt(new X(X.PROJECTION)),this.fragment=e||new vt(new ut(16711680)),this.updaters=[]}function yt(t,e,o,i){i=i||{},this.input=o,this.clear=void 0===i.clear||i.clear,this.renderTarget=new s._85(t,e,i),this.material=new ft,this.camera=new s._31(-1,1,1,-1,0,1),this.scene=new s._57,this.quad=new s._15(new s._36(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.render=!0,q.call(this,this.renderTarget.texture)}nt.prototype={constructor:nt,build:function(t,e){this.buildShader("vertex",t),this.buildShader("fragment",e);for(var o=0;o<this.requires.uv.length;o++)if(this.requires.uv[o]){var i=o>0?o+1:"";this.addVaryCode("varying vec2 vUv"+i+";"),o>0&&this.addVertexParsCode("attribute vec2 uv"+i+";"),this.addVertexFinalCode("vUv"+i+" = uv"+i+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition&&(this.addVaryCode("varying vec3 vWPosition;"),this.addVertexFinalCode("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;")),this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this},buildShader:function(t,e){this.resultCode[t]=e.build(this.setShader(t),"v4")},setMaterial:function(t,e){return this.material=t,this.renderer=e,this.requires.lights=t.lights,this.requires.fog=t.fog,this.mergeDefines(t.defines),this},addFlow:function(t,e,o){return this.addSlot(t).addCache(e).addContext(o)},removeFlow:function(){return this.removeSlot().removeCache().removeContext()},addCache:function(t){return this.cache=t||"",this.caches.push(this.cache),this},removeCache:function(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this},addContext:function(t){return this.context=Object.assign({},this.context,t),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this},removeContext:function(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this},addSlot:function(t){return this.slot=t||"",this.slots.push(this.slot),this},removeSlot:function(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this},addVertexCode:function(t){this.addCode(t,"vertex")},addFragmentCode:function(t){this.addCode(t,"fragment")},addCode:function(t,e){this.code[e||this.shader]+=t+"\n"},addVertexNodeCode:function(t){this.addNodeCode(t,"vertex")},addFragmentNodeCode:function(t){this.addNodeCode(t,"fragment")},addNodeCode:function(t,e){this.nodeCode[e||this.shader]+=t+"\n"},clearNodeCode:function(t){t=t||this.shader;var e=this.nodeCode[t];return this.nodeCode[t]="",e},clearVertexNodeCode:function(){return this.clearNodeCode("vertex")},clearFragmentNodeCode:function(){return this.clearNodeCode("fragment")},addVertexFinalCode:function(t){this.addFinalCode(t,"vertex")},addFragmentFinalCode:function(t){this.addFinalCode(t,"fragment")},addFinalCode:function(t,e){this.finalCode[e||this.shader]+=t+"\n"},addVertexParsCode:function(t){this.addParsCode(t,"vertex")},addFragmentParsCode:function(t){this.addParsCode(t,"fragment")},addParsCode:function(t,e){this.parsCode[e||this.shader]+=t+"\n"},addVaryCode:function(t){this.addVertexParsCode(t),this.addFragmentParsCode(t)},isCache:function(t){return-1!==this.caches.indexOf(t)},isSlot:function(t){return-1!==this.slots.indexOf(t)},define:function(t,e){this.defines[t]=void 0===e?1:e},require:function(t){this.requires[t]=!0},isDefined:function(t){return void 0!==this.defines[t]},getVar:function(t,e,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"varying",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"V",n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",s=this.getVars(i),a=s[t];if(!a){var u=s.length;a={name:o||"node"+r+u+(n?"_"+n:""),type:e},s.push(a),s[t]=a}return a},getTempVar:function(t,e,o,i){return this.getVar(t,e,o,this.shader,"T",i)},getAttribute:function(t,e){if(!this.attributes[t]){var o=this.getVar(t,e);this.addVertexParsCode("attribute "+e+" "+t+";"),this.addVertexFinalCode(o.name+" = "+t+";"),this.attributes[t]={varying:o,name:t,type:e}}return this.attributes[t]},getCode:function(t){return[this.prefixCode,this.parsCode[t],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[t],"uniform"),this.getIncludesCode("consts",t),this.getIncludesCode("structs",t),this.getIncludesCode("functions",t),"void main() {",this.getVarListCode(this.getVars(t)),this.code[t],this.resultCode[t],this.finalCode[t],"}"].join("\n")},getVarListCode:function(t,e){e=e||"";for(var o="",i=0,r=t.length;i<r;++i){var n=t[i],s=n.type,a=n.name,u=this.getFormatByType(s);if(void 0===u)throw new Error("Node pars "+u+" not found.");o+=e+" "+u+" "+a+";\n"}return o},getVars:function(t){return this.inputs.vars[t||this.shader]},getNodeData:function(t){var e=t.isNode?t.uuid:t;return this.nodeData[e]=this.nodeData[e]||{}},createUniform:function(t,e,o,i,r,n){var s=this.inputs.uniforms,a=s.list.length,u=new j({type:e,name:i||"nodeU"+a+(n?"_"+n:""),node:o,needsUpdate:r});return s.list.push(u),s[t].push(u),s[t][u.name]=u,this.uniforms[u.name]=u,u},createVertexUniform:function(t,e,o,i,r){return this.createUniform("vertex",t,e,o,i,r)},createFragmentUniform:function(t,e,o,i,r){return this.createUniform("fragment",t,e,o,i,r)},include:function(t,e,o){var i;if(t="string"==typeof t?m.get(t):t,!1===this.context.include)return t.name;t instanceof x?i=this.includes.functions:t instanceof p?i=this.includes.consts:t instanceof f&&(i=this.includes.structs);var r=i[this.shader]=i[this.shader]||[];if(t){var n=r[t.name];if(n||(n=r[t.name]={node:t,deps:[]},r.push(n),n.src=t.build(this,"source")),t instanceof x&&e&&r[e.name]&&-1==r[e.name].deps.indexOf(t)&&(r[e.name].deps.push(t),t.includes&&t.includes.length)){var s=0;do{this.include(t.includes[s++],e)}while(s<t.includes.length)}return o&&(n.src=o),t.name}throw new Error("Include not found.")},colorToVectorProperties:function(t){return t.replace("r","x").replace("g","y").replace("b","z").replace("a","w")},colorToVector:function(t){return t.replace(/c/g,"v3")},getIncludes:function(t,e){return this.includes[t][e||this.shader]},getIncludesCode:function(){function t(t,e){return t.deps.length-e.deps.length}return function(e,o){if(!(r=this.getIncludes(e,o)))return"";for(var i="",r=r.sort(t),n=0;n<r.length;n++)r[n].src&&(i+=r[n].src+"\n");return i}}(),getConstructorFromLength:function(t){return ot[t-1]},isTypeMatrix:function(t){return/^m/.test(t)},getTypeLength:function(t){return"f"===t?1:parseInt(this.colorToVector(t).substr(1))},getTypeFromLength:function(t){return 1===t?"f":"v"+t},findNode:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if(void 0!==e&&e.isNode)return e}},resolve:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if(void 0!==e){if(e.isNode)return e;if(e.isTexture)switch(e.mapping){case s.q:case s.r:return new K(e);case s.s:case s.t:return new tt(new q(e));default:return new q(e)}else{if(e.isVector2)return new I(e);if(e.isVector3)return new B(e);if(e.isVector4)return new U(e)}}}},format:function(t,e,o){switch(this.colorToVector(o+" <- "+e)){case"f <- v2":case"f <- v3":case"f <- v4":return t+".x";case"f <- i":case"f <- b":return"float( "+t+" )";case"v2 <- f":return"vec2( "+t+" )";case"v2 <- v3":case"v2 <- v4":return t+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+t+" ) )";case"v3 <- f":return"vec3( "+t+" )";case"v3 <- v2":return"vec3( "+t+", 0.0 )";case"v3 <- v4":return t+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+t+" ) )";case"v4 <- f":return"vec4( "+t+" )";case"v4 <- v2":return"vec4( "+t+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+t+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+t+" ) )";case"i <- f":case"i <- b":return"int( "+t+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+t+".x )";case"b <- f":return"( "+t+" != 0.0 )";case"b <- v2":return"( "+t+" != vec2( 0.0 ) )";case"b <- v3":return"( "+t+" != vec3( 0.0 ) )";case"b <- v4":return"( "+t+" != vec4( 0.0 ) )";case"b <- i":return"( "+t+" != 0 )"}return t},getTypeByFormat:function(t){return it[t]||t},getFormatByType:function(t){return rt[t]||t},getUuid:function(t,e){return(e=void 0===e||e)&&this.cache&&(t=this.cache+"-"+t),t},getElementByIndex:function(t){return et[t]},getIndexByElement:function(t){return et.indexOf(t)},isShader:function(t){return this.shader===t},setShader:function(t){return this.shader=t,this},mergeDefines:function(t){for(var e in t)this.defines[e]=t[e];return this.defines},mergeUniform:function(t){for(var e in t)this.uniforms[e]=t[e];return this.uniforms},getTextureEncodingFromMap:function(t){var e;return t?t.isTexture?e=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=s._3,e===s._3&&this.context.gamma&&(e=s.K),e}},st.prototype=Object.create(c.prototype),st.prototype.constructor=st,st.prototype.nodeType="Bool",st.prototype.generateReadonly=function(t,e,o,i){return t.format(this.value,i,e)},st.prototype.copy=function(t){return c.prototype.copy.call(this,t),this.value=t.value,this},st.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value,!0===this.readonly&&(e.readonly=!0)),e},at.prototype=Object.create(c.prototype),at.prototype.constructor=at,at.prototype.nodeType="Int",at.prototype.generateReadonly=function(t,e,o,i){return t.format(this.value,i,e)},at.prototype.copy=function(t){return c.prototype.copy.call(this,t),this.value=t.value,this},at.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value,!0===this.readonly&&(e.readonly=!0)),e},ut.prototype=Object.create(c.prototype),ut.prototype.constructor=ut,ut.prototype.nodeType="Color",V.addShortcuts(ut.prototype,"value",["r","g","b"]),ut.prototype.generateReadonly=function(t,e,o,i){return t.format("vec3( "+this.r+", "+this.g+", "+this.b+" )",i,e)},ut.prototype.copy=function(t){return c.prototype.copy.call(this,t),this.value.copy(t),this},ut.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).r=this.r,e.g=this.g,e.b=this.b,!0===this.readonly&&(e.readonly=!0)),e},ct.prototype=Object.create(c.prototype),ct.prototype.constructor=ct,ct.prototype.nodeType="Matrix3",Object.defineProperties(ct.prototype,{elements:{set:function(t){this.value.elements=t},get:function(){return this.value.elements}}}),ct.prototype.generateReadonly=function(t,e,o,i){return t.format("mat3( "+this.value.elements.join(", ")+" )",i,e)},ct.prototype.copy=function(t){return c.prototype.copy.call(this,t),this.value.fromArray(t.elements),this},ct.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).elements=this.value.elements.concat()),e},ht.prototype=Object.create(c.prototype),ht.prototype.constructor=ht,ht.prototype.nodeType="Matrix4",Object.defineProperties(ht.prototype,{elements:{set:function(t){this.value.elements=t},get:function(){return this.value.elements}}}),ht.prototype.generateReadonly=function(t,e,o,i){return t.format("mat4( "+this.value.elements.join(", ")+" )",i,e)},ht.prototype.copy=function(t){return c.prototype.copy.call(this,t),this.scope.value.fromArray(t.elements),this},ht.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).elements=this.value.elements.concat()),e},pt.prototype=Object.create(q.prototype),pt.prototype.constructor=pt,pt.prototype.nodeType="Screen",pt.prototype.getUnique=function(){return!0},pt.prototype.getTexture=function(t,e){return c.prototype.generate.call(this,t,e,this.getUuid(),"t","renderTexture")},lt.prototype=Object.create(u.prototype),lt.prototype.constructor=lt,lt.prototype.nodeType="Reflector",lt.prototype.setMirror=function(t){this.mirror=t,this.textureMatrix=new ht(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new X(X.LOCAL),this.uv=new $(this.textureMatrix,this.localPosition,$.MUL),this.uvResult=new $(null,this.uv,$.ADD),this.texture=new q(this.mirror.material.uniforms.tDiffuse.value,this.uv,null,!0)},lt.prototype.generate=function(t,e){return t.isShader("fragment")?(this.uvResult.a=this.offset,this.texture.uv=this.offset?this.uvResult:this.uv,"sampler2D"===e?this.texture.build(t,e):t.format(this.texture.build(t,this.type),this.type,e)):(console.warn("THREE.ReflectorNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.type,e))},lt.prototype.copy=function(t){return c.prototype.copy.call(this,t),this.scope.mirror=t.mirror,this},lt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).mirror=this.mirror.uuid,this.offset&&(e.offset=this.offset.toJSON(t).uuid)),e},dt.prototype=Object.create(c.prototype),dt.prototype.constructor=dt,dt.prototype.nodeType="Property",Object.defineProperties(dt.prototype,{value:{get:function(){return this.object[this.property]},set:function(t){this.object[this.property]=t}}}),dt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value,e.property=this.property),e},vt.prototype=Object.create(a.prototype),vt.prototype.constructor=vt,vt.prototype.nodeType="Raw",vt.prototype.generate=function(t){var e=this.value.analyzeAndFlow(t,this.type),o=e.code+"\n";return t.isShader("vertex")?o+="gl_Position = "+e.result+";":o+="gl_FragColor = "+e.result+";",o},vt.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.value=t.value,this},vt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid),e},ft.prototype=Object.create(s._59.prototype),ft.prototype.constructor=ft,ft.prototype.type="NodeMaterial",ft.prototype.isNodeMaterial=!0,Object.defineProperties(ft.prototype,{properties:{get:function(){return this.fragment.properties}},needsUpdate:{set:function(t){!0===t&&this.version++,this.needsCompile=t},get:function(){return this.needsCompile}}}),ft.prototype.onBeforeCompile=function(t,e){this.build({renderer:e}),t.defines=this.defines,t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.extensionDerivatives=!0===this.extensions.derivatives,t.extensionFragDepth=!0===this.extensions.fragDepth,t.extensionDrawBuffers=!0===this.extensions.drawBuffers,t.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD},ft.prototype.customProgramCacheKey=function(){return this.getHash()},ft.prototype.getHash=function(){var t="{";return t+='"vertex":'+this.vertex.getHash()+",",t+='"fragment":'+this.fragment.getHash(),t+="}"},ft.prototype.updateFrame=function(t){for(var e=0;e<this.updaters.length;++e)t.updateNode(this.updaters[e])},ft.prototype.build=function(t){var e=(t=t||{}).builder||new nt;return e.setMaterial(this,t.renderer),e.build(this.vertex,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters,this.fog=e.requires.fog,this.lights=e.requires.lights,this.transparent=e.requires.transparent||this.blending>s._27,this},ft.prototype.copy=function(t){var e=this.uuid;for(var o in t)this[o]=t[o];return this.uuid=e,void 0!==t.userData&&(this.userData=JSON.parse(JSON.stringify(t.userData))),this},ft.prototype.toJSON=function(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.materials&&(t.materials={}),!t.materials[this.uuid]){var e={};e.uuid=this.uuid,e.type=this.type,t.materials[e.uuid]=e,""!==this.name&&(e.name=this.name),void 0!==this.size&&(e.size=this.size),void 0!==this.sizeAttenuation&&(e.sizeAttenuation=this.sizeAttenuation),this.blending!==s._27&&(e.blending=this.blending),!0===this.flatShading&&(e.flatShading=this.flatShading),this.side!==s.J&&(e.side=this.side),this.vertexColors!==s._26&&(e.vertexColors=this.vertexColors),this.depthFunc!==s.W&&(e.depthFunc=this.depthFunc),!1===this.depthTest&&(e.depthTest=this.depthTest),!1===this.depthWrite&&(e.depthWrite=this.depthWrite),1!==this.linewidth&&(e.linewidth=this.linewidth),void 0!==this.dashSize&&(e.dashSize=this.dashSize),void 0!==this.gapSize&&(e.gapSize=this.gapSize),void 0!==this.scale&&(e.scale=this.scale),!0===this.dithering&&(e.dithering=!0),!0===this.wireframe&&(e.wireframe=this.wireframe),this.wireframeLinewidth>1&&(e.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(e.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(e.wireframeLinejoin=this.wireframeLinejoin),this.alphaTest>0&&(e.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(e.premultipliedAlpha=this.premultipliedAlpha),!0===this.morphTargets&&(e.morphTargets=!0),!0===this.skinning&&(e.skinning=!0),!1===this.visible&&(e.visible=!1),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),e.fog=this.fog,e.lights=this.lights,e.vertex=this.vertex.toJSON(t).uuid,e.fragment=this.fragment.toJSON(t).uuid}return t.material=this.uuid,t},yt.prototype=Object.create(q.prototype),yt.prototype.constructor=yt,yt.prototype.nodeType="RTT",yt.prototype.build=function(t,e,o){var i=new nt;return i.nodes=t.nodes,i.updaters=t.updaters,this.material.fragment.value=this.input,this.material.build({builder:i}),q.prototype.build.call(this,t,e,o)},yt.prototype.updateFramesaveTo=function(t){if(this.saveTo.render=!1,this.saveTo!==this.saveToCurrent){this.saveToMaterial&&this.saveToMaterial.dispose();var e=new ft;e.fragment.value=this,e.build();var o=new s._57,i=new s._15(new s._36(2,2),e);i.frustumCulled=!1,o.add(i),this.saveToScene=o,this.saveToMaterial=e}this.saveToCurrent=this.saveTo,t.renderer.setRenderTarget(this.saveTo.renderTarget),this.saveTo.clear&&t.renderer.clear(),t.renderer.render(this.saveToScene,this.camera)},yt.prototype.updateFrame=function(t){t.renderer?(this.saveTo&&!1===this.saveTo.render&&this.updateFramesaveTo(t),this.render&&(this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=t.renderTexture),t.renderer.setRenderTarget(this.renderTarget),this.clear&&t.renderer.clear(),t.renderer.render(this.scene,this.camera)),this.saveTo&&!0===this.saveTo.render&&this.updateFramesaveTo(t)):console.warn("RTTNode need a renderer in NodeFrame")},yt.prototype.copy=function(t){return q.prototype.copy.call(this,t),this.saveTo=t.saveTo,this},yt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=q.prototype.toJSON.call(this,t),this.saveTo&&(e.saveTo=this.saveTo.toJSON(t).uuid)),e};var mt,gt=["color","color2"],Nt=["vColor","vColor2"];function xt(t){u.call(this,"v4",{shared:!1}),this.index=t||0}function bt(t,e){u.call(this,"v3"),this.setScope(t||bt.POSITION),this.setCamera(e)}function St(t){u.call(this,"v3",{shared:!1}),this.scope=t||St.TOTAL}function wt(){I.call(this),this.size=new s._81}function Tt(t){u.call(this,"v2"),this.resolution=t||new wt}function Ot(t,e,o,i,r){u.call(this),this.a=t,this.b=e,this.op=o,this.ifNode=i,this.elseNode=r}function _t(t){u.call(this,"f"),this.uv=t||new k}function Lt(t){u.call(this,"f"),this.uv=t||new k}function Rt(t,e){u.call(this,"v3"),this.value=t,this.scale=e||new I(1,1)}function Ct(t,e){u.call(this,"v3"),this.value=t,this.scale=e||new G(1),this.toNormalMap=!1}function Jt(t,e){a.call(this),this.code=t,this.value=e}xt.prototype=Object.create(u.prototype),xt.prototype.constructor=xt,xt.prototype.nodeType="Colors",xt.prototype.generate=function(t,e){t.requires.color[this.index]=!0;var o=t.isShader("vertex")?gt[this.index]:Nt[this.index];return t.format(o,this.getType(t),e)},xt.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.index=t.index,this},xt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).index=this.index),e},bt.Nodes={depthColor:new x(["float depthColor( float mNear, float mFar ) {","\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\treturn 1.0 - smoothstep( mNear, mFar, depth );","}"].join("\n"))},bt.POSITION="position",bt.DEPTH="depth",bt.TO_VERTEX="toVertex",bt.prototype=Object.create(u.prototype),bt.prototype.constructor=bt,bt.prototype.nodeType="Camera",bt.prototype.setCamera=function(t){this.camera=t,this.updateFrame=void 0!==t?this.onUpdateFrame:void 0},bt.prototype.setScope=function(t){switch(this.scope){case bt.DEPTH:delete this.near,delete this.far}switch(this.scope=t,t){case bt.DEPTH:var e=this.camera;this.near=new G(e?e.near:1),this.far=new G(e?e.far:1200)}},bt.prototype.getType=function(){switch(this.scope){case bt.DEPTH:return"f"}return this.type},bt.prototype.getUnique=function(){switch(this.scope){case bt.DEPTH:case bt.TO_VERTEX:return!0}return!1},bt.prototype.getShared=function(){switch(this.scope){case bt.POSITION:return!1}return!0},bt.prototype.generate=function(t,e){var o;switch(this.scope){case bt.POSITION:o="cameraPosition";break;case bt.DEPTH:o=t.include(bt.Nodes.depthColor)+"( "+this.near.build(t,"f")+", "+this.far.build(t,"f")+" )";break;case bt.TO_VERTEX:o="normalize( "+new X(X.WORLD).build(t,"v3")+" - cameraPosition )"}return t.format(o,this.getType(t),e)},bt.prototype.onUpdateFrame=function(){switch(this.scope){case bt.DEPTH:var t=this.camera;this.near.value=t.near,this.far.value=t.far}},bt.prototype.copy=function(t){switch(u.prototype.copy.call(this,t),this.setScope(t.scope),t.camera&&this.setCamera(t.camera),t.scope){case bt.DEPTH:this.near.number=t.near,this.far.number=t.far}return this},bt.prototype.toJSON=function(t){var e=this.getJSONNode(t);if(!e)switch((e=this.createJSONNode(t)).scope=this.scope,this.camera&&(e.camera=this.camera.uuid),this.scope){case bt.DEPTH:e.near=this.near.value,e.far=this.far.value}return e},St.TOTAL="total",St.prototype=Object.create(u.prototype),St.prototype.constructor=St,St.prototype.nodeType="Light",St.prototype.generate=function(t,e){return t.isCache("light")?t.format("reflectedLight.directDiffuse",this.type,e):(console.warn('THREE.LightNode is only compatible in "light" channel.'),t.format("vec3( 0.0 )",this.type,e))},St.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.scope=t.scope,this},St.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope),e},wt.prototype=Object.create(I.prototype),wt.prototype.constructor=wt,wt.prototype.nodeType="Resolution",wt.prototype.updateFrame=function(t){if(t.renderer){t.renderer.getSize(this.size);var e=t.renderer.getPixelRatio();this.x=this.size.width*e,this.y=this.size.height*e}else console.warn("ResolutionNode need a renderer in NodeFrame")},wt.prototype.copy=function(t){return I.prototype.copy.call(this,t),this.renderer=t.renderer,this},wt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).renderer=this.renderer.uuid),e},Tt.prototype=Object.create(u.prototype),Tt.prototype.constructor=Tt,Tt.prototype.nodeType="ScreenUV",Tt.prototype.generate=function(t,e){var o;return t.isShader("fragment")?o="( gl_FragCoord.xy / "+this.resolution.build(t,"v2")+")":(console.warn("THREE.ScreenUVNode is not compatible with "+t.shader+" shader."),o="vec2( 0.0 )"),t.format(o,this.getType(t),e)},Tt.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.resolution=t.resolution,this},Tt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).resolution=this.resolution.toJSON(t).uuid),e},Ot.EQUAL="==",Ot.NOT_EQUAL="!=",Ot.GREATER=">",Ot.GREATER_EQUAL=">=",Ot.LESS="<",Ot.LESS_EQUAL="<=",Ot.AND="&&",Ot.OR="||",Ot.prototype=Object.create(u.prototype),Ot.prototype.constructor=Ot,Ot.prototype.nodeType="Cond",Ot.prototype.getType=function(t){if(this.ifNode){var e=this.ifNode.getType(t),o=this.elseNode.getType(t);return t.getTypeLength(o)>t.getTypeLength(e)?o:e}return"b"},Ot.prototype.getCondType=function(t){return t.getTypeLength(this.b.getType(t))>t.getTypeLength(this.a.getType(t))?this.b.getType(t):this.a.getType(t)},Ot.prototype.generate=function(t,e){var o,i=this.getType(t),r=this.getCondType(t),n=this.a.build(t,r),s=this.b.build(t,r);if(this.ifNode){var a=this.ifNode.build(t,i),u=this.elseNode.build(t,i);o="( "+[n,this.op,s,"?",a,":",u].join(" ")+" )"}else o="( "+n+" "+this.op+" "+s+" )";return t.format(o,this.getType(t),e)},Ot.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.a=t.a,this.b=t.b,this.op=t.op,this.ifNode=t.ifNode,this.elseNode=t.elseNode,this},Ot.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).a=this.a.toJSON(t).uuid,e.b=this.b.toJSON(t).uuid,e.op=this.op,e.ifNode&&(e.ifNode=this.ifNode.toJSON(t).uuid),e.elseNode&&(e.elseNode=this.elseNode.toJSON(t).uuid)),e},_t.prototype=Object.create(u.prototype),_t.prototype.constructor=_t,_t.prototype.nodeType="Noise",_t.Nodes={snoise:new x(["float snoise(vec2 co) {","\treturn fract( sin( dot( co.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );","}"].join("\n"))},_t.prototype.generate=function(t,e){var o=t.include(_t.Nodes.snoise);return t.format(o+"( "+this.uv.build(t,"v2")+" )",this.getType(t),e)},_t.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.uv=t.uv,this},_t.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).uv=this.uv.toJSON(t).uuid),e},Lt.prototype=Object.create(u.prototype),Lt.prototype.constructor=Lt,Lt.prototype.nodeType="Noise",Lt.Nodes={checker:new x(["float checker( vec2 uv ) {","\tfloat cx = floor( uv.x );","\tfloat cy = floor( uv.y ); ","\tfloat result = mod( cx + cy, 2.0 );","\treturn sign( result );","}"].join("\n"))},Lt.prototype.generate=function(t,e){var o=t.include(Lt.Nodes.checker);return t.format(o+"( "+this.uv.build(t,"v2")+" )",this.getType(t),e)},Lt.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.uv=t.uv,this},Lt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).uv=this.uv.toJSON(t).uuid),e},Rt.Nodes={perturbNormal2Arb:new x("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 vUv, vec2 normalScale ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = map * 2.0 - 1.0;\n\n\t\tmapN.xy *= normalScale;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t// Workaround for Adreno GPUs gl_FrontFacing bug. See #15850 and #10331\n\n\t\t\tif ( dot( cross( S, T ), N ) < 0.0 ) mapN.xy *= - 1.0;\n\n\t\t#else\n\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}",null,{derivatives:!0})},Rt.prototype=Object.create(u.prototype),Rt.prototype.constructor=Rt,Rt.prototype.nodeType="NormalMap",Rt.prototype.generate=function(t,e){if(t.isShader("fragment")){var o=t.include(Rt.Nodes.perturbNormal2Arb);this.normal=this.normal||new W,this.position=this.position||new X(X.VIEW),this.uv=this.uv||new k;var i=this.scale.build(t,"v2");return t.material.side===s.f&&(i="-"+i),t.format(o+"( -"+this.position.build(t,"v3")+", "+this.normal.build(t,"v3")+", "+this.value.build(t,"v3")+", "+this.uv.build(t,"v2")+", "+i+" )",this.getType(t),e)}return console.warn("THREE.NormalMapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)},Rt.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.value=t.value,this.scale=t.scale,this},Rt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.scale=this.scale.toJSON(t).uuid),e},Ct.Nodes={dHdxy_fwd:mt=new x(["vec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {","\tvec2 dSTdx = dFdx( vUv );","\tvec2 dSTdy = dFdy( vUv );","\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;","\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","\treturn vec2( dBx, dBy );","}"].join("\n"),null,{derivatives:!0}),perturbNormalArb:new x(["vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );","\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );","\tvec3 vN = surf_norm;","\tvec3 R1 = cross( vSigmaY, vN );","\tvec3 R2 = cross( vN, vSigmaX );","\tfloat fDet = dot( vSigmaX, R1 );","\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );","\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","\treturn normalize( abs( fDet ) * surf_norm - vGrad );","}"].join("\n"),[mt],{derivatives:!0}),bumpToNormal:new x(["vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {","\tvec2 dSTdx = dFdx( uv );","\tvec2 dSTdy = dFdy( uv );","\tfloat Hll = texture2D( bumpMap, uv ).x;","\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;","\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;","\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );","}"].join("\n"),null,{derivatives:!0})},Ct.prototype=Object.create(u.prototype),Ct.prototype.constructor=Ct,Ct.prototype.nodeType="BumpMap",Ct.prototype.hashProperties=["toNormalMap"],Ct.prototype.generate=function(t,e){if(t.isShader("fragment")){if(this.toNormalMap){var o=t.include(Ct.Nodes.bumpToNormal);return t.format(o+"( "+this.value.build(t,"sampler2D")+", "+this.value.uv.build(t,"v2")+", "+this.scale.build(t,"f")+" )",this.getType(t),e)}var i=t.include(Ct.Nodes.dHdxy_fwd),r=t.include(Ct.Nodes.perturbNormalArb);this.normal=this.normal||new W,this.position=this.position||new X(X.VIEW);var n=i+"( "+this.value.build(t,"sampler2D")+", "+this.value.uv.build(t,"v2")+", "+this.scale.build(t,"f")+" )";return t.format(r+"( -"+this.position.build(t,"v3")+", "+this.normal.build(t,"v3")+", "+n+" )",this.getType(t),e)}return console.warn("THREE.BumpMapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)},Ct.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.value=t.value,this.scale=t.scale,this},Ct.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.scale=this.scale.toJSON(t).uuid),e},Jt.prototype=Object.create(a.prototype),Jt.prototype.constructor=Jt,Jt.prototype.nodeType="Bypass",Jt.prototype.getType=function(t){return this.value?this.value.getType(t):t.isShader("fragment")?"f":"void"},Jt.prototype.generate=function(t,e){var o=this.code.build(t,e)+";";return t.addNodeCode(o),t.isShader("vertex")?this.value?this.value.build(t,e):void 0:this.value?this.value.build(t,e):t.format("0.0","f",e)},Jt.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.code=t.code,this.value=t.value,this},Jt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).code=this.code.toJSON(t).uuid,this.value&&(e.value=this.value.toJSON(t).uuid)),e};var Et,Dt=V.elements;function Mt(t,e,o,i){u.call(this,"f"),this.x=t,this.y=e,this.z=o,this.w=i}function At(t,e){a.call(this),this.node=t,this.components=e||"x"}function Pt(t,e,o){G.call(this),this.scale=void 0!==t?t:1,this.scope=e||Pt.GLOBAL,this.timeScale=void 0!==o?o:void 0!==t}function zt(t,e){B.call(this),this.params={},this.velocity=new s._82,this.setTarget(t),this.setParams(e)}function Vt(t,e){b.call(this,"( uvTransform * vec3( uvNode, 1 ) ).xy","vec2"),this.uv=t||new k,this.position=e||new ct}function Ft(t){G.call(this),this.texture=t,this.maxMIPLevel=0}function jt(t,e){u.call(this,"f"),this.roughness=t,this.texture=e,this.maxMIPLevel=void 0}function It(t){u.call(this),this.slots=t||{}}function Bt(t,e,o,i){u.call(this,"v4"),this.value=t,this.uv=e||new k,this.radius=o||new I(1,1),this.size=i,this.blurX=!0,this.blurY=!0,this.horizontal=new G(1/64),this.vertical=new G(1/64)}function Ut(t){u.call(this,"f"),this.rgb=t}function kt(t,e,o){u.call(this,"v3"),this.rgb=t,this.adjustment=e,this.method=o||kt.SATURATION}function Gt(){a.call(this),this.color=new ut(16777215)}function Ht(){a.call(this),this.color=new ut(15658734),this.spherical=!0}function qt(){a.call(this),this.color=new ut(15658734),this.specular=new ut(1118481),this.shininess=new G(30)}function Xt(){a.call(this),this.color=new ut(16777215),this.roughness=new G(1),this.metalness=new G(0)}function Wt(){Xt.call(this),this.properties={color:new s.o(16777215),roughness:.5,metalness:.5,normalScale:new s._81(1,1)},this.inputs={color:new dt(this.properties,"color","c"),roughness:new dt(this.properties,"roughness","f"),metalness:new dt(this.properties,"metalness","f"),normalScale:new dt(this.properties,"normalScale","v2")}}function Yt(){var t=new Gt;ft.call(this,t,t),this.type="BasicNodeMaterial"}function Kt(){var t=new Ht;ft.call(this,t,t),this.type="SpriteNodeMaterial"}function $t(){var t=new qt;ft.call(this,t,t),this.type="PhongNodeMaterial"}function Zt(){var t=new Xt;ft.call(this,t,t),this.type="StandardNodeMaterial"}function Qt(){var t=new Wt;ft.call(this,t,t),this.type="MeshStandardNodeMaterial"}function te(t,e){if(void 0===e){var o={minFilter:s._4,magFilter:s._4,format:s._43},i=t.getDrawingBufferSize(new s._81);e=new s._85(i.width,i.height,o)}this.renderer=t,this.renderTarget=e,this.output=new pt,this.material=new ft,this.camera=new s._31(-1,1,1,-1,0,1),this.scene=new s._57,this.quad=new s._15(new s._36(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.needsUpdate=!0}Mt.prototype=Object.create(u.prototype),Mt.prototype.constructor=Mt,Mt.prototype.nodeType="Join",Mt.prototype.getNumElements=function(){for(var t=Dt.length;t--;)if(void 0!==this[Dt[t]]){++t;break}return Math.max(t,2)},Mt.prototype.getType=function(t){return t.getTypeFromLength(this.getNumElements())},Mt.prototype.generate=function(t,e){for(var o=this.getType(t),i=this.getNumElements(),r=[],n=0;n<i;n++){var s=this[Dt[n]];r.push(s?s.build(t,"f"):"0.0")}var a=(i>1?t.getConstructorFromLength(i):"")+"( "+r.join(", ")+" )";return t.format(a,o,e)},Mt.prototype.copy=function(t){for(var e in u.prototype.copy.call(this,t),t.inputs)this[e]=t.inputs[e];return this},Mt.prototype.toJSON=function(t){var e=this.getJSONNode(t);if(!e){(e=this.createJSONNode(t)).inputs={};for(var o=this.getNumElements(),i=0;i<o;i++){var r=this[Dt[i]];r&&(e.inputs[Dt[i]]=r.toJSON(t).uuid)}}return e},At.prototype=Object.create(a.prototype),At.prototype.constructor=At,At.prototype.nodeType="Switch",At.prototype.getType=function(t){return t.getTypeFromLength(this.components.length)},At.prototype.generate=function(t,e){var o=this.node.getType(t),i=this.node.build(t,o),r=t.getTypeLength(o)-1;if(r>0){var n,s=0,a=t.colorToVectorProperties(this.components),u=a.length;for(n=0;n<u;n++)s=Math.max(s,t.getIndexByElement(a.charAt(n)));for(s>r&&(s=r),i+=".",n=0;n<u;n++){var c=t.getIndexByElement(a.charAt(n));c>s&&(c=s),i+=t.getElementByIndex(c)}return t.format(i,this.getType(t),e)}return t.format(i,o,e)},At.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.node=t.node,this.components=t.components,this},At.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).node=this.node.toJSON(t).uuid,e.components=this.components),e},Pt.GLOBAL="global",Pt.LOCAL="local",Pt.DELTA="delta",Pt.prototype=Object.create(G.prototype),Pt.prototype.constructor=Pt,Pt.prototype.nodeType="Timer",Pt.prototype.getReadonly=function(){return!1},Pt.prototype.getUnique=function(){return this.timeScale&&(this.scope===Pt.GLOBAL||this.scope===Pt.DELTA)},Pt.prototype.updateFrame=function(t){var e=this.timeScale?this.scale:1;switch(this.scope){case Pt.LOCAL:this.value+=t.delta*e;break;case Pt.DELTA:this.value=t.delta*e;break;default:this.value=t.time*e}},Pt.prototype.copy=function(t){return G.prototype.copy.call(this,t),this.scope=t.scope,this.scale=t.scale,this.timeScale=t.timeScale,this},Pt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).scope=this.scope,e.scale=this.scale,e.timeScale=this.timeScale),e},m.addKeyword("time",function(){return new Pt}),zt.prototype=Object.create(B.prototype),zt.prototype.constructor=zt,zt.prototype.nodeType="Velocity",zt.prototype.getReadonly=function(){return!1},zt.prototype.setParams=function(t){switch(this.params.type){case"elastic":delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity}switch(this.params=t||{},this.params.type){case"elastic":this.moment=new s._82,this.speed=new s._82,this.springVelocity=new s._82,this.lastVelocity=new s._82}},zt.prototype.setTarget=function(t){this.target&&(delete this.position,delete this.oldPosition),this.target=t,t&&(this.position=t.getWorldPosition(this.position||new s._82),this.oldPosition=this.position.clone())},zt.prototype.updateFrameVelocity=function(){this.target&&(this.position=this.target.getWorldPosition(this.position||new s._82),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))},zt.prototype.updateFrame=function(t){switch(this.updateFrameVelocity(t),this.params.type){case"elastic":var e=t.delta*(this.params.fps||60),o=Math.pow(this.params.spring,e),i=Math.pow(this.params.damping,e);this.velocity.multiplyScalar(Math.exp(-this.params.damping*e)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(i).multiplyScalar(1-o)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(o),this.moment.add(this.springVelocity),this.moment.multiplyScalar(i),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment);break;default:this.value.copy(this.velocity)}},zt.prototype.copy=function(t){return B.prototype.copy.call(this,t),t.target&&this.setTarget(t.target),this.setParams(t.params),this},zt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.target&&(e.target=this.target.uuid),e.params=JSON.parse(JSON.stringify(this.params))),e},Vt.prototype=Object.create(b.prototype),Vt.prototype.constructor=Vt,Vt.prototype.nodeType="UVTransform",Vt.prototype.generate=function(t,e){return this.keywords.uvNode=this.uv,this.keywords.uvTransform=this.position,b.prototype.generate.call(this,t,e)},Vt.prototype.setUvTransform=function(t,e,o,i,r,n,s){n=void 0!==n?n:.5,s=void 0!==s?s:.5,this.position.value.setUvTransform(t,e,o,i,r,n,s)},Vt.prototype.copy=function(t){return b.prototype.copy.call(this,t),this.uv=t.uv,this.position=t.position,this},Vt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).uv=this.uv.toJSON(t).uuid,e.position=this.position.toJSON(t).uuid),e},Ft.prototype=Object.create(G.prototype),Ft.prototype.constructor=Ft,Ft.prototype.nodeType="MaxMIPLevel",Object.defineProperties(Ft.prototype,{value:{get:function(){if(0===this.maxMIPLevel){var t=this.texture.value.image;Array.isArray(t)&&(t=t[0]),this.maxMIPLevel=void 0!==t?Math.log(Math.max(t.width,t.height))*Math.LOG2E:0}return this.maxMIPLevel},set:function(){}}}),Ft.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).texture=this.texture.uuid),e},jt.Nodes={getSpecularMIPLevel:new x(["float getSpecularMIPLevel( const in float roughness, const in float maxMIPLevelScalar ) {","\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );","\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );","\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );","}"].join("\n"))},jt.prototype=Object.create(u.prototype),jt.prototype.constructor=jt,jt.prototype.nodeType="SpecularMIPLevel",jt.prototype.setTexture=function(t){return this.texture=t,this},jt.prototype.generate=function(t,e){if(t.isShader("fragment")){this.maxMIPLevel=this.maxMIPLevel||new Ft,this.maxMIPLevel.texture=this.texture;var o=t.include(jt.Nodes.getSpecularMIPLevel);return t.format(o+"( "+this.roughness.build(t,"f")+", "+this.maxMIPLevel.build(t,"f")+" )",this.type,e)}return console.warn("THREE.SpecularMIPLevelNode is not compatible with "+t.shader+" shader."),t.format("0.0",this.type,e)},jt.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.texture=t.texture,this.roughness=t.roughness,this},jt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).texture=this.texture,e.roughness=this.roughness),e},It.prototype=Object.create(u.prototype),It.prototype.constructor=It,It.prototype.nodeType="SubSlot",It.prototype.getType=function(t,e){return e},It.prototype.generate=function(t,e){return this.slots[t.slot]?this.slots[t.slot].build(t,e):t.format("0.0","f",e)},It.prototype.copy=function(t){for(var e in u.prototype.copy.call(this,t),t.slots)this.slots[e]=t.slots[e];return this},It.prototype.toJSON=function(t){var e=this.getJSONNode(t);if(!e)for(var o in(e=this.createJSONNode(t)).slots={},this.slots){var i=this.slots[o];i&&(e.slots[o]=i.toJSON(t).uuid)}return e},Bt.Nodes={blurX:new x(["vec4 blurX( sampler2D tex, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( tex, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;","\tsum += texture2D( tex, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( tex, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;","\treturn sum * .667;","}"].join("\n")),blurY:new x(["vec4 blurY( sampler2D tex, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( tex, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;","\tsum += texture2D( tex, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;","\treturn sum * .667;","}"].join("\n"))},Bt.prototype=Object.create(u.prototype),Bt.prototype.constructor=Bt,Bt.prototype.nodeType="Blur",Bt.prototype.hashProperties=["blurX","blurY"],Bt.prototype.updateFrame=function(){if(this.size)this.horizontal.value=this.radius.x/this.size.x,this.vertical.value=this.radius.y/this.size.y;else if(this.value.value&&this.value.value.image){var t=this.value.value.image;this.horizontal.value=this.radius.x/t.width,this.vertical.value=this.radius.y/t.height}},Bt.prototype.generate=function(t,e){if(t.isShader("fragment")){var o,i=[],r=t.include(Bt.Nodes.blurX),n=t.include(Bt.Nodes.blurY);return this.blurX&&i.push(r+"( "+this.value.build(t,"sampler2D")+", "+this.uv.build(t,"v2")+", "+this.horizontal.build(t,"f")+" )"),this.blurY&&i.push(n+"( "+this.value.build(t,"sampler2D")+", "+this.uv.build(t,"v2")+", "+this.vertical.build(t,"f")+" )"),o=2==i.length?"( "+i.join(" + ")+" / 2.0 )":i.length?"( "+i[0]+" )":"vec4( 0.0 )",t.format(o,this.getType(t),e)}return console.warn("THREE.BlurNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)},Bt.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.value=t.value,this.uv=t.uv,this.radius=t.radius,void 0!==t.size&&(this.size=new s._81(t.size.x,t.size.y)),this.blurX=t.blurX,this.blurY=t.blurY,this},Bt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).value=this.value.toJSON(t).uuid,e.uv=this.uv.toJSON(t).uuid,e.radius=this.radius.toJSON(t).uuid,this.size&&(e.size={x:this.size.x,y:this.size.y}),e.blurX=this.blurX,e.blurY=this.blurY),e},Ut.Nodes={LUMA:Et=new p("vec3 LUMA vec3( 0.2125, 0.7154, 0.0721 )"),luminance:new x(["float luminance( vec3 rgb ) {","\treturn dot( rgb, LUMA );","}"].join("\n"),[Et])},Ut.prototype=Object.create(u.prototype),Ut.prototype.constructor=Ut,Ut.prototype.nodeType="Luminance",Ut.prototype.generate=function(t,e){var o=t.include(Ut.Nodes.luminance);return t.format(o+"( "+this.rgb.build(t,"v3")+" )",this.getType(t),e)},Ut.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.rgb=t.rgb,this},Ut.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).rgb=this.rgb.toJSON(t).uuid),e},kt.Nodes={hue:new x(["vec3 hue(vec3 rgb, float adjustment) {","\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);","\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);","\tvec3 yiq = RGBtoYIQ * rgb;","\tfloat hue = atan(yiq.z, yiq.y) + adjustment;","\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);","\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));","}"].join("\n")),saturation:new x(["vec3 saturation(vec3 rgb, float adjustment) {","\tvec3 intensity = vec3( luminance( rgb ) );","\treturn mix( intensity, rgb, adjustment );","}"].join("\n"),[Ut.Nodes.luminance]),vibrance:new x(["vec3 vibrance(vec3 rgb, float adjustment) {","\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;","\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));","\tfloat amt = (mx - average) * (-3.0 * adjustment);","\treturn mix(rgb.rgb, vec3(mx), amt);","}"].join("\n"))},kt.SATURATION="saturation",kt.HUE="hue",kt.VIBRANCE="vibrance",kt.BRIGHTNESS="brightness",kt.CONTRAST="contrast",kt.prototype=Object.create(u.prototype),kt.prototype.constructor=kt,kt.prototype.nodeType="ColorAdjustment",kt.prototype.hashProperties=["method"],kt.prototype.generate=function(t,e){var o=this.rgb.build(t,"v3"),i=this.adjustment.build(t,"f");switch(this.method){case kt.BRIGHTNESS:return t.format("( "+o+" + "+i+" )",this.getType(t),e);case kt.CONTRAST:return t.format("( "+o+" * "+i+" )",this.getType(t),e)}var r=t.include(kt.Nodes[this.method]);return t.format(r+"( "+o+", "+i+" )",this.getType(t),e)},kt.prototype.copy=function(t){return u.prototype.copy.call(this,t),this.rgb=t.rgb,this.adjustment=t.adjustment,this.method=t.method,this},kt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).rgb=this.rgb.toJSON(t).uuid,e.adjustment=this.adjustment.toJSON(t).uuid,e.method=this.method),e},Gt.prototype=Object.create(a.prototype),Gt.prototype.constructor=Gt,Gt.prototype.nodeType="Basic",Gt.prototype.generate=function(t){var e;if(t.isShader("vertex")){var o=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED"," varying vec3 vNormal;","#endif"].join("\n"));var i=["#include <beginnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED"," vNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];o&&i.push(o.code,o.result?"transformed = "+o.result+";":""),i.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),e=i.join("\n")}else{this.color.analyze(t,{slot:"color"}),this.alpha&&this.alpha.analyze(t),this.mask&&this.mask.analyze(t);var r=this.color.flow(t,"c",{slot:"color"}),n=this.alpha?this.alpha.flow(t,"f"):void 0,s=this.mask?this.mask.flow(t,"b"):void 0;t.requires.transparent=void 0!==n,t.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED"," varying vec3 vNormal;","#endif"].join("\n"));i=["#include <normal_fragment_begin>",r.code];s&&i.push(s.code,"if ( ! "+s.result+" ) discard;"),n&&i.push(n.code,"#ifdef ALPHATEST"," if ( "+n.result+" <= ALPHATEST ) discard;","#endif"),n?i.push("gl_FragColor = vec4("+r.result+", "+n.result+" );"):i.push("gl_FragColor = vec4("+r.result+", 1.0 );"),e=i.join("\n")}return e},Gt.prototype.copy=function(t){return a.prototype.copy.call(this,t),this.color=t.color,t.position&&(this.position=t.position),t.alpha&&(this.alpha=t.alpha),t.mask&&(this.mask=t.mask),this},Gt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).color=this.color.toJSON(t).uuid,this.position&&(e.position=this.position.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.mask&&(e.mask=this.mask.toJSON(t).uuid)),e},Ht.prototype=Object.create(a.prototype),Ht.prototype.constructor=Ht,Ht.prototype.nodeType="Sprite",Ht.prototype.build=function(t){if(t.define("SPRITE"),t.requires.lights=!1,t.requires.transparent=void 0!==this.alpha,t.isShader("vertex")){var e=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform(s._79.merge([s._78.fog])),t.addParsCode(["#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n")),n=["#include <clipping_planes_fragment>","#include <begin_vertex>"],e&&n.push(e.code,e.result?"transformed = "+e.result+";":""),n.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||n.push("modelMtx[1][1] = 1.0;"),n.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&n.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),n.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>")}else{t.addParsCode(["#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>"].join("\n")),t.addCode(["#include <clipping_planes_fragment>","#include <logdepthbuf_fragment>"].join("\n")),this.mask&&this.mask.analyze(t),this.alpha&&this.alpha.analyze(t),this.color.analyze(t,{slot:"color"});var o=this.mask?this.mask.flow(t,"b"):void 0,i=this.alpha?this.alpha.flow(t,"f"):void 0,r=this.color.flow(t,"c",{slot:"color"}),n=[];o&&n.push(o.code,"if ( ! "+o.result+" ) discard;"),i?n.push(i.code,"#ifdef ALPHATEST","if ( "+i.result+" <= ALPHATEST ) discard;","#endif",r.code,"gl_FragColor = vec4( "+r.result+", "+i.result+" );"):n.push(r.code,"gl_FragColor = vec4( "+r.result+", 1.0 );"),n.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>")}return n.join("\n")},Ht.prototype.copy=function(t){return a.prototype.copy.call(this,t),t.position&&(this.position=t.position),this.color=t.color,void 0!==t.spherical&&(this.spherical=t.spherical),t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),this},Ht.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.position&&(e.position=this.position.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,!1===this.spherical&&(e.spherical=!1),this.mask&&(e.mask=this.mask.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid)),e},qt.prototype=Object.create(a.prototype),qt.prototype.constructor=qt,qt.prototype.nodeType="Phong",qt.prototype.build=function(t){var e;if(t.define("PHONG"),t.requires.lights=!0,t.isShader("vertex")){var o=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform(s._79.merge([s._78.fog,s._78.lights])),t.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];o&&i.push(o.code,o.result?"transformed = "+o.result+";":""),i.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),e=i.join("\n")}else{this.mask&&this.mask.analyze(t),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t),this.alpha&&this.alpha.analyze(t),this.normal&&this.normal.analyze(t),this.light&&this.light.analyze(t,{cache:"light"}),this.ao&&this.ao.analyze(t),this.ambient&&this.ambient.analyze(t),this.shadow&&this.shadow.analyze(t),this.emissive&&this.emissive.analyze(t,{slot:"emissive"}),this.environment&&this.environment.analyze(t,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.analyze(t);var r=this.mask?this.mask.flow(t,"b"):void 0,n=this.color.flow(t,"c",{slot:"color"}),a=this.specular.flow(t,"c"),u=this.shininess.flow(t,"f"),c=this.alpha?this.alpha.flow(t,"f"):void 0,h=this.normal?this.normal.flow(t,"v3"):void 0,p=this.light?this.light.flow(t,"v3",{cache:"light"}):void 0,l=this.ao?this.ao.flow(t,"f"):void 0,d=this.ambient?this.ambient.flow(t,"c"):void 0,v=this.shadow?this.shadow.flow(t,"c"):void 0,f=this.emissive?this.emissive.flow(t,"c",{slot:"emissive"}):void 0,y=this.environment?this.environment.flow(t,"c",{slot:"environment"}):void 0,m=this.environmentAlpha&&this.environment?this.environmentAlpha.flow(t,"f"):void 0;t.requires.transparent=void 0!==c,t.addParsCode(["#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n"));i=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;"];r&&i.push(r.code,"if ( ! "+r.result+" ) discard;"),i.push(n.code,"\tvec3 diffuseColor = "+n.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",a.code,"\tvec3 specular = "+a.result+";",u.code,"\tfloat shininess = max( 0.0001, "+u.result+" );","\tfloat specularStrength = 1.0;"),c&&i.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h&&i.push(h.code,"normal = "+h.result+";"),i.push("material.diffuseColor = "+(p?"vec3( 1.0 )":"diffuseColor")+";"),i.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),p&&(i.push(p.code,"reflectedLight.directDiffuse = "+p.result+";"),i.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),l&&i.push(l.code,"reflectedLight.indirectDiffuse *= "+l.result+";"),d&&i.push(d.code,"reflectedLight.indirectDiffuse += "+d.result+";"),v&&i.push(v.code,"reflectedLight.directDiffuse *= "+v.result+";","reflectedLight.directSpecular *= "+v.result+";"),f&&i.push(f.code,"reflectedLight.directDiffuse += "+f.result+";"),i.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),y&&(i.push(y.code),m?i.push(m.code,"outgoingLight = mix( outgoingLight, "+y.result+", "+m.result+" );"):i.push("outgoingLight = "+y.result+";")),c?i.push("gl_FragColor = vec4( outgoingLight, "+c.result+" );"):i.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),i.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>"),e=i.join("\n")}return e},qt.prototype.copy=function(t){return a.prototype.copy.call(this,t),t.position&&(this.position=t.position),this.color=t.color,this.specular=t.specular,this.shininess=t.shininess,t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),t.normal&&(this.normal=t.normal),t.light&&(this.light=t.light),t.shadow&&(this.shadow=t.shadow),t.ao&&(this.ao=t.ao),t.emissive&&(this.emissive=t.emissive),t.ambient&&(this.ambient=t.ambient),t.environment&&(this.environment=t.environment),t.environmentAlpha&&(this.environmentAlpha=t.environmentAlpha),this},qt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.position&&(e.position=this.position.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,e.specular=this.specular.toJSON(t).uuid,e.shininess=this.shininess.toJSON(t).uuid,this.mask&&(e.mask=this.mask.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.normal&&(e.normal=this.normal.toJSON(t).uuid),this.light&&(e.light=this.light.toJSON(t).uuid),this.ao&&(e.ao=this.ao.toJSON(t).uuid),this.ambient&&(e.ambient=this.ambient.toJSON(t).uuid),this.shadow&&(e.shadow=this.shadow.toJSON(t).uuid),this.emissive&&(e.emissive=this.emissive.toJSON(t).uuid),this.environment&&(e.environment=this.environment.toJSON(t).uuid),this.environmentAlpha&&(e.environmentAlpha=this.environmentAlpha.toJSON(t).uuid)),e},Xt.prototype=Object.create(a.prototype),Xt.prototype.constructor=Xt,Xt.prototype.nodeType="Standard",Xt.prototype.build=function(t){var e;t.define("STANDARD");var o=this.clearcoat||this.clearcoatRoughness||this.clearCoatNormal;if(o&&t.define("CLEARCOAT"),t.requires.lights=!0,t.extensions.derivatives=!0,t.extensions.shaderTextureLOD=!0,t.isShader("vertex")){var i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform(s._79.merge([s._78.fog,s._78.lights])),s._78.LTC_1&&(t.uniforms.ltc_1={value:void 0},t.uniforms.ltc_2={value:void 0}),t.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];i&&r.push(i.code,i.result?"transformed = "+i.result+";":""),r.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),e=r.join("\n")}else{var n=new b("material.specularRoughness","f"),a=new b("material.clearcoatRoughness","f"),u={roughness:n,bias:new jt(n),viewNormal:new b("normal","v3"),worldNormal:new b("inverseTransformDirection( geometry.normal, viewMatrix )","v3"),gamma:!0},c={gamma:!0},h={roughness:a,bias:new jt(a),viewNormal:new b("clearcoatNormal","v3"),worldNormal:new b("inverseTransformDirection( geometry.clearcoatNormal, viewMatrix )","v3"),gamma:!0};this.mask&&this.mask.analyze(t),this.color.analyze(t,{slot:"color",context:c}),this.roughness.analyze(t),this.metalness.analyze(t),this.alpha&&this.alpha.analyze(t),this.normal&&this.normal.analyze(t),this.clearcoat&&this.clearcoat.analyze(t),this.clearcoatRoughness&&this.clearcoatRoughness.analyze(t),this.clearcoatNormal&&this.clearcoatNormal.analyze(t),this.reflectivity&&this.reflectivity.analyze(t),this.light&&this.light.analyze(t,{cache:"light"}),this.ao&&this.ao.analyze(t),this.ambient&&this.ambient.analyze(t),this.shadow&&this.shadow.analyze(t),this.emissive&&this.emissive.analyze(t,{slot:"emissive"}),this.environment&&(this.environment.analyze(t,{cache:"radiance",context:u,slot:"radiance"}),t.requires.irradiance&&this.environment.analyze(t,{cache:"irradiance",context:u,slot:"irradiance"})),this.sheen&&this.sheen.analyze(t);var p,l=this.mask?this.mask.flow(t,"b"):void 0,d=this.color.flow(t,"c",{slot:"color",context:c}),v=this.roughness.flow(t,"f"),f=this.metalness.flow(t,"f"),y=this.alpha?this.alpha.flow(t,"f"):void 0,m=this.normal?this.normal.flow(t,"v3"):void 0,g=this.clearcoat?this.clearcoat.flow(t,"f"):void 0,N=(a=this.clearcoatRoughness?this.clearcoatRoughness.flow(t,"f"):void 0,this.clearcoatNormal?this.clearcoatNormal.flow(t,"v3"):void 0),x=this.reflectivity?this.reflectivity.flow(t,"f"):void 0,S=this.light?this.light.flow(t,"v3",{cache:"light"}):void 0,w=this.ao?this.ao.flow(t,"f"):void 0,T=this.ambient?this.ambient.flow(t,"c"):void 0,O=this.shadow?this.shadow.flow(t,"c"):void 0,_=this.emissive?this.emissive.flow(t,"c",{slot:"emissive"}):void 0;this.environment&&(p={radiance:this.environment.flow(t,"c",{cache:"radiance",context:u,slot:"radiance"})},t.requires.irradiance&&(p.irradiance=this.environment.flow(t,"c",{cache:"irradiance",context:u,slot:"irradiance"})));var L=o&&p?this.environment.flow(t,"c",{cache:"clearcoat",context:h,slot:"environment"}):void 0,R=this.sheen?this.sheen.flow(t,"c"):void 0;t.requires.transparent=void 0!==y,t.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n"));r=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\t#include <clearcoat_normal_fragment_begin>","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];l&&r.push(l.code,"if ( ! "+l.result+" ) discard;"),r.push(d.code,"\tvec3 diffuseColor = "+d.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",v.code,"\tfloat roughnessFactor = "+v.result+";",f.code,"\tfloat metalnessFactor = "+f.result+";"),y&&r.push(y.code,"#ifdef ALPHATEST","\tif ( "+y.result+" <= ALPHATEST ) discard;","#endif"),m&&r.push(m.code,"normal = "+m.result+";"),N&&r.push(N.code,"clearcoatNormal = "+N.result+";"),r.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),r.push("material.diffuseColor = "+(S?"vec3( 1.0 )":"diffuseColor * ( 1.0 - metalnessFactor )")+";","material.specularRoughness = max( roughnessFactor, 0.0525 );","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );"),g?r.push(g.code,"material.clearcoat = saturate( "+g.result+" );"):o&&r.push("material.clearcoat = 0.0;"),a?r.push(a.code,"material.clearcoatRoughness = max( "+a.result+", 0.0525 );","material.clearcoatRoughness += geometryRoughness;","material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );"):o&&r.push("material.clearcoatRoughness = 0.0;"),R&&r.push("material.sheenColor = "+R.result+";"),x?r.push(x.code,"material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( "+x.result+" ) ), diffuseColor, metalnessFactor );"):r.push("material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );"),r.push("#include <lights_fragment_begin>"),S&&(r.push(S.code,"reflectedLight.directDiffuse = "+S.result+";"),r.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),w&&r.push(w.code,"reflectedLight.indirectDiffuse *= "+w.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+w.result+", material.specularRoughness );"),T&&r.push(T.code,"reflectedLight.indirectDiffuse += "+T.result+";"),O&&r.push(O.code,"reflectedLight.directDiffuse *= "+O.result+";","reflectedLight.directSpecular *= "+O.result+";"),_&&r.push(_.code,"reflectedLight.directDiffuse += "+_.result+";"),p&&(r.push(p.radiance.code),t.requires.irradiance&&r.push(p.irradiance.code),L&&r.push(L.code,"clearcoatRadiance += "+L.result+";"),r.push("radiance += "+p.radiance.result+";"),t.requires.irradiance&&r.push("iblIrradiance += PI * "+p.irradiance.result+";")),r.push("#include <lights_fragment_end>"),r.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),y?r.push("gl_FragColor = vec4( outgoingLight, "+y.result+" );"):r.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),r.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>","#include <dithering_fragment>"),e=r.join("\n")}return e},Xt.prototype.copy=function(t){return a.prototype.copy.call(this,t),t.position&&(this.position=t.position),this.color=t.color,this.roughness=t.roughness,this.metalness=t.metalness,t.mask&&(this.mask=t.mask),t.alpha&&(this.alpha=t.alpha),t.normal&&(this.normal=t.normal),t.clearcoat&&(this.clearcoat=t.clearcoat),t.clearcoatRoughness&&(this.clearcoatRoughness=t.clearcoatRoughness),t.clearcoatNormal&&(this.clearcoatNormal=t.clearcoatNormal),t.reflectivity&&(this.reflectivity=t.reflectivity),t.light&&(this.light=t.light),t.shadow&&(this.shadow=t.shadow),t.ao&&(this.ao=t.ao),t.emissive&&(this.emissive=t.emissive),t.ambient&&(this.ambient=t.ambient),t.environment&&(this.environment=t.environment),t.sheen&&(this.sheen=t.sheen),this},Xt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.position&&(e.position=this.position.toJSON(t).uuid),e.color=this.color.toJSON(t).uuid,e.roughness=this.roughness.toJSON(t).uuid,e.metalness=this.metalness.toJSON(t).uuid,this.mask&&(e.mask=this.mask.toJSON(t).uuid),this.alpha&&(e.alpha=this.alpha.toJSON(t).uuid),this.normal&&(e.normal=this.normal.toJSON(t).uuid),this.clearcoat&&(e.clearcoat=this.clearcoat.toJSON(t).uuid),this.clearcoatRoughness&&(e.clearcoatRoughness=this.clearcoatRoughness.toJSON(t).uuid),this.clearcoatNormal&&(e.clearcoatNormal=this.clearcoatNormal.toJSON(t).uuid),this.reflectivity&&(e.reflectivity=this.reflectivity.toJSON(t).uuid),this.light&&(e.light=this.light.toJSON(t).uuid),this.shadow&&(e.shadow=this.shadow.toJSON(t).uuid),this.ao&&(e.ao=this.ao.toJSON(t).uuid),this.emissive&&(e.emissive=this.emissive.toJSON(t).uuid),this.ambient&&(e.ambient=this.ambient.toJSON(t).uuid),this.environment&&(e.environment=this.environment.toJSON(t).uuid),this.sheen&&(e.sheen=this.sheen.toJSON(t).uuid)),e},Wt.prototype=Object.create(Xt.prototype),Wt.prototype.constructor=Wt,Wt.prototype.nodeType="MeshStandard",Wt.prototype.build=function(t){var e=this.properties,o=this.inputs;if(t.isShader("fragment")){var i=t.findNode(e.color,o.color),r=t.resolve(e.map);this.color=r?new $(i,r,$.MUL):i;var n=t.findNode(e.roughness,o.roughness),s=t.resolve(e.roughnessMap);this.roughness=s?new $(n,new At(s,"g"),$.MUL):n;var a=t.findNode(e.metalness,o.metalness),u=t.resolve(e.metalnessMap);this.metalness=u?new $(a,new At(u,"b"),$.MUL):a,e.normalMap?(this.normal=new Rt(t.resolve(e.normalMap)),this.normal.scale=t.findNode(e.normalScale,o.normalScale)):this.normal=void 0,this.environment=t.resolve(e.envMap)}return Xt.prototype.build.call(this,t)},Wt.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),console.warn(".toJSON not implemented in",this)),e},Yt.prototype=Object.create(ft.prototype),Yt.prototype.constructor=Yt,V.addShortcuts(Yt.prototype,"fragment",["color","alpha","mask","position"]),Kt.prototype=Object.create(ft.prototype),Kt.prototype.constructor=Kt,V.addShortcuts(Kt.prototype,"fragment",["color","alpha","mask","position","spherical"]),$t.prototype=Object.create(ft.prototype),$t.prototype.constructor=$t,V.addShortcuts($t.prototype,"fragment",["color","alpha","specular","shininess","normal","emissive","ambient","light","shadow","ao","environment","environmentAlpha","mask","position"]),Zt.prototype=Object.create(ft.prototype),Zt.prototype.constructor=Zt,V.addShortcuts(Zt.prototype,"fragment",["color","alpha","roughness","metalness","reflectivity","clearcoat","clearcoatRoughness","clearcoatNormal","normal","emissive","ambient","light","shadow","ao","environment","mask","position","sheen"]),Qt.prototype=Object.create(ft.prototype),Qt.prototype.constructor=Qt,V.addShortcuts(Qt.prototype,"properties",["color","roughness","metalness","map","normalMap","normalScale","metalnessMap","roughnessMap","envMap"]),te.prototype={constructor:te,render:function(t,e,o){this.needsUpdate&&(this.material.dispose(),this.material.fragment.value=this.output,this.material.build(),this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=this.renderTarget.texture),this.needsUpdate=!1),o.setRenderer(this.renderer).setRenderTexture(this.renderTarget.texture),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(t,e),o.updateNode(this.material),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.camera)},setPixelRatio:function(t){this.renderer.setPixelRatio(t);var e=this.renderer.getSize(new s._81);this.setSize(e.width,e.height)},setSize:function(t,e){var o=this.renderer.getPixelRatio();this.renderTarget.setSize(t*o,e*o),this.renderer.setSize(t,e)},copy:function(t){return this.output=t.output,this},toJSON:function(t){if((void 0===t||"string"==typeof t)&&(t={nodes:{}}),t&&!t.post&&(t.post={}),!t.post[this.uuid]){var e={};e.uuid=this.uuid,e.type="NodePostProcessing",t.post[this.uuid]=e,""!==this.name&&(e.name=this.name),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),e.output=this.output.toJSON(t).uuid}return t.post=this.uuid,t}};var ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oe=function(t,e){this.manager=void 0!==t?t:s.z,this.nodes={},this.materials={},this.passes={},this.names={},this.library=e||{}};Object.assign(oe.prototype,{load:function(t,e,o,i){var r=this,n=new s.G(r.manager);return n.setPath(r.path),n.load(t,function(t){e(r.parse(JSON.parse(t)))},o,i),this},setPath:function(t){return this.path=t,this},getObjectByName:function(t){return this.names[t]},getObjectById:function(t){return this.library[t]||this.nodes[t]||this.materials[t]||this.passes[t]||this.names[t]},getNode:function(t){var e=this.getObjectById(t);return e||console.warn('Node "'+t+'" not found.'),e},resolve:function(t){switch(void 0===t?"undefined":ee(t)){case"boolean":case"number":return t;case"string":return/^\w{8}-\w{4}-\w{4}-\w{4}-\w{12}$/i.test(t)||this.library[t]?this.getNode(t):t;default:if(Array.isArray(t))for(var e=0;e<t.length;e++)t[e]=this.resolve(t[e]);else for(var o in t)"uuid"!==o&&(t[o]=this.resolve(t[o]))}return t},declare:function(t){var e,o,r;for(e in t.nodes)o=t.nodes[e],r=new i[o.nodeType+"Node"],o.name&&(r.name=o.name,this.names[r.name]=r),this.nodes[e]=r;for(e in t.materials)o=t.materials[e],r=new i[o.type],o.name&&(r.name=o.name,this.names[r.name]=r),this.materials[e]=r;for(e in t.passes)o=t.passes[e],r=new i[o.type],o.name&&(r.name=o.name,this.names[r.name]=r),this.passes[e]=r;return t.material&&(this.material=this.materials[t.material]),t.pass&&(this.pass=this.passes[t.pass]),t},parse:function(t){var e;for(e in(t=this.resolve(this.declare(t))).nodes)this.nodes[e].copy(t.nodes[e]);for(e in t.materials)this.materials[e].copy(t.materials[e]);for(e in t.passes)this.passes[e].copy(t.passes[e]);return this.material||this.pass||this}});var ie=o("WvuV"),re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ne={data:function(){return{container:null,renderer:null,scene:null,camera:null,clock:null,frame:null,teapot:null,mesh:null,cloud:null,controls:null,gui:null,param:{load:"caustic"}}},mounted:function(){this.container=document.getElementById("container"),this.clock=new this.$THREE.Clock,this.fov=50,this.frame=new F,window.addEventListener("load",this.init)},beforeDestroy:function(){this.gui.hide()},methods:{init:function(){this.renderer=new this.$THREE.WebGLRenderer({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.container.appendChild(this.renderer.domElement),this.scene=new this.$THREE.Scene,this.camera=new this.$THREE.PerspectiveCamera(this.fov,window.innerWidth/window.innerHeight,1,1e3),this.camera.position.x=50,this.camera.position.z=-50,this.camera.position.y=30,this.camera.target=new this.$THREE.Vector3,this.cloud=(new this.$THREE.TextureLoader).load("static/textures/lava/cloud.png"),this.cloud.wrapS=this.cloud.wrapT=this.$THREE.RepeatWrapping,this.controls=new n.a(this.camera,this.renderer.domElement),this.controls.minDistance=50,this.controls.maxDistance=200,this.scene.add(new this.$THREE.AmbientLight(4605510));var t=new this.$THREE.DirectionalLight(16768460,1);t.position.set(1,.75,.5),this.scene.add(t);var e=new this.$THREE.DirectionalLight(13421823,1);e.position.set(-1,.75,-.5),this.scene.add(e),this.teapot=new ie.a(15,18),this.mesh=new this.$THREE.Mesh(this.teapot),this.scene.add(this.mesh),window.addEventListener("resize",this.onWindowResize,!1),this.updateMaterial(),this.onWindowResize(),this.animate()},clearGui:function(){var t=this;this.gui&&this.gui.destroy(),this.gui=new r.a,this.gui.add(this.param,"load",{caustic:"caustic",displace:"displace",wave:"wave",xray:"xray"}).onFinishChange(function(){t.updateMaterial()}),this.gui.open()},addGui:function(t,e,o,i,r,n){var s=this;return this.param[t]=e,i?this.gui.addColor(this.param,t).onChange(function(){o(s.param[t])}):"object"==(void 0===e?"undefined":re(e))?this.gui.add(this.param,t,e).onChange(function(){o(s.param[t])}):this.gui.add(this.param,t,r,n).onChange(function(){o(s.param[t])})},updateMaterial:function(){var t=this;this.mesh.material&&this.mesh.material.dispose(),this.clearGui();var e="static/nodes/"+this.param.load+".json",o={cloud:this.cloud},i=new oe(void 0,o).load(e,function(){var e=i.getObjectByName("time");e&&(e.timeScale=!0,t.addGui("timeScale",e.scale,function(t){e.scale=t},!1,-2,2)),t.mesh.material=i.material})},onWindowResize:function(){this.$onWindowResize(this.camera,this.renderer)},animate:function(){var t=this.clock.getDelta();this.mesh.material instanceof ft&&this.frame.update(t).updateNode(this.mesh.material),this.renderer.render(this.scene,this.camera),requestAnimationFrame(this.animate)}}},se={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"webglLoaderNodes-container"},[e("div",{attrs:{id:"container"}}),this._v(" "),e("div",{attrs:{id:"info"}},[e("a",{attrs:{href:"https://threejs.org",target:"_blank",rel:"noopener"}},[this._v("three.js")]),this._v(" - Node-Based Material"),e("br"),this._v("\n\t\t\tSerialized using "),e("a",{attrs:{href:"webgl_materials_nodes.html"}},[this._v("webgl_materials_nodes.html")])])])}]};var ae=o("VU/8")(ne,se,!1,function(t){o("kp19")},"data-v-62076acc",null);e.default=ae.exports},WvuV:function(t,e,o){"use strict";o.d(e,"a",function(){return r});var i=o("6+nK"),r=function(t,e,o,r,n,s,a){var u=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],c=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];i.k.call(this),t=t||50,e=void 0!==e?Math.max(2,Math.floor(e)||10):10,o=void 0===o||o,r=void 0===r||r,n=void 0===n||n,s=void 0===s||s;var h=3.15*((a=void 0===a||a)?1:1.3)/2,p=t/h,l=o?(8*e-4)*e:0;l+=r?(16*e-4)*e:0,l+=n?40*e*e:0;var d=new Uint32Array(3*l),v=o?4:0;v+=r?8:0,v+=n?20:0,v*=(e+1)*(e+1);var f=new Float32Array(3*v),y=new Float32Array(3*v),m=new Float32Array(2*v),g=new i._14;g.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);var N,x,b,S,w,T,O,_,L,R,C,J,E,D,M,A,P=[],z=[],V=[],F=[],j=[],I=[],B=[],U=[],k=[],G=new i._82,H=0,q=0,X=new i._82,W=new i._14,Y=new i._14,K=new i._83,$=new i._83,Z=new i._83,Q=new i._83,tt=new i._82,et=new i._82,ot=g.clone();ot.transpose();var it=function(t,e,o){return!(f[3*t]===f[3*e]&&f[3*t+1]===f[3*e+1]&&f[3*t+2]===f[3*e+2]||f[3*t]===f[3*o]&&f[3*t+1]===f[3*o+1]&&f[3*t+2]===f[3*o+2]||f[3*e]===f[3*o]&&f[3*e+1]===f[3*o+1]&&f[3*e+2]===f[3*o+2])};for(N=0;N<3;N++)I[N]=new i._14;var rt=o?32:28;O=e+1;for(var nt=0,st=0,at=0,ut=0,ct=0,ht=n?0:20;ht<rt;ht++)if(r||ht<20||ht>=28){for(N=0;N<3;N++){for(x=0;x<4;x++)for(b=0;b<4;b++)P[4*b+x]=c[3*u[16*ht+4*x+b]+N],s&&ht>=20&&ht<28&&2!==N&&(P[4*b+x]*=1.077),a||2!==N||(P[4*b+x]*=1.3);W.set(P[0],P[1],P[2],P[3],P[4],P[5],P[6],P[7],P[8],P[9],P[10],P[11],P[12],P[13],P[14],P[15]),Y.multiplyMatrices(W,g),I[N].multiplyMatrices(ot,Y)}for(w=0;w<=e;w++)for(_=w/e,T=0;T<=e;T++){for(L=T/e,J=4,R=C=1;J--;)z[J]=R,V[J]=C,R*=_,C*=L,3===J?(F[J]=j[J]=0,H=q=1):(F[J]=H*(3-J),j[J]=q*(3-J),H*=_,q*=L);for(K.fromArray(z),$.fromArray(V),Z.fromArray(F),Q.fromArray(j),N=0;N<3;N++)(S=K.clone()).applyMatrix4(I[N]),B[N]=S.dot($),(S=Z.clone()).applyMatrix4(I[N]),U[N]=S.dot($),(S=K.clone()).applyMatrix4(I[N]),k[N]=S.dot(Q);tt.fromArray(U),et.fromArray(k),G.crossVectors(et,tt),G.normalize(),0===B[0]&&0===B[1]?X.set(0,B[2]>h?1:-1,0):X.set(G.x,G.z,-G.y),f[st++]=p*B[0],f[st++]=p*(B[2]-h),f[st++]=-p*B[1],y[at++]=X.x,y[at++]=X.y,y[at++]=X.z,m[ut++]=1-L,m[ut++]=1-_}for(w=0;w<e;w++)for(T=0;T<e;T++)A=(E=nt*O*O+w*O+T)+O,it(E,D=E+1,M=D+O)&&(d[ct++]=E,d[ct++]=D,d[ct++]=M),it(E,M,A)&&(d[ct++]=E,d[ct++]=M,d[ct++]=A);nt++}this.setIndex(new i.j(d,1)),this.setAttribute("position",new i.j(f,3)),this.setAttribute("normal",new i.j(y,3)),this.setAttribute("uv",new i.j(m,2)),this.computeBoundingSphere()};r.prototype=Object.create(i.k.prototype),r.prototype.constructor=r},kp19:function(t,e){}});
//# sourceMappingURL=16.eb9c17886e1683cc3f5f.js.map