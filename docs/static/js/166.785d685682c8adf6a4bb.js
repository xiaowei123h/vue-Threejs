webpackJsonp([166],{wYRC:function(e,t){},wv39:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("wIBv"),i=r("6+nK"),n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],a=!0,i=!1,n=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){i=!0,n=e}finally{try{!a&&s.return&&s.return()}finally{if(i)throw n}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(e){i.Loader.call(this,e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[]};o.taskCache=new WeakMap,o.prototype=Object.assign(Object.create(i.Loader.prototype),{constructor:o,setLibraryPath:function(e){return this.libraryPath=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},load:function(e,t,r,a){var n=this,s=new i.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.load(e,function(r){if(o.taskCache.has(r))return o.taskCache.get(r).promise.then(t).catch(a);n.decodeObjects(r,e).then(t).catch(a)},r,a)},debug:function(){console.log("Task load: ",this.workerPool.map(function(e){return e._taskLoad}))},decodeObjects:function(e,t){var r,a,i=this,n=e.byteLength,s=this._getWorker(n).then(function(t){return r=t,a=i.workerNextTaskID++,new Promise(function(t,i){r._callbacks[a]={resolve:t,reject:i},r.postMessage({type:"decode",id:a,buffer:e},[e])})}).then(function(e){return i._createGeometry(e.data)});return s.catch(function(){return!0}).then(function(){r&&a&&i._releaseTask(r,a)}),o.taskCache.set(e,{url:t,promise:s}),s},parse:function(e,t,r){this.decodeObjects(e,"").then(t).catch(r)},_compareMaterials:function(e){var t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;for(var r=0;r<this.materials.length;r++){var a=this.materials[r],i={};if(i.name=a.name,i.color={},i.color.r=a.color.r,i.color.g=a.color.g,i.color.b=a.color.b,i.type=a.type,JSON.stringify(t)===JSON.stringify(i))return a}return this.materials.push(e),e},_createMaterial:function(e){if(void 0===e)return new i.MeshStandardMaterial({color:new i.Color(1,1,1),metalness:.8,name:"default",side:2});var t=e.diffuseColor,r=new i.Color(t.r/255,t.g/255,t.b/255);0===t.r&&0===t.g&&0===t.b&&(r.r=1,r.g=1,r.b=1);for(var a=new i.MeshStandardMaterial({color:r,name:e.name,side:2,transparent:e.transparency>0,opacity:1-e.transparency}),n=new i.TextureLoader,o=0;o<e.textures.length;o++){var s=e.textures[o];if(null!==s.image){var c=n.load(s.image);switch(s.type){case"Diffuse":a.map=c;break;case"Bump":a.bumpMap=c;break;case"Transparency":a.alphaMap=c,a.transparent=!0;break;case"Emap":a.envMap=c}}}return a},_createGeometry:function(e){var t=new i.Object3D,r=[],a=[],n=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings;for(var o=e.objects,s=e.materials,c=0;c<o.length;c++){var l=o[c],u=l.attributes;switch(l.objectType){case"InstanceDefinition":a.push(l);break;case"InstanceReference":n.push(l);break;default:if(u.hasOwnProperty("materialUUID")){var h=s.find(function(e){return e.id===u.materialUUID}),d=this._createMaterial(h);d=this._compareMaterials(d);var p=this._createObject(l,d)}else p=this._createObject(l,null);if(void 0===p)continue;var f=e.layers[u.layerIndex];p.visible=!f||e.layers[u.layerIndex].visible,u.isInstanceDefinitionObject?r.push(p):t.add(p)}}for(c=0;c<a.length;c++){for(var y=a[c],g=(o=[],0);g<y.attributes.objectIds.length;g++)for(var b=y.attributes.objectIds[g],m=0;m<r.length;m++){b===r[m].userData.attributes.id&&o.push(r[m])}for(g=0;g<n.length;g++){var v=n[g];if(v.geometry.parentIdefId===y.attributes.id){var w=new i.Object3D,T=v.geometry.xform.array,x=new i.Matrix4;x.set(T[0],T[1],T[2],T[3],T[4],T[5],T[6],T[7],T[8],T[9],T[10],T[11],T[12],T[13],T[14],T[15]),w.applyMatrix4(x);for(m=0;m<o.length;m++)w.add(o[m].clone(!0));t.add(w)}}}return this.materials=[],t},_createObject:function(e,t){var r=new i.BufferGeometryLoader,a=e.attributes;switch(e.objectType){case"Point":case"PointSet":var n=r.parse(e.geometry),o=a.drawColor,s=new i.Color(o.r/255,o.g/255,o.b/255),c=new i.PointsMaterial({color:s,sizeAttenuation:!1,size:2});n.attributes.hasOwnProperty("color")&&(c.vertexColors=!0),c=this._compareMaterials(c);var l=new i.Points(n,c);return l.userData.attributes=a,l.userData.objectType=e.objectType,l;case"Mesh":case"Extrusion":case"SubD":return(n=r.parse(e.geometry)).attributes.hasOwnProperty("color")&&(t.vertexColors=!0),null===t&&(t=this._createMaterial(),t=this._compareMaterials(t)),(d=new i.Mesh(n,t)).castShadow=a.castsShadows,d.receiveShadow=a.receivesShadows,d.userData.attributes=a,d.userData.objectType=e.objectType,d;case"Brep":for(var u=new i.Object3D,h=0;h<e.geometry.length;h++){var d;n=r.parse(e.geometry[h]),(d=new i.Mesh(n,t)).castShadow=a.castsShadows,d.receiveShadow=a.receivesShadows,u.add(d)}return u.userData.attributes=a,u.userData.objectType=e.objectType,u;case"Curve":n=r.parse(e.geometry);o=a.drawColor,s=new i.Color(o.r/255,o.g/255,o.b/255),c=new i.LineBasicMaterial({color:s});c=this._compareMaterials(c);var p=new i.Line(n,c);return p.userData.attributes=a,p.userData.objectType=e.objectType,p;case"TextDot":n=e.geometry;var f=document.createElement("canvas").getContext("2d"),y=n.fontHeight+"px "+n.fontFace;f.font=y;var g=f.measureText(n.text).width+10,b=n.fontHeight+10,m=window.devicePixelRatio;f.canvas.width=g*m,f.canvas.height=b*m,f.canvas.style.width=g+"px",f.canvas.style.height=b+"px",f.setTransform(m,0,0,m,0,0),f.font=y,f.textBaseline="middle",f.textAlign="center";s=a.drawColor;f.fillStyle="rgba("+s.r+","+s.g+","+s.b+","+s.a+")",f.fillRect(0,0,g,b),f.fillStyle="white",f.fillText(n.text,g/2,b/2);var v=new i.CanvasTexture(f.canvas);v.minFilter=i.LinearFilter,v.wrapS=i.ClampToEdgeWrapping,v.wrapT=i.ClampToEdgeWrapping;c=new i.SpriteMaterial({map:v,depthTest:!1});var w=new i.Sprite(c);return w.position.set(n.point[0],n.point[1],n.point[2]),w.scale.set(g/10,b/10,1),w.userData.attributes=a,w.userData.objectType=e.objectType,w;case"Light":var T;if((n=e.geometry).isDirectionalLight)(T=new i.DirectionalLight).castShadow=a.castsShadows,T.position.set(n.location[0],n.location[1],n.location[2]),T.target.position.set(n.direction[0],n.direction[1],n.direction[2]),T.shadow.normalBias=.1;else if(n.isPointLight)(T=new i.PointLight).castShadow=a.castsShadows,T.position.set(n.location[0],n.location[1],n.location[2]),T.shadow.normalBias=.1;else if(n.isRectangularLight){T=new i.RectAreaLight;g=Math.abs(n.width[2]),b=Math.abs(n.length[0]);T.position.set(n.location[0]-b/2,n.location[1],n.location[2]-g/2),T.height=b,T.width=g,T.lookAt(new i.Vector3(n.direction[0],n.direction[1],n.direction[2]))}else if(n.isSpotLight)(T=new i.SpotLight).castShadow=a.castsShadows,T.position.set(n.location[0],n.location[1],n.location[2]),T.target.position.set(n.direction[0],n.direction[1],n.direction[2]),T.angle=n.spotAngleRadians,T.shadow.normalBias=.1;else if(n.isLinearLight)return void console.warn("THREE.3DMLoader:  No conversion exists for linear lights.");if(T){T.intensity=n.intensity;o=n.diffuse,s=new i.Color(o.r/255,o.g/255,o.b/255);T.color=s,T.userData.attributes=a,T.userData.objectType=e.objectType}return T}},_initLibrary:function(){var e=this;if(!this.libraryPending){var t=new i.FileLoader(this.manager);t.setPath(this.libraryPath);var r=new Promise(function(e,r){t.load("rhino3dm.js",e,void 0,r)}),a=new i.FileLoader(this.manager);a.setPath(this.libraryPath),a.setResponseType("arraybuffer");var s=new Promise(function(e,t){a.load("rhino3dm.wasm",e,void 0,t)});this.libraryPending=Promise.all([r,s]).then(function(t){var r=n(t,2),a=r[0],i=r[1];e.libraryConfig.wasmBinary=i;var s=o.Rhino3dmWorker.toString(),c=["/* rhino3dm.js */",a,"/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([c]))})}return this.libraryPending},_getWorker:function(e){var t=this;return this._initLibrary().then(function(){var r;t.workerPool.length<t.workerLimit?((r=new Worker(t.workerSourceURL))._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",libraryConfig:t.libraryConfig}),r.onmessage=function(e){var t=e.data;switch(t.type){case"decode":r._callbacks[t.id].resolve(t);break;case"error":r._callbacks[t.id].reject(t);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+t.type+'"')}},t.workerPool.push(r)):t.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});return(r=t.workerPool[t.workerPool.length-1])._taskLoad+=e,r})},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),o.Rhino3dmWorker=function(){var e,t;function r(e,r){var i=e.geometry(),n=e.attributes(),o=i.objectType,s=null,c=null;switch(o){case t.ObjectType.Curve:var l=function e(r,a){var i=a;var n=[];var o=[];if(r instanceof t.LineCurve)return[r.pointAtStart,r.pointAtEnd];if(r instanceof t.PolylineCurve){i=r.pointCount;for(var s=0;s<i;s++)n.push(r.point(s));return n}if(r instanceof t.PolyCurve){for(var c=r.segmentCount,s=0;s<c;s++){var l=r.segmentCurve(s),u=e(l,i);n=n.concat(u),l.delete()}return n}r instanceof t.ArcCurve&&(i=(i=Math.floor(r.angleDegrees/5))<1?2:i);if(r instanceof t.NurbsCurve&&1===r.degree&&(void 0===r.segmentCount||1===r.segmentCount))return[r.pointAtStart,r.pointAtEnd];var h=r.domain;var d=i-1;for(var p=0;p<i;p++){var f=h[0]+p/d*(h[1]-h[0]);if(f!==h[0]&&f!==h[1]){var y,g=r.tangentAt(f),b=r.tangentAt(o.slice(-1)[0]),m=g[0]*g[0]+g[1]*g[1]+g[2]*g[2],v=b[0]*b[0]+b[1]*b[1]+b[2]*b[2],w=Math.sqrt(m*v);if(0===w)y=Math.PI/2;else{var T=(g.x*b.x+g.y*b.y+g.z*b.z)/w;y=Math.acos(Math.max(-1,Math.min(1,T)))}y<.1||o.push(f)}else o.push(f)}n=o.map(function(e){return r.pointAt(e)});return n}(i,100),c={},u={};(d={}).itemSize=3,d.type="Float32Array",d.array=[];for(var h=0;h<l.length;h++)d.array.push(l[h][0]),d.array.push(l[h][1]),d.array.push(l[h][2]);c.position=d,u.attributes=c,s={data:u};break;case t.ObjectType.Point:var d,p=i.location,f={};c={},u={};(d={}).itemSize=3,d.type="Float32Array",d.array=[p[0],p[1],p[2]];var y=n.drawColor(r);f.itemSize=3,f.type="Float32Array",f.array=[y.r/255,y.g/255,y.b/255],c.position=d,c.color=f,u.attributes=c,s={data:u};break;case t.ObjectType.PointSet:case t.ObjectType.Mesh:s=i.toThreejsJSON();break;case t.ObjectType.Brep:var g=i.faces();s=[];for(var b=0;b<g.count;b++){var m=g.get(b);(v=m.getMesh(t.MeshType.Any))&&(s.push(v.toThreejsJSON()),v.delete()),m.delete()}g.delete();break;case t.ObjectType.Extrusion:(v=i.getMesh(t.MeshType.Any))&&(s=v.toThreejsJSON(),v.delete());break;case t.ObjectType.TextDot:case t.ObjectType.Light:s=a(i);break;case t.ObjectType.InstanceReference:(s=a(i)).xform=a(i.xform),s.xform.array=i.xform.toFloatArray(!0);break;case t.ObjectType.SubD:var v;i.subdivide(3),(v=t.Mesh.createFromSubDControlNet(i))&&(s=v.toThreejsJSON(),v.delete());break;default:console.warn("THREE.3DMLoader: TODO: Implement "+o.constructor.name)}if(s)return(c=a(n)).geometry=a(i),n.groupCount>0&&(c.groupIds=n.getGroupList()),n.userStringCount>0&&(c.userStrings=n.getUserStrings()),c.drawColor=n.drawColor(r),o=(o=o.constructor.name).substring(11,o.length),c.geometry.objectType=o,{geometry:s,attributes:c,objectType:o}}function a(e){var t={};for(var r in e)"function"!=typeof e[r]&&(t[r]=e[r]);return t}onmessage=function(i){var n=i.data;switch(n.type){case"init":var o,s=n.libraryConfig.wasmBinary;e=new Promise(function(e){o={wasmBinary:s,onRuntimeInitialized:e},rhino3dm(o)}).then(function(){t=o});break;case"decode":var c=n.buffer;e.then(function(){var e=function(e,t){for(var i=new Uint8Array(t),n=e.File3dm.fromByteArray(i),o=[],s=[],c=[],l=[],u=[],h=[],d=0;d<n.objects().count;d++){var p=n.objects().get(d),f=r(p,n);if(void 0!==f){if(f.attributes.materialIndex>=0){var y=n.materials().findIndex(f.attributes.materialIndex).id;f.attributes.materialUUID=y}o.push(f)}p.delete()}for(var d=0;d<n.instanceDefinitions().count();d++){var g=n.instanceDefinitions().get(d),b=a(g);b.objectIds=g.getObjectIds(),o.push({geometry:null,attributes:b,objectType:"InstanceDefinition"})}for(var m=[e.TextureType.Diffuse,e.TextureType.Bump,e.TextureType.Transparency,e.TextureType.Opacity,e.TextureType.Emap],v=[e.TextureType.PBR_BaseColor,e.TextureType.PBR_Subsurface,e.TextureType.PBR_SubsurfaceScattering,e.TextureType.PBR_SubsurfaceScatteringRadius,e.TextureType.PBR_Metallic,e.TextureType.PBR_Specular,e.TextureType.PBR_SpecularTint,e.TextureType.PBR_Roughness,e.TextureType.PBR_Anisotropic,e.TextureType.PBR_Anisotropic_Rotation,e.TextureType.PBR_Sheen,e.TextureType.PBR_SheenTint,e.TextureType.PBR_Clearcoat,e.TextureType.PBR_ClearcoatBump,e.TextureType.PBR_ClearcoatRoughness,e.TextureType.PBR_OpacityIor,e.TextureType.PBR_OpacityRoughness,e.TextureType.PBR_Emission,e.TextureType.PBR_AmbientOcclusion,e.TextureType.PBR_Displacement],d=0;d<n.materials().count();d++){for(var w=n.materials().get(d),T=w.physicallyBased(),x=a(w),k=[],P=0;P<m.length;P++){var j=w.getTexture(m[P]);if(j){var _=m[P].constructor.name,R={type:_=_.substring(12,_.length)},S=n.getEmbeddedFileAsBase64(j.fileName);S?R.image="data:image/png;base64,"+S:(console.warn("THREE.3DMLoader: Image for "+_+" texture not embedded in file."),R.image=null),k.push(R),j.delete()}}if(x.textures=k,T.supported){console.log("pbr true");for(var P=0;P<v.length;P++){var j=w.getTexture(m[P]);if(j){var S=n.getEmbeddedFileAsBase64(j.fileName),_=m[P].constructor.name,R={type:_=_.substring(12,_.length),image:"data:image/png;base64,"+S};k.push(R),j.delete()}}var C=a(w.physicallyBased());x=Object.assign(C,x)}s.push(x),w.delete(),T.delete()}for(var d=0;d<n.layers().count();d++){var L=n.layers().get(d),D=a(L);c.push(D),L.delete()}for(var d=0;d<n.views().count();d++){var M=n.views().get(d),O=a(M);l.push(O),M.delete()}for(var d=0;d<n.namedViews().count();d++){var B=n.namedViews().get(d),E=a(B);u.push(E),B.delete()}for(var d=0;d<n.groups().count();d++){var I=n.groups().get(d),A=a(I);h.push(A),I.delete()}var U=a(n.settings());return n.delete(),{objects:o,materials:s,layers:c,views:l,namedViews:u,groups:h,settings:U}}(t,c);self.postMessage({type:"decode",id:n.id,data:e})})}}};var s=r("QEtz"),c={data:function(){return{container:null,controls:null,camera:null,scene:null,renderer:null,gui:null}},mounted:function(){this.init(),this.animate()},beforeDestroy:function(){this.gui.destroy()},methods:{init:function(){var e=this;this.$THREE.Object3D.DefaultUp=new this.$THREE.Vector3(0,0,1),this.container=document.createElement("div"),document.getElementsByClassName("webglLoader3dm-container")[0].appendChild(this.container),this.camera=new this.$THREE.PerspectiveCamera(60,this.$webglInnerWidth/window.innerHeight,1,1e3),this.camera.position.set(26,-40,5),this.scene=new this.$THREE.Scene;var t=new this.$THREE.DirectionalLight(16777215);t.position.set(0,0,2),t.castShadow=!0,t.intensity=2,this.scene.add(t);var r=new o;r.setLibraryPath("static/jsm/libs/rhino3dm/"),r.load("static/models/3dm/Rhino_Logo.3dm",function(t){e.scene.add(t),e.initGUI(t.userData.layers)});var i=this.$webglInnerWidth,n=window.innerHeight;this.renderer=new this.$THREE.WebGLRenderer({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(i,n),this.container.appendChild(this.renderer.domElement),this.controls=new a.b(this.camera,this.container),window.addEventListener("resize",this.resize,!1)},resize:function(){this.$onWindowResize(this.camera,this.renderer)},animate:function(){this.controls.update(),this.renderer.render(this.scene,this.camera),requestAnimationFrame(this.animate)},initGUI:function(e){var t=this;this.gui=new s.a({width:300});var r=this.gui.addFolder("layers");r.open();for(var a=0;a<e.length;a++){var i=e[a];r.add(i,"visible").name(i.name).onChange(function(r){var a=this.object.name;t.scene.traverse(function(t){t.userData.hasOwnProperty("attributes")&&("layerIndex"in t.userData.attributes&&e[t.userData.attributes.layerIndex].name===a&&(t.visible=r,i.visible=r))})})}}}},l={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"webglLoader3dm-container"},[t("div",{attrs:{id:"info"}},[t("a",{attrs:{href:"https://threejs.org",target:"_blank",rel:"noopener"}},[this._v("three.js")]),this._v(" - Rhino 3DM loader\n\t\t")])])}]};var u=r("VU/8")(c,l,!1,function(e){r("wYRC")},"data-v-6d2a14a4",null);t.default=u.exports}});
//# sourceMappingURL=166.785d685682c8adf6a4bb.js.map