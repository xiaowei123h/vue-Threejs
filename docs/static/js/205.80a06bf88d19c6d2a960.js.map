{"version":3,"sources":["webpack:///./src/components/jsm/modifiers/SimplifyModifier.js","webpack:///src/views/modifier/webglModifierSimplifier.vue","webpack:///./src/views/modifier/webglModifierSimplifier.vue?b0dd","webpack:///./src/views/modifier/webglModifierSimplifier.vue"],"names":["SimplifyModifier","cb","Vector3","ab","removeFromArray","array","object","k","indexOf","splice","computeEdgeCollapseCost","u","v","i","face","sideFace","edgelength","position","distanceTo","curvature","sideFaces","il","faces","length","hasVertex","push","minCurvature","j","dotProd","normal","dot","Math","min","max","computeEdgeCostAtVertex","neighbors","collapseNeighbor","collapseCost","minCost","totalCost","costCount","removeVertex","vertices","console","assert","pop","removeFace","f","v1","v2","v3","vs","removeIfNonNeighbor","collapse","tmpVertices","replaceVertex","minimumCostEdge","least","Triangle","a","b","c","this","computeNormal","addUniqueNeighbor","Vertex","id","prototype","vA","vB","vC","subVectors","cross","normalize","copy","oldv","newv","vertex","n","offset","modify","geometry","count","isBufferGeometry","Geometry","fromBufferGeometry","mergeVertices","nextVertex","oldVertices","oldFaces","triangle","z","log","simplifiedGeometry","BufferGeometry","index","x","y","setAttribute","Float32BufferAttribute","setIndex","webglModifierSimplifier","data","renderer","scene","camera","mounted","init","methods","_this","info","document","createElement","style","top","width","textAlign","innerHTML","getElementsByClassName","appendChild","$THREE","WebGLRenderer","antialias","setPixelRatio","window","devicePixelRatio","setSize","$webglInnerWidth","innerHeight","domElement","Scene","PerspectiveCamera","controls","OrbitControls","addEventListener","render","enablePan","enableZoom","add","AmbientLight","light","PointLight","GLTFLoader","load","gltf","mesh","children","rotation","PI","modifier","simplified","clone","material","flatShading","floor","attributes","onWindowResize","$onWindowResize","modifier_webglModifierSimplifier","_h","$createElement","_self","_c","staticClass","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/205.80a06bf88d19c6d2a960.js","sourcesContent":["import {\r\n\tBufferGeometry,\r\n\tFloat32BufferAttribute,\r\n\tGeometry,\r\n\tVector3\r\n} from \"@/components/build/three.module.js\";\r\n\r\n/**\r\n *\tSimplification Geometry Modifier\r\n *    - based on code and technique\r\n *\t  - by Stan Melax in 1998\r\n *\t  - Progressive Mesh type Polygon Reduction Algorithm\r\n *    - http://www.melax.com/polychop/\r\n */\r\n\r\nvar SimplifyModifier = function () {};\r\n\r\n( function () {\r\n\r\n\tvar cb = new Vector3(), ab = new Vector3();\r\n\r\n\tfunction pushIfUnique( array, object ) {\r\n\r\n\t\tif ( array.indexOf( object ) === - 1 ) array.push( object );\r\n\r\n\t}\r\n\r\n\tfunction removeFromArray( array, object ) {\r\n\r\n\t\tvar k = array.indexOf( object );\r\n\t\tif ( k > - 1 ) array.splice( k, 1 );\r\n\r\n\t}\r\n\r\n\tfunction computeEdgeCollapseCost( u, v ) {\r\n\r\n\t\t// if we collapse edge uv by moving u to v then how\r\n\t\t// much different will the model change, i.e. the \"error\".\r\n\r\n\t\tvar edgelength = v.position.distanceTo( u.position );\r\n\t\tvar curvature = 0;\r\n\r\n\t\tvar sideFaces = [];\r\n\t\tvar i, il = u.faces.length, face, sideFace;\r\n\r\n\t\t// find the \"sides\" triangles that are on the edge uv\r\n\t\tfor ( i = 0; i < il; i ++ ) {\r\n\r\n\t\t\tface = u.faces[ i ];\r\n\r\n\t\t\tif ( face.hasVertex( v ) ) {\r\n\r\n\t\t\t\tsideFaces.push( face );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// use the triangle facing most away from the sides\r\n\t\t// to determine our curvature term\r\n\t\tfor ( i = 0; i < il; i ++ ) {\r\n\r\n\t\t\tvar minCurvature = 1;\r\n\t\t\tface = u.faces[ i ];\r\n\r\n\t\t\tfor ( var j = 0; j < sideFaces.length; j ++ ) {\r\n\r\n\t\t\t\tsideFace = sideFaces[ j ];\r\n\t\t\t\t// use dot product of face normals.\r\n\t\t\t\tvar dotProd = face.normal.dot( sideFace.normal );\r\n\t\t\t\tminCurvature = Math.min( minCurvature, ( 1.001 - dotProd ) / 2 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurvature = Math.max( curvature, minCurvature );\r\n\r\n\t\t}\r\n\r\n\t\t// crude approach in attempt to preserve borders\r\n\t\t// though it seems not to be totally correct\r\n\t\tvar borders = 0;\r\n\t\tif ( sideFaces.length < 2 ) {\r\n\r\n\t\t\t// we add some arbitrary cost for borders,\r\n\t\t\t// borders += 10;\r\n\t\t\tcurvature = 1;\r\n\r\n\t\t}\r\n\r\n\t\tvar amt = edgelength * curvature + borders;\r\n\r\n\t\treturn amt;\r\n\r\n\t}\r\n\r\n\tfunction computeEdgeCostAtVertex( v ) {\r\n\r\n\t\t// compute the edge collapse cost for all edges that start\r\n\t\t// from vertex v.  Since we are only interested in reducing\r\n\t\t// the object by selecting the min cost edge at each step, we\r\n\t\t// only cache the cost of the least cost edge at this vertex\r\n\t\t// (in member variable collapse) as well as the value of the\r\n\t\t// cost (in member variable collapseCost).\r\n\r\n\t\tif ( v.neighbors.length === 0 ) {\r\n\r\n\t\t\t// collapse if no neighbors.\r\n\t\t\tv.collapseNeighbor = null;\r\n\t\t\tv.collapseCost = - 0.01;\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tv.collapseCost = 100000;\r\n\t\tv.collapseNeighbor = null;\r\n\r\n\t\t// search all neighboring edges for \"least cost\" edge\r\n\t\tfor ( var i = 0; i < v.neighbors.length; i ++ ) {\r\n\r\n\t\t\tvar collapseCost = computeEdgeCollapseCost( v, v.neighbors[ i ] );\r\n\r\n\t\t\tif ( ! v.collapseNeighbor ) {\r\n\r\n\t\t\t\tv.collapseNeighbor = v.neighbors[ i ];\r\n\t\t\t\tv.collapseCost = collapseCost;\r\n\t\t\t\tv.minCost = collapseCost;\r\n\t\t\t\tv.totalCost = 0;\r\n\t\t\t\tv.costCount = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tv.costCount ++;\r\n\t\t\tv.totalCost += collapseCost;\r\n\r\n\t\t\tif ( collapseCost < v.minCost ) {\r\n\r\n\t\t\t\tv.collapseNeighbor = v.neighbors[ i ];\r\n\t\t\t\tv.minCost = collapseCost;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// we average the cost of collapsing at this vertex\r\n\t\tv.collapseCost = v.totalCost / v.costCount;\r\n\t\t// v.collapseCost = v.minCost;\r\n\r\n\t}\r\n\r\n\tfunction removeVertex( v, vertices ) {\r\n\r\n\t\tconsole.assert( v.faces.length === 0 );\r\n\r\n\t\twhile ( v.neighbors.length ) {\r\n\r\n\t\t\tvar n = v.neighbors.pop();\r\n\t\t\tremoveFromArray( n.neighbors, v );\r\n\r\n\t\t}\r\n\r\n\t\tremoveFromArray( vertices, v );\r\n\r\n\t}\r\n\r\n\tfunction removeFace( f, faces ) {\r\n\r\n\t\tremoveFromArray( faces, f );\r\n\r\n\t\tif ( f.v1 ) removeFromArray( f.v1.faces, f );\r\n\t\tif ( f.v2 ) removeFromArray( f.v2.faces, f );\r\n\t\tif ( f.v3 ) removeFromArray( f.v3.faces, f );\r\n\r\n\t\t// TODO optimize this!\r\n\t\tvar vs = [ f.v1, f.v2, f.v3 ];\r\n\t\tvar v1, v2;\r\n\r\n\t\tfor ( var i = 0; i < 3; i ++ ) {\r\n\r\n\t\t\tv1 = vs[ i ];\r\n\t\t\tv2 = vs[ ( i + 1 ) % 3 ];\r\n\r\n\t\t\tif ( ! v1 || ! v2 ) continue;\r\n\r\n\t\t\tv1.removeIfNonNeighbor( v2 );\r\n\t\t\tv2.removeIfNonNeighbor( v1 );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction collapse( vertices, faces, u, v ) { // u and v are pointers to vertices of an edge\r\n\r\n\t\t// Collapse the edge uv by moving vertex u onto v\r\n\r\n\t\tif ( ! v ) {\r\n\r\n\t\t\t// u is a vertex all by itself so just delete it..\r\n\t\t\tremoveVertex( u, vertices );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar i;\r\n\t\tvar tmpVertices = [];\r\n\r\n\t\tfor ( i = 0; i < u.neighbors.length; i ++ ) {\r\n\r\n\t\t\ttmpVertices.push( u.neighbors[ i ] );\r\n\r\n\t\t}\r\n\r\n\r\n\t\t// delete triangles on edge uv:\r\n\t\tfor ( i = u.faces.length - 1; i >= 0; i -- ) {\r\n\r\n\t\t\tif ( u.faces[ i ].hasVertex( v ) ) {\r\n\r\n\t\t\t\tremoveFace( u.faces[ i ], faces );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// update remaining triangles to have v instead of u\r\n\t\tfor ( i = u.faces.length - 1; i >= 0; i -- ) {\r\n\r\n\t\t\tu.faces[ i ].replaceVertex( u, v );\r\n\r\n\t\t}\r\n\r\n\r\n\t\tremoveVertex( u, vertices );\r\n\r\n\t\t// recompute the edge collapse costs in neighborhood\r\n\t\tfor ( i = 0; i < tmpVertices.length; i ++ ) {\r\n\r\n\t\t\tcomputeEdgeCostAtVertex( tmpVertices[ i ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\r\n\tfunction minimumCostEdge( vertices ) {\r\n\r\n\t\t// O(n * n) approach. TODO optimize this\r\n\r\n\t\tvar least = vertices[ 0 ];\r\n\r\n\t\tfor ( var i = 0; i < vertices.length; i ++ ) {\r\n\r\n\t\t\tif ( vertices[ i ].collapseCost < least.collapseCost ) {\r\n\r\n\t\t\t\tleast = vertices[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn least;\r\n\r\n\t}\r\n\r\n\t// we use a triangle class to represent structure of face slightly differently\r\n\r\n\tfunction Triangle( v1, v2, v3, a, b, c ) {\r\n\r\n\t\tthis.a = a;\r\n\t\tthis.b = b;\r\n\t\tthis.c = c;\r\n\r\n\t\tthis.v1 = v1;\r\n\t\tthis.v2 = v2;\r\n\t\tthis.v3 = v3;\r\n\r\n\t\tthis.normal = new Vector3();\r\n\r\n\t\tthis.computeNormal();\r\n\r\n\t\tv1.faces.push( this );\r\n\t\tv1.addUniqueNeighbor( v2 );\r\n\t\tv1.addUniqueNeighbor( v3 );\r\n\r\n\t\tv2.faces.push( this );\r\n\t\tv2.addUniqueNeighbor( v1 );\r\n\t\tv2.addUniqueNeighbor( v3 );\r\n\r\n\r\n\t\tv3.faces.push( this );\r\n\t\tv3.addUniqueNeighbor( v1 );\r\n\t\tv3.addUniqueNeighbor( v2 );\r\n\r\n\t}\r\n\r\n\tTriangle.prototype.computeNormal = function () {\r\n\r\n\t\tvar vA = this.v1.position;\r\n\t\tvar vB = this.v2.position;\r\n\t\tvar vC = this.v3.position;\r\n\r\n\t\tcb.subVectors( vC, vB );\r\n\t\tab.subVectors( vA, vB );\r\n\t\tcb.cross( ab ).normalize();\r\n\r\n\t\tthis.normal.copy( cb );\r\n\r\n\t};\r\n\r\n\tTriangle.prototype.hasVertex = function ( v ) {\r\n\r\n\t\treturn v === this.v1 || v === this.v2 || v === this.v3;\r\n\r\n\t};\r\n\r\n\tTriangle.prototype.replaceVertex = function ( oldv, newv ) {\r\n\r\n\t\tif ( oldv === this.v1 ) this.v1 = newv;\r\n\t\telse if ( oldv === this.v2 ) this.v2 = newv;\r\n\t\telse if ( oldv === this.v3 ) this.v3 = newv;\r\n\r\n\t\tremoveFromArray( oldv.faces, this );\r\n\t\tnewv.faces.push( this );\r\n\r\n\r\n\t\toldv.removeIfNonNeighbor( this.v1 );\r\n\t\tthis.v1.removeIfNonNeighbor( oldv );\r\n\r\n\t\toldv.removeIfNonNeighbor( this.v2 );\r\n\t\tthis.v2.removeIfNonNeighbor( oldv );\r\n\r\n\t\toldv.removeIfNonNeighbor( this.v3 );\r\n\t\tthis.v3.removeIfNonNeighbor( oldv );\r\n\r\n\t\tthis.v1.addUniqueNeighbor( this.v2 );\r\n\t\tthis.v1.addUniqueNeighbor( this.v3 );\r\n\r\n\t\tthis.v2.addUniqueNeighbor( this.v1 );\r\n\t\tthis.v2.addUniqueNeighbor( this.v3 );\r\n\r\n\t\tthis.v3.addUniqueNeighbor( this.v1 );\r\n\t\tthis.v3.addUniqueNeighbor( this.v2 );\r\n\r\n\t\tthis.computeNormal();\r\n\r\n\t};\r\n\r\n\tfunction Vertex( v, id ) {\r\n\r\n\t\tthis.position = v;\r\n\r\n\t\tthis.id = id; // old index id\r\n\r\n\t\tthis.faces = []; // faces vertex is connected\r\n\t\tthis.neighbors = []; // neighbouring vertices aka \"adjacentVertices\"\r\n\r\n\t\t// these will be computed in computeEdgeCostAtVertex()\r\n\t\tthis.collapseCost = 0; // cost of collapsing this vertex, the less the better. aka objdist\r\n\t\tthis.collapseNeighbor = null; // best candinate for collapsing\r\n\r\n\t}\r\n\r\n\tVertex.prototype.addUniqueNeighbor = function ( vertex ) {\r\n\r\n\t\tpushIfUnique( this.neighbors, vertex );\r\n\r\n\t};\r\n\r\n\tVertex.prototype.removeIfNonNeighbor = function ( n ) {\r\n\r\n\t\tvar neighbors = this.neighbors;\r\n\t\tvar faces = this.faces;\r\n\r\n\t\tvar offset = neighbors.indexOf( n );\r\n\t\tif ( offset === - 1 ) return;\r\n\t\tfor ( var i = 0; i < faces.length; i ++ ) {\r\n\r\n\t\t\tif ( faces[ i ].hasVertex( n ) ) return;\r\n\r\n\t\t}\r\n\r\n\t\tneighbors.splice( offset, 1 );\r\n\r\n\t};\r\n\r\n\tSimplifyModifier.prototype.modify = function ( geometry, count ) {\r\n\r\n\t\tif ( geometry.isBufferGeometry ) {\r\n\r\n\t\t\tgeometry = new Geometry().fromBufferGeometry( geometry );\r\n\r\n\t\t}\r\n\r\n\t\tgeometry.mergeVertices();\r\n\r\n\t\tvar oldVertices = geometry.vertices; // Three Position\r\n\t\tvar oldFaces = geometry.faces; // Three Face\r\n\r\n\t\t// conversion\r\n\t\tvar vertices = [];\r\n\t\tvar faces = [];\r\n\r\n\t\tvar i, il;\r\n\r\n\t\t//\r\n\t\t// put data of original geometry in different data structures\r\n\t\t//\r\n\r\n\t\t// add vertices\r\n\r\n\t\tfor ( i = 0, il = oldVertices.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar vertex = new Vertex( oldVertices[ i ], i );\r\n\t\t\tvertices.push( vertex );\r\n\r\n\t\t}\r\n\r\n\t\t// add faces\r\n\r\n\t\tfor ( i = 0, il = oldFaces.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar face = oldFaces[ i ];\r\n\r\n\t\t\tvar a = face.a;\r\n\t\t\tvar b = face.b;\r\n\t\t\tvar c = face.c;\r\n\r\n\t\t\tvar triangle = new Triangle( vertices[ a ], vertices[ b ], vertices[ c ], a, b, c );\r\n\t\t\tfaces.push( triangle );\r\n\r\n\t\t}\r\n\r\n\t\t// compute all edge collapse costs\r\n\r\n\t\tfor ( i = 0, il = vertices.length; i < il; i ++ ) {\r\n\r\n\t\t\tcomputeEdgeCostAtVertex( vertices[ i ] );\r\n\r\n\t\t}\r\n\r\n\t\tvar nextVertex;\r\n\r\n\t\tvar z = count;\r\n\r\n\t\twhile ( z -- ) {\r\n\r\n\t\t\tnextVertex = minimumCostEdge( vertices );\r\n\r\n\t\t\tif ( ! nextVertex ) {\r\n\r\n\t\t\t\tconsole.log( 'THREE.SimplifyModifier: No next vertex' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcollapse( vertices, faces, nextVertex, nextVertex.collapseNeighbor );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tvar simplifiedGeometry = new BufferGeometry();\r\n\t\tvar position = [];\r\n\t\tvar index = [];\r\n\r\n\t\t//\r\n\r\n\t\tfor ( i = 0; i < vertices.length; i ++ ) {\r\n\r\n\t\t\tvar vertex = vertices[ i ].position;\r\n\t\t\tposition.push( vertex.x, vertex.y, vertex.z );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tfor ( i = 0; i < faces.length; i ++ ) {\r\n\r\n\t\t\tvar face = faces[ i ];\r\n\r\n\t\t\tvar a = vertices.indexOf( face.v1 );\r\n\t\t\tvar b = vertices.indexOf( face.v2 );\r\n\t\t\tvar c = vertices.indexOf( face.v3 );\r\n\r\n\t\t\tindex.push( a, b, c );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tsimplifiedGeometry.setAttribute( 'position', new Float32BufferAttribute( position, 3 ) );\r\n\t\tsimplifiedGeometry.setIndex( index );\r\n\r\n\t\treturn simplifiedGeometry;\r\n\r\n\t};\r\n\r\n} )();\r\n\r\nexport { SimplifyModifier };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/modifiers/SimplifyModifier.js","<template>\r\n    <div class=\"webglModifierSimplifier-container\">\r\n        \r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { OrbitControls } from '@/components/jsm/controls/OrbitControls.js'\r\nimport { GLTFLoader } from '@/components/jsm/loaders/GLTFLoader.js'\r\nimport { SimplifyModifier } from '@/components/jsm/modifiers/SimplifyModifier.js'\r\nexport default {\r\n    data() {\r\n        return {\r\n            renderer: null,\r\n            scene: null,\r\n            camera: null,\r\n        }\r\n    },\r\n    mounted() {\r\n        this.init()\r\n    },\r\n    methods: {\r\n        init() {\r\n            var info = document.createElement('div')\r\n            info.style.position = 'absolute'\r\n            info.style.top = '10px'\r\n            info.style.width = '100%'\r\n            info.style.textAlign = 'center'\r\n            info.innerHTML = '<a href=\"https://threejs.org\" target=\"_blank\" rel=\"noopener\">three.js</a> - Vertex Reduction using SimplifyModifier'\r\n            document.getElementsByClassName('webglModifierSimplifier-container')[0].appendChild(info)\r\n            this.renderer = new this.$THREE.WebGLRenderer({ antialias: true })\r\n            this.renderer.setPixelRatio(window.devicePixelRatio)\r\n            this.renderer.setSize(this.$webglInnerWidth, window.innerHeight)\r\n            document.getElementsByClassName('webglModifierSimplifier-container')[0].appendChild(this.renderer.domElement)\r\n            this.scene = new this.$THREE.Scene()\r\n            this.camera = new this.$THREE.PerspectiveCamera(40, this.$webglInnerWidth / window.innerHeight, 1, 1000)\r\n            this.camera.position.z = 15\r\n            var controls = new OrbitControls(this.camera, this.renderer.domElement)\r\n            controls.addEventListener('change', this.render) // use if there is no animation loop\r\n            controls.enablePan = false\r\n            controls.enableZoom = false\r\n            this.scene.add(new this.$THREE.AmbientLight(0xffffff, 0.2))\r\n            var light = new this.$THREE.PointLight(0xffffff, 0.7)\r\n            this.camera.add(light)\r\n            this.scene.add(this.camera)\r\n            new GLTFLoader().load(\"static/models/gltf/LeePerrySmith/LeePerrySmith.glb\", (gltf) => {\r\n                var mesh = gltf.scene.children[ 0 ]\r\n                mesh.position.x = - 3\r\n                mesh.rotation.y = Math.PI / 2\r\n                this.scene.add(mesh)\r\n                var modifier = new SimplifyModifier()\r\n                var simplified = mesh.clone()\r\n                simplified.material = simplified.material.clone()\r\n                simplified.material.flatShading = true\r\n                var count = Math.floor(simplified.geometry.attributes.position.count * 0.875) // number of vertices to remove\r\n                simplified.geometry = modifier.modify(simplified.geometry, count)\r\n                simplified.position.x = 3\r\n                simplified.rotation.y = - Math.PI / 2\r\n                this.scene.add(simplified)\r\n                this.render()\r\n            })\r\n            window.addEventListener('resize', this.onWindowResize, false)\r\n        },\r\n        onWindowResize() {\r\n            this.$onWindowResize(this.camera, this.renderer)\r\n            this.render()\r\n        },\r\n        render() {\r\n            this.renderer.render(this.scene, this.camera)\r\n        }\r\n    },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.webglModifierSimplifier-container {\r\n    position: relative;\r\n    width: 100%;\r\n}\r\n#info {\r\n    color: #fff;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/views/modifier/webglModifierSimplifier.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"webglModifierSimplifier-container\"})}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-576ba4df\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/modifier/webglModifierSimplifier.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-576ba4df\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./webglModifierSimplifier.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglModifierSimplifier.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglModifierSimplifier.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-576ba4df\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./webglModifierSimplifier.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-576ba4df\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/modifier/webglModifierSimplifier.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}