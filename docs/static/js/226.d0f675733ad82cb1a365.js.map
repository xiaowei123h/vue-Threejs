{"version":3,"sources":["webpack:///./src/components/jsm/loaders/3MFLoader.js","webpack:///src/views/loader/webglLoader3mfMaterials.vue","webpack:///./src/views/loader/webglLoader3mfMaterials.vue?4abe","webpack:///./src/views/loader/webglLoader3mfMaterials.vue"],"names":["ThreeMFLoader","manager","Loader","call","this","availableExtensions","prototype","Object","assign","create","constructor","load","url","onLoad","onProgress","onError","scope","loader","FileLoader","setPath","path","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","buffer","parse","e","console","error","itemError","data","textureLoader","TextureLoader","parseRelsXml","relsFileText","relationships","relsNodes","DOMParser","parseFromString","querySelectorAll","i","length","relsNode","relationship","target","getAttribute","id","type","push","parseBasematerialsNode","basematerialsNode","basematerialsData","basematerials","basematerialNodes","basematerialData","parseBasematerialNode","index","parseTextures2DGroupNode","texture2DGroupNode","texture2DGroupData","texid","displaypropertiesid","tex2coordNodes","uvs","tex2coordNode","u","v","parseFloat","Float32Array","parseColorGroupNode","colorGroupNode","colorGroupData","colorNodes","colors","colorObject","Color","color","setStyle","substring","convertSRGBToLinear","r","g","b","parseMetallicDisplaypropertiesNode","metallicDisplaypropetiesNode","metallicDisplaypropertiesData","metallicNodes","metallicData","metallicNode","name","metallicness","roughness","basematerialNode","parseComponentNode","componentNode","componentData","transform","parseTransform","t","split","forEach","s","matrix","Matrix4","set","parseObjectNode","objectNode","objectData","pid","pindex","thumbnail","partnumber","meshNode","querySelector","meshData","vertices","vertexNodes","vertexNode","x","y","z","triangleProperties","triangles","triangleNodes","triangleNode","v1","v2","v3","p1","p2","p3","triangleProperty","parseInt","keys","Uint32Array","parseMeshNode","componentsNode","components","componentNodes","parseComponentsNode","parseModelNode","modelNode","modelData","unit","metadataNodes","metadataData","metadataNode","indexOf","textContent","parseMetadataNodes","resourcesNode","resourcesData","basematerialsNodes","texture2DNode","textures2DNodes","textures2DNode","texture2DData","contenttype","tilestyleu","tilestylev","filter","colorGroupNodes","pbmetallicdisplaypropertiesNodes","pbmetallicdisplaypropertiesData","textures2DGroupNodes","textures2DGroupData","objectNodes","parseResourcesNode","buildNode","buildData","itemNodes","itemNode","buildItem","objectId","parseBuildNode","buildTexture","texture2dgroup","objects","textureData","texture2d","resources","blob","Blob","sourceURI","URL","createObjectURL","texture","revokeObjectURL","encoding","sRGBEncoding","wrapS","RepeatWrapping","MirroredRepeatWrapping","ClampToEdgeWrapping","wrapT","magFilter","LinearFilter","minFilter","LinearMipmapLinearFilter","NearestFilter","buildBasematerialsMeshes","objectPindex","materialMap","l","undefined","meshes","materialIndex","trianglePropertiesProps","material","getBuild","buildBasematerial","geometry","BufferGeometry","positionData","j","jl","setAttribute","Float32BufferAttribute","mesh","Mesh","buildTexturedMesh","uvData","MeshPhongMaterial","map","flatShading","buildVertexColorMesh","colorgroup","colorData","vertexColors","buildDefaultMesh","setIndex","BufferAttribute","getResourceType","buildGroup","group","Group","resourceMap","il","resourceId","newMeshes","buildMeshes","objectPid","analyzeObject","add","builder","build","materialData","pbmetallicdisplayproperties","MeshStandardMaterial","metalness","displaycolor","opacity","charAt","buildComposite","compositeData","composite","component","buildObject","object3D","clone","applyMatrix4","extensions","modelXml","ns","extension","apply","applyExtensions","data3mf","relsName","modelRelsName","rels","modelRels","zip","file","modelPartNames","printTicketPartNames","texturesPartNames","otherPartNames","modelParts","texturesParts","JSZip","ReferenceError","files","match","relsView","Uint8Array","asArrayBuffer","LoaderUtils","decodeText","modelPart","view","fileText","xmlData","documentElement","nodeName","toLowerCase","attributes","attr","value","RegExp","$1","texturesPartName","model","printTicket","other","loadDocument","modelsData","modelsKeys","modelRel","textureKey","objectIds","buildObjects","addExtension","webglLoader3mfMaterials","camera","scene","renderer","mounted","init","methods","_this","$THREE","Scene","background","fog","Fog","PerspectiveCamera","$webglInnerWidth","window","innerHeight","position","hemiLight","HemisphereLight","dirLight","DirectionalLight","castShadow","shadow","top","bottom","left","right","near","far","mapSize","LoadingManager","_MFLoader_ThreeMFLoader","object","quaternion","setFromEuler","Euler","Math","PI","traverse","child","render","ground","PlaneBufferGeometry","depthWrite","rotation","receiveShadow","WebGLRenderer","antialias","setPixelRatio","devicePixelRatio","setSize","outputEncoding","shadowMap","enabled","PCFSoftShadowMap","document","getElementsByClassName","appendChild","domElement","controls","OrbitControls","addEventListener","minDistance","maxDistance","enablePan","update","onWindowResize","$onWindowResize","loader_webglLoader3mfMaterials","$createElement","_self","_c","_m","staticRenderFns","_h","staticClass","attrs","href","rel","_v","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/226.d0f675733ad82cb1a365.js","sourcesContent":["import {\r\n\tBufferAttribute,\r\n\tBufferGeometry,\r\n\tClampToEdgeWrapping,\r\n\tColor,\r\n\tFileLoader,\r\n\tFloat32BufferAttribute,\r\n\tGroup,\r\n\tLinearFilter,\r\n\tLinearMipmapLinearFilter,\r\n\tLoader,\r\n\tLoaderUtils,\r\n\tMatrix4,\r\n\tMesh,\r\n\tMeshPhongMaterial,\r\n\tMeshStandardMaterial,\r\n\tMirroredRepeatWrapping,\r\n\tNearestFilter,\r\n\tRepeatWrapping,\r\n\tTextureLoader,\r\n\tsRGBEncoding\r\n} from \"@/components/build/three.module.js\";\r\nimport { JSZip } from \"../libs/jszip.module.min.js\";\r\n\r\n/**\r\n *\r\n * 3D Manufacturing Format (3MF) specification: https://3mf.io/specification/\r\n *\r\n * The following features from the core specification are supported:\r\n *\r\n * - 3D Models\r\n * - Object Resources (Meshes and Components)\r\n * - Material Resources (Base Materials)\r\n *\r\n * 3MF Materials and Properties Extension are only partially supported.\r\n *\r\n * - Texture 2D\r\n * - Texture 2D Groups\r\n * - Color Groups (Vertex Colors)\r\n * - Metallic Display Properties (PBR)\r\n */\r\n\r\nvar ThreeMFLoader = function ( manager ) {\r\n\r\n\tLoader.call( this, manager );\r\n\r\n\tthis.availableExtensions = [];\r\n\r\n};\r\n\r\nThreeMFLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\tconstructor: ThreeMFLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\t\tvar loader = new FileLoader( scope.manager );\r\n\t\tloader.setPath( scope.path );\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\t\tloader.setRequestHeader( scope.requestHeader );\r\n\t\tloader.setWithCredentials( scope.withCredentials );\r\n\t\tloader.load( url, function ( buffer ) {\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\tonLoad( scope.parse( buffer ) );\r\n\r\n\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\tif ( onError ) {\r\n\r\n\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.manager.itemError( url );\r\n\r\n\t\t\t}\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tparse: function ( data ) {\r\n\r\n\t\tvar scope = this;\r\n\t\tvar textureLoader = new TextureLoader( this.manager );\r\n\r\n\t\tfunction loadDocument( data ) {\r\n\r\n\t\t\tvar zip = null;\r\n\t\t\tvar file = null;\r\n\r\n\t\t\tvar relsName;\r\n\t\t\tvar modelRelsName;\r\n\t\t\tvar modelPartNames = [];\r\n\t\t\tvar printTicketPartNames = [];\r\n\t\t\tvar texturesPartNames = [];\r\n\t\t\tvar otherPartNames = [];\r\n\r\n\t\t\tvar rels;\r\n\t\t\tvar modelRels;\r\n\t\t\tvar modelParts = {};\r\n\t\t\tvar printTicketParts = {};\r\n\t\t\tvar texturesParts = {};\r\n\t\t\tvar otherParts = {};\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\tzip = new JSZip( data ); // eslint-disable-line no-undef\r\n\r\n\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\tif ( e instanceof ReferenceError ) {\r\n\r\n\t\t\t\t\tconsole.error( 'THREE.3MFLoader: jszip missing and file is compressed.' );\r\n\t\t\t\t\treturn null;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( file in zip.files ) {\r\n\r\n\t\t\t\tif ( file.match( /\\_rels\\/.rels$/ ) ) {\r\n\r\n\t\t\t\t\trelsName = file;\r\n\r\n\t\t\t\t} else if ( file.match( /3D\\/_rels\\/.*\\.model\\.rels$/ ) ) {\r\n\r\n\t\t\t\t\tmodelRelsName = file;\r\n\r\n\t\t\t\t} else if ( file.match( /^3D\\/.*\\.model$/ ) ) {\r\n\r\n\t\t\t\t\tmodelPartNames.push( file );\r\n\r\n\t\t\t\t} else if ( file.match( /^3D\\/Metadata\\/.*\\.xml$/ ) ) {\r\n\r\n\t\t\t\t\tprintTicketPartNames.push( file );\r\n\r\n\t\t\t\t} else if ( file.match( /^3D\\/Textures?\\/.*/ ) ) {\r\n\r\n\t\t\t\t\ttexturesPartNames.push( file );\r\n\r\n\t\t\t\t} else if ( file.match( /^3D\\/Other\\/.*/ ) ) {\r\n\r\n\t\t\t\t\totherPartNames.push( file );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tvar relsView = new Uint8Array( zip.file( relsName ).asArrayBuffer() );\r\n\t\t\tvar relsFileText = LoaderUtils.decodeText( relsView );\r\n\t\t\trels = parseRelsXml( relsFileText );\r\n\r\n\t\t\t//\r\n\r\n\t\t\tif ( modelRelsName ) {\r\n\r\n\t\t\t\tvar relsView = new Uint8Array( zip.file( modelRelsName ).asArrayBuffer() );\r\n\t\t\t\tvar relsFileText = LoaderUtils.decodeText( relsView );\r\n\t\t\t\tmodelRels = parseRelsXml( relsFileText );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tfor ( var i = 0; i < modelPartNames.length; i ++ ) {\r\n\r\n\t\t\t\tvar modelPart = modelPartNames[ i ];\r\n\t\t\t\tvar view = new Uint8Array( zip.file( modelPart ).asArrayBuffer() );\r\n\r\n\t\t\t\tvar fileText = LoaderUtils.decodeText( view );\r\n\t\t\t\tvar xmlData = new DOMParser().parseFromString( fileText, 'application/xml' );\r\n\r\n\t\t\t\tif ( xmlData.documentElement.nodeName.toLowerCase() !== 'model' ) {\r\n\r\n\t\t\t\t\tconsole.error( 'THREE.3MFLoader: Error loading 3MF - no 3MF document found: ', modelPart );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar modelNode = xmlData.querySelector( 'model' );\r\n\t\t\t\tvar extensions = {};\r\n\r\n\t\t\t\tfor ( var i = 0; i < modelNode.attributes.length; i ++ ) {\r\n\r\n\t\t\t\t\tvar attr = modelNode.attributes[ i ];\r\n\t\t\t\t\tif ( attr.name.match( /^xmlns:(.+)$/ ) ) {\r\n\r\n\t\t\t\t\t\textensions[ attr.value ] = RegExp.$1;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar modelData = parseModelNode( modelNode );\r\n\t\t\t\tmodelData[ 'xml' ] = modelNode;\r\n\r\n\t\t\t\tif ( 0 < Object.keys( extensions ).length ) {\r\n\r\n\t\t\t\t\tmodelData[ 'extensions' ] = extensions;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmodelParts[ modelPart ] = modelData;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tfor ( var i = 0; i < texturesPartNames.length; i ++ ) {\r\n\r\n\t\t\t\tvar texturesPartName = texturesPartNames[ i ];\r\n\t\t\t\ttexturesParts[ texturesPartName ] = zip.file( texturesPartName ).asArrayBuffer();\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\trels: rels,\r\n\t\t\t\tmodelRels: modelRels,\r\n\t\t\t\tmodel: modelParts,\r\n\t\t\t\tprintTicket: printTicketParts,\r\n\t\t\t\ttexture: texturesParts,\r\n\t\t\t\tother: otherParts\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseRelsXml( relsFileText ) {\r\n\r\n\t\t\tvar relationships = [];\r\n\r\n\t\t\tvar relsXmlData = new DOMParser().parseFromString( relsFileText, 'application/xml' );\r\n\r\n\t\t\tvar relsNodes = relsXmlData.querySelectorAll( 'Relationship' );\r\n\r\n\t\t\tfor ( var i = 0; i < relsNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar relsNode = relsNodes[ i ];\r\n\r\n\t\t\t\tvar relationship = {\r\n\t\t\t\t\ttarget: relsNode.getAttribute( 'Target' ), //required\r\n\t\t\t\t\tid: relsNode.getAttribute( 'Id' ), //required\r\n\t\t\t\t\ttype: relsNode.getAttribute( 'Type' ) //required\r\n\t\t\t\t};\r\n\r\n\t\t\t\trelationships.push( relationship );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn relationships;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseMetadataNodes( metadataNodes ) {\r\n\r\n\t\t\tvar metadataData = {};\r\n\r\n\t\t\tfor ( var i = 0; i < metadataNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar metadataNode = metadataNodes[ i ];\r\n\t\t\t\tvar name = metadataNode.getAttribute( 'name' );\r\n\t\t\t\tvar validNames = [\r\n\t\t\t\t\t'Title',\r\n\t\t\t\t\t'Designer',\r\n\t\t\t\t\t'Description',\r\n\t\t\t\t\t'Copyright',\r\n\t\t\t\t\t'LicenseTerms',\r\n\t\t\t\t\t'Rating',\r\n\t\t\t\t\t'CreationDate',\r\n\t\t\t\t\t'ModificationDate'\r\n\t\t\t\t];\r\n\r\n\t\t\t\tif ( 0 <= validNames.indexOf( name ) ) {\r\n\r\n\t\t\t\t\tmetadataData[ name ] = metadataNode.textContent;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn metadataData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseBasematerialsNode( basematerialsNode ) {\r\n\r\n\t\t\tvar basematerialsData = {\r\n\t\t\t\tid: basematerialsNode.getAttribute( 'id' ), // required\r\n\t\t\t\tbasematerials: []\r\n\t\t\t};\r\n\r\n\t\t\tvar basematerialNodes = basematerialsNode.querySelectorAll( 'base' );\r\n\r\n\t\t\tfor ( var i = 0; i < basematerialNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar basematerialNode = basematerialNodes[ i ];\r\n\t\t\t\tvar basematerialData = parseBasematerialNode( basematerialNode );\r\n\t\t\t\tbasematerialData.index = i; // the order and count of the material nodes form an implicit 0-based index\r\n\t\t\t\tbasematerialsData.basematerials.push( basematerialData );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn basematerialsData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseTexture2DNode( texture2DNode ) {\r\n\r\n\t\t\tvar texture2dData = {\r\n\t\t\t\tid: texture2DNode.getAttribute( 'id' ), // required\r\n\t\t\t\tpath: texture2DNode.getAttribute( 'path' ), // required\r\n\t\t\t\tcontenttype: texture2DNode.getAttribute( 'contenttype' ), // required\r\n\t\t\t\ttilestyleu: texture2DNode.getAttribute( 'tilestyleu' ),\r\n\t\t\t\ttilestylev: texture2DNode.getAttribute( 'tilestylev' ),\r\n\t\t\t\tfilter: texture2DNode.getAttribute( 'filter' ),\r\n\t\t\t};\r\n\r\n\t\t\treturn texture2dData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseTextures2DGroupNode( texture2DGroupNode ) {\r\n\r\n\t\t\tvar texture2DGroupData = {\r\n\t\t\t\tid: texture2DGroupNode.getAttribute( 'id' ), // required\r\n\t\t\t\ttexid: texture2DGroupNode.getAttribute( 'texid' ), // required\r\n\t\t\t\tdisplaypropertiesid: texture2DGroupNode.getAttribute( 'displaypropertiesid' )\r\n\t\t\t};\r\n\r\n\t\t\tvar tex2coordNodes = texture2DGroupNode.querySelectorAll( 'tex2coord' );\r\n\r\n\t\t\tvar uvs = [];\r\n\r\n\t\t\tfor ( var i = 0; i < tex2coordNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar tex2coordNode = tex2coordNodes[ i ];\r\n\t\t\t\tvar u = tex2coordNode.getAttribute( 'u' );\r\n\t\t\t\tvar v = tex2coordNode.getAttribute( 'v' );\r\n\r\n\t\t\t\tuvs.push( parseFloat( u ), parseFloat( v ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture2DGroupData[ 'uvs' ] = new Float32Array( uvs );\r\n\r\n\t\t\treturn texture2DGroupData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseColorGroupNode( colorGroupNode ) {\r\n\r\n\t\t\tvar colorGroupData = {\r\n\t\t\t\tid: colorGroupNode.getAttribute( 'id' ), // required\r\n\t\t\t\tdisplaypropertiesid: colorGroupNode.getAttribute( 'displaypropertiesid' )\r\n\t\t\t};\r\n\r\n\t\t\tvar colorNodes = colorGroupNode.querySelectorAll( 'color' );\r\n\r\n\t\t\tvar colors = [];\r\n\t\t\tvar colorObject = new Color();\r\n\r\n\t\t\tfor ( var i = 0; i < colorNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar colorNode = colorNodes[ i ];\r\n\t\t\t\tvar color = colorNode.getAttribute( 'color' );\r\n\r\n\t\t\t\tcolorObject.setStyle( color.substring( 0, 7 ) );\r\n\t\t\t\tcolorObject.convertSRGBToLinear(); // color is in sRGB\r\n\r\n\t\t\t\tcolors.push( colorObject.r, colorObject.g, colorObject.b );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcolorGroupData[ 'colors' ] = new Float32Array( colors );\r\n\r\n\t\t\treturn colorGroupData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseMetallicDisplaypropertiesNode( metallicDisplaypropetiesNode ) {\r\n\r\n\t\t\tvar metallicDisplaypropertiesData = {\r\n\t\t\t\tid: metallicDisplaypropetiesNode.getAttribute( 'id' ) // required\r\n\t\t\t};\r\n\r\n\t\t\tvar metallicNodes = metallicDisplaypropetiesNode.querySelectorAll( 'pbmetallic' );\r\n\r\n\t\t\tvar metallicData = [];\r\n\r\n\t\t\tfor ( var i = 0; i < metallicNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar metallicNode = metallicNodes[ i ];\r\n\r\n\t\t\t\tmetallicData.push( {\r\n\t\t\t\t\tname: metallicNode.getAttribute( 'name' ), // required\r\n\t\t\t\t\tmetallicness: parseFloat( metallicNode.getAttribute( 'metallicness' ) ), // required\r\n\t\t\t\t\troughness: parseFloat( metallicNode.getAttribute( 'roughness' ) ) // required\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmetallicDisplaypropertiesData.data = metallicData;\r\n\r\n\t\t\treturn metallicDisplaypropertiesData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseBasematerialNode( basematerialNode ) {\r\n\r\n\t\t\tvar basematerialData = {};\r\n\r\n\t\t\tbasematerialData[ 'name' ] = basematerialNode.getAttribute( 'name' ); // required\r\n\t\t\tbasematerialData[ 'displaycolor' ] = basematerialNode.getAttribute( 'displaycolor' ); // required\r\n\t\t\tbasematerialData[ 'displaypropertiesid' ] = basematerialNode.getAttribute( 'displaypropertiesid' );\r\n\r\n\t\t\treturn basematerialData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseMeshNode( meshNode ) {\r\n\r\n\t\t\tvar meshData = {};\r\n\r\n\t\t\tvar vertices = [];\r\n\t\t\tvar vertexNodes = meshNode.querySelectorAll( 'vertices vertex' );\r\n\r\n\t\t\tfor ( var i = 0; i < vertexNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar vertexNode = vertexNodes[ i ];\r\n\t\t\t\tvar x = vertexNode.getAttribute( 'x' );\r\n\t\t\t\tvar y = vertexNode.getAttribute( 'y' );\r\n\t\t\t\tvar z = vertexNode.getAttribute( 'z' );\r\n\r\n\t\t\t\tvertices.push( parseFloat( x ), parseFloat( y ), parseFloat( z ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmeshData[ 'vertices' ] = new Float32Array( vertices );\r\n\r\n\t\t\tvar triangleProperties = [];\r\n\t\t\tvar triangles = [];\r\n\t\t\tvar triangleNodes = meshNode.querySelectorAll( 'triangles triangle' );\r\n\r\n\t\t\tfor ( var i = 0; i < triangleNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar triangleNode = triangleNodes[ i ];\r\n\t\t\t\tvar v1 = triangleNode.getAttribute( 'v1' );\r\n\t\t\t\tvar v2 = triangleNode.getAttribute( 'v2' );\r\n\t\t\t\tvar v3 = triangleNode.getAttribute( 'v3' );\r\n\t\t\t\tvar p1 = triangleNode.getAttribute( 'p1' );\r\n\t\t\t\tvar p2 = triangleNode.getAttribute( 'p2' );\r\n\t\t\t\tvar p3 = triangleNode.getAttribute( 'p3' );\r\n\t\t\t\tvar pid = triangleNode.getAttribute( 'pid' );\r\n\r\n\t\t\t\tvar triangleProperty = {};\r\n\r\n\t\t\t\ttriangleProperty[ 'v1' ] = parseInt( v1, 10 );\r\n\t\t\t\ttriangleProperty[ 'v2' ] = parseInt( v2, 10 );\r\n\t\t\t\ttriangleProperty[ 'v3' ] = parseInt( v3, 10 );\r\n\r\n\t\t\t\ttriangles.push( triangleProperty[ 'v1' ], triangleProperty[ 'v2' ], triangleProperty[ 'v3' ] );\r\n\r\n\t\t\t\t// optional\r\n\r\n\t\t\t\tif ( p1 ) {\r\n\r\n\t\t\t\t\ttriangleProperty[ 'p1' ] = parseInt( p1, 10 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( p2 ) {\r\n\r\n\t\t\t\t\ttriangleProperty[ 'p2' ] = parseInt( p2, 10 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( p3 ) {\r\n\r\n\t\t\t\t\ttriangleProperty[ 'p3' ] = parseInt( p3, 10 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pid ) {\r\n\r\n\t\t\t\t\ttriangleProperty[ 'pid' ] = pid;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( 0 < Object.keys( triangleProperty ).length ) {\r\n\r\n\t\t\t\t\ttriangleProperties.push( triangleProperty );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmeshData[ 'triangleProperties' ] = triangleProperties;\r\n\t\t\tmeshData[ 'triangles' ] = new Uint32Array( triangles );\r\n\r\n\t\t\treturn meshData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseComponentsNode( componentsNode ) {\r\n\r\n\t\t\tvar components = [];\r\n\r\n\t\t\tvar componentNodes = componentsNode.querySelectorAll( 'component' );\r\n\r\n\t\t\tfor ( var i = 0; i < componentNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar componentNode = componentNodes[ i ];\r\n\t\t\t\tvar componentData = parseComponentNode( componentNode );\r\n\t\t\t\tcomponents.push( componentData );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn components;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseComponentNode( componentNode ) {\r\n\r\n\t\t\tvar componentData = {};\r\n\r\n\t\t\tcomponentData[ 'objectId' ] = componentNode.getAttribute( 'objectid' ); // required\r\n\r\n\t\t\tvar transform = componentNode.getAttribute( 'transform' );\r\n\r\n\t\t\tif ( transform ) {\r\n\r\n\t\t\t\tcomponentData[ 'transform' ] = parseTransform( transform );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn componentData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseTransform( transform ) {\r\n\r\n\t\t\tvar t = [];\r\n\t\t\ttransform.split( ' ' ).forEach( function ( s ) {\r\n\r\n\t\t\t\tt.push( parseFloat( s ) );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tvar matrix = new Matrix4();\r\n\t\t\tmatrix.set(\r\n\t\t\t\tt[ 0 ], t[ 3 ], t[ 6 ], t[ 9 ],\r\n\t\t\t\tt[ 1 ], t[ 4 ], t[ 7 ], t[ 10 ],\r\n\t\t\t\tt[ 2 ], t[ 5 ], t[ 8 ], t[ 11 ],\r\n\t\t\t\t 0.0, 0.0, 0.0, 1.0\r\n\t\t\t);\r\n\r\n\t\t\treturn matrix;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseObjectNode( objectNode ) {\r\n\r\n\t\t\tvar objectData = {\r\n\t\t\t\ttype: objectNode.getAttribute( 'type' )\r\n\t\t\t};\r\n\r\n\t\t\tvar id = objectNode.getAttribute( 'id' );\r\n\r\n\t\t\tif ( id ) {\r\n\r\n\t\t\t\tobjectData[ 'id' ] = id;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar pid = objectNode.getAttribute( 'pid' );\r\n\r\n\t\t\tif ( pid ) {\r\n\r\n\t\t\t\tobjectData[ 'pid' ] = pid;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar pindex = objectNode.getAttribute( 'pindex' );\r\n\r\n\t\t\tif ( pindex ) {\r\n\r\n\t\t\t\tobjectData[ 'pindex' ] = pindex;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar thumbnail = objectNode.getAttribute( 'thumbnail' );\r\n\r\n\t\t\tif ( thumbnail ) {\r\n\r\n\t\t\t\tobjectData[ 'thumbnail' ] = thumbnail;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar partnumber = objectNode.getAttribute( 'partnumber' );\r\n\r\n\t\t\tif ( partnumber ) {\r\n\r\n\t\t\t\tobjectData[ 'partnumber' ] = partnumber;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar name = objectNode.getAttribute( 'name' );\r\n\r\n\t\t\tif ( name ) {\r\n\r\n\t\t\t\tobjectData[ 'name' ] = name;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar meshNode = objectNode.querySelector( 'mesh' );\r\n\r\n\t\t\tif ( meshNode ) {\r\n\r\n\t\t\t\tobjectData[ 'mesh' ] = parseMeshNode( meshNode );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar componentsNode = objectNode.querySelector( 'components' );\r\n\r\n\t\t\tif ( componentsNode ) {\r\n\r\n\t\t\t\tobjectData[ 'components' ] = parseComponentsNode( componentsNode );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn objectData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseResourcesNode( resourcesNode ) {\r\n\r\n\t\t\tvar resourcesData = {};\r\n\r\n\t\t\tresourcesData[ 'basematerials' ] = {};\r\n\t\t\tvar basematerialsNodes = resourcesNode.querySelectorAll( 'basematerials' );\r\n\r\n\t\t\tfor ( var i = 0; i < basematerialsNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar basematerialsNode = basematerialsNodes[ i ];\r\n\t\t\t\tvar basematerialsData = parseBasematerialsNode( basematerialsNode );\r\n\t\t\t\tresourcesData[ 'basematerials' ][ basematerialsData[ 'id' ] ] = basematerialsData;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tresourcesData[ 'texture2d' ] = {};\r\n\t\t\tvar textures2DNodes = resourcesNode.querySelectorAll( 'texture2d' );\r\n\r\n\t\t\tfor ( var i = 0; i < textures2DNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar textures2DNode = textures2DNodes[ i ];\r\n\t\t\t\tvar texture2DData = parseTexture2DNode( textures2DNode );\r\n\t\t\t\tresourcesData[ 'texture2d' ][ texture2DData[ 'id' ] ] = texture2DData;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tresourcesData[ 'colorgroup' ] = {};\r\n\t\t\tvar colorGroupNodes = resourcesNode.querySelectorAll( 'colorgroup' );\r\n\r\n\t\t\tfor ( var i = 0; i < colorGroupNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar colorGroupNode = colorGroupNodes[ i ];\r\n\t\t\t\tvar colorGroupData = parseColorGroupNode( colorGroupNode );\r\n\t\t\t\tresourcesData[ 'colorgroup' ][ colorGroupData[ 'id' ] ] = colorGroupData;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tresourcesData[ 'pbmetallicdisplayproperties' ] = {};\r\n\t\t\tvar pbmetallicdisplaypropertiesNodes = resourcesNode.querySelectorAll( 'pbmetallicdisplayproperties' );\r\n\r\n\t\t\tfor ( var i = 0; i < pbmetallicdisplaypropertiesNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar pbmetallicdisplaypropertiesNode = pbmetallicdisplaypropertiesNodes[ i ];\r\n\t\t\t\tvar pbmetallicdisplaypropertiesData = parseMetallicDisplaypropertiesNode( pbmetallicdisplaypropertiesNode );\r\n\t\t\t\tresourcesData[ 'pbmetallicdisplayproperties' ][ pbmetallicdisplaypropertiesData[ 'id' ] ] = pbmetallicdisplaypropertiesData;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tresourcesData[ 'texture2dgroup' ] = {};\r\n\t\t\tvar textures2DGroupNodes = resourcesNode.querySelectorAll( 'texture2dgroup' );\r\n\r\n\t\t\tfor ( var i = 0; i < textures2DGroupNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar textures2DGroupNode = textures2DGroupNodes[ i ];\r\n\t\t\t\tvar textures2DGroupData = parseTextures2DGroupNode( textures2DGroupNode );\r\n\t\t\t\tresourcesData[ 'texture2dgroup' ][ textures2DGroupData[ 'id' ] ] = textures2DGroupData;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tresourcesData[ 'object' ] = {};\r\n\t\t\tvar objectNodes = resourcesNode.querySelectorAll( 'object' );\r\n\r\n\t\t\tfor ( var i = 0; i < objectNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar objectNode = objectNodes[ i ];\r\n\t\t\t\tvar objectData = parseObjectNode( objectNode );\r\n\t\t\t\tresourcesData[ 'object' ][ objectData[ 'id' ] ] = objectData;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn resourcesData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseBuildNode( buildNode ) {\r\n\r\n\t\t\tvar buildData = [];\r\n\t\t\tvar itemNodes = buildNode.querySelectorAll( 'item' );\r\n\r\n\t\t\tfor ( var i = 0; i < itemNodes.length; i ++ ) {\r\n\r\n\t\t\t\tvar itemNode = itemNodes[ i ];\r\n\t\t\t\tvar buildItem = {\r\n\t\t\t\t\tobjectId: itemNode.getAttribute( 'objectid' )\r\n\t\t\t\t};\r\n\t\t\t\tvar transform = itemNode.getAttribute( 'transform' );\r\n\r\n\t\t\t\tif ( transform ) {\r\n\r\n\t\t\t\t\tbuildItem[ 'transform' ] = parseTransform( transform );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbuildData.push( buildItem );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn buildData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction parseModelNode( modelNode ) {\r\n\r\n\t\t\tvar modelData = { unit: modelNode.getAttribute( 'unit' ) || 'millimeter' };\r\n\t\t\tvar metadataNodes = modelNode.querySelectorAll( 'metadata' );\r\n\r\n\t\t\tif ( metadataNodes ) {\r\n\r\n\t\t\t\tmodelData[ 'metadata' ] = parseMetadataNodes( metadataNodes );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar resourcesNode = modelNode.querySelector( 'resources' );\r\n\r\n\t\t\tif ( resourcesNode ) {\r\n\r\n\t\t\t\tmodelData[ 'resources' ] = parseResourcesNode( resourcesNode );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar buildNode = modelNode.querySelector( 'build' );\r\n\r\n\t\t\tif ( buildNode ) {\r\n\r\n\t\t\t\tmodelData[ 'build' ] = parseBuildNode( buildNode );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn modelData;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildTexture( texture2dgroup, objects, modelData, textureData ) {\r\n\r\n\t\t\tvar texid = texture2dgroup.texid;\r\n\t\t\tvar texture2ds = modelData.resources.texture2d;\r\n\t\t\tvar texture2d = texture2ds[ texid ];\r\n\r\n\t\t\tif ( texture2d ) {\r\n\r\n\t\t\t\tvar data = textureData[ texture2d.path ];\r\n\t\t\t\tvar type = texture2d.contenttype;\r\n\r\n\t\t\t\tvar blob = new Blob( [ data ], { type: type } );\r\n\t\t\t\tvar sourceURI = URL.createObjectURL( blob );\r\n\r\n\t\t\t\tvar texture = textureLoader.load( sourceURI, function () {\r\n\r\n\t\t\t\t\tURL.revokeObjectURL( sourceURI );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t\ttexture.encoding = sRGBEncoding;\r\n\r\n\t\t\t\t// texture parameters\r\n\r\n\t\t\t\tswitch ( texture2d.tilestyleu ) {\r\n\r\n\t\t\t\t\tcase 'wrap':\r\n\t\t\t\t\t\ttexture.wrapS = RepeatWrapping;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'mirror':\r\n\t\t\t\t\t\ttexture.wrapS = MirroredRepeatWrapping;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'none':\r\n\t\t\t\t\tcase 'clamp':\r\n\t\t\t\t\t\ttexture.wrapS = ClampToEdgeWrapping;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\ttexture.wrapS = RepeatWrapping;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch ( texture2d.tilestylev ) {\r\n\r\n\t\t\t\t\tcase 'wrap':\r\n\t\t\t\t\t\ttexture.wrapT = RepeatWrapping;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'mirror':\r\n\t\t\t\t\t\ttexture.wrapT = MirroredRepeatWrapping;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'none':\r\n\t\t\t\t\tcase 'clamp':\r\n\t\t\t\t\t\ttexture.wrapT = ClampToEdgeWrapping;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\ttexture.wrapT = RepeatWrapping;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch ( texture2d.filter ) {\r\n\r\n\t\t\t\t\tcase 'auto':\r\n\t\t\t\t\t\ttexture.magFilter = LinearFilter;\r\n\t\t\t\t\t\ttexture.minFilter = LinearMipmapLinearFilter;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'linear':\r\n\t\t\t\t\t\ttexture.magFilter = LinearFilter;\r\n\t\t\t\t\t\ttexture.minFilter = LinearFilter;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'nearest':\r\n\t\t\t\t\t\ttexture.magFilter = NearestFilter;\r\n\t\t\t\t\t\ttexture.minFilter = NearestFilter;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\ttexture.magFilter = LinearFilter;\r\n\t\t\t\t\t\ttexture.minFilter = LinearMipmapLinearFilter;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn texture;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildBasematerialsMeshes( basematerials, triangleProperties, modelData, meshData, textureData, objectData ) {\r\n\r\n\t\t\tvar objectPindex = objectData.pindex;\r\n\r\n\t\t\tvar materialMap = {};\r\n\r\n\t\t\tfor ( var i = 0, l = triangleProperties.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar triangleProperty = triangleProperties[ i ];\r\n\t\t\t\tvar pindex = ( triangleProperty.p1 !== undefined ) ? triangleProperty.p1 : objectPindex;\r\n\r\n\t\t\t\tif ( materialMap[ pindex ] === undefined ) materialMap[ pindex ] = [];\r\n\r\n\t\t\t\tmaterialMap[ pindex ].push( triangleProperty );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tvar keys = Object.keys( materialMap );\r\n\t\t\tvar meshes = [];\r\n\r\n\t\t\tfor ( var i = 0, l = keys.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar materialIndex = keys[ i ];\r\n\t\t\t\tvar trianglePropertiesProps = materialMap[ materialIndex ];\r\n\t\t\t\tvar basematerialData = basematerials.basematerials[ materialIndex ];\r\n\t\t\t\tvar material = getBuild( basematerialData, objects, modelData, textureData, objectData, buildBasematerial );\r\n\r\n\t\t\t\t//\r\n\r\n\t\t\t\tvar geometry = new BufferGeometry();\r\n\r\n\t\t\t\tvar positionData = [];\r\n\r\n\t\t\t\tvar vertices = meshData.vertices;\r\n\r\n\t\t\t\tfor ( var j = 0, jl = trianglePropertiesProps.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tvar triangleProperty = trianglePropertiesProps[ j ];\r\n\r\n\t\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v1 * 3 ) + 0 ] );\r\n\t\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v1 * 3 ) + 1 ] );\r\n\t\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v1 * 3 ) + 2 ] );\r\n\r\n\t\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v2 * 3 ) + 0 ] );\r\n\t\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v2 * 3 ) + 1 ] );\r\n\t\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v2 * 3 ) + 2 ] );\r\n\r\n\t\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v3 * 3 ) + 0 ] );\r\n\t\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v3 * 3 ) + 1 ] );\r\n\t\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v3 * 3 ) + 2 ] );\r\n\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( positionData, 3 ) );\r\n\r\n\t\t\t\t//\r\n\r\n\t\t\t\tvar mesh = new Mesh( geometry, material );\r\n\t\t\t\tmeshes.push( mesh );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn meshes;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildTexturedMesh( texture2dgroup, triangleProperties, modelData, meshData, textureData, objectData ) {\r\n\r\n\t\t\t// geometry\r\n\r\n\t\t\tvar geometry = new BufferGeometry();\r\n\r\n\t\t\tvar positionData = [];\r\n\t\t\tvar uvData = [];\r\n\r\n\t\t\tvar vertices = meshData.vertices;\r\n\t\t\tvar uvs = texture2dgroup.uvs;\r\n\r\n\t\t\tfor ( var i = 0, l = triangleProperties.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar triangleProperty = triangleProperties[ i ];\r\n\r\n\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v1 * 3 ) + 0 ] );\r\n\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v1 * 3 ) + 1 ] );\r\n\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v1 * 3 ) + 2 ] );\r\n\r\n\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v2 * 3 ) + 0 ] );\r\n\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v2 * 3 ) + 1 ] );\r\n\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v2 * 3 ) + 2 ] );\r\n\r\n\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v3 * 3 ) + 0 ] );\r\n\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v3 * 3 ) + 1 ] );\r\n\t\t\t\tpositionData.push( vertices[ ( triangleProperty.v3 * 3 ) + 2 ] );\r\n\r\n\t\t\t\t//\r\n\r\n\t\t\t\tuvData.push( uvs[ ( triangleProperty.p1 * 2 ) + 0 ] );\r\n\t\t\t\tuvData.push( uvs[ ( triangleProperty.p1 * 2 ) + 1 ] );\r\n\r\n\t\t\t\tuvData.push( uvs[ ( triangleProperty.p2 * 2 ) + 0 ] );\r\n\t\t\t\tuvData.push( uvs[ ( triangleProperty.p2 * 2 ) + 1 ] );\r\n\r\n\t\t\t\tuvData.push( uvs[ ( triangleProperty.p3 * 2 ) + 0 ] );\r\n\t\t\t\tuvData.push( uvs[ ( triangleProperty.p3 * 2 ) + 1 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( positionData, 3 ) );\r\n\t\t\tgeometry.setAttribute( 'uv', new Float32BufferAttribute( uvData, 2 ) );\r\n\r\n\t\t\t// material\r\n\r\n\t\t\tvar texture = getBuild( texture2dgroup, objects, modelData, textureData, objectData, buildTexture );\r\n\r\n\t\t\tvar material = new MeshPhongMaterial( { map: texture, flatShading: true } );\r\n\r\n\t\t\t// mesh\r\n\r\n\t\t\tvar mesh = new Mesh( geometry, material );\r\n\r\n\t\t\treturn mesh;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildVertexColorMesh( colorgroup, triangleProperties, modelData, meshData, objectData ) {\r\n\r\n\t\t\t// geometry\r\n\r\n\t\t\tvar geometry = new BufferGeometry();\r\n\r\n\t\t\tvar positionData = [];\r\n\t\t\tvar colorData = [];\r\n\r\n\t\t\tvar vertices = meshData.vertices;\r\n\t\t\tvar colors = colorgroup.colors;\r\n\r\n\t\t\tfor ( var i = 0, l = triangleProperties.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar triangleProperty = triangleProperties[ i ];\r\n\r\n\t\t\t\tvar v1 = triangleProperty.v1;\r\n\t\t\t\tvar v2 = triangleProperty.v2;\r\n\t\t\t\tvar v3 = triangleProperty.v3;\r\n\r\n\t\t\t\tpositionData.push( vertices[ ( v1 * 3 ) + 0 ] );\r\n\t\t\t\tpositionData.push( vertices[ ( v1 * 3 ) + 1 ] );\r\n\t\t\t\tpositionData.push( vertices[ ( v1 * 3 ) + 2 ] );\r\n\r\n\t\t\t\tpositionData.push( vertices[ ( v2 * 3 ) + 0 ] );\r\n\t\t\t\tpositionData.push( vertices[ ( v2 * 3 ) + 1 ] );\r\n\t\t\t\tpositionData.push( vertices[ ( v2 * 3 ) + 2 ] );\r\n\r\n\t\t\t\tpositionData.push( vertices[ ( v3 * 3 ) + 0 ] );\r\n\t\t\t\tpositionData.push( vertices[ ( v3 * 3 ) + 1 ] );\r\n\t\t\t\tpositionData.push( vertices[ ( v3 * 3 ) + 2 ] );\r\n\r\n\t\t\t\t//\r\n\r\n\t\t\t\tvar p1 = ( triangleProperty.p1 !== undefined ) ? triangleProperty.p1 : objectData.pindex;\r\n\t\t\t\tvar p2 = ( triangleProperty.p2 !== undefined ) ? triangleProperty.p2 : p1;\r\n\t\t\t\tvar p3 = ( triangleProperty.p3 !== undefined ) ? triangleProperty.p3 : p1;\r\n\r\n\t\t\t\tcolorData.push( colors[ ( p1 * 3 ) + 0 ] );\r\n\t\t\t\tcolorData.push( colors[ ( p1 * 3 ) + 1 ] );\r\n\t\t\t\tcolorData.push( colors[ ( p1 * 3 ) + 2 ] );\r\n\r\n\t\t\t\tcolorData.push( colors[ ( p2 * 3 ) + 0 ] );\r\n\t\t\t\tcolorData.push( colors[ ( p2 * 3 ) + 1 ] );\r\n\t\t\t\tcolorData.push( colors[ ( p2 * 3 ) + 2 ] );\r\n\r\n\t\t\t\tcolorData.push( colors[ ( p3 * 3 ) + 0 ] );\r\n\t\t\t\tcolorData.push( colors[ ( p3 * 3 ) + 1 ] );\r\n\t\t\t\tcolorData.push( colors[ ( p3 * 3 ) + 2 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( positionData, 3 ) );\r\n\t\t\tgeometry.setAttribute( 'color', new Float32BufferAttribute( colorData, 3 ) );\r\n\r\n\t\t\t// material\r\n\r\n\t\t\tvar material = new MeshPhongMaterial( { vertexColors: true, flatShading: true } );\r\n\r\n\t\t\t// mesh\r\n\r\n\t\t\tvar mesh = new Mesh( geometry, material );\r\n\r\n\t\t\treturn mesh;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildDefaultMesh( meshData ) {\r\n\r\n\t\t\tvar geometry = new BufferGeometry();\r\n\t\t\tgeometry.setIndex( new BufferAttribute( meshData[ 'triangles' ], 1 ) );\r\n\t\t\tgeometry.setAttribute( 'position', new BufferAttribute( meshData[ 'vertices' ], 3 ) );\r\n\r\n\t\t\tvar material = new MeshPhongMaterial( { color: 0xaaaaff, flatShading: true } );\r\n\r\n\t\t\tvar mesh = new Mesh( geometry, material );\r\n\r\n\t\t\treturn mesh;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildMeshes( resourceMap, modelData, meshData, textureData, objectData ) {\r\n\r\n\t\t\tvar keys = Object.keys( resourceMap );\r\n\t\t\tvar meshes = [];\r\n\r\n\t\t\tfor ( var i = 0, il = keys.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar resourceId = keys[ i ];\r\n\t\t\t\tvar triangleProperties = resourceMap[ resourceId ];\r\n\t\t\t\tvar resourceType = getResourceType( resourceId, modelData );\r\n\r\n\t\t\t\tswitch ( resourceType ) {\r\n\r\n\t\t\t\t\tcase 'material':\r\n\t\t\t\t\t\tvar basematerials = modelData.resources.basematerials[ resourceId ];\r\n\t\t\t\t\t\tvar newMeshes = buildBasematerialsMeshes( basematerials, triangleProperties, modelData, meshData, textureData, objectData );\r\n\r\n\t\t\t\t\t\tfor ( var j = 0, jl = newMeshes.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\t\tmeshes.push( newMeshes[ j ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'texture':\r\n\t\t\t\t\t\tvar texture2dgroup = modelData.resources.texture2dgroup[ resourceId ];\r\n\t\t\t\t\t\tmeshes.push( buildTexturedMesh( texture2dgroup, triangleProperties, modelData, meshData, textureData, objectData ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'vertexColors':\r\n\t\t\t\t\t\tvar colorgroup = modelData.resources.colorgroup[ resourceId ];\r\n\t\t\t\t\t\tmeshes.push( buildVertexColorMesh( colorgroup, triangleProperties, modelData, meshData, objectData ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'default':\r\n\t\t\t\t\t\tmeshes.push( buildDefaultMesh( meshData ) );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.error( 'THREE.3MFLoader: Unsupported resource type.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn meshes;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getResourceType( pid, modelData ) {\r\n\r\n\t\t\tif ( modelData.resources.texture2dgroup[ pid ] !== undefined ) {\r\n\r\n\t\t\t\treturn 'texture';\r\n\r\n\t\t\t} else if ( modelData.resources.basematerials[ pid ] !== undefined ) {\r\n\r\n\t\t\t\treturn 'material';\r\n\r\n\t\t\t} else if ( modelData.resources.colorgroup[ pid ] !== undefined ) {\r\n\r\n\t\t\t\treturn 'vertexColors';\r\n\r\n\t\t\t} else if ( pid === 'default' ) {\r\n\r\n\t\t\t\treturn 'default';\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn undefined;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction analyzeObject( modelData, meshData, objectData ) {\r\n\r\n\t\t\tvar resourceMap = {};\r\n\r\n\t\t\tvar triangleProperties = meshData[ 'triangleProperties' ];\r\n\r\n\t\t\tvar objectPid = objectData.pid;\r\n\r\n\t\t\tfor ( var i = 0, l = triangleProperties.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar triangleProperty = triangleProperties[ i ];\r\n\t\t\t\tvar pid = ( triangleProperty.pid !== undefined ) ? triangleProperty.pid : objectPid;\r\n\r\n\t\t\t\tif ( pid === undefined ) pid = 'default';\r\n\r\n\t\t\t\tif ( resourceMap[ pid ] === undefined ) resourceMap[ pid ] = [];\r\n\r\n\t\t\t\tresourceMap[ pid ].push( triangleProperty );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn resourceMap;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildGroup( meshData, objects, modelData, textureData, objectData ) {\r\n\r\n\t\t\tvar group = new Group();\r\n\r\n\t\t\tvar resourceMap = analyzeObject( modelData, meshData, objectData );\r\n\t\t\tvar meshes = buildMeshes( resourceMap, modelData, meshData, textureData, objectData );\r\n\r\n\t\t\tfor ( var i = 0, l = meshes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tgroup.add( meshes[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn group;\r\n\r\n\t\t}\r\n\r\n\t\tfunction applyExtensions( extensions, meshData, modelXml ) {\r\n\r\n\t\t\tif ( ! extensions ) {\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar availableExtensions = [];\r\n\t\t\tvar keys = Object.keys( extensions );\r\n\r\n\t\t\tfor ( var i = 0; i < keys.length; i ++ ) {\r\n\r\n\t\t\t\tvar ns = keys[ i ];\r\n\r\n\t\t\t\tfor ( var j = 0; j < scope.availableExtensions.length; j ++ ) {\r\n\r\n\t\t\t\t\tvar extension = scope.availableExtensions[ j ];\r\n\r\n\t\t\t\t\tif ( extension.ns === ns ) {\r\n\r\n\t\t\t\t\t\tavailableExtensions.push( extension );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var i = 0; i < availableExtensions.length; i ++ ) {\r\n\r\n\t\t\t\tvar extension = availableExtensions[ i ];\r\n\t\t\t\textension.apply( modelXml, extensions[ extension[ 'ns' ] ], meshData );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction getBuild( data, objects, modelData, textureData, objectData, builder ) {\r\n\r\n\t\t\tif ( data.build !== undefined ) return data.build;\r\n\r\n\t\t\tdata.build = builder( data, objects, modelData, textureData, objectData );\r\n\r\n\t\t\treturn data.build;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildBasematerial( materialData, objects, modelData ) {\r\n\r\n\t\t\tvar material;\r\n\r\n\t\t\tvar displaypropertiesid = materialData.displaypropertiesid;\r\n\t\t\tvar pbmetallicdisplayproperties = modelData.resources.pbmetallicdisplayproperties;\r\n\r\n\t\t\tif ( displaypropertiesid !== null && pbmetallicdisplayproperties[ displaypropertiesid ] !== undefined ) {\r\n\r\n\t\t\t\t// metallic display property, use StandardMaterial\r\n\r\n\t\t\t\tvar pbmetallicdisplayproperty = pbmetallicdisplayproperties[ displaypropertiesid ];\r\n\t\t\t\tvar metallicData = pbmetallicdisplayproperty.data[ materialData.index ];\r\n\r\n\t\t\t\tmaterial = new MeshStandardMaterial( { flatShading: true, roughness: metallicData.roughness, metalness: metallicData.metallicness } );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// otherwise use PhongMaterial\r\n\r\n\t\t\t\tmaterial = new MeshPhongMaterial( { flatShading: true } );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial.name = materialData.name;\r\n\r\n\t\t\t// displaycolor MUST be specified with a value of a 6 or 8 digit hexadecimal number, e.g. \"#RRGGBB\" or \"#RRGGBBAA\"\r\n\r\n\t\t\tvar displaycolor = materialData.displaycolor;\r\n\r\n\t\t\tvar color = displaycolor.substring( 0, 7 );\r\n\t\t\tmaterial.color.setStyle( color );\r\n\t\t\tmaterial.color.convertSRGBToLinear(); // displaycolor is in sRGB\r\n\r\n\t\t\t// process alpha if set\r\n\r\n\t\t\tif ( displaycolor.length === 9 ) {\r\n\r\n\t\t\t\tmaterial.opacity = parseInt( displaycolor.charAt( 7 ) + displaycolor.charAt( 8 ), 16 ) / 255;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn material;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildComposite( compositeData, objects, modelData, textureData ) {\r\n\r\n\t\t\tvar composite = new Group();\r\n\r\n\t\t\tfor ( var j = 0; j < compositeData.length; j ++ ) {\r\n\r\n\t\t\t\tvar component = compositeData[ j ];\r\n\t\t\t\tvar build = objects[ component.objectId ];\r\n\r\n\t\t\t\tif ( build === undefined ) {\r\n\r\n\t\t\t\t\tbuildObject( component.objectId, objects, modelData, textureData );\r\n\t\t\t\t\tbuild = objects[ component.objectId ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar object3D = build.clone();\r\n\r\n\t\t\t\t// apply component transform\r\n\r\n\t\t\t\tvar transform = component.transform;\r\n\r\n\t\t\t\tif ( transform ) {\r\n\r\n\t\t\t\t\tobject3D.applyMatrix4( transform );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcomposite.add( object3D );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn composite;\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildObject( objectId, objects, modelData, textureData ) {\r\n\r\n\t\t\tvar objectData = modelData[ 'resources' ][ 'object' ][ objectId ];\r\n\r\n\t\t\tif ( objectData[ 'mesh' ] ) {\r\n\r\n\t\t\t\tvar meshData = objectData[ 'mesh' ];\r\n\r\n\t\t\t\tvar extensions = modelData[ 'extensions' ];\r\n\t\t\t\tvar modelXml = modelData[ 'xml' ];\r\n\r\n\t\t\t\tapplyExtensions( extensions, meshData, modelXml );\r\n\r\n\t\t\t\tobjects[ objectData.id ] = getBuild( meshData, objects, modelData, textureData, objectData, buildGroup );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar compositeData = objectData[ 'components' ];\r\n\r\n\t\t\t\tobjects[ objectData.id ] = getBuild( compositeData, objects, modelData, textureData, objectData, buildComposite );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction buildObjects( data3mf ) {\r\n\r\n\t\t\tvar modelsData = data3mf.model;\r\n\t\t\tvar modelRels = data3mf.modelRels;\r\n\t\t\tvar objects = {};\r\n\t\t\tvar modelsKeys = Object.keys( modelsData );\r\n\t\t\tvar textureData = {};\r\n\r\n\t\t\t// evaluate model relationships to textures\r\n\r\n\t\t\tif ( modelRels ) {\r\n\r\n\t\t\t\tfor ( var i = 0, l = modelRels.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\tvar modelRel = modelRels[ i ];\r\n\t\t\t\t\tvar textureKey = modelRel.target.substring( 1 );\r\n\r\n\t\t\t\t\tif ( data3mf.texture[ textureKey ] ) {\r\n\r\n\t\t\t\t\t\ttextureData[ modelRel.target ] = data3mf.texture[ textureKey ];\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// start build\r\n\r\n\t\t\tfor ( var i = 0; i < modelsKeys.length; i ++ ) {\r\n\r\n\t\t\t\tvar modelsKey = modelsKeys[ i ];\r\n\t\t\t\tvar modelData = modelsData[ modelsKey ];\r\n\r\n\t\t\t\tvar objectIds = Object.keys( modelData[ 'resources' ][ 'object' ] );\r\n\r\n\t\t\t\tfor ( var j = 0; j < objectIds.length; j ++ ) {\r\n\r\n\t\t\t\t\tvar objectId = objectIds[ j ];\r\n\r\n\t\t\t\t\tbuildObject( objectId, objects, modelData, textureData );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn objects;\r\n\r\n\t\t}\r\n\r\n\t\tfunction build( objects, data3mf ) {\r\n\r\n\t\t\tvar group = new Group();\r\n\r\n\t\t\tvar relationship = data3mf[ 'rels' ][ 0 ];\r\n\t\t\tvar buildData = data3mf.model[ relationship[ 'target' ].substring( 1 ) ][ 'build' ];\r\n\r\n\t\t\tfor ( var i = 0; i < buildData.length; i ++ ) {\r\n\r\n\t\t\t\tvar buildItem = buildData[ i ];\r\n\t\t\t\tvar object3D = objects[ buildItem[ 'objectId' ] ];\r\n\r\n\t\t\t\t// apply transform\r\n\r\n\t\t\t\tvar transform = buildItem[ 'transform' ];\r\n\r\n\t\t\t\tif ( transform ) {\r\n\r\n\t\t\t\t\tobject3D.applyMatrix4( transform );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgroup.add( object3D );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn group;\r\n\r\n\t\t}\r\n\r\n\t\tvar data3mf = loadDocument( data );\r\n\t\tvar objects = buildObjects( data3mf );\r\n\r\n\t\treturn build( objects, data3mf );\r\n\r\n\t},\r\n\r\n\taddExtension: function ( extension ) {\r\n\r\n\t\tthis.availableExtensions.push( extension );\r\n\r\n\t}\r\n\r\n} );\r\n\r\nexport { ThreeMFLoader };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/loaders/3MFLoader.js","<template>\r\n    <div class=\"webglLoader3mfMaterials-container\">\r\n        <div id=\"info\">\r\n\t\t\t<a href=\"https://threejs.org\" target=\"_blank\" rel=\"noopener\">three.js</a> -\r\n\t\t\t<a href=\"http://3mf.io\" target=\"_blank\" rel=\"noopener\">3MF</a> file with materials\r\n\t\t</div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { OrbitControls } from '@/components/jsm/controls/OrbitControls.js';\r\nimport { ThreeMFLoader } from '@/components/jsm/loaders/3MFLoader.js'\r\nexport default {\r\n    data() {\r\n        return {\r\n            camera: null,\r\n            scene: null,\r\n            renderer: null,\r\n        }\r\n    },\r\n    mounted() {\r\n        this.init()\r\n    },\r\n    methods: {\r\n        init() {\r\n            this.scene = new this.$THREE.Scene()\r\n            this.scene.background = new this.$THREE.Color(0xa0a0a0)\r\n            this.scene.fog = new this.$THREE.Fog(0xa0a0a0, 10, 500)\r\n            this.camera = new this.$THREE.PerspectiveCamera(35, this.$webglInnerWidth / window.innerHeight, 1, 500)\r\n            this.camera.position.set(- 50, 40, 50)\r\n            this.scene.add(this.camera)\r\n            //\r\n            var hemiLight = new this.$THREE.HemisphereLight(0xffffff, 0x444444)\r\n            hemiLight.position.set(0, 100, 0)\r\n            this.scene.add(hemiLight)\r\n            var dirLight = new this.$THREE.DirectionalLight(0xffffff)\r\n            dirLight.position.set(- 0, 40, 50)\r\n            dirLight.castShadow = true\r\n            dirLight.shadow.camera.top = 50\r\n            dirLight.shadow.camera.bottom = - 25\r\n            dirLight.shadow.camera.left = - 25\r\n            dirLight.shadow.camera.right = 25\r\n            dirLight.shadow.camera.near = 0.1\r\n            dirLight.shadow.camera.far = 200\r\n            dirLight.shadow.mapSize.set(1024, 1024)\r\n            this.scene.add(dirLight)\r\n            // this.scene.add(new this.$THREE.CameraHelper(dirLight.shadow.camera))\r\n            //\r\n            var manager = new this.$THREE.LoadingManager()\r\n            var loader = new ThreeMFLoader(manager)\r\n            loader.load('static/models/3mf/truck.3mf', (object) => {\r\n                object.quaternion.setFromEuler(new this.$THREE.Euler(- Math.PI / 2, 0, 0)) \t// z-up conversion\r\n                object.traverse((child) => {\r\n                    child.castShadow = true\r\n                })\r\n                this.scene.add(object)\r\n            })\r\n            //\r\n            manager.onLoad = () => {\r\n                this.render()\r\n            }\r\n            //\r\n            var ground = new this.$THREE.Mesh(new this.$THREE.PlaneBufferGeometry(1000, 1000), new this.$THREE.MeshPhongMaterial({ color: 0x999999, depthWrite: false }))\r\n            ground.rotation.x = - Math.PI / 2\r\n            ground.position.y = 11\r\n            ground.receiveShadow = true\r\n            this.scene.add(ground)\r\n            //\r\n            this.renderer = new this.$THREE.WebGLRenderer({ antialias: true })\r\n            this.renderer.setPixelRatio(window.devicePixelRatio)\r\n            this.renderer.setSize(this.$webglInnerWidth, window.innerHeight)\r\n            this.renderer.outputEncoding = this.$THREE.sRGBEncoding\r\n            this.renderer.shadowMap.enabled = true\r\n            this.renderer.shadowMap.type = this.$THREE.PCFSoftShadowMap\r\n            document.getElementsByClassName('webglLoader3mfMaterials-container')[0].appendChild(this.renderer.domElement)\r\n            //\r\n            var controls = new OrbitControls(this.camera, this.renderer.domElement)\r\n            controls.addEventListener('change', this.render)\r\n            controls.minDistance = 50\r\n            controls.maxDistance = 200\r\n            controls.enablePan = false\r\n            controls.target.set(0, 20, 0)\r\n            controls.update()\r\n            window.addEventListener('resize', this.onWindowResize, false)\r\n            this.render()\r\n        },\r\n        onWindowResize() {\r\n            this.$onWindowResize(this.camera, this.renderer)\r\n            this.render()\r\n        },\r\n        render() {\r\n            this.renderer.render(this.scene, this.camera)\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.webglLoader3mfMaterials-container {\r\n    width: 100%;\r\n    background-color: #a0a0a0;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/views/loader/webglLoader3mfMaterials.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"webglLoader3mfMaterials-container\"},[_c('div',{attrs:{\"id\":\"info\"}},[_c('a',{attrs:{\"href\":\"https://threejs.org\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"three.js\")]),_vm._v(\" -\\n\\t\\t\\t\"),_c('a',{attrs:{\"href\":\"http://3mf.io\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"3MF\")]),_vm._v(\" file with materials\\n\\t\\t\")])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-0b5787d7\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/loader/webglLoader3mfMaterials.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-0b5787d7\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./webglLoader3mfMaterials.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglLoader3mfMaterials.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglLoader3mfMaterials.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-0b5787d7\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./webglLoader3mfMaterials.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-0b5787d7\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/loader/webglLoader3mfMaterials.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}