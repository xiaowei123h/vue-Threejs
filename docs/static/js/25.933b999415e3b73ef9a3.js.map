{"version":3,"sources":["webpack:///./src/components/jsm/loaders/VOXLoader.js","webpack:///src/views/volume/webgl2VolumeInstancing.vue","webpack:///./src/views/volume/webgl2VolumeInstancing.vue?a96f","webpack:///./src/views/volume/webgl2VolumeInstancing.vue"],"names":["__webpack_require__","d","__webpack_exports__","VOXLoader","__WEBPACK_IMPORTED_MODULE_0__components_build_three_module_js__","manager","Loader","call","this","prototype","Object","assign","create","constructor","load","url","onLoad","onProgress","onError","scope","loader","FileLoader","setPath","path","setResponseType","setRequestHeader","requestHeader","buffer","parse","e","console","error","itemError","data","DataView","id","getInt32","version","getUint32","DEFAULT_PALETTE","i","chunk","chunks","byteLength","j","String","fromCharCode","getInt8","chunkSize","x","y","z","palette","size","push","numVoxels","Int8Array","webgl2VolumeInstancing","renderer","scene","camera","controls","mounted","WebGL","isWebGL2Available","document","getElementsByClassName","appendChild","getWebGL2ErrorMessage","init","animate","methods","_this","$THREE","WebGLRenderer","setPixelRatio","window","devicePixelRatio","setSize","$webglInnerWidth","innerHeight","domElement","Scene","PerspectiveCamera","position","set","OrbitControls","autoRotate","autoRotateSpeed","enableDamping","length","array","Uint8Array","k","texture","DataTexture3D","format","RedFormat","minFilter","NearestFilter","magFilter","LinearFilter","unpackAlignment","geometry","BoxBufferGeometry","material","RawShaderMaterial","glslVersion","GLSL3","uniforms","map","value","cameraPos","Vector3","vertexShader","fragmentShader","side","BackSide","mesh","InstancedMesh","onBeforeRender","copy","transform","Object3D","_i","count","random","subScalar","multiplyScalar","rotation","Math","PI","updateMatrix","setMatrixAt","matrix","add","addEventListener","onWindowResize","$onWindowResize","requestAnimationFrame","update","render","volume_webgl2VolumeInstancing","$createElement","_self","_c","_m","staticRenderFns","_h","staticClass","attrs","href","target","rel","_v","Component","normalizeComponent","ssrContext"],"mappings":"uDAAAA,EAAAC,EAAAC,EAAA,sBAAAC,IAAA,IAAAC,EAAAJ,EAAA,QAKA,SAASG,EAAWE,GAEnBC,MAAOC,KAAMC,KAAMH,GAIpBF,EAAUM,UAAYC,OAAOC,OAAQD,OAAOE,OAAQN,MAAOG,YAE1DI,YAAaV,EAEbW,KAAM,SAAWC,EAAKC,EAAQC,EAAYC,GAEzC,IAAIC,EAAQX,KAERY,EAAS,IAAIC,IAAYF,EAAMd,SACnCe,EAAOE,QAASH,EAAMI,MACtBH,EAAOI,gBAAiB,eACxBJ,EAAOK,iBAAkBN,EAAMO,eAC/BN,EAAON,KAAMC,EAAK,SAAWY,GAE5B,IAECX,EAAQG,EAAMS,MAAOD,IAEpB,MAAQE,GAEJX,EAEJA,EAASW,GAITC,QAAQC,MAAOF,GAIhBV,EAAMd,QAAQ2B,UAAWjB,KAIxBE,EAAYC,IAIhBU,MAAO,SAAWD,GAEjB,IAAMM,EAAO,IAAIC,SAAUP,GAErBQ,EAAKF,EAAKG,SAAU,GAAG,GACvBC,EAAUJ,EAAKK,UAAW,GAAG,GAEnC,GAAY,YAAPH,GAAgC,MAAZE,EAAzB,CA+CA,IAxCA,IAAME,GACL,EAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAGjFC,EAAI,EAEJC,SACEC,KAEEF,EAAIP,EAAKU,YAAa,CAI7B,IAFA,IAAIR,EAAK,GAECS,EAAI,EAAGA,EAAI,EAAGA,IAEvBT,GAAMU,OAAOC,aAAcb,EAAKc,QAASP,KAAM,IAIhD,IAAMQ,EAAYf,EAAKG,SAAUI,GAAG,GAGpC,GAH4CA,GAAK,EACjDP,EAAKG,SAAUI,GAAG,GAAQA,GAAK,EAEnB,SAAPL,EAAgB,CAEpB,IAAMc,EAAIhB,EAAKG,SAAUI,GAAG,GAAQA,GAAK,EACzC,IAAMU,EAAIjB,EAAKG,SAAUI,GAAG,GAAQA,GAAK,EACzC,IAAMW,EAAIlB,EAAKG,SAAUI,GAAG,GAAQA,GAAK,EAEzCC,GACCW,QAASb,EACTc,MAAQJ,EAAGA,EAAGC,EAAGA,EAAGC,EAAGA,IAGxBT,EAAOY,KAAMb,GAEbD,GAAKQ,EAAc,QAEb,GAAY,SAAPb,EAAgB,CAE3B,IAAMoB,EAAYtB,EAAKG,SAAUI,GAAG,GAAQA,GAAK,EACjDC,EAAMR,KAAO,IAAIuB,UAAW7B,EAAQa,EAAe,EAAZe,GAEvCf,GAAiB,EAAZe,OAEC,GAAY,SAAPpB,EAAgB,CAI3B,IAFA,IAAMiB,GAAY,GAERR,EAAI,EAAGA,EAAI,IAAKA,IAEzBQ,EAASR,EAAI,GAAMX,EAAKG,SAAUI,GAAG,GAAQA,GAAK,EAInDC,EAAMW,QAAUA,OAMhBZ,GAAKQ,EAMP,OAAON,EAtGNZ,QAAQC,MAAO,8KC9ClB0B,GACAxB,KADA,WAEA,OACAyB,SAAA,KACAC,MAAA,KACAC,OAAA,KACAC,SAAA,OAGAC,QATA,YAUA,IAAAC,EAAA,EAAAC,qBACAC,SAAAC,uBAAA,uCAAAC,YAAAJ,EAAA,EAAAK,yBAEA5D,KAAA6D,OACA7D,KAAA8D,WAEAC,SACAF,KADA,WACA,IAAAG,EAAAhE,KACAA,KAAAkD,SAAA,IAAAlD,KAAAiE,OAAAC,cACAlE,KAAAkD,SAAAiB,cAAAC,OAAAC,kBACArE,KAAAkD,SAAAoB,QAAAtE,KAAAuE,iBAAAH,OAAAI,aACAf,SAAAC,uBAAA,uCAAAC,YAAA3D,KAAAkD,SAAAuB,YACAzE,KAAAmD,MAAA,IAAAnD,KAAAiE,OAAAS,MACA1E,KAAAoD,OAAA,IAAApD,KAAAiE,OAAAU,kBAAA,GAAA3E,KAAAuE,iBAAAH,OAAAI,YAAA,QACAxE,KAAAoD,OAAAwB,SAAAC,IAAA,OACA7E,KAAAqD,SAAA,IAAAyB,EAAA,EAAA9E,KAAAoD,OAAApD,KAAAkD,SAAAuB,YACAzE,KAAAqD,SAAA0B,YAAA,EACA/E,KAAAqD,SAAA2B,iBAAA,EACAhF,KAAAqD,SAAA4B,eAAA,GA+EA,IAAAtF,EAAA,GACAW,KAAA,wCAAA4B,GACA,QAAAF,EAAA,EAAAA,EAAAE,EAAAgD,OAAAlD,IAAA,CAKA,IAJA,IAAAC,EAAAC,EAAAF,GACAP,EAAAQ,EAAAR,KACAoB,EAAAZ,EAAAY,KACAsC,EAAA,IAAAC,WAAAvC,EAAAJ,EAAAI,EAAAH,EAAAG,EAAAF,GACAP,EAAA,EAAAiD,EAAA,EAAAjD,EAAAX,EAAAyD,OAAA9C,GAAA,EAAAiD,IAAA,CACA,IAAA5C,EAAAhB,EAAAW,EAAA,GACAM,EAAAjB,EAAAW,EAAA,GACAO,EAAAlB,EAAAW,EAAA,GAEA+C,EADA1C,EAAAC,EAAAG,EAAAJ,EAAAE,EAAAE,EAAAJ,EAAAI,EAAAH,GACA,IAEA,IAAA4C,EAAA,IAAAtB,EAAAC,OAAAsB,cAAAJ,EAAAtC,EAAAJ,EAAAI,EAAAH,EAAAG,EAAAF,GACA2C,EAAAE,OAAAxB,EAAAC,OAAAwB,UACAH,EAAAI,UAAA1B,EAAAC,OAAA0B,cACAL,EAAAM,UAAA5B,EAAAC,OAAA4B,aACAP,EAAAQ,gBAAA,EACA,IAAAC,EAAA,IAAA/B,EAAAC,OAAA+B,kBAAA,OACAC,EAAA,IAAAjC,EAAAC,OAAAiC,mBACAC,YAAAnC,EAAAC,OAAAmC,MACAC,UACAC,KAAAC,MAAAjB,GACAkB,WAAAD,MAAA,IAAAvC,EAAAC,OAAAwC,UAEAC,aAvGA,ysBAwGAC,eAxFA,ikGAyFAC,KAAA5C,EAAAC,OAAA4C,WAEAC,EAAA,IAAA9C,EAAAC,OAAA8C,cAAAhB,EAAAE,EAAA,KACAa,EAAAE,eAAA,WACAf,EAAAI,SAAAG,UAAAD,MAAAU,KAAAjD,EAAAZ,OAAAwB,WAGA,IADA,IAAAsC,EAAA,IAAAlD,EAAAC,OAAAkD,SACAC,EAAA,EAAAA,EAAAN,EAAAO,MAAAD,IACAF,EAAAtC,SAAA0C,SAAAC,UAAA,IAAAC,eAAA,KACAN,EAAAO,SAAAhF,EAAAiF,KAAAJ,SAAAI,KAAAC,GACAT,EAAAO,SAAA/E,EAAAgF,KAAAJ,SAAAI,KAAAC,GACAT,EAAAO,SAAA9E,EAAA+E,KAAAJ,SAAAI,KAAAC,GACAT,EAAAU,eACAd,EAAAe,YAAAT,EAAAF,EAAAY,QAEA9D,EAAAb,MAAA4E,IAAAjB,MAGA1C,OAAA4D,iBAAA,SAAAhI,KAAAiI,gBAAA,IAEAA,eA3IA,WA4IAjI,KAAAkI,gBAAAlI,KAAAoD,OAAApD,KAAAkD,WAEAY,QA9IA,WA+IAqE,sBAAAnI,KAAA8D,SACA9D,KAAAqD,SAAA+E,SACApI,KAAAkD,SAAAmF,OAAArI,KAAAmD,MAAAnD,KAAAoD,WC1KekF,GADED,OAFjB,WAA0BrI,KAAauI,eAAbvI,KAAuCwI,MAAAC,GAAwB,OAA/DzI,KAA+D0I,GAAA,IAExEC,iBADjB,WAAoC,IAAaC,EAAb5I,KAAauI,eAA0BE,EAAvCzI,KAAuCwI,MAAAC,IAAAG,EAAwB,OAAAH,EAAA,OAAiBI,YAAA,qCAA+CJ,EAAA,OAAYK,OAAOnH,GAAA,UAAa8G,EAAA,KAAUK,OAAOC,KAAA,sBAAAC,OAAA,SAAAC,IAAA,cAAhLjJ,KAAiPkJ,GAAA,cAAjPlJ,KAAiPkJ,GAAA,8CCErR,IAcAC,EAdyB3J,EAAQ,OAcjC4J,CACEnG,EACAqF,GATF,EAVA,SAAAe,GACE7J,EAAQ,SAaV,kBAEA,MAUeE,EAAA,QAAAyJ,EAAiB","file":"static/js/25.933b999415e3b73ef9a3.js","sourcesContent":["import {\r\n\tFileLoader,\r\n\tLoader\r\n} from \"@/components/build/three.module.js\";\r\n\r\nfunction VOXLoader( manager ) {\r\n\r\n\tLoader.call( this, manager );\r\n\r\n}\r\n\r\nVOXLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\tconstructor: VOXLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar loader = new FileLoader( scope.manager );\r\n\t\tloader.setPath( scope.path );\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\t\tloader.setRequestHeader( scope.requestHeader );\r\n\t\tloader.load( url, function ( buffer ) {\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\tonLoad( scope.parse( buffer ) );\r\n\r\n\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\tif ( onError ) {\r\n\r\n\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.manager.itemError( url );\r\n\r\n\t\t\t}\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tparse: function ( buffer ) {\r\n\r\n\t\tconst data = new DataView( buffer );\r\n\r\n\t\tconst id = data.getInt32( 0, true );\r\n\t\tconst version = data.getUint32( 4, true );\r\n\r\n\t\tif ( id !== 542658390 || version !== 150 ) {\r\n\r\n\t\t\tconsole.error( 'Not a valid VOX file' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tconst DEFAULT_PALETTE = [\r\n\t\t\t0x00000000, 0xffffffff, 0xffccffff, 0xff99ffff, 0xff66ffff, 0xff33ffff, 0xff00ffff, 0xffffccff,\r\n\t\t\t0xffccccff, 0xff99ccff, 0xff66ccff, 0xff33ccff, 0xff00ccff, 0xffff99ff, 0xffcc99ff, 0xff9999ff,\r\n\t\t\t0xff6699ff, 0xff3399ff, 0xff0099ff, 0xffff66ff, 0xffcc66ff, 0xff9966ff, 0xff6666ff, 0xff3366ff,\r\n\t\t\t0xff0066ff, 0xffff33ff, 0xffcc33ff, 0xff9933ff, 0xff6633ff, 0xff3333ff, 0xff0033ff, 0xffff00ff,\r\n\t\t\t0xffcc00ff, 0xff9900ff, 0xff6600ff, 0xff3300ff, 0xff0000ff, 0xffffffcc, 0xffccffcc, 0xff99ffcc,\r\n\t\t\t0xff66ffcc, 0xff33ffcc, 0xff00ffcc, 0xffffcccc, 0xffcccccc, 0xff99cccc, 0xff66cccc, 0xff33cccc,\r\n\t\t\t0xff00cccc, 0xffff99cc, 0xffcc99cc, 0xff9999cc, 0xff6699cc, 0xff3399cc, 0xff0099cc, 0xffff66cc,\r\n\t\t\t0xffcc66cc, 0xff9966cc, 0xff6666cc, 0xff3366cc, 0xff0066cc, 0xffff33cc, 0xffcc33cc, 0xff9933cc,\r\n\t\t\t0xff6633cc, 0xff3333cc, 0xff0033cc, 0xffff00cc, 0xffcc00cc, 0xff9900cc, 0xff6600cc, 0xff3300cc,\r\n\t\t\t0xff0000cc, 0xffffff99, 0xffccff99, 0xff99ff99, 0xff66ff99, 0xff33ff99, 0xff00ff99, 0xffffcc99,\r\n\t\t\t0xffcccc99, 0xff99cc99, 0xff66cc99, 0xff33cc99, 0xff00cc99, 0xffff9999, 0xffcc9999, 0xff999999,\r\n\t\t\t0xff669999, 0xff339999, 0xff009999, 0xffff6699, 0xffcc6699, 0xff996699, 0xff666699, 0xff336699,\r\n\t\t\t0xff006699, 0xffff3399, 0xffcc3399, 0xff993399, 0xff663399, 0xff333399, 0xff003399, 0xffff0099,\r\n\t\t\t0xffcc0099, 0xff990099, 0xff660099, 0xff330099, 0xff000099, 0xffffff66, 0xffccff66, 0xff99ff66,\r\n\t\t\t0xff66ff66, 0xff33ff66, 0xff00ff66, 0xffffcc66, 0xffcccc66, 0xff99cc66, 0xff66cc66, 0xff33cc66,\r\n\t\t\t0xff00cc66, 0xffff9966, 0xffcc9966, 0xff999966, 0xff669966, 0xff339966, 0xff009966, 0xffff6666,\r\n\t\t\t0xffcc6666, 0xff996666, 0xff666666, 0xff336666, 0xff006666, 0xffff3366, 0xffcc3366, 0xff993366,\r\n\t\t\t0xff663366, 0xff333366, 0xff003366, 0xffff0066, 0xffcc0066, 0xff990066, 0xff660066, 0xff330066,\r\n\t\t\t0xff000066, 0xffffff33, 0xffccff33, 0xff99ff33, 0xff66ff33, 0xff33ff33, 0xff00ff33, 0xffffcc33,\r\n\t\t\t0xffcccc33, 0xff99cc33, 0xff66cc33, 0xff33cc33, 0xff00cc33, 0xffff9933, 0xffcc9933, 0xff999933,\r\n\t\t\t0xff669933, 0xff339933, 0xff009933, 0xffff6633, 0xffcc6633, 0xff996633, 0xff666633, 0xff336633,\r\n\t\t\t0xff006633, 0xffff3333, 0xffcc3333, 0xff993333, 0xff663333, 0xff333333, 0xff003333, 0xffff0033,\r\n\t\t\t0xffcc0033, 0xff990033, 0xff660033, 0xff330033, 0xff000033, 0xffffff00, 0xffccff00, 0xff99ff00,\r\n\t\t\t0xff66ff00, 0xff33ff00, 0xff00ff00, 0xffffcc00, 0xffcccc00, 0xff99cc00, 0xff66cc00, 0xff33cc00,\r\n\t\t\t0xff00cc00, 0xffff9900, 0xffcc9900, 0xff999900, 0xff669900, 0xff339900, 0xff009900, 0xffff6600,\r\n\t\t\t0xffcc6600, 0xff996600, 0xff666600, 0xff336600, 0xff006600, 0xffff3300, 0xffcc3300, 0xff993300,\r\n\t\t\t0xff663300, 0xff333300, 0xff003300, 0xffff0000, 0xffcc0000, 0xff990000, 0xff660000, 0xff330000,\r\n\t\t\t0xff0000ee, 0xff0000dd, 0xff0000bb, 0xff0000aa, 0xff000088, 0xff000077, 0xff000055, 0xff000044,\r\n\t\t\t0xff000022, 0xff000011, 0xff00ee00, 0xff00dd00, 0xff00bb00, 0xff00aa00, 0xff008800, 0xff007700,\r\n\t\t\t0xff005500, 0xff004400, 0xff002200, 0xff001100, 0xffee0000, 0xffdd0000, 0xffbb0000, 0xffaa0000,\r\n\t\t\t0xff880000, 0xff770000, 0xff550000, 0xff440000, 0xff220000, 0xff110000, 0xffeeeeee, 0xffdddddd,\r\n\t\t\t0xffbbbbbb, 0xffaaaaaa, 0xff888888, 0xff777777, 0xff555555, 0xff444444, 0xff222222, 0xff111111\r\n\t\t];\r\n\r\n\t\tlet i = 8;\r\n\r\n\t\tlet chunk;\r\n\t\tconst chunks = [];\r\n\r\n\t\twhile ( i < data.byteLength ) {\r\n\r\n\t\t\tlet id = '';\r\n\r\n\t\t\tfor ( let j = 0; j < 4; j ++ ) {\r\n\r\n\t\t\t\tid += String.fromCharCode( data.getInt8( i ++, true ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst chunkSize = data.getInt32( i, true ); i += 4;\r\n\t\t\tdata.getInt32( i, true ); i += 4; // childChunks\r\n\r\n\t\t\tif ( id === 'SIZE' ) {\r\n\r\n\t\t\t\tconst x = data.getInt32( i, true ); i += 4;\r\n\t\t\t\tconst y = data.getInt32( i, true ); i += 4;\r\n\t\t\t\tconst z = data.getInt32( i, true ); i += 4;\r\n\r\n\t\t\t\tchunk = {\r\n\t\t\t\t\tpalette: DEFAULT_PALETTE,\r\n\t\t\t\t\tsize: { x: x, y: y, z: z },\r\n\t\t\t\t};\r\n\r\n\t\t\t\tchunks.push( chunk );\r\n\r\n\t\t\t\ti += chunkSize - ( 3 * 4 );\r\n\r\n\t\t\t} else if ( id === 'XYZI' ) {\r\n\r\n\t\t\t\tconst numVoxels = data.getInt32( i, true ); i += 4;\r\n\t\t\t\tchunk.data = new Int8Array( buffer, i, numVoxels * 4 );\r\n\r\n\t\t\t\ti += numVoxels * 4;\r\n\r\n\t\t\t} else if ( id === 'RGBA' ) {\r\n\r\n\t\t\t\tconst palette = [ 0 ];\r\n\r\n\t\t\t\tfor ( let j = 0; j < 256; j ++ ) {\r\n\r\n\t\t\t\t\tpalette[ j + 1 ] = data.getInt32( i, true ); i += 4;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tchunk.palette = palette;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// console.log( id, chunkSize, childChunks );\r\n\r\n\t\t\t\ti += chunkSize;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn chunks;\r\n\r\n\t}\r\n\r\n} );\r\n\r\nexport { VOXLoader };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/loaders/VOXLoader.js","<template>\r\n    <div class=\"webgl2VolumeInstancing-container\">\r\n        <div id=\"info\">\r\n\t\t\t<a href=\"https://threejs.org\" target=\"_blank\" rel=\"noopener\">three.js</a> webgl2 - volume - instancing\r\n\t\t</div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { OrbitControls } from '@/components/jsm/controls/OrbitControls.js'\r\nimport { VOXLoader } from '@/components/jsm/loaders/VOXLoader.js'\r\nimport { WEBGL } from '@/components/jsm/WebGL.js'\r\nexport default {\r\n    data() {\r\n        return {\r\n            renderer: null,\r\n            scene: null,\r\n            camera: null,\r\n\t\t\tcontrols: null,\r\n        }\r\n    },\r\n    mounted() {\r\n        if (WEBGL.isWebGL2Available() === false) {\r\n            document.getElementsByClassName('webgl2VolumeInstancing-container')[0].appendChild(WEBGL.getWebGL2ErrorMessage())\r\n        }\r\n        this.init()\r\n\t\tthis.animate()\r\n    },\r\n    methods: {\r\n        init() {\r\n            this.renderer = new this.$THREE.WebGLRenderer()\r\n            this.renderer.setPixelRatio(window.devicePixelRatio)\r\n            this.renderer.setSize(this.$webglInnerWidth, window.innerHeight)\r\n            document.getElementsByClassName('webgl2VolumeInstancing-container')[0].appendChild(this.renderer.domElement)\r\n            this.scene = new this.$THREE.Scene()\r\n            this.camera = new this.$THREE.PerspectiveCamera(60, this.$webglInnerWidth / window.innerHeight, 0.1, 1000)\r\n            this.camera.position.set(0, 0, 4)\r\n            this.controls = new OrbitControls(this.camera, this.renderer.domElement)\r\n            this.controls.autoRotate = true\r\n            this.controls.autoRotateSpeed = - 1.0\r\n            this.controls.enableDamping = true\r\n            // Material\r\n            var vertexShader = /* glsl */`\r\n                in vec3 position;\r\n                in mat4 instanceMatrix;\r\n                uniform mat4 modelMatrix;\r\n                uniform mat4 modelViewMatrix;\r\n                uniform mat4 projectionMatrix;\r\n                uniform vec3 cameraPos;\r\n                out vec3 vOrigin;\r\n                out vec3 vDirection;\r\n                void main() {\r\n                    vec4 mvPosition = modelViewMatrix * instanceMatrix * vec4(position, 1.0);\r\n                    vOrigin = vec3(inverse(instanceMatrix * modelMatrix) * vec4(cameraPos, 1.0)).xyz;\r\n                    vDirection = position - vOrigin;\r\n                    gl_Position = projectionMatrix * mvPosition;\r\n                }\r\n            `\r\n            var fragmentShader = /* glsl */`\r\n                precision highp float;\r\n                precision highp sampler3D;\r\n                uniform mat4 modelViewMatrix;\r\n                uniform mat4 projectionMatrix;\r\n                in vec3 vOrigin;\r\n                in vec3 vDirection;\r\n                out vec4 color;\r\n                uniform sampler3D map;\r\n                uniform float threshold;\r\n                uniform float steps;\r\n                vec2 hitBox(vec3 orig, vec3 dir) {\r\n                    const vec3 box_min = vec3(- 0.5);\r\n                    const vec3 box_max = vec3(0.5);\r\n                    vec3 inv_dir = 1.0 / dir;\r\n                    vec3 tmin_tmp = (box_min - orig) * inv_dir;\r\n                    vec3 tmax_tmp = (box_max - orig) * inv_dir;\r\n                    vec3 tmin = min(tmin_tmp, tmax_tmp);\r\n                    vec3 tmax = max(tmin_tmp, tmax_tmp);\r\n                    float t0 = max(tmin.x, max(tmin.y, tmin.z));\r\n                    float t1 = min(tmax.x, min(tmax.y, tmax.z));\r\n                    return vec2(t0, t1);\r\n                }\r\n                float sample1(vec3 p) {\r\n                    return texture(map, p).r;\r\n                }\r\n                #define epsilon .0001\r\n                vec3 normal(vec3 coord) {\r\n                    if (coord.x < epsilon) return vec3(1.0, 0.0, 0.0);\r\n                    if (coord.y < epsilon) return vec3(0.0, 1.0, 0.0);\r\n                    if (coord.z < epsilon) return vec3(0.0, 0.0, 1.0);\r\n                    if (coord.x > 1.0 - epsilon) return vec3(- 1.0, 0.0, 0.0);\r\n                    if (coord.y > 1.0 - epsilon) return vec3(0.0, - 1.0, 0.0);\r\n                    if (coord.z > 1.0 - epsilon) return vec3(0.0, 0.0, - 1.0);\r\n                    float step = 0.01;\r\n                    float x = sample1(coord + vec3(- step, 0.0, 0.0)) - sample1(coord + vec3(step, 0.0, 0.0));\r\n                    float y = sample1(coord + vec3(0.0, - step, 0.0)) - sample1(coord + vec3(0.0, step, 0.0));\r\n                    float z = sample1(coord + vec3(0.0, 0.0, - step)) - sample1(coord + vec3(0.0, 0.0, step));\r\n                    return normalize(vec3(x, y, z));\r\n                }\r\n                void main(){\r\n                    vec3 rayDir = normalize(vDirection);\r\n                    vec2 bounds = hitBox(vOrigin, rayDir);\r\n                    if (bounds.x > bounds.y) discard;\r\n                    bounds.x = max(bounds.x, 0.0);\r\n                    vec3 p = vOrigin + bounds.x * rayDir;\r\n                    vec3 inc = 1.0 / abs(rayDir);\r\n                    float delta = min(inc.x, min(inc.y, inc.z));\r\n                    delta /= 50.0;\r\n                    for (float t = bounds.x; t < bounds.y; t += delta) {\r\n                        float d = sample1(p + 0.5);\r\n                        if (d > 0.5) {\r\n                            color.rgb = p * 2.0; // normal(p + 0.5); // * 0.5 + (p * 1.5 + 0.25);\r\n                            color.a = 1.;\r\n                            break;\r\n                        }\r\n                        p += rayDir * delta;\r\n                    }\r\n                    if (color.a == 0.0) discard;\r\n                }\r\n            `\r\n            var loader = new VOXLoader()\r\n            loader.load('static/models/vox/menger.vox', (chunks) => {\r\n                for (var i = 0; i < chunks.length; i ++) {\r\n                    var chunk = chunks[ i ]\r\n                    var data = chunk.data\r\n                    var size = chunk.size\r\n                    var array = new Uint8Array(size.x * size.y * size.z);\r\n                    for (var j = 0, k = 0; j < data.length; j += 4, k ++) {\r\n                        var x = data[ j + 0 ]\r\n                        var y = data[ j + 1 ]\r\n                        var z = data[ j + 2 ]\r\n                        var index = x + (y * size.x) + (z * size.x * size.y)\r\n                        array[ index ] = 255.0\r\n                    }\r\n                    var texture = new this.$THREE.DataTexture3D(array, size.x, size.y, size.z)\r\n                    texture.format = this.$THREE.RedFormat\r\n                    texture.minFilter = this.$THREE.NearestFilter\r\n                    texture.magFilter = this.$THREE.LinearFilter\r\n                    texture.unpackAlignment = 1\r\n                    var geometry = new this.$THREE.BoxBufferGeometry(1, 1, 1)\r\n                    var material = new this.$THREE.RawShaderMaterial({\r\n                        glslVersion: this.$THREE.GLSL3,\r\n                        uniforms: {\r\n                            map: { value: texture },\r\n                            cameraPos: { value: new this.$THREE.Vector3() }\r\n                        },\r\n                        vertexShader,\r\n                        fragmentShader,\r\n                        side: this.$THREE.BackSide\r\n                    })\r\n                    var mesh = new this.$THREE.InstancedMesh(geometry, material, 100000)\r\n                    mesh.onBeforeRender = () => {\r\n                        material.uniforms.cameraPos.value.copy(this.camera.position)\r\n                    }\r\n                    var transform = new this.$THREE.Object3D()\r\n                    for (let i = 0; i < mesh.count; i ++) {\r\n                        transform.position.random().subScalar(0.5).multiplyScalar(150)\r\n                        transform.rotation.x = Math.random() * Math.PI\r\n                        transform.rotation.y = Math.random() * Math.PI\r\n                        transform.rotation.z = Math.random() * Math.PI\r\n                        transform.updateMatrix()\r\n                        mesh.setMatrixAt(i, transform.matrix)\r\n                    }\r\n                    this.scene.add(mesh)\r\n                }\r\n            })\r\n            window.addEventListener('resize', this.onWindowResize, false)\r\n        },\r\n        onWindowResize() {\r\n            this.$onWindowResize(this.camera, this.renderer)\r\n        },\r\n        animate() {\r\n            requestAnimationFrame(this.animate)\r\n            this.controls.update()\r\n            this.renderer.render(this.scene, this.camera)\r\n        }\r\n    },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.webgl2VolumeInstancing-container {\r\n    width: 100%;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/views/volume/webgl2VolumeInstancing.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"webgl2VolumeInstancing-container\"},[_c('div',{attrs:{\"id\":\"info\"}},[_c('a',{attrs:{\"href\":\"https://threejs.org\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"three.js\")]),_vm._v(\" webgl2 - volume - instancing\\n\\t\\t\")])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-24ec7e09\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/volume/webgl2VolumeInstancing.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-24ec7e09\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./webgl2VolumeInstancing.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webgl2VolumeInstancing.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webgl2VolumeInstancing.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-24ec7e09\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./webgl2VolumeInstancing.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-24ec7e09\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/volume/webgl2VolumeInstancing.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}