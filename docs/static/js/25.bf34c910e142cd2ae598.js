webpackJsonp([25],{"5tvV":function(t,e){},"8f9v":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("QEtz"),r=i("kYVu"),n={data:function(){return{container:null,stats:null,camera:null,scene:null,renderer:null,materialDepth:null,windowHalfX:null,windowHalfY:null,distance:100,effectController:null,postprocessing:{enabled:!0},shaderSettings:{rings:3,samples:4},mouse:null,raycaster:null,target:null,planes:[],leaves:100,gui:null}},mounted:function(){this.mouse=new this.$THREE.Vector2,this.raycaster=new this.$THREE.Raycaster,this.target=new this.$THREE.Vector3(0,20,-50),this.init(),this.animate()},beforeDestroy:function(){this.gui.destroy()},methods:{init:function(){var t=this;this.container=document.createElement("div"),document.getElementsByClassName("webglPostprocessingDof2-container")[0].appendChild(this.container),this.camera=new this.$THREE.PerspectiveCamera(70,this.$webglInnerWidth/window.innerHeight,1,3e3),this.camera.position.y=150,this.camera.position.z=450,this.scene=new this.$THREE.Scene,this.scene.add(this.camera),this.renderer=new this.$THREE.WebGLRenderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.$webglInnerWidth,window.innerHeight),this.renderer.autoClear=!1,this.container.appendChild(this.renderer.domElement);var e=r.a;this.materialDepth=new this.$THREE.ShaderMaterial({uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.materialDepth.uniforms.mNear.value=this.camera.near,this.materialDepth.uniforms.mFar.value=this.camera.far;var i="static/textures/cube/Bridge2/",n=[i+"posx.jpg",i+"negx.jpg",i+"posy.jpg",i+"negy.jpg",i+"posz.jpg",i+"negz.jpg"],s=(new this.$THREE.CubeTextureLoader).load(n);this.scene.background=s;for(var a=new this.$THREE.PlaneBufferGeometry(10,10,1,1),l=new this.$THREE.MeshPhongMaterial({color:6710886,shininess:.5,specular:16777215,envMap:s,side:this.$THREE.DoubleSide}),h=Math.random,c=0;c<this.leaves;c++){var f=new this.$THREE.Mesh(a,l);f.rotation.set(h(),h(),h()),f.rotation.dx=.1*h(),f.rotation.dy=.1*h(),f.rotation.dz=.1*h(),f.position.set(150*h(),0+300*h(),150*h()),f.position.dx=h()-.5,f.position.dz=h()-.5,this.scene.add(f),this.planes.push(f)}(new this.$THREE.BufferGeometryLoader).load("static/models/json/suzanne_buffergeometry.json",function(e){e.computeVertexNormals();for(var i=new t.$THREE.MeshPhongMaterial({specular:16777215,envMap:s,shininess:50,reflectivity:1,flatShading:!0}),o=0;o<20;o++){var r=new t.$THREE.Mesh(e,i);r.position.z=200*Math.cos(o/20*Math.PI*2),r.position.y=20*Math.sin(o/20*Math.PI*3),r.position.x=200*Math.sin(o/20*Math.PI*2),r.rotation.y=o/20*Math.PI*2,r.scale.setScalar(30),t.scene.add(r)}});var d=new this.$THREE.SphereBufferGeometry(1,20,20);for(c=0;c<20;c++){var u=new this.$THREE.MeshPhongMaterial({color:16777215*Math.random(),shininess:.5,specular:16777215,envMap:s}),p=new this.$THREE.Mesh(d,u);p.position.x=200*(Math.random()-.5),p.position.y=50*Math.random(),p.position.z=200*(Math.random()-.5),p.scale.multiplyScalar(10),this.scene.add(p)}this.scene.add(new this.$THREE.AmbientLight(2236962));var g=new this.$THREE.DirectionalLight(16777215,2);g.position.set(2,1.2,10).normalize(),this.scene.add(g);var m=new this.$THREE.DirectionalLight(16777215,1);m.position.set(-2,1.2,-10).normalize(),this.scene.add(m),this.initPostprocessing(),this.stats=new this.$Stats,this.stats.dom.style.left="280px",this.container.appendChild(this.stats.dom),this.container.style.touchAction="none",this.container.addEventListener("pointermove",this.onPointerMove,!1),this.effectController={enabled:!0,jsDepthCalculation:!0,shaderFocus:!1,fstop:2.2,maxblur:1,showFocus:!1,focalDepth:2.8,manualdof:!1,vignetting:!1,depthblur:!1,threshold:.5,gain:2,bias:.5,fringe:.7,focalLength:35,noise:!0,pentagon:!1,dithering:1e-4};var v=function(){for(var e in t.effectController)e in t.postprocessing.bokeh_uniforms&&(t.postprocessing.bokeh_uniforms[e].value=t.effectController[e]);t.postprocessing.enabled=t.effectController.enabled,t.postprocessing.bokeh_uniforms.znear.value=t.camera.near,t.postprocessing.bokeh_uniforms.zfar.value=t.camera.far,t.camera.setFocalLength(t.effectController.focalLength)};this.gui=new o.a,this.gui.add(this.effectController,"enabled").onChange(v),this.gui.add(this.effectController,"jsDepthCalculation").onChange(v),this.gui.add(this.effectController,"shaderFocus").onChange(v),this.gui.add(this.effectController,"focalDepth",0,200).listen().onChange(v),this.gui.add(this.effectController,"fstop",.1,22,.001).onChange(v),this.gui.add(this.effectController,"maxblur",0,5,.025).onChange(v),this.gui.add(this.effectController,"showFocus").onChange(v),this.gui.add(this.effectController,"manualdof").onChange(v),this.gui.add(this.effectController,"vignetting").onChange(v),this.gui.add(this.effectController,"depthblur").onChange(v),this.gui.add(this.effectController,"threshold",0,1,.001).onChange(v),this.gui.add(this.effectController,"gain",0,100,.001).onChange(v),this.gui.add(this.effectController,"bias",0,3,.001).onChange(v),this.gui.add(this.effectController,"fringe",0,5,.001).onChange(v),this.gui.add(this.effectController,"focalLength",16,80,.001).onChange(v),this.gui.add(this.effectController,"noise").onChange(v),this.gui.add(this.effectController,"dithering",0,.001,1e-4).onChange(v),this.gui.add(this.effectController,"pentagon").onChange(v),this.gui.add(this.shaderSettings,"rings",1,8).step(1).onChange(this.shaderUpdate),this.gui.add(this.shaderSettings,"samples",1,13).step(1).onChange(this.shaderUpdate),v(),window.addEventListener("resize",this.onWindowResize,!1)},onWindowResize:function(){this.$onWindowResize(this.camera,this.renderer),this.windowHalfX=(window.innerWidth-281)/2,this.windowHalfY=window.innerHeight/2,this.postprocessing.rtTextureDepth.setSize(window.innerWidth-281,window.innerHeight),this.postprocessing.rtTextureColor.setSize(window.innerWidth-281,window.innerHeight),this.postprocessing.bokeh_uniforms.textureWidth.value=window.innerWidth-281,this.postprocessing.bokeh_uniforms.textureHeight.value=window.innerHeight},onPointerMove:function(t){!1!==t.isPrimary&&(this.mouse.x=(t.clientX-this.windowHalfX)/this.windowHalfX,this.mouse.y=-(t.clientY-this.windowHalfY)/this.windowHalfY,this.postprocessing.bokeh_uniforms.focusCoords.value.set(t.clientX/window.innerWidth,1-t.clientY/window.innerHeight))},initPostprocessing:function(){this.postprocessing.scene=new this.$THREE.Scene,this.postprocessing.camera=new this.$THREE.OrthographicCamera(this.$webglInnerWidth/-2,this.$webglInnerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1e4,1e4),this.postprocessing.camera.position.z=100,this.postprocessing.scene.add(this.postprocessing.camera);var t={minFilter:this.$THREE.LinearFilter,magFilter:this.$THREE.LinearFilter,format:this.$THREE.RGBFormat};this.postprocessing.rtTextureDepth=new this.$THREE.WebGLRenderTarget(this.$webglInnerWidth,window.innerHeight,t),this.postprocessing.rtTextureColor=new this.$THREE.WebGLRenderTarget(this.$webglInnerWidth,window.innerHeight,t);var e=r.b;this.postprocessing.bokeh_uniforms=this.$THREE.UniformsUtils.clone(e.uniforms),this.postprocessing.bokeh_uniforms.tColor.value=this.postprocessing.rtTextureColor.texture,this.postprocessing.bokeh_uniforms.tDepth.value=this.postprocessing.rtTextureDepth.texture,this.postprocessing.bokeh_uniforms.textureWidth.value=this.$webglInnerWidth,this.postprocessing.bokeh_uniforms.textureHeight.value=window.innerHeight,this.postprocessing.materialBokeh=new this.$THREE.ShaderMaterial({uniforms:this.postprocessing.bokeh_uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,defines:{RINGS:this.shaderSettings.rings,SAMPLES:this.shaderSettings.samples}}),this.postprocessing.quad=new this.$THREE.Mesh(new this.$THREE.PlaneBufferGeometry(this.$webglInnerWidth,window.innerHeight),this.postprocessing.materialBokeh),this.postprocessing.quad.position.z=-500,this.postprocessing.scene.add(this.postprocessing.quad)},shaderUpdate:function(){this.postprocessing.materialBokeh.defines.RINGS=this.shaderSettings.rings,this.postprocessing.materialBokeh.defines.SAMPLES=this.shaderSettings.samples,this.postprocessing.materialBokeh.needsUpdate=!0},animate:function(){requestAnimationFrame(this.animate,this.renderer.domElement),this.render(),this.stats.update()},linearize:function(t){var e=this.camera.far,i=this.camera.near;return-e*i/(t*(e-i)-e)},smoothstep:function(t,e,i){var o=this.saturate((i-t)/(e-t));return o*o*(3-2*o)},saturate:function(t){return Math.max(0,Math.min(1,t))},render:function(){var t=15e-5*Date.now();if(this.camera.position.x=400*Math.cos(t),this.camera.position.z=500*Math.sin(t),this.camera.position.y=100*Math.sin(t/1.4),this.camera.lookAt(this.target),this.camera.updateMatrixWorld(),this.effectController.jsDepthCalculation){this.raycaster.setFromCamera(this.mouse,this.camera);var e=this.raycaster.intersectObjects(this.scene.children,!0),i=e.length>0?e[0].distance:1e3;this.distance+=.03*(i-this.distance);var o=this.smoothstep(this.camera.near,this.camera.far,this.distance),r=this.linearize(1-o);this.postprocessing.bokeh_uniforms.focalDepth.value=r,this.effectController.focalDepth=r}for(var n=0;n<this.leaves;n++){var s=this.planes[n];s.rotation.x+=s.rotation.dx,s.rotation.y+=s.rotation.dy,s.rotation.z+=s.rotation.dz,s.position.y-=2,s.position.x+=s.position.dx,s.position.z+=s.position.dz,s.position.y<0&&(s.position.y+=300)}this.postprocessing.enabled?(this.renderer.clear(),this.renderer.setRenderTarget(this.postprocessing.rtTextureColor),this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.scene.overrideMaterial=this.materialDepth,this.renderer.setRenderTarget(this.postprocessing.rtTextureDepth),this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.scene.overrideMaterial=null,this.renderer.setRenderTarget(null),this.renderer.render(this.postprocessing.scene,this.postprocessing.camera)):(this.scene.overrideMaterial=null,this.renderer.setRenderTarget(null),this.renderer.clear(),this.renderer.render(this.scene,this.camera))}}},s={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"webglPostprocessingDof2-container"},[e("div",{attrs:{id:"info"}},[e("a",{attrs:{href:"https://threejs.org",target:"_blank",rel:"noopener"}},[this._v("three.js")]),this._v(" - webgl realistic depth-of-field bokeh example"),e("br"),this._v("\n\t\t\tshader ported from "),e("a",{attrs:{href:"http://blenderartists.org/forum/showthread.php?237488-GLSL-depth-of-field-with-bokeh-v2-4-(update)"}},[this._v("Martins Upitis")])])])}]};var a=i("VU/8")(n,s,!1,function(t){i("5tvV")},"data-v-3cc83e84",null);e.default=a.exports},kYVu:function(t,e,i){"use strict";i.d(e,"b",function(){return o}),i.d(e,"a",function(){return r});var o={uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:0},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new(i("6+nK").Vector2)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","/*","make sure that these two values are the same for your camera, otherwise distances will be wrong.","*/","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","/*","next part is experimental","not looking good with small sample and ring count","looks okay starting from samples = 4, rings = 4","*/","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","\t//pentagonal shape","\tfloat scale = float(rings) - 1.3;","\tvec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","\tvec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","\tvec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","\tvec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","\tvec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","\tvec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","\tvec4  one = vec4( 1.0 );","\tvec4 P = vec4((coords),vec2(scale, scale));","\tvec4 dist = vec4(0.0);","\tfloat inorout = -4.0;","\tdist.x = dot( P, HS0 );","\tdist.y = dot( P, HS1 );","\tdist.z = dot( P, HS2 );","\tdist.w = dot( P, HS3 );","\tdist = smoothstep( -feather, feather, dist );","\tinorout += dot( dist, one );","\tdist.x = dot( P, HS4 );","\tdist.y = HS5.w - abs( P.z );","\tdist = smoothstep( -feather, feather, dist );","\tinorout += dist.x;","\treturn clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","\t// Depth buffer blur","\tfloat d = 0.0;","\tfloat kernel[9];","\tvec2 offset[9];","\tvec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","\toffset[0] = vec2(-wh.x,-wh.y);","\toffset[1] = vec2( 0.0, -wh.y);","\toffset[2] = vec2( wh.x -wh.y);","\toffset[3] = vec2(-wh.x,  0.0);","\toffset[4] = vec2( 0.0,   0.0);","\toffset[5] = vec2( wh.x,  0.0);","\toffset[6] = vec2(-wh.x, wh.y);","\toffset[7] = vec2( 0.0,  wh.y);","\toffset[8] = vec2( wh.x, wh.y);","\tkernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","\tkernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","\tkernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","\tfor( int i=0; i<9; i++ ) {","\t\tfloat tmp = texture2D(tDepth, coords + offset[i]).r;","\t\td += tmp * kernel[i];","\t}","\treturn d;","}","vec3 color(vec2 coords,float blur) {","\t//processing the sample","\tvec3 col = vec3(0.0);","\tvec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","\tcol.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","\tcol.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","\tcol.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","\tvec3 lumcoeff = vec3(0.299,0.587,0.114);","\tfloat lum = dot(col.rgb, lumcoeff);","\tfloat thresh = max((lum-threshold)*gain, 0.0);","\treturn col+mix(vec3(0.0),col,thresh*blur);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","\tfloat edge = 0.002*depth; //distance based edge smoothing","\tfloat m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","\tfloat e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","\tcol = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","\tcol = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","\treturn col;","}","float linearize(float depth) {","\treturn -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","\tfloat dist = distance(vUv.xy, vec2(0.5,0.5));","\tdist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","\treturn clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","\tfloat rings2 = float(rings);","\tfloat step = PI*2.0 / float(ringsamples);","\tfloat pw = cos(j*step)*i;","\tfloat ph = sin(j*step)*i;","\tfloat p = 1.0;","\tif (pentagon) {","\t\tp = penta(vec2(pw,ph));","\t}","\tcol += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","\treturn 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","\t//scene depth calculation","\tfloat depth = linearize(texture2D(tDepth,vUv.xy).x);","\t// Blur depth?","\tif ( depthblur ) {","\t\tdepth = linearize(bdepth(vUv.xy));","\t}","\t//focal plane calculation","\tfloat fDepth = focalDepth;","\tif (shaderFocus) {","\t\tfDepth = linearize(texture2D(tDepth,focusCoords).x);","\t}","\t// dof blur factor calculation","\tfloat blur = 0.0;","\tif (manualdof) {","\t\tfloat a = depth-fDepth; // Focal plane","\t\tfloat b = (a-fdofstart)/fdofdist; // Far DoF","\t\tfloat c = (-a-ndofstart)/ndofdist; // Near Dof","\t\tblur = (a>0.0) ? b : c;","\t} else {","\t\tfloat f = focalLength; // focal length in mm","\t\tfloat d = fDepth*1000.0; // focal plane in mm","\t\tfloat o = depth*1000.0; // depth in mm","\t\tfloat a = (o*f)/(o-f);","\t\tfloat b = (d*f)/(d-f);","\t\tfloat c = (d-f)/(d*fstop*CoC);","\t\tblur = abs(a-b)*c;","\t}","\tblur = clamp(blur,0.0,1.0);","\t// calculation of pattern for dithering","\tvec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;","\t// getting blur x and y step factor","\tfloat w = (1.0/textureWidth)*blur*maxblur+noise.x;","\tfloat h = (1.0/textureHeight)*blur*maxblur+noise.y;","\t// calculation of final color","\tvec3 col = vec3(0.0);","\tif(blur < 0.05) {","\t\t//some optimization thingy","\t\tcol = texture2D(tColor, vUv.xy).rgb;","\t} else {","\t\tcol = texture2D(tColor, vUv.xy).rgb;","\t\tfloat s = 1.0;","\t\tint ringsamples;","\t\tfor (int i = 1; i <= rings; i++) {","\t\t\t/*unboxstart*/","\t\t\tringsamples = i * samples;","\t\t\tfor (int j = 0 ; j < maxringsamples ; j++) {","\t\t\t\tif (j >= ringsamples) break;","\t\t\t\ts += gather(float(i), float(j), ringsamples, col, w, h, blur);","\t\t\t}","\t\t\t/*unboxend*/","\t\t}","\t\tcol /= s; //divide by sample count","\t}","\tif (showFocus) {","\t\tcol = debugFocus(col, blur, depth);","\t}","\tif (vignetting) {","\t\tcol *= vignette();","\t}","\tgl_FragColor.rgb = col;","\tgl_FragColor.a = 1.0;","} "].join("\n")},r={uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:["varying float vViewZDepth;","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","\tvViewZDepth = - mvPosition.z;","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","varying float vViewZDepth;","void main() {","\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );","\tgl_FragColor = vec4( vec3( color ), 1.0 );","} "].join("\n")}}});
//# sourceMappingURL=25.bf34c910e142cd2ae598.js.map