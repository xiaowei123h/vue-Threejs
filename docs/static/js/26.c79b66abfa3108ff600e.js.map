{"version":3,"sources":["webpack:///./src/components/jsm/cameras/CinematicCamera.js","webpack:///src/views/camera/webglCameraCinematic.vue","webpack:///./src/views/camera/webglCameraCinematic.vue?7e57","webpack:///./src/views/camera/webglCameraCinematic.vue","webpack:///./src/components/jsm/shaders/BokehShader2.js"],"names":["CinematicCamera","fov","aspect","near","far","PerspectiveCamera","call","this","type","postprocessing","enabled","shaderSettings","rings","samples","depthShader","BokehDepthShader","materialDepth","ShaderMaterial","uniforms","vertexShader","fragmentShader","value","setLens","initPostProcessing","prototype","Object","create","constructor","focalLength","filmGauge","fNumber","coc","undefined","setFocalLength","aperture","hyperFocal","linearize","depth","zfar","znear","smoothstep","x","saturate","Math","max","min","focusAt","focusDistance","getFocalLength","focus","nearPoint","farPoint","depthOfField","sdistance","ldistance","bokeh_uniforms","scene","Scene","camera","OrthographicCamera","window","innerWidth","innerHeight","add","pars","minFilter","LinearFilter","magFilter","format","RGBFormat","rtTextureDepth","WebGLRenderTarget","rtTextureColor","bokeh_shader","BokehShader","UniformsUtils","clone","texture","materialBokeh","defines","RINGS","SAMPLES","DEPTH_PACKING","quad","Mesh","PlaneBufferGeometry","position","z","renderCinematic","renderer","currentRenderTarget","getRenderTarget","clear","overrideMaterial","setRenderTarget","render","webglCameraCinematic","data","raycaster","stats","mouse","INTERSECTED","radius","theta","gui","mounted","$THREE","Vector2","init","animate","beforeDestroy","destroy","methods","CinematicCamera_CinematicCamera","$webglInnerWidth","set","background","Color","AmbientLight","light","DirectionalLight","normalize","geometry","BoxBufferGeometry","i","object","MeshLambertMaterial","color","random","y","Raycaster","WebGLRenderer","antialias","setPixelRatio","devicePixelRatio","setSize","document","getElementsByClassName","appendChild","domElement","$Stats","dom","style","left","addEventListener","onDocumentMouseMove","onWindowResize","effectController","fstop","showFocus","focalDepth","that","matChanger","e","frameHeight","dat_gui_module","onChange","$onWindowResize","event","preventDefault","clientX","clientY","requestAnimationFrame","update","sin","MathUtils","degToRad","cos","lookAt","updateMatrixWorld","setFromCamera","intersects","intersectObjects","children","length","targetDistance","distance","material","emissive","setHex","currentHex","getHex","camera_webglCameraCinematic","$createElement","_self","_c","_m","staticRenderFns","_h","staticClass","attrs","id","href","target","rel","_v","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__","d","textureWidth","textureHeight","tColor","tDepth","maxblur","manualdof","vignetting","depthblur","threshold","gain","bias","fringe","noise","dithering","pentagon","shaderFocus","focusCoords","join","mNear","mFar"],"mappings":"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EAGA,+BACA,2DACA,4BACA,MAEA,cACA,IAGA,uCACA,4BAEA,0BACA,2DAEA,0EACA,8EACA,6EAEA,6CACA,wCACA,mDACA,+CACA,IAEA,uDACA,8DACA,wDACA,4DAEA,kDACA,4DAEA,gBACA,IAEA,iCACA,4DACA,IAGA,qBACA,kDACA,gFACA,gCACA,IAEA,kGACA,iCACA,8CACA,8BACA,8BACA,mBACA,oBACA,8BACA,MACA,iFACA,gDACA,IAEA,gBACA,8BAEA,yDAEA,mBACA,uBACA,yCACA,MAEA,8BAEA,+BAEA,uBAEA,2DAEA,MAEA,mCAEA,sBAEA,qBACA,6CACA,mDACA,qDACA,8BACA,aACA,mDACA,oDACA,6CAEA,6BACA,6BACA,qCAEA,yBACA,MAEA,gCAEA,4CAEA,wFAEA,wCAEA,uDACA,wDAEA,kCAEA,0BAEA,sBACA,iCACA,2CACA,aACA,2CACA,qBACA,uBAEA,yCACA,uBACA,mCAEA,qDACA,uCACA,yEACA,UACA,qBACA,QAEA,yCACA,MAEA,qBACA,0CACA,MAEA,sBACA,yBACA,MAEA,4BACA,0BACA,MAECuM,KAAM,OAIL5M,GAEHG,UAEC0M,OAAWvM,MAAO,GAClBwM,MAAUxM,MAAO,MAIlBF,cAEC,6BAEA,gBAEA,4BACA,8BAEA,kCAEA,KAECwM,KAAM,MAERvM,gBAEC,uBACA,sBAEA,6BAEA,gBAEA,gEACA,+CAEA,MAECuM,KAAM","file":"static/js/26.c79b66abfa3108ff600e.js","sourcesContent":["import {\r\n\tLinearFilter,\r\n\tMesh,\r\n\tOrthographicCamera,\r\n\tPerspectiveCamera,\r\n\tPlaneBufferGeometry,\r\n\tRGBFormat,\r\n\tScene,\r\n\tShaderMaterial,\r\n\tUniformsUtils,\r\n\tWebGLRenderTarget\r\n} from \"@/components/build/three.module.js\";\r\nimport { BokehShader } from \"@/components/jsm/shaders/BokehShader2.js\";\r\nimport { BokehDepthShader } from \"@/components/jsm/shaders/BokehShader2.js\";\r\n\r\nvar CinematicCamera = function ( fov, aspect, near, far ) {\r\n\r\n\tPerspectiveCamera.call( this, fov, aspect, near, far );\r\n\r\n\tthis.type = 'CinematicCamera';\r\n\r\n\tthis.postprocessing = { enabled: true };\r\n\tthis.shaderSettings = {\r\n\t\trings: 3,\r\n\t\tsamples: 4\r\n\t};\r\n\r\n\tvar depthShader = BokehDepthShader;\r\n\r\n\tthis.materialDepth = new ShaderMaterial( {\r\n\t\tuniforms: depthShader.uniforms,\r\n\t\tvertexShader: depthShader.vertexShader,\r\n\t\tfragmentShader: depthShader.fragmentShader\r\n\t} );\r\n\r\n\tthis.materialDepth.uniforms[ 'mNear' ].value = near;\r\n\tthis.materialDepth.uniforms[ 'mFar' ].value = far;\r\n\r\n\t// In case of cinematicCamera, having a default lens set is important\r\n\tthis.setLens();\r\n\r\n\tthis.initPostProcessing();\r\n\r\n};\r\n\r\nCinematicCamera.prototype = Object.create( PerspectiveCamera.prototype );\r\nCinematicCamera.prototype.constructor = CinematicCamera;\r\n\r\n\r\n// providing fnumber and coc(Circle of Confusion) as extra arguments\r\nCinematicCamera.prototype.setLens = function ( focalLength, filmGauge, fNumber, coc ) {\r\n\r\n\t// In case of cinematicCamera, having a default lens set is important\r\n\tif ( focalLength === undefined ) focalLength = 35;\r\n\tif ( filmGauge !== undefined ) this.filmGauge = filmGauge;\r\n\r\n\tthis.setFocalLength( focalLength );\r\n\r\n\t// if fnumber and coc are not provided, cinematicCamera tries to act as a basic PerspectiveCamera\r\n\tif ( fNumber === undefined ) fNumber = 8;\r\n\tif ( coc === undefined ) coc = 0.019;\r\n\r\n\tthis.fNumber = fNumber;\r\n\tthis.coc = coc;\r\n\r\n\t// fNumber is focalLength by aperture\r\n\tthis.aperture = focalLength / this.fNumber;\r\n\r\n\t// hyperFocal is required to calculate depthOfField when a lens tries to focus at a distance with given fNumber and focalLength\r\n\tthis.hyperFocal = ( focalLength * focalLength ) / ( this.aperture * this.coc );\r\n\r\n};\r\n\r\nCinematicCamera.prototype.linearize = function ( depth ) {\r\n\r\n\tvar zfar = this.far;\r\n\tvar znear = this.near;\r\n\treturn - zfar * znear / ( depth * ( zfar - znear ) - zfar );\r\n\r\n};\r\n\r\nCinematicCamera.prototype.smoothstep = function ( near, far, depth ) {\r\n\r\n\tvar x = this.saturate( ( depth - near ) / ( far - near ) );\r\n\treturn x * x * ( 3 - 2 * x );\r\n\r\n};\r\n\r\nCinematicCamera.prototype.saturate = function ( x ) {\r\n\r\n\treturn Math.max( 0, Math.min( 1, x ) );\r\n\r\n};\r\n\r\n// function for focusing at a distance from the camera\r\nCinematicCamera.prototype.focusAt = function ( focusDistance ) {\r\n\r\n\tif ( focusDistance === undefined ) focusDistance = 20;\r\n\r\n\tvar focalLength = this.getFocalLength();\r\n\r\n\t// distance from the camera (normal to frustrum) to focus on\r\n\tthis.focus = focusDistance;\r\n\r\n\t// the nearest point from the camera which is in focus (unused)\r\n\tthis.nearPoint = ( this.hyperFocal * this.focus ) / ( this.hyperFocal + ( this.focus - focalLength ) );\r\n\r\n\t// the farthest point from the camera which is in focus (unused)\r\n\tthis.farPoint = ( this.hyperFocal * this.focus ) / ( this.hyperFocal - ( this.focus - focalLength ) );\r\n\r\n\t// the gap or width of the space in which is everything is in focus (unused)\r\n\tthis.depthOfField = this.farPoint - this.nearPoint;\r\n\r\n\t// Considering minimum distance of focus for a standard lens (unused)\r\n\tif ( this.depthOfField < 0 ) this.depthOfField = 0;\r\n\r\n\tthis.sdistance = this.smoothstep( this.near, this.far, this.focus );\r\n\r\n\tthis.ldistance = this.linearize( 1 -\tthis.sdistance );\r\n\r\n\tthis.postprocessing.bokeh_uniforms[ 'focalDepth' ].value = this.ldistance;\r\n\r\n};\r\n\r\nCinematicCamera.prototype.initPostProcessing = function () {\r\n\r\n\tif ( this.postprocessing.enabled ) {\r\n\r\n\t\tthis.postprocessing.scene = new Scene();\r\n\r\n\t\tthis.postprocessing.camera = new OrthographicCamera( window.innerWidth / - 2, window.innerWidth / 2,\twindow.innerHeight / 2, window.innerHeight / - 2, - 10000, 10000 );\r\n\r\n\t\tthis.postprocessing.scene.add( this.postprocessing.camera );\r\n\r\n\t\tvar pars = { minFilter: LinearFilter, magFilter: LinearFilter, format: RGBFormat };\r\n\t\tthis.postprocessing.rtTextureDepth = new WebGLRenderTarget( window.innerWidth, window.innerHeight, pars );\r\n\t\tthis.postprocessing.rtTextureColor = new WebGLRenderTarget( window.innerWidth, window.innerHeight, pars );\r\n\r\n\t\tvar bokeh_shader = BokehShader;\r\n\r\n\t\tthis.postprocessing.bokeh_uniforms = UniformsUtils.clone( bokeh_shader.uniforms );\r\n\r\n\t\tthis.postprocessing.bokeh_uniforms[ \"tColor\" ].value = this.postprocessing.rtTextureColor.texture;\r\n\t\tthis.postprocessing.bokeh_uniforms[ \"tDepth\" ].value = this.postprocessing.rtTextureDepth.texture;\r\n\r\n\t\tthis.postprocessing.bokeh_uniforms[ \"manualdof\" ].value = 0;\r\n\t\tthis.postprocessing.bokeh_uniforms[ \"shaderFocus\" ].value = 0;\r\n\r\n\t\tthis.postprocessing.bokeh_uniforms[ \"fstop\" ].value = 2.8;\r\n\r\n\t\tthis.postprocessing.bokeh_uniforms[ \"showFocus\" ].value = 1;\r\n\r\n\t\tthis.postprocessing.bokeh_uniforms[ \"focalDepth\" ].value = 0.1;\r\n\r\n\t\t//console.log( this.postprocessing.bokeh_uniforms[ \"focalDepth\" ].value );\r\n\r\n\t\tthis.postprocessing.bokeh_uniforms[ \"znear\" ].value = this.near;\r\n\t\tthis.postprocessing.bokeh_uniforms[ \"zfar\" ].value = this.near;\r\n\r\n\r\n\t\tthis.postprocessing.bokeh_uniforms[ \"textureWidth\" ].value = window.innerWidth;\r\n\r\n\t\tthis.postprocessing.bokeh_uniforms[ \"textureHeight\" ].value = window.innerHeight;\r\n\r\n\t\tthis.postprocessing.materialBokeh = new ShaderMaterial( {\r\n\t\t\tuniforms: this.postprocessing.bokeh_uniforms,\r\n\t\t\tvertexShader: bokeh_shader.vertexShader,\r\n\t\t\tfragmentShader: bokeh_shader.fragmentShader,\r\n\t\t\tdefines: {\r\n\t\t\t\tRINGS: this.shaderSettings.rings,\r\n\t\t\t\tSAMPLES: this.shaderSettings.samples,\r\n\t\t\t\tDEPTH_PACKING: 1\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\tthis.postprocessing.quad = new Mesh( new PlaneBufferGeometry( window.innerWidth, window.innerHeight ), this.postprocessing.materialBokeh );\r\n\t\tthis.postprocessing.quad.position.z = - 500;\r\n\t\tthis.postprocessing.scene.add( this.postprocessing.quad );\r\n\r\n\t}\r\n\r\n};\r\n\r\nCinematicCamera.prototype.renderCinematic = function ( scene, renderer ) {\r\n\r\n\tif ( this.postprocessing.enabled ) {\r\n\r\n\t\tvar currentRenderTarget = renderer.getRenderTarget();\r\n\r\n\t\trenderer.clear();\r\n\r\n\t\t// Render scene into texture\r\n\r\n\t\tscene.overrideMaterial = null;\r\n\t\trenderer.setRenderTarget( this.postprocessing.rtTextureColor );\r\n\t\trenderer.clear();\r\n\t\trenderer.render( scene, this );\r\n\r\n\t\t// Render depth into texture\r\n\r\n\t\tscene.overrideMaterial = this.materialDepth;\r\n\t\trenderer.setRenderTarget( this.postprocessing.rtTextureDepth );\r\n\t\trenderer.clear();\r\n\t\trenderer.render( scene, this );\r\n\r\n\t\t// Render bokeh composite\r\n\r\n\t\trenderer.setRenderTarget( null );\r\n\t\trenderer.render( this.postprocessing.scene, this.postprocessing.camera );\r\n\r\n\t\trenderer.setRenderTarget( currentRenderTarget );\r\n\r\n\t}\r\n\r\n};\r\n\r\nexport { CinematicCamera };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/cameras/CinematicCamera.js","<template>\r\n    <div class=\"webglCameraCinematic-container\">\r\n        <div id=\"info\">\r\n\t\t\t<a href=\"https://threejs.org\" target=\"_blank\" rel=\"noopener\">three.js</a> webgl - interactive cubes\r\n\t\t</div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { GUI } from '@/components/jsm/libs/dat.gui.module.js'\r\nimport { CinematicCamera } from '@/components/jsm/cameras/CinematicCamera.js'\r\nexport default {\r\n    data() {\r\n        return {\r\n            camera: null,\r\n            scene: null,\r\n            raycaster: null,\r\n            renderer: null,\r\n            stats: null,\r\n\t\t\tmouse: null,\r\n\t\t\tINTERSECTED: null,\r\n\t\t\tradius: 100,\r\n            theta: 0,\r\n            gui: null\r\n        }\r\n    },\r\n    mounted() {\r\n        this.mouse = new this.$THREE.Vector2()\r\n        this.init()\r\n        this.animate()\r\n    },\r\n    beforeDestroy() {\r\n        this.gui.destroy()\r\n    },\r\n    methods: {\r\n        init() {\r\n            this.camera = new CinematicCamera(60, this.$webglInnerWidth / window.innerHeight, 1, 1000)\r\n            this.camera.setLens(5)\r\n            this.camera.position.set(2, 1, 500)\r\n            this.scene = new this.$THREE.Scene()\r\n            this.scene.background = new this.$THREE.Color(0xf0f0f0)\r\n            this.scene.add(new this.$THREE.AmbientLight(0xffffff, 0.3))\r\n            var light = new this.$THREE.DirectionalLight(0xffffff, 0.35)\r\n            light.position.set(1, 1, 1).normalize()\r\n            this.scene.add(light)\r\n            var geometry = new this.$THREE.BoxBufferGeometry(20, 20, 20)\r\n            for (var i = 0; i < 1500; i ++) {\r\n                var object = new this.$THREE.Mesh(geometry, new this.$THREE.MeshLambertMaterial({ color: Math.random() * 0xffffff }))\r\n                object.position.x = Math.random() * 800 - 400\r\n                object.position.y = Math.random() * 800 - 400\r\n                object.position.z = Math.random() * 800 - 400\r\n                this.scene.add(object)\r\n            }\r\n            this.raycaster = new this.$THREE.Raycaster()\r\n            this.renderer = new this.$THREE.WebGLRenderer({ antialias: true })\r\n            this.renderer.setPixelRatio(window.devicePixelRatio)\r\n            this.renderer.setSize(this.$webglInnerWidth, window.innerHeight)\r\n            document.getElementsByClassName('webglCameraCinematic-container')[0].appendChild(this.renderer.domElement)\r\n            this.stats = new this.$Stats()\r\n            this.stats.dom.style.left = '280px'\r\n            document.getElementsByClassName('webglCameraCinematic-container')[0].appendChild(this.stats.dom)\r\n            document.addEventListener('mousemove', this.onDocumentMouseMove, false)\r\n            window.addEventListener('resize', this.onWindowResize, false)\r\n            var effectController = {\r\n                focalLength: 15,\r\n                // jsDepthCalculation: true,\r\n                // shaderFocus: false,\r\n                //\r\n                fstop: 2.8,\r\n                // maxblur: 1.0,\r\n                //\r\n                showFocus: false,\r\n                focalDepth: 3,\r\n                // manualdof: false,\r\n                // vignetting: false,\r\n                // depthblur: false,\r\n                //\r\n                // threshold: 0.5,\r\n                // gain: 2.0,\r\n                // bias: 0.5,\r\n                // fringe: 0.7,\r\n                //\r\n                // focalLength: 35,\r\n                // noise: true,\r\n                // pentagon: false,\r\n                //\r\n                // dithering: 0.0001\r\n            }\r\n            var that = this\r\n            var matChanger = function () {\r\n                for (var e in effectController) {\r\n                    if (e in that.camera.postprocessing.bokeh_uniforms) {\r\n                        that.camera.postprocessing.bokeh_uniforms[ e ].value = effectController[ e ]\r\n                    }\r\n                }\r\n                that.camera.postprocessing.bokeh_uniforms[ 'znear' ].value = that.camera.near\r\n                that.camera.postprocessing.bokeh_uniforms[ 'zfar' ].value = that.camera.far\r\n                that.camera.setLens(effectController.focalLength, that.camera.frameHeight, effectController.fstop, that.camera.coc)\r\n                effectController[ 'focalDepth' ] = that.camera.postprocessing.bokeh_uniforms[ 'focalDepth' ].value\r\n            }\r\n            //\r\n            this.gui = new GUI()\r\n            this.gui.add(effectController, 'focalLength', 1, 135, 0.01).onChange(matChanger)\r\n            this.gui.add(effectController, 'fstop', 1.8, 22, 0.01).onChange(matChanger)\r\n            this.gui.add(effectController, 'focalDepth', 0.1, 100, 0.001).onChange(matChanger)\r\n            this.gui.add(effectController, 'showFocus', true).onChange(matChanger)\r\n            matChanger()\r\n            window.addEventListener('resize', this.onWindowResize, false)\r\n        },\r\n        onWindowResize() {\r\n            this.$onWindowResize(this.camera, this.renderer)\r\n        },\r\n        onDocumentMouseMove(event) {\r\n            event.preventDefault()\r\n            this.mouse.x = (event.clientX / this.$webglInnerWidth) * 2 - 1\r\n            this.mouse.y = - (event.clientY / window.innerHeight) * 2 + 1\r\n        },\r\n        animate() {\r\n            requestAnimationFrame(this.animate, this.renderer.domElement)\r\n            this.render()\r\n            this.stats.update()\r\n        },\r\n        render() {\r\n            this.theta += 0.1\r\n            this.camera.position.x = this.radius * Math.sin(this.$THREE.MathUtils.degToRad(this.theta))\r\n            this.camera.position.y = this.radius * Math.sin(this.$THREE.MathUtils.degToRad(this.theta))\r\n            this.camera.position.z = this.radius * Math.cos(this.$THREE.MathUtils.degToRad(this.theta))\r\n            this.camera.lookAt(this.scene.position)\r\n            this.camera.updateMatrixWorld()\r\n            // find intersections\r\n            this.raycaster.setFromCamera(this.mouse, this.camera)\r\n            var intersects = this.raycaster.intersectObjects(this.scene.children)\r\n            if (intersects.length > 0) {\r\n                var targetDistance = intersects[ 0 ].distance\r\n                this.camera.focusAt(targetDistance) // using Cinematic this.camera focusAt method\r\n                if (this.INTERSECTED != intersects[ 0 ].object) {\r\n                    if (this.INTERSECTED) this.INTERSECTED.material.emissive.setHex(this.INTERSECTED.currentHex)\r\n                    this.INTERSECTED = intersects[ 0 ].object\r\n                    this.INTERSECTED.currentHex = this.INTERSECTED.material.emissive.getHex()\r\n                    this.INTERSECTED.material.emissive.setHex(0xff0000)\r\n                }\r\n            } else {\r\n                if (this.INTERSECTED) this.INTERSECTED.material.emissive.setHex(this.INTERSECTED.currentHex)\r\n                this.INTERSECTED = null\r\n            }\r\n            //\r\n            if (this.camera.postprocessing.enabled) {\r\n                this.camera.renderCinematic(this.scene, this.renderer)\r\n            } else {\r\n                this.scene.overrideMaterial = null\r\n                this.renderer.clear()\r\n                this.renderer.render(this.scene, this.camera)\r\n            }\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.webglCameraCinematic-container {\r\n    width: 100%;\r\n    background-color: #fff;\r\n    color: #000;\r\n}\r\n#info a {\r\n    color: #08f;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/views/camera/webglCameraCinematic.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"webglCameraCinematic-container\"},[_c('div',{attrs:{\"id\":\"info\"}},[_c('a',{attrs:{\"href\":\"https://threejs.org\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"three.js\")]),_vm._v(\" webgl - interactive cubes\\n\\t\\t\")])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-102b6950\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/camera/webglCameraCinematic.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-102b6950\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./webglCameraCinematic.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglCameraCinematic.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglCameraCinematic.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-102b6950\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./webglCameraCinematic.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-102b6950\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/camera/webglCameraCinematic.vue\n// module id = null\n// module chunks = ","import {\r\n\tVector2\r\n} from \"@/components/build/three.module.js\";\r\n\r\n/**\r\n * Depth-of-field shader with bokeh\r\n * ported from GLSL shader by Martins Upitis\r\n * http://blenderartists.org/forum/showthread.php?237488-GLSL-depth-of-field-with-bokeh-v2-4-(update)\r\n *\r\n * Requires #define RINGS and SAMPLES integers\r\n */\r\n\r\n\r\n\r\nvar BokehShader = {\r\n\r\n\tuniforms: {\r\n\r\n\t\t\"textureWidth\": { value: 1.0 },\r\n\t\t\"textureHeight\": { value: 1.0 },\r\n\r\n\t\t\"focalDepth\": { value: 1.0 },\r\n\t\t\"focalLength\": { value: 24.0 },\r\n\t\t\"fstop\": { value: 0.9 },\r\n\r\n\t\t\"tColor\": { value: null },\r\n\t\t\"tDepth\": { value: null },\r\n\r\n\t\t\"maxblur\": { value: 1.0 },\r\n\r\n\t\t\"showFocus\": { value: 0 },\r\n\t\t\"manualdof\": { value: 0 },\r\n\t\t\"vignetting\": { value: 0 },\r\n\t\t\"depthblur\": { value: 0 },\r\n\r\n\t\t\"threshold\": { value: 0.5 },\r\n\t\t\"gain\": { value: 2.0 },\r\n\t\t\"bias\": { value: 0.5 },\r\n\t\t\"fringe\": { value: 0.7 },\r\n\r\n\t\t\"znear\": { value: 0.1 },\r\n\t\t\"zfar\": { value: 100 },\r\n\r\n\t\t\"noise\": { value: 1 },\r\n\t\t\"dithering\": { value: 0.0001 },\r\n\t\t\"pentagon\": { value: 0 },\r\n\r\n\t\t\"shaderFocus\": { value: 1 },\r\n\t\t\"focusCoords\": { value: new Vector2() }\r\n\r\n\r\n\t},\r\n\r\n\tvertexShader: [\r\n\r\n\t\t\"varying vec2 vUv;\",\r\n\r\n\t\t\"void main() {\",\r\n\r\n\t\t\"\tvUv = uv;\",\r\n\t\t\"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n\t\t\"}\"\r\n\r\n\t].join( \"\\n\" ),\r\n\r\n\tfragmentShader: [\r\n\r\n\t\t\"#include <common>\",\r\n\r\n\t\t\"varying vec2 vUv;\",\r\n\r\n\t\t\"uniform sampler2D tColor;\",\r\n\t\t\"uniform sampler2D tDepth;\",\r\n\t\t\"uniform float textureWidth;\",\r\n\t\t\"uniform float textureHeight;\",\r\n\r\n\t\t\"uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below\",\r\n\t\t\"uniform float focalLength; //focal length in mm\",\r\n\t\t\"uniform float fstop; //f-stop value\",\r\n\t\t\"uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)\",\r\n\r\n\t\t\"/*\",\r\n\t\t\"make sure that these two values are the same for your camera, otherwise distances will be wrong.\",\r\n\t\t\"*/\",\r\n\r\n\t\t\"uniform float znear; // camera clipping start\",\r\n\t\t\"uniform float zfar; // camera clipping end\",\r\n\r\n\t\t\"//------------------------------------------\",\r\n\t\t\"//user variables\",\r\n\r\n\t\t\"const int samples = SAMPLES; //samples on the first ring\",\r\n\t\t\"const int rings = RINGS; //ring count\",\r\n\r\n\t\t\"const int maxringsamples = rings * samples;\",\r\n\r\n\t\t\"uniform bool manualdof; // manual dof calculation\",\r\n\t\t\"float ndofstart = 1.0; // near dof blur start\",\r\n\t\t\"float ndofdist = 2.0; // near dof blur falloff distance\",\r\n\t\t\"float fdofstart = 1.0; // far dof blur start\",\r\n\t\t\"float fdofdist = 3.0; // far dof blur falloff distance\",\r\n\r\n\t\t\"float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)\",\r\n\r\n\t\t\"uniform bool vignetting; // use optical lens vignetting\",\r\n\r\n\t\t\"float vignout = 1.3; // vignetting outer border\",\r\n\t\t\"float vignin = 0.0; // vignetting inner border\",\r\n\t\t\"float vignfade = 22.0; // f-stops till vignete fades\",\r\n\r\n\t\t\"uniform bool shaderFocus;\",\r\n\t\t\"// disable if you use external focalDepth value\",\r\n\r\n\t\t\"uniform vec2 focusCoords;\",\r\n\t\t\"// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)\",\r\n\t\t\"// if center of screen use vec2(0.5, 0.5);\",\r\n\r\n\t\t\"uniform float maxblur;\",\r\n\t\t\"//clamp value of max blur (0.0 = no blur, 1.0 default)\",\r\n\r\n\t\t\"uniform float threshold; // highlight threshold;\",\r\n\t\t\"uniform float gain; // highlight gain;\",\r\n\r\n\t\t\"uniform float bias; // bokeh edge bias\",\r\n\t\t\"uniform float fringe; // bokeh chromatic aberration / fringing\",\r\n\r\n\t\t\"uniform bool noise; //use noise instead of pattern for sample dithering\",\r\n\r\n\t\t\"uniform float dithering;\",\r\n\r\n\t\t\"uniform bool depthblur; // blur the depth buffer\",\r\n\t\t\"float dbsize = 1.25; // depth blur size\",\r\n\r\n\t\t\"/*\",\r\n\t\t\"next part is experimental\",\r\n\t\t\"not looking good with small sample and ring count\",\r\n\t\t\"looks okay starting from samples = 4, rings = 4\",\r\n\t\t\"*/\",\r\n\r\n\t\t\"uniform bool pentagon; //use pentagon as bokeh shape?\",\r\n\t\t\"float feather = 0.4; //pentagon shape feather\",\r\n\r\n\t\t\"//------------------------------------------\",\r\n\r\n\t\t\"float penta(vec2 coords) {\",\r\n\t\t\"\t//pentagonal shape\",\r\n\t\t\"\tfloat scale = float(rings) - 1.3;\",\r\n\t\t\"\tvec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);\",\r\n\t\t\"\tvec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);\",\r\n\t\t\"\tvec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);\",\r\n\t\t\"\tvec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);\",\r\n\t\t\"\tvec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);\",\r\n\t\t\"\tvec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);\",\r\n\r\n\t\t\"\tvec4  one = vec4( 1.0 );\",\r\n\r\n\t\t\"\tvec4 P = vec4((coords),vec2(scale, scale));\",\r\n\r\n\t\t\"\tvec4 dist = vec4(0.0);\",\r\n\t\t\"\tfloat inorout = -4.0;\",\r\n\r\n\t\t\"\tdist.x = dot( P, HS0 );\",\r\n\t\t\"\tdist.y = dot( P, HS1 );\",\r\n\t\t\"\tdist.z = dot( P, HS2 );\",\r\n\t\t\"\tdist.w = dot( P, HS3 );\",\r\n\r\n\t\t\"\tdist = smoothstep( -feather, feather, dist );\",\r\n\r\n\t\t\"\tinorout += dot( dist, one );\",\r\n\r\n\t\t\"\tdist.x = dot( P, HS4 );\",\r\n\t\t\"\tdist.y = HS5.w - abs( P.z );\",\r\n\r\n\t\t\"\tdist = smoothstep( -feather, feather, dist );\",\r\n\t\t\"\tinorout += dist.x;\",\r\n\r\n\t\t\"\treturn clamp( inorout, 0.0, 1.0 );\",\r\n\t\t\"}\",\r\n\r\n\t\t\"float bdepth(vec2 coords) {\",\r\n\t\t\"\t// Depth buffer blur\",\r\n\t\t\"\tfloat d = 0.0;\",\r\n\t\t\"\tfloat kernel[9];\",\r\n\t\t\"\tvec2 offset[9];\",\r\n\r\n\t\t\"\tvec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;\",\r\n\r\n\t\t\"\toffset[0] = vec2(-wh.x,-wh.y);\",\r\n\t\t\"\toffset[1] = vec2( 0.0, -wh.y);\",\r\n\t\t\"\toffset[2] = vec2( wh.x -wh.y);\",\r\n\r\n\t\t\"\toffset[3] = vec2(-wh.x,  0.0);\",\r\n\t\t\"\toffset[4] = vec2( 0.0,   0.0);\",\r\n\t\t\"\toffset[5] = vec2( wh.x,  0.0);\",\r\n\r\n\t\t\"\toffset[6] = vec2(-wh.x, wh.y);\",\r\n\t\t\"\toffset[7] = vec2( 0.0,  wh.y);\",\r\n\t\t\"\toffset[8] = vec2( wh.x, wh.y);\",\r\n\r\n\t\t\"\tkernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;\",\r\n\t\t\"\tkernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;\",\r\n\t\t\"\tkernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;\",\r\n\r\n\r\n\t\t\"\tfor( int i=0; i<9; i++ ) {\",\r\n\t\t\"\t\tfloat tmp = texture2D(tDepth, coords + offset[i]).r;\",\r\n\t\t\"\t\td += tmp * kernel[i];\",\r\n\t\t\"\t}\",\r\n\r\n\t\t\"\treturn d;\",\r\n\t\t\"}\",\r\n\r\n\r\n\t\t\"vec3 color(vec2 coords,float blur) {\",\r\n\t\t\"\t//processing the sample\",\r\n\r\n\t\t\"\tvec3 col = vec3(0.0);\",\r\n\t\t\"\tvec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);\",\r\n\r\n\t\t\"\tcol.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;\",\r\n\t\t\"\tcol.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;\",\r\n\t\t\"\tcol.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;\",\r\n\r\n\t\t\"\tvec3 lumcoeff = vec3(0.299,0.587,0.114);\",\r\n\t\t\"\tfloat lum = dot(col.rgb, lumcoeff);\",\r\n\t\t\"\tfloat thresh = max((lum-threshold)*gain, 0.0);\",\r\n\t\t\"\treturn col+mix(vec3(0.0),col,thresh*blur);\",\r\n\t\t\"}\",\r\n\r\n\t\t\"vec3 debugFocus(vec3 col, float blur, float depth) {\",\r\n\t\t\"\tfloat edge = 0.002*depth; //distance based edge smoothing\",\r\n\t\t\"\tfloat m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);\",\r\n\t\t\"\tfloat e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);\",\r\n\r\n\t\t\"\tcol = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);\",\r\n\t\t\"\tcol = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);\",\r\n\r\n\t\t\"\treturn col;\",\r\n\t\t\"}\",\r\n\r\n\t\t\"float linearize(float depth) {\",\r\n\t\t\"\treturn -zfar * znear / (depth * (zfar - znear) - zfar);\",\r\n\t\t\"}\",\r\n\r\n\r\n\t\t\"float vignette() {\",\r\n\t\t\"\tfloat dist = distance(vUv.xy, vec2(0.5,0.5));\",\r\n\t\t\"\tdist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);\",\r\n\t\t\"\treturn clamp(dist,0.0,1.0);\",\r\n\t\t\"}\",\r\n\r\n\t\t\"float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {\",\r\n\t\t\"\tfloat rings2 = float(rings);\",\r\n\t\t\"\tfloat step = PI*2.0 / float(ringsamples);\",\r\n\t\t\"\tfloat pw = cos(j*step)*i;\",\r\n\t\t\"\tfloat ph = sin(j*step)*i;\",\r\n\t\t\"\tfloat p = 1.0;\",\r\n\t\t\"\tif (pentagon) {\",\r\n\t\t\"\t\tp = penta(vec2(pw,ph));\",\r\n\t\t\"\t}\",\r\n\t\t\"\tcol += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;\",\r\n\t\t\"\treturn 1.0 * mix(1.0, i /rings2, bias) * p;\",\r\n\t\t\"}\",\r\n\r\n\t\t\"void main() {\",\r\n\t\t\"\t//scene depth calculation\",\r\n\r\n\t\t\"\tfloat depth = linearize(texture2D(tDepth,vUv.xy).x);\",\r\n\r\n\t\t\"\t// Blur depth?\",\r\n\t\t\"\tif ( depthblur ) {\",\r\n\t\t\"\t\tdepth = linearize(bdepth(vUv.xy));\",\r\n\t\t\"\t}\",\r\n\r\n\t\t\"\t//focal plane calculation\",\r\n\r\n\t\t\"\tfloat fDepth = focalDepth;\",\r\n\r\n\t\t\"\tif (shaderFocus) {\",\r\n\r\n\t\t\"\t\tfDepth = linearize(texture2D(tDepth,focusCoords).x);\",\r\n\r\n\t\t\"\t}\",\r\n\r\n\t\t\"\t// dof blur factor calculation\",\r\n\r\n\t\t\"\tfloat blur = 0.0;\",\r\n\r\n\t\t\"\tif (manualdof) {\",\r\n\t\t\"\t\tfloat a = depth-fDepth; // Focal plane\",\r\n\t\t\"\t\tfloat b = (a-fdofstart)/fdofdist; // Far DoF\",\r\n\t\t\"\t\tfloat c = (-a-ndofstart)/ndofdist; // Near Dof\",\r\n\t\t\"\t\tblur = (a>0.0) ? b : c;\",\r\n\t\t\"\t} else {\",\r\n\t\t\"\t\tfloat f = focalLength; // focal length in mm\",\r\n\t\t\"\t\tfloat d = fDepth*1000.0; // focal plane in mm\",\r\n\t\t\"\t\tfloat o = depth*1000.0; // depth in mm\",\r\n\r\n\t\t\"\t\tfloat a = (o*f)/(o-f);\",\r\n\t\t\"\t\tfloat b = (d*f)/(d-f);\",\r\n\t\t\"\t\tfloat c = (d-f)/(d*fstop*CoC);\",\r\n\r\n\t\t\"\t\tblur = abs(a-b)*c;\",\r\n\t\t\"\t}\",\r\n\r\n\t\t\"\tblur = clamp(blur,0.0,1.0);\",\r\n\r\n\t\t\"\t// calculation of pattern for dithering\",\r\n\r\n\t\t\"\tvec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;\",\r\n\r\n\t\t\"\t// getting blur x and y step factor\",\r\n\r\n\t\t\"\tfloat w = (1.0/textureWidth)*blur*maxblur+noise.x;\",\r\n\t\t\"\tfloat h = (1.0/textureHeight)*blur*maxblur+noise.y;\",\r\n\r\n\t\t\"\t// calculation of final color\",\r\n\r\n\t\t\"\tvec3 col = vec3(0.0);\",\r\n\r\n\t\t\"\tif(blur < 0.05) {\",\r\n\t\t\"\t\t//some optimization thingy\",\r\n\t\t\"\t\tcol = texture2D(tColor, vUv.xy).rgb;\",\r\n\t\t\"\t} else {\",\r\n\t\t\"\t\tcol = texture2D(tColor, vUv.xy).rgb;\",\r\n\t\t\"\t\tfloat s = 1.0;\",\r\n\t\t\"\t\tint ringsamples;\",\r\n\r\n\t\t\"\t\tfor (int i = 1; i <= rings; i++) {\",\r\n\t\t\"\t\t\t/*unboxstart*/\",\r\n\t\t\"\t\t\tringsamples = i * samples;\",\r\n\r\n\t\t\"\t\t\tfor (int j = 0 ; j < maxringsamples ; j++) {\",\r\n\t\t\"\t\t\t\tif (j >= ringsamples) break;\",\r\n\t\t\"\t\t\t\ts += gather(float(i), float(j), ringsamples, col, w, h, blur);\",\r\n\t\t\"\t\t\t}\",\r\n\t\t\"\t\t\t/*unboxend*/\",\r\n\t\t\"\t\t}\",\r\n\r\n\t\t\"\t\tcol /= s; //divide by sample count\",\r\n\t\t\"\t}\",\r\n\r\n\t\t\"\tif (showFocus) {\",\r\n\t\t\"\t\tcol = debugFocus(col, blur, depth);\",\r\n\t\t\"\t}\",\r\n\r\n\t\t\"\tif (vignetting) {\",\r\n\t\t\"\t\tcol *= vignette();\",\r\n\t\t\"\t}\",\r\n\r\n\t\t\"\tgl_FragColor.rgb = col;\",\r\n\t\t\"\tgl_FragColor.a = 1.0;\",\r\n\t\t\"} \"\r\n\r\n\t].join( \"\\n\" )\r\n\r\n};\r\n\r\nvar BokehDepthShader = {\r\n\r\n\tuniforms: {\r\n\r\n\t\t\"mNear\": { value: 1.0 },\r\n\t\t\"mFar\": { value: 1000.0 },\r\n\r\n\t},\r\n\r\n\tvertexShader: [\r\n\r\n\t\t\"varying float vViewZDepth;\",\r\n\r\n\t\t\"void main() {\",\r\n\r\n\t\t\"\t#include <begin_vertex>\",\r\n\t\t\"\t#include <project_vertex>\",\r\n\r\n\t\t\"\tvViewZDepth = - mvPosition.z;\",\r\n\r\n\t\t\"}\"\r\n\r\n\t].join( \"\\n\" ),\r\n\r\n\tfragmentShader: [\r\n\r\n\t\t\"uniform float mNear;\",\r\n\t\t\"uniform float mFar;\",\r\n\r\n\t\t\"varying float vViewZDepth;\",\r\n\r\n\t\t\"void main() {\",\r\n\r\n\t\t\"\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );\",\r\n\t\t\"\tgl_FragColor = vec4( vec3( color ), 1.0 );\",\r\n\r\n\t\t\"} \"\r\n\r\n\t].join( \"\\n\" )\r\n\r\n};\r\n\r\nexport { BokehShader, BokehDepthShader };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/shaders/BokehShader2.js"],"sourceRoot":""}