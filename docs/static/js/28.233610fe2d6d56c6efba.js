webpackJsonp([28],{"7mRf":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,a=r("wIBv"),i=r("6+nK");function n(e){this.IFF=e}function c(e){this.IFF=e}function o(){this.debugger=new u}function h(e){this.dv=new DataView(e),this.offset=0}function u(){this.active=!1,this.depth=0,this.formList=[]}function F(e){return e%2}function p(e){return e.length+1+(F(e.length+1)?1:0)}n.prototype={constructor:n,parseBlock:function(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();var e=this.IFF.reader.getIDTag(),t=this.IFF.reader.getUint32();switch(t>this.IFF.reader.dv.byteLength-this.IFF.reader.offset&&(this.IFF.reader.offset-=4,t=this.IFF.reader.getUint16()),this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=t,e){case"FORM":this.IFF.parseForm(t);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"AUVO":case"STCK":case"PROC":case"VALU":case"FUNC":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NVSK":case"NCRD":case"WRPW":case"WRPH":case"NMOD":case"NPRW":case"NPLA":case"NODS":case"VERS":case"ENUM":case"TAG ":case"OPAC":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"GLOW":case"GVAL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"SURF":this.IFF.parseSurfaceLwo2(t);break;case"CLIP":this.IFF.parseClipLwo2(t);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":4===t?this.IFF.currentNode[e]=this.IFF.reader.getInt32():this.IFF.reader.skip(t);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(t);break;case"PNTS":this.IFF.parsePoints(t);break;case"VMAP":this.IFF.parseVertexMapping(t);break;case"AUVU":case"AUVN":this.IFF.reader.skip(t-1),this.IFF.reader.getVariableLengthIndex();break;case"POLS":this.IFF.parsePolygonList(t);break;case"TAGS":this.IFF.parseTagStrings(t);break;case"PTAG":this.IFF.parsePolygonTagMapping(t);break;case"VMAD":this.IFF.parseVertexMapping(t,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":var r=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=r;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":4===t?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(t);break;case"SMAN":var s=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(s<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.reader.skip(2);break;case"TMAP":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(t);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;case"BLOK":break;default:this.IFF.parseUnknownCHUNK(e,t)}"FORM"!=e&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=e,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}},c.prototype={constructor:c,parseBlock:function(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();var e=this.IFF.reader.getIDTag(),t=this.IFF.reader.getUint32();switch(this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=t,e){case"FORM":this.IFF.parseForm(t);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"STCK":case"VALU":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NCRD":case"NMOD":case"NSEL":case"NPRW":case"NPLA":case"VERS":case"ENUM":case"TAG ":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"GLOW":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":4===t?this.IFF.currentNode[e]=this.IFF.reader.getInt32():this.IFF.reader.skip(t);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(t);break;case"PNTS":this.IFF.parsePoints(t);break;case"VMAP":this.IFF.parseVertexMapping(t);break;case"POLS":this.IFF.parsePolygonList(t);break;case"TAGS":this.IFF.parseTagStrings(t);break;case"PTAG":this.IFF.parsePolygonTagMapping(t);break;case"VMAD":this.IFF.parseVertexMapping(t,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":var r=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=r;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":4===t?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(t);break;case"SMAN":var s=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(s<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.currentSurface.attributes.imageMapIndex=this.IFF.reader.getUint32();break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(t);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;default:this.IFF.parseUnknownCHUNK(e,t)}"FORM"!=e&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=e,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}},o.prototype={constructor:o,parse:function(e){if(this.reader=new h(e),this.tree={materials:{},layers:[],tags:[],textures:[]},this.currentLayer=this.tree,this.currentForm=this.tree,this.parseTopForm(),void 0!==this.tree.format){if("LWO2"===this.tree.format)for(this.parser=new n(this);!this.reader.endOfFile();)this.parser.parseBlock();else if("LWO3"===this.tree.format)for(this.parser=new c(this);!this.reader.endOfFile();)this.parser.parseBlock();return this.debugger.offset=this.reader.offset,this.debugger.closeForms(),this.tree}},parseTopForm:function(){if(this.debugger.offset=this.reader.offset,"FORM"===this.reader.getIDTag()){var e=this.reader.getUint32();this.debugger.dataOffset=this.reader.offset,this.debugger.length=e;var t=this.reader.getIDTag();"LWO2"===t?this.tree.format=t:"LWO3"===t&&(this.tree.format=t),this.debugger.node=0,this.debugger.nodeID=t,this.debugger.log()}else console.warn("LWOLoader: Top-level FORM missing.")},parseForm:function(e){var t=this.reader.getIDTag();switch(t){case"ISEQ":case"ANIM":case"STCC":case"VPVL":case"VPRM":case"NROT":case"WRPW":case"WRPH":case"FUNC":case"FALL":case"OPAC":case"GRAD":case"ENVS":case"VMOP":case"VMBG":case"OMAX":case"STEX":case"CKBG":case"CKEY":case"VMLA":case"VMLB":this.debugger.skipped=!0,this.skipForm(e);break;case"META":case"NNDS":case"NODS":case"NDTA":case"ADAT":case"AOVS":case"BLOK":case"IBGC":case"IOPC":case"IIMG":case"TXTR":this.debugger.length=4,this.debugger.skipped=!0;break;case"IFAL":case"ISCL":case"IPOS":case"IROT":case"IBMP":case"IUTD":case"IVTD":this.parseTextureNodeAttribute(t);break;case"ENVL":this.parseEnvelope(e);break;case"CLIP":"LWO2"===this.tree.format?this.parseForm(e):this.parseClip(e);break;case"STIL":this.parseImage();break;case"XREF":this.reader.skip(8),this.currentForm.referenceTexture={index:this.reader.getUint32(),refName:this.reader.getString()};break;case"IMST":this.parseImageStateForm(e);break;case"SURF":this.parseSurfaceForm(e);break;case"VALU":this.parseValueForm(e);break;case"NTAG":this.parseSubNode(e);break;case"ATTR":case"SATR":this.setupForm("attributes",e);break;case"NCON":this.parseConnections(e);break;case"SSHA":this.parentForm=this.currentForm,this.currentForm=this.currentSurface,this.setupForm("surfaceShader",e);break;case"SSHD":this.setupForm("surfaceShaderData",e);break;case"ENTR":this.parseEntryForm(e);break;case"IMAP":this.parseImageMap(e);break;case"TAMP":this.parseXVAL("amplitude",e);break;case"TMAP":this.setupForm("textureMap",e);break;case"CNTR":this.parseXVAL3("center",e);break;case"SIZE":this.parseXVAL3("scale",e);break;case"ROTA":this.parseXVAL3("rotation",e);break;default:this.parseUnknownForm(t,e)}this.debugger.node=0,this.debugger.nodeID=t,this.debugger.log()},setupForm:function(e,t){this.currentForm||(this.currentForm=this.currentNode),this.currentFormEnd=this.reader.offset+t,this.parentForm=this.currentForm,this.currentForm[e]?(console.warn("LWOLoader: form already exists on parent: ",e,this.currentForm),this.currentForm=this.currentForm[e]):(this.currentForm[e]={},this.currentForm=this.currentForm[e])},skipForm:function(e){this.reader.skip(e-4)},parseUnknownForm:function(e,t){var r,s,a;console.warn("LWOLoader: unknown FORM encountered: "+e,t),r=this.reader.dv.buffer,s=this.reader.offset,a=t-4,console.log(i._15.decodeText(new Uint8Array(r,s,a))),this.reader.skip(t-4)},parseSurfaceForm:function(e){this.reader.skip(8);var t=this.reader.getString(),r={attributes:{},connections:{},name:t,inputName:t,nodes:{},source:this.reader.getString()};this.tree.materials[t]=r,this.currentSurface=r,this.parentForm=this.tree.materials,this.currentForm=r,this.currentFormEnd=this.reader.offset+e},parseSurfaceLwo2:function(e){var t=this.reader.getString(),r={attributes:{},connections:{},name:t,nodes:{},source:this.reader.getString()};this.tree.materials[t]=r,this.currentSurface=r,this.parentForm=this.tree.materials,this.currentForm=r,this.currentFormEnd=this.reader.offset+e},parseSubNode:function(e){this.reader.skip(8);var t={name:this.reader.getString()};this.currentForm=t,this.currentNode=t,this.currentFormEnd=this.reader.offset+e},parseConnections:function(e){this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.currentForm=this.currentSurface.connections},parseEntryForm:function(e){this.reader.skip(8);var t=this.reader.getString();this.currentForm=this.currentNode.attributes,this.setupForm(t,e)},parseValueForm:function(){this.reader.skip(8);var e=this.reader.getString();"double"===e?this.currentForm.value=this.reader.getUint64():"int"===e?this.currentForm.value=this.reader.getUint32():"vparam"===e?(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64()):"vparam3"===e&&(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64Array(3))},parseImageStateForm:function(){this.reader.skip(8),this.currentForm.mipMapLevel=this.reader.getFloat32()},parseImageMap:function(e){this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.currentForm.maps||(this.currentForm.maps=[]);var t={};this.currentForm.maps.push(t),this.currentForm=t,this.reader.skip(10)},parseTextureNodeAttribute:function(e){switch(this.reader.skip(28),this.reader.skip(20),e){case"ISCL":this.currentNode.scale=this.reader.getFloat32Array(3);break;case"IPOS":this.currentNode.position=this.reader.getFloat32Array(3);break;case"IROT":this.currentNode.rotation=this.reader.getFloat32Array(3);break;case"IFAL":this.currentNode.falloff=this.reader.getFloat32Array(3);break;case"IBMP":this.currentNode.amplitude=this.reader.getFloat32();break;case"IUTD":this.currentNode.uTiles=this.reader.getFloat32();break;case"IVTD":this.currentNode.vTiles=this.reader.getFloat32()}this.reader.skip(2)},parseEnvelope:function(e){this.reader.skip(e-4)},parseClip:function(e){if("FORM"===this.reader.getIDTag())return this.reader.skip(16),void(this.currentNode.fileName=this.reader.getString());this.reader.setOffset(this.reader.offset-4),this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.reader.skip(8);var t={index:this.reader.getUint32()};this.tree.textures.push(t),this.currentForm=t},parseClipLwo2:function(e){for(var t={index:this.reader.getUint32(),fileName:""};;){var r=this.reader.getIDTag(),s=this.reader.getUint16();if("STIL"===r){t.fileName=this.reader.getString();break}if(s>=e)break}this.tree.textures.push(t),this.currentForm=t},parseImage:function(){this.reader.skip(8),this.currentForm.fileName=this.reader.getString()},parseXVAL:function(e,t){var r=this.reader.offset+t-4;this.reader.skip(8),this.currentForm[e]=this.reader.getFloat32(),this.reader.setOffset(r)},parseXVAL3:function(e,t){var r=this.reader.offset+t-4;this.reader.skip(8),this.currentForm[e]={x:this.reader.getFloat32(),y:this.reader.getFloat32(),z:this.reader.getFloat32()},this.reader.setOffset(r)},parseObjectTag:function(){this.tree.objectTags||(this.tree.objectTags={}),this.tree.objectTags[this.reader.getIDTag()]={tagString:this.reader.getString()}},parseLayer:function(e){var t={number:this.reader.getUint16(),flags:this.reader.getUint16(),pivot:this.reader.getFloat32Array(3),name:this.reader.getString()};this.tree.layers.push(t),this.currentLayer=t;var r=16+p(this.currentLayer.name);this.currentLayer.parent=r<e?this.reader.getUint16():-1},parsePoints:function(e){this.currentPoints=[];for(var t=0;t<e/4;t+=3)this.currentPoints.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32())},parseVertexMapping:function(e,t){var r=this.reader.offset+e,s=this.reader.getString();if(this.reader.offset!==r){this.reader.setOffset(this.reader.offset-p(s));var a=this.reader.getIDTag();this.reader.getUint16();var i=this.reader.getString(),n=e-6-p(i);switch(a){case"TXUV":this.parseUVMapping(i,r,t);break;case"MORF":case"SPOT":this.parseMorphTargets(i,r,a);break;case"APSL":case"NORM":case"WGHT":case"MNVW":case"PICK":case"RGB ":case"RGBA":this.reader.skip(n);break;default:console.warn("LWOLoader: unknown vertex map type: "+a),this.reader.skip(n)}}else this.currentForm.UVChannel=s},parseUVMapping:function(e,t,r){for(var s=[],a=[],i=[];this.reader.offset<t;)s.push(this.reader.getVariableLengthIndex()),r&&a.push(this.reader.getVariableLengthIndex()),i.push(this.reader.getFloat32(),this.reader.getFloat32());r?(this.currentLayer.discontinuousUVs||(this.currentLayer.discontinuousUVs={}),this.currentLayer.discontinuousUVs[e]={uvIndices:s,polyIndices:a,uvs:i}):(this.currentLayer.uvs||(this.currentLayer.uvs={}),this.currentLayer.uvs[e]={uvIndices:s,uvs:i})},parseMorphTargets:function(e,t,r){var s=[],a=[];for(r="MORF"===r?"relative":"absolute";this.reader.offset<t;)s.push(this.reader.getVariableLengthIndex()),a.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32());this.currentLayer.morphTargets||(this.currentLayer.morphTargets={}),this.currentLayer.morphTargets[e]={indices:s,points:a,type:r}},parsePolygonList:function(e){for(var t=this.reader.offset+e,r=this.reader.getIDTag(),s=[],a=[];this.reader.offset<t;){var i=this.reader.getUint16();i&=1023,a.push(i);for(var n=0;n<i;n++)s.push(this.reader.getVariableLengthIndex())}var c={type:r,vertexIndices:s,polygonDimensions:a,points:this.currentPoints};1===a[0]?c.type="points":2===a[0]&&(c.type="lines"),this.currentLayer.geometry=c},parseTagStrings:function(e){this.tree.tags=this.reader.getStringArray(e)},parsePolygonTagMapping:function(e){var t=this.reader.offset+e;"SURF"===this.reader.getIDTag()?this.parseMaterialIndices(t):this.reader.skip(e-4)},parseMaterialIndices:function(e){for(this.currentLayer.geometry.materialIndices=[];this.reader.offset<e;){var t=this.reader.getVariableLengthIndex(),r=this.reader.getUint16();this.currentLayer.geometry.materialIndices.push(t,r)}},parseUnknownCHUNK:function(e,t){console.warn("LWOLoader: unknown chunk type: "+e+" length: "+t);var r=this.reader.getString(t);this.currentForm[e]=r}},h.prototype={constructor:h,size:function(){return this.dv.buffer.byteLength},setOffset:function(e){e>0&&e<this.dv.buffer.byteLength?this.offset=e:console.error("LWOLoader: invalid buffer offset")},endOfFile:function(){return this.offset>=this.size()},skip:function(e){this.offset+=e},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getUint16:function(){var e=this.dv.getUint16(this.offset);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,!1);return this.offset+=4,e},getUint32:function(){var e=this.dv.getUint32(this.offset,!1);return this.offset+=4,e},getUint64:function(){return 4294967296*this.getUint32()+this.getUint32()},getFloat32:function(){var e=this.dv.getFloat32(this.offset,!1);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getVariableLengthIndex:function(){var e=this.getUint8();return 255===e?65536*this.getUint8()+256*this.getUint8()+this.getUint8():256*e+this.getUint8()},getIDTag:function(){return this.getString(4)},getString:function(e){if(0!==e){var t=[];if(e)for(var r=0;r<e;r++)t[r]=this.getUint8();else{for(var s,a=0;0!==s;)0!==(s=this.getUint8())&&t.push(s),a++;F(a+1)||this.getUint8()}return i._15.decodeText(new Uint8Array(t))}},getStringArray:function(e){var t=this.getString(e);return(t=t.split("\0")).filter(Boolean)}},u.prototype={constructor:u,enable:function(){this.active=!0},log:function(){if(this.active){var e;switch(this.node){case 0:e="FORM";break;case 1:e="CHK";break;case 2:e="S-CHK"}console.log("| ".repeat(this.depth)+e,this.nodeID,"( "+this.offset+" ) -> ( "+(this.dataOffset+this.length)+" )",0==this.node?" {":"",this.skipped?"SKIPPED":"",0==this.node&&this.skipped?"}":""),0!=this.node||this.skipped||(this.depth+=1,this.formList.push(this.dataOffset+this.length)),this.skipped=!1}},closeForms:function(){if(this.active)for(var e=this.formList.length-1;e>=0;e--)this.offset>=this.formList[e]&&(this.depth-=1,console.log("| ".repeat(this.depth)+"}"),this.formList.splice(-1,1))}};var d=function(e,t){i._14.call(this,e),t=t||{},this.resourcePath=void 0!==t.resourcePath?t.resourcePath:""};function g(e){this.textureLoader=e}function f(e){this.textureLoader=e}function I(){}d.prototype=Object.assign(Object.create(i._14.prototype),{constructor:d,load:function(e,t,r,s){var a=this,n=""===a.path?function(e,t){var r=e.indexOf(t);return-1===r?"./":e.substr(0,r)}(e,"Objects"):a.path,c=e.split(n).pop().split(".")[0],o=new i.L(this.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.load(e,function(r){try{t(a.parse(r,n,c))}catch(t){s?s(t):console.error(t),a.manager.itemError(e)}},r,s)},parse:function(e,t,r){return s=(new o).parse(e),new g(new i._80(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin)).parse(r)}}),g.prototype={constructor:g,parse:function(e){return this.materials=new f(this.textureLoader).parse(),this.defaultLayerName=e,this.meshes=this.parseLayers(),{materials:this.materials,meshes:this.meshes}},parseLayers:function(){var e=[],t=[],r=new I,a=this;return s.layers.forEach(function(s){var i=r.parse(s.geometry,s),n=a.parseMesh(i,s);e[s.number]=n,-1===s.parent?t.push(n):e[s.parent].add(n)}),this.applyPivots(t),t},parseMesh:function(e,t){var r,s=this.getMaterials(e.userData.matNames,t.geometry.type);return this.duplicateUVs(e,s),r="points"===t.geometry.type?new i._45(e,s):"lines"===t.geometry.type?new i._9(e,s):new i._22(e,s),t.name?r.name=t.name:r.name=this.defaultLayerName+"_layer_"+t.number,r.userData.pivot=t.pivot,r},applyPivots:function(e){e.forEach(function(e){e.traverse(function(e){var t=e.userData.pivot;if(e.position.x+=t[0],e.position.y+=t[1],e.position.z+=t[2],e.parent){var r=e.parent.userData.pivot;e.position.x-=r[0],e.position.y-=r[1],e.position.z-=r[2]}})})},getMaterials:function(e,t){var r=[],s=this;e.forEach(function(e,t){r[t]=s.getMaterialByName(e)}),"points"!==t&&"lines"!==t||r.forEach(function(e,s){var a={color:e.color};"points"===t?(a.size=.1,a.map=e.map,a.morphTargets=e.morphTargets,r[s]=new i._46(a)):"lines"===t&&(r[s]=new i._7(a))});var a=r.filter(Boolean);return 1===a.length?a[0]:r},getMaterialByName:function(e){return this.materials.filter(function(t){return t.name===e})[0]},duplicateUVs:function(e,t){var r=!1;Array.isArray(t)?t.forEach(function(e){e.aoMap&&(r=!0)}):t.aoMap&&(r=!0),r&&e.setAttribute("uv2",new i.j(e.attributes.uv.array,2))}},f.prototype={constructor:f,parse:function(){var e=[];for(var t in this.textures={},s.materials)"LWO3"===s.format?e.push(this.parseMaterial(s.materials[t],t,s.textures)):"LWO2"===s.format&&e.push(this.parseMaterialLwo2(s.materials[t],t,s.textures));return e},parseMaterial:function(e,t,r){var s={name:t,side:this.getSide(e.attributes),flatShading:this.getSmooth(e.attributes)},a=this.parseConnections(e.connections,e.nodes),i=this.parseTextureNodes(a.maps);this.parseAttributeImageMaps(a.attributes,r,i,e.maps);var n=this.parseAttributes(a.attributes,i);return this.parseEnvMap(a,i,n),s=Object.assign(i,s),s=Object.assign(s,n),new(this.getMaterialType(a.attributes))(s)},parseMaterialLwo2:function(e,t){var r={name:t,side:this.getSide(e.attributes),flatShading:this.getSmooth(e.attributes)},s=this.parseAttributes(e.attributes,{});return r=Object.assign(r,s),new i._25(r)},getSide:function(e){if(!e.side)return i.f;switch(e.side){case 0:case 1:return i.f;case 2:return i.O;case 3:return i.E}},getSmooth:function(e){return!e.smooth||!e.smooth},parseConnections:function(e,t){var r={maps:{}},s=e.inputName,a=e.inputNodeName,i=e.nodeName,n=this;return s.forEach(function(e,s){if("Material"===e){var i=n.getNodeByRefName(a[s],t);r.attributes=i.attributes,r.envMap=i.fileName,r.name=a[s]}}),i.forEach(function(e,i){e===r.name&&(r.maps[s[i]]=n.getNodeByRefName(a[i],t))}),r},getNodeByRefName:function(e,t){for(var r in t)if(t[r].refName===e)return t[r]},parseTextureNodes:function(e){var t={};for(var r in e){var s=e[r],a=s.fileName;if(!a)return;var n=this.loadTexture(a);switch(void 0!==s.widthWrappingMode&&(n.wrapS=this.getWrappingType(s.widthWrappingMode)),void 0!==s.heightWrappingMode&&(n.wrapT=this.getWrappingType(s.heightWrappingMode)),r){case"Color":t.map=n;break;case"Roughness":t.roughnessMap=n,t.roughness=.5;break;case"Specular":t.specularMap=n,t.specular=16777215;break;case"Luminous":t.emissiveMap=n,t.emissive=8421504;break;case"Luminous Color":t.emissive=8421504;break;case"Metallic":t.metalnessMap=n,t.metalness=.5;break;case"Transparency":case"Alpha":t.alphaMap=n,t.transparent=!0;break;case"Normal":t.normalMap=n,void 0!==s.amplitude&&(t.normalScale=new i._91(s.amplitude,s.amplitude));break;case"Bump":t.bumpMap=n}}return t.roughnessMap&&t.specularMap&&delete t.specularMap,t},parseAttributeImageMaps:function(e,t,r){for(var s in e){var a=e[s];if(a.maps){var i=a.maps[0],n=this.getTexturePathByIndex(i.imageIndex,t);if(!n)return;var c=this.loadTexture(n);switch(void 0!==i.wrap&&(c.wrapS=this.getWrappingType(i.wrap.w)),void 0!==i.wrap&&(c.wrapT=this.getWrappingType(i.wrap.h)),s){case"Color":r.map=c;break;case"Diffuse":r.aoMap=c;break;case"Roughness":r.roughnessMap=c,r.roughness=1;break;case"Specular":r.specularMap=c,r.specular=16777215;break;case"Luminosity":r.emissiveMap=c,r.emissive=8421504;break;case"Metallic":r.metalnessMap=c,r.metalness=1;break;case"Transparency":case"Alpha":r.alphaMap=c,r.transparent=!0;break;case"Normal":r.normalMap=c;break;case"Bump":r.bumpMap=c}}}},parseAttributes:function(e,t){var r={};return e.Color&&!t.map?r.color=(new i.p).fromArray(e.Color.value):r.color=new i.p,e.Transparency&&0!==e.Transparency.value&&(r.opacity=1-e.Transparency.value,r.transparent=!0),e["Bump Height"]&&(r.bumpScale=.1*e["Bump Height"].value),e["Refraction Index"]&&(r.refractionRatio=1/e["Refraction Index"].value),this.parsePhysicalAttributes(r,e,t),this.parseStandardAttributes(r,e,t),this.parsePhongAttributes(r,e,t),r},parsePhysicalAttributes:function(e,t){t.Clearcoat&&t.Clearcoat.value>0&&(e.clearcoat=t.Clearcoat.value,t["Clearcoat Gloss"]&&(e.clearcoatRoughness=.5*(1-t["Clearcoat Gloss"].value)))},parseStandardAttributes:function(e,t,r){t.Luminous&&(e.emissiveIntensity=t.Luminous.value,t["Luminous Color"]&&!r.emissive?e.emissive=(new i.p).fromArray(t["Luminous Color"].value):e.emissive=new i.p(8421504)),t.Roughness&&!r.roughnessMap&&(e.roughness=t.Roughness.value),t.Metallic&&!r.metalnessMap&&(e.metalness=t.Metallic.value)},parsePhongAttributes:function(e,t,r){t.Diffuse&&e.color.multiplyScalar(t.Diffuse.value),t.Reflection&&(e.reflectivity=t.Reflection.value,e.combine=i.a),t.Luminosity&&(e.emissiveIntensity=t.Luminosity.value,r.emissiveMap||r.map?e.emissive=new i.p(8421504):e.emissive=e.color),t.Roughness||!t.Specular||r.specularMap||(t["Color Highlight"]?e.specular=(new i.p).setScalar(t.Specular.value).lerp(e.color.clone().multiplyScalar(t.Specular.value),t["Color Highlight"].value):e.specular=(new i.p).setScalar(t.Specular.value)),e.specular&&t.Glossiness&&(e.shininess=7+Math.pow(2,12*t.Glossiness.value+2))},parseEnvMap:function(e,t,r){if(e.envMap){var s=this.loadTexture(e.envMap);r.transparent&&r.opacity<.999?(s.mapping=i.H,void 0!==r.reflectivity&&(delete r.reflectivity,delete r.combine),void 0!==r.metalness&&delete r.metalness):s.mapping=i.G,t.envMap=s}},getTexturePathByIndex:function(e){var t="";return s.textures?(s.textures.forEach(function(r){r.index===e&&(t=r.fileName)}),t):t},loadTexture:function(e){return e?this.textureLoader.load(e,void 0,void 0,function(){console.warn("LWOLoader: non-standard resource hierarchy. Use `resourcePath` parameter to specify root content directory.")}):null},getWrappingType:function(e){switch(e){case 0:return console.warn('LWOLoader: "Reset" texture wrapping type is not supported in three.js'),i.n;case 1:return i._64;case 2:return i._28;case 3:return i.n}},getMaterialType:function(e){return e.Clearcoat&&e.Clearcoat.value>0?i._26:e.Roughness?i._27:i._25}},I.prototype={constructor:I,parse:function(e,t){var r=new i.k;r.setAttribute("position",new i.M(e.points,3));var s=this.splitIndices(e.vertexIndices,e.polygonDimensions);return r.setIndex(s),this.parseGroups(r,e),r.computeVertexNormals(),this.parseUVs(r,t,s),this.parseMorphTargets(r,t,s),r.translate(-t.pivot[0],-t.pivot[1],-t.pivot[2]),r},splitIndices:function(e,t){var r=[],s=0;return t.forEach(function(t){if(t<4)for(var a=0;a<t;a++)r.push(e[s+a]);else if(4===t)r.push(e[s],e[s+1],e[s+2],e[s],e[s+2],e[s+3]);else if(t>4){for(a=1;a<t-1;a++)r.push(e[s],e[s+a],e[s+a+1]);console.warn("LWOLoader: polygons with greater than 4 sides are not supported")}s+=t}),r},parseGroups:function(e,t){var r=s.tags,a=[],i=3;"lines"===t.type&&(i=2),"points"===t.type&&(i=1);for(var n,c=this.splitMaterialIndices(t.polygonDimensions,t.materialIndices),o=0,h={},u=0,F=0,p=0;p<c.length;p+=2){var d,g=c[p+1];if(0===p&&(a[o]=r[g]),void 0===n&&(n=g),g!==n)h[r[n]]?d=h[r[n]]:(d=o,h[r[n]]=o,a[o]=r[n],o++),e.addGroup(u,F,d),u+=F,n=g,F=0;F+=i}e.groups.length>0&&(h[r[g]]?d=h[r[g]]:(d=o,h[r[g]]=o,a[o]=r[g]),e.addGroup(u,F,d));e.userData.matNames=a},splitMaterialIndices:function(e,t){var r=[];return e.forEach(function(e,s){if(e<=3)r.push(t[2*s],t[2*s+1]);else if(4===e)r.push(t[2*s],t[2*s+1],t[2*s],t[2*s+1]);else for(var a=0;a<e-2;a++)r.push(t[2*s],t[2*s+1])}),r},parseUVs:function(e,t){var r=Array.from(Array(2*e.attributes.position.count),function(){return 0});for(var s in t.uvs){var a=t.uvs[s].uvs;t.uvs[s].uvIndices.forEach(function(e,t){r[2*e]=a[2*t],r[2*e+1]=a[2*t+1]})}e.setAttribute("uv",new i.M(r,2))},parseMorphTargets:function(e,t){var r=0;for(var s in t.morphTargets){var a=e.attributes.position.array.slice();e.morphAttributes.position||(e.morphAttributes.position=[]);var n=t.morphTargets[s].points,c=t.morphTargets[s].indices,o=t.morphTargets[s].type;c.forEach(function(e,t){"relative"===o?(a[3*e]+=n[3*t],a[3*e+1]+=n[3*t+1],a[3*e+2]+=n[3*t+2]):(a[3*e]=n[3*t],a[3*e+1]=n[3*t+1],a[3*e+2]=n[3*t+2])}),e.morphAttributes.position[r]=new i.M(a,3),e.morphAttributes.position[r].name=s,r++}e.morphTargetsRelative=!1}};var l={data:function(){return{camera:null,scene:null,renderer:null}},mounted:function(){this.init()},methods:{init:function(){var e=this,t=document.createElement("div");document.getElementsByClassName("webglLoaderLwo-container")[0].appendChild(t),this.camera=new this.$THREE.PerspectiveCamera(45,this.$webglInnerWidth/window.innerHeight,1,200),this.camera.position.set(-.7,14.6,43.2),this.scene=new this.$THREE.Scene,this.scene.background=new this.$THREE.Color(10526880);var r=new this.$THREE.AmbientLight(11184810,1.75);this.scene.add(r);var s=new this.$THREE.DirectionalLight(16777215,1);s.position.set(0,200,100),s.castShadow=!0,s.shadow.camera.top=180,s.shadow.camera.bottom=-100,s.shadow.camera.left=-120,s.shadow.camera.right=120,this.scene.add(s);var i=new this.$THREE.DirectionalLight(16777215,.7);i.position.set(-100,200,-100),this.scene.add(i);var n=new this.$THREE.DirectionalLight(16777215,.4);n.position.set(100,-200,100),this.scene.add(n);var c=new this.$THREE.DirectionalLight(16777215,1);c.position.set(-100,-100,100),this.scene.add(c);var o=new this.$THREE.GridHelper(200,20,0,0);o.material.opacity=.3,o.material.transparent=!0,this.scene.add(o),(new d).load("static/models/lwo/Objects/LWO3/Demo.lwo",function(t){var r=t.meshes[0];r.position.set(-2,12,0);var s=t.meshes[1];s.position.set(2,12,0);var a=t.meshes[2];a.position.set(0,10.5,-1),e.scene.add(r,s,a)}),this.renderer=new this.$THREE.WebGLRenderer({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.$webglInnerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.renderer.physicallyCorrectLights=!0,this.renderer.gammaFactor=1.18,this.renderer.outputEncoding=this.$THREE.sRGBEncoding,t.appendChild(this.renderer.domElement);var h=new a.a(this.camera,this.renderer.domElement);h.target.set(1.33,10,-6.7),h.update(),this.renderer.setAnimationLoop(function(){e.renderer.render(e.scene,e.camera)}),window.addEventListener("resize",this.onWindowResize,!1)},onWindowResize:function(){this.$onWindowResize(this.camera,this.renderer)}}},m={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"webglLoaderLwo-container"},[r("div",{attrs:{id:"info"}},[r("a",{attrs:{href:"https://threejs.org",target:"_blank",rel:"noopener"}},[e._v("three.js")]),e._v(" - LWOLoader\n\t\t\t"),r("P",[e._v("Lightwave Object loader by "),r("a",{attrs:{href:"https://discoverthreejs.com/",target:"_blank",rel:"noopener"}},[e._v("Discover three.js")])]),e._v("\n\t\t\tModels by "),r("a",{attrs:{href:"https://onthez.com/",target:"_blank",rel:"noopener"}},[e._v("on the z")]),e._v(" - Environment images by "),r("a",{attrs:{href:"https://hdrihaven.com/",target:"_blank",rel:"noopener"}},[e._v("HDRI Haven")])],1)])},staticRenderFns:[]};var b=r("VU/8")(l,m,!1,function(e){r("LSPy")},"data-v-f7784c4a",null);t.default=b.exports},LSPy:function(e,t){}});
//# sourceMappingURL=28.233610fe2d6d56c6efba.js.map