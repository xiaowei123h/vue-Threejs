{"version":3,"sources":["webpack:///./src/components/jsm/loaders/LWOLoader.js","webpack:///./src/components/jsm/loaders/lwo/LWO2Parser.js","webpack:///./src/components/jsm/loaders/lwo/LWO3Parser.js","webpack:///./src/components/jsm/loaders/lwo/IFFParser.js","webpack:///src/views/loader/webglLoaderLwo.vue","webpack:///./src/views/loader/webglLoaderLwo.vue?8940","webpack:///./src/views/loader/webglLoaderLwo.vue"],"names":["lwoTree","LWO2Parser","IFFParser","this","IFF","LWO3Parser","debugger","Debugger","DataViewReader","buffer","dv","DataView","offset","active","depth","formList","isEven","num","stringOffset","string","length","prototype","constructor","parseBlock","reader","closeForms","blockID","getIDTag","getUint32","byteLength","getUint16","dataOffset","parseForm","skipped","skip","parseSurfaceLwo2","parseClipLwo2","currentNode","getInt32","parseObjectTag","parseLayer","parsePoints","parseVertexMapping","getVariableLengthIndex","parsePolygonList","parseTagStrings","parsePolygonTagMapping","currentForm","description","getString","comment","channelName","wrap","w","h","index","imageIndex","referenceObject","referenceObjectID","currentSurface","surfaceShaderName","surfaceCustomAOVName","disabled","realName","refName","nodes","nodeName","push","inputNodeName","inputName","inputOutputName","fileName","textureChannel","maxSmoothingAngle","getFloat32","attributes","smooth","Color","value","getFloat32Array","Luminosity","Specular","Diffuse","Reflection","Glossiness","opacity","bumpStrength","side","reflectionMap","refractiveIndex","refractionMap","UVChannel","widthWrappingMode","heightWrappingMode","parseUnknownCHUNK","node","nodeID","log","currentFormEnd","parentForm","imageMapIndex","parse","tree","materials","layers","tags","textures","currentLayer","parseTopForm","undefined","format","parser","endOfFile","type","console","warn","skipForm","parseTextureNodeAttribute","parseEnvelope","parseClip","parseImage","referenceTexture","parseImageStateForm","parseSurfaceForm","parseValueForm","parseSubNode","setupForm","parseConnections","parseEntryForm","parseImageMap","parseXVAL","parseXVAL3","parseUnknownForm","from","to","LoaderUtils","decodeText","Uint8Array","name","surface","connections","source","valueType","getUint64","getFloat64","getFloat64Array","mipMapLevel","maps","map","scale","position","rotation","falloff","amplitude","uTiles","vTiles","setOffset","texture","tag","n_length","endOffset","x","y","z","objectTags","tagString","layer","number","flags","pivot","parsedLength","parent","currentPoints","i","discontinuous","finalOffset","remainingLength","parseUVMapping","parseMorphTargets","uvIndices","polyIndices","uvs","discontinuousUVs","indices","points","morphTargets","polygonDimensions","numverts","j","geometryData","vertexIndices","geometry","getStringArray","parseMaterialIndices","materialIndices","polygonIndex","materialIndex","data","size","error","getUint8","a","littleEndian","firstByte","currentChar","len","split","filter","Boolean","enable","nodeType","repeat","splice","LWOLoader","manager","parameters","Loader","call","resourcePath","LWOTreeParser","textureLoader","MaterialParser","GeometryParser","Object","assign","create","load","url","onLoad","onProgress","onError","scope","path","dir","indexOf","substr","extractParentUrl","modelName","pop","loader","FileLoader","setPath","setResponseType","e","itemError","iffBuffer","TextureLoader","setCrossOrigin","crossOrigin","defaultLayerName","meshes","parseLayers","finalMeshes","geometryParser","forEach","mesh","parseMesh","add","applyPivots","getMaterials","userData","matNames","duplicateUVs","Points","LineSegments","Mesh","traverse","child","parentPivot","namesArray","getMaterialByName","mat","spec","color","PointsMaterial","LineBasicMaterial","filtered","m","Array","isArray","material","aoMap","setAttribute","BufferAttribute","uv","array","parseMaterial","parseMaterialLwo2","materialData","params","getSide","flatShading","getSmooth","parseTextureNodes","parseAttributeImageMaps","parseAttributes","parseEnvMap","getMaterialType","MeshPhongMaterial","BackSide","FrontSide","DoubleSide","materialConnections","matNode","getNodeByRefName","envMap","textureNodes","loadTexture","wrapS","getWrappingType","wrapT","roughnessMap","roughness","specularMap","specular","emissiveMap","emissive","metalnessMap","metalness","alphaMap","transparent","normalMap","normalScale","Vector2","bumpMap","attribute","mapData","getTexturePathByIndex","fromArray","Transparency","bumpScale","refractionRatio","parsePhysicalAttributes","parseStandardAttributes","parsePhongAttributes","Clearcoat","clearcoat","clearcoatRoughness","Luminous","emissiveIntensity","Roughness","Metallic","multiplyScalar","reflectivity","combine","AddOperation","setScalar","lerp","clone","shininess","Math","pow","mapping","EquirectangularRefractionMapping","EquirectangularReflectionMapping","ClampToEdgeWrapping","RepeatWrapping","MirroredRepeatWrapping","nodeData","MeshPhysicalMaterial","MeshStandardMaterial","geoData","BufferGeometry","Float32BufferAttribute","splitIndices","setIndex","parseGroups","computeVertexNormals","parseUVs","translate","remappedIndices","dim","k","elemSize","prevMaterialIndex","splitMaterialIndices","indexNum","indexPairs","prevStart","currentCount","currentIndex","addGroup","groups","remappedUVs","count","remappedPoints","slice","morphAttributes","morphPoints","morphIndices","morphTargetsRelative","webglLoaderLwo","camera","scene","renderer","mounted","init","methods","_this","container","document","createElement","getElementsByClassName","appendChild","$THREE","PerspectiveCamera","$webglInnerWidth","window","innerHeight","set","Scene","background","ambientLight","AmbientLight","light1","DirectionalLight","castShadow","shadow","top","bottom","left","right","light2","light3","light4","grid","GridHelper","LWOLoader_LWOLoader","object","phong","standard","rocket","WebGLRenderer","antialias","setPixelRatio","devicePixelRatio","setSize","shadowMap","enabled","physicallyCorrectLights","gammaFactor","outputEncoding","sRGBEncoding","domElement","controls","OrbitControls","target","update","setAnimationLoop","render","addEventListener","onWindowResize","$onWindowResize","loader_webglLoaderLwo","_vm","_h","$createElement","_c","_self","staticClass","attrs","id","href","rel","_v","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/28.233610fe2d6d56c6efba.js","sourcesContent":["/**\r\n * @version 1.1.1\r\n *\r\n * @desc Load files in LWO3 and LWO2 format on Three.js\r\n *\r\n * LWO3 format specification:\r\n * \thttp://static.lightwave3d.com/sdk/2018/html/filefmts/lwo3.html\r\n *\r\n * LWO2 format specification:\r\n * \thttp://static.lightwave3d.com/sdk/2018/html/filefmts/lwo2.html\r\n *\r\n **/\r\n\r\nimport {\r\n\tAddOperation,\r\n\tBackSide,\r\n\tBufferAttribute,\r\n\tBufferGeometry,\r\n\tClampToEdgeWrapping,\r\n\tColor,\r\n\tDoubleSide,\r\n\tEquirectangularReflectionMapping,\r\n\tEquirectangularRefractionMapping,\r\n\tFileLoader,\r\n\tFloat32BufferAttribute,\r\n\tFrontSide,\r\n\tLineBasicMaterial,\r\n\tLineSegments,\r\n\tLoader,\r\n\tMesh,\r\n\tMeshPhongMaterial,\r\n\tMeshPhysicalMaterial,\r\n\tMeshStandardMaterial,\r\n\tMirroredRepeatWrapping,\r\n\tPoints,\r\n\tPointsMaterial,\r\n\tRepeatWrapping,\r\n\tTextureLoader,\r\n\tVector2\r\n} from \"@/components/build/three.module.js\";\r\n\r\nimport { IFFParser } from \"./lwo/IFFParser.js\";\r\n\r\nvar lwoTree;\r\n\r\nvar LWOLoader = function ( manager, parameters ) {\r\n\r\n\tLoader.call( this, manager );\r\n\r\n\tparameters = parameters || {};\r\n\r\n\tthis.resourcePath = ( parameters.resourcePath !== undefined ) ? parameters.resourcePath : '';\r\n\r\n};\r\n\r\nLWOLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\tconstructor: LWOLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar path = ( scope.path === '' ) ? extractParentUrl( url, 'Objects' ) : scope.path;\r\n\r\n\t\t// give the mesh a default name based on the filename\r\n\t\tvar modelName = url.split( path ).pop().split( '.' )[ 0 ];\r\n\r\n\t\tvar loader = new FileLoader( this.manager );\r\n\t\tloader.setPath( scope.path );\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\r\n\t\tloader.load( url, function ( buffer ) {\r\n\r\n\t\t\t// console.time( 'Total parsing: ' );\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\tonLoad( scope.parse( buffer, path, modelName ) );\r\n\r\n\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\tif ( onError ) {\r\n\r\n\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.manager.itemError( url );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// console.timeEnd( 'Total parsing: ' );\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tparse: function ( iffBuffer, path, modelName ) {\r\n\r\n\t\tlwoTree = new IFFParser().parse( iffBuffer );\r\n\r\n\t\t// console.log( 'lwoTree', lwoTree );\r\n\r\n\t\tvar textureLoader = new TextureLoader( this.manager ).setPath( this.resourcePath || path ).setCrossOrigin( this.crossOrigin );\r\n\r\n\t\treturn new LWOTreeParser( textureLoader ).parse( modelName );\r\n\r\n\t}\r\n\r\n} );\r\n\r\n// Parse the lwoTree object\r\nfunction LWOTreeParser( textureLoader ) {\r\n\r\n\tthis.textureLoader = textureLoader;\r\n\r\n}\r\n\r\nLWOTreeParser.prototype = {\r\n\r\n\tconstructor: LWOTreeParser,\r\n\r\n\tparse: function ( modelName ) {\r\n\r\n\t\tthis.materials = new MaterialParser( this.textureLoader ).parse();\r\n\t\tthis.defaultLayerName = modelName;\r\n\r\n\t\tthis.meshes = this.parseLayers();\r\n\r\n\t\treturn {\r\n\t\t\tmaterials: this.materials,\r\n\t\t\tmeshes: this.meshes,\r\n\t\t};\r\n\r\n\t},\r\n\r\n\tparseLayers() {\r\n\r\n\t\t// array of all meshes for building hierarchy\r\n\t\tvar meshes = [];\r\n\r\n\t\t// final array containing meshes with scene graph hierarchy set up\r\n\t\tvar finalMeshes = [];\r\n\r\n\t\tvar geometryParser = new GeometryParser();\r\n\r\n\t\tvar scope = this;\r\n\t\tlwoTree.layers.forEach( function ( layer ) {\r\n\r\n\t\t\tvar geometry = geometryParser.parse( layer.geometry, layer );\r\n\r\n\t\t\tvar mesh = scope.parseMesh( geometry, layer );\r\n\r\n\t\t\tmeshes[ layer.number ] = mesh;\r\n\r\n\t\t\tif ( layer.parent === - 1 ) finalMeshes.push( mesh );\r\n\t\t\telse meshes[ layer.parent ].add( mesh );\r\n\r\n\r\n\t\t} );\r\n\r\n\t\tthis.applyPivots( finalMeshes );\r\n\r\n\t\treturn finalMeshes;\r\n\r\n\t},\r\n\r\n\tparseMesh( geometry, layer ) {\r\n\r\n\t\tvar mesh;\r\n\r\n\t\tvar materials = this.getMaterials( geometry.userData.matNames, layer.geometry.type );\r\n\r\n\t\tthis.duplicateUVs( geometry, materials );\r\n\r\n\t\tif ( layer.geometry.type === 'points' ) mesh = new Points( geometry, materials );\r\n\t\telse if ( layer.geometry.type === 'lines' ) mesh = new LineSegments( geometry, materials );\r\n\t\telse mesh = new Mesh( geometry, materials );\r\n\r\n\t\tif ( layer.name ) mesh.name = layer.name;\r\n\t\telse mesh.name = this.defaultLayerName + '_layer_' + layer.number;\r\n\r\n\t\tmesh.userData.pivot = layer.pivot;\r\n\r\n\t\treturn mesh;\r\n\r\n\t},\r\n\r\n\t// TODO: may need to be reversed in z to convert LWO to three.js coordinates\r\n\tapplyPivots( meshes ) {\r\n\r\n\t\tmeshes.forEach( function ( mesh ) {\r\n\r\n\t\t\tmesh.traverse( function ( child ) {\r\n\r\n\t\t\t\tvar pivot = child.userData.pivot;\r\n\r\n\t\t\t\tchild.position.x += pivot[ 0 ];\r\n\t\t\t\tchild.position.y += pivot[ 1 ];\r\n\t\t\t\tchild.position.z += pivot[ 2 ];\r\n\r\n\t\t\t\tif ( child.parent ) {\r\n\r\n\t\t\t\t\tvar parentPivot = child.parent.userData.pivot;\r\n\r\n\t\t\t\t\tchild.position.x -= parentPivot[ 0 ];\r\n\t\t\t\t\tchild.position.y -= parentPivot[ 1 ];\r\n\t\t\t\t\tchild.position.z -= parentPivot[ 2 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t},\r\n\r\n\tgetMaterials( namesArray, type ) {\r\n\r\n\t\tvar materials = [];\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tnamesArray.forEach( function ( name, i ) {\r\n\r\n\t\t\tmaterials[ i ] = scope.getMaterialByName( name );\r\n\r\n\t\t} );\r\n\r\n\t\t// convert materials to line or point mats if required\r\n\t\tif ( type === 'points' || type === 'lines' ) {\r\n\r\n\t\t\tmaterials.forEach( function ( mat, i ) {\r\n\r\n\t\t\t\tvar spec = {\r\n\t\t\t\t\tcolor: mat.color,\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif ( type === 'points' ) {\r\n\r\n\t\t\t\t\tspec.size = 0.1;\r\n\t\t\t\t\tspec.map = mat.map;\r\n\t\t\t\t\tspec.morphTargets = mat.morphTargets;\r\n\t\t\t\t\tmaterials[ i ] = new PointsMaterial( spec );\r\n\r\n\t\t\t\t} else if ( type === 'lines' ) {\r\n\r\n\t\t\t\t\tmaterials[ i ] = new LineBasicMaterial( spec );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\t// if there is only one material, return that directly instead of array\r\n\t\tvar filtered = materials.filter( Boolean );\r\n\t\tif ( filtered.length === 1 ) return filtered[ 0 ];\r\n\r\n\t\treturn materials;\r\n\r\n\t},\r\n\r\n\tgetMaterialByName( name ) {\r\n\r\n\t\treturn this.materials.filter( function ( m ) {\r\n\r\n\t\t\treturn m.name === name;\r\n\r\n\t\t} )[ 0 ];\r\n\r\n\t},\r\n\r\n\t// If the material has an aoMap, duplicate UVs\r\n\tduplicateUVs( geometry, materials ) {\r\n\r\n\t\tvar duplicateUVs = false;\r\n\r\n\t\tif ( ! Array.isArray( materials ) ) {\r\n\r\n\t\t\tif ( materials.aoMap ) duplicateUVs = true;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmaterials.forEach( function ( material ) {\r\n\r\n\t\t\t\tif ( material.aoMap ) duplicateUVs = true;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! duplicateUVs ) return;\r\n\r\n\t\tgeometry.setAttribute( 'uv2', new BufferAttribute( geometry.attributes.uv.array, 2 ) );\r\n\r\n\t},\r\n\r\n};\r\n\r\nfunction MaterialParser( textureLoader ) {\r\n\r\n\tthis.textureLoader = textureLoader;\r\n\r\n}\r\n\r\nMaterialParser.prototype = {\r\n\r\n\tconstructor: MaterialParser,\r\n\r\n\tparse: function () {\r\n\r\n\t\tvar materials = [];\r\n\t\tthis.textures = {};\r\n\r\n\t\tfor ( var name in lwoTree.materials ) {\r\n\r\n\t\t\tif ( lwoTree.format === 'LWO3' ) {\r\n\r\n\t\t\t\tmaterials.push( this.parseMaterial( lwoTree.materials[ name ], name, lwoTree.textures ) );\r\n\r\n\t\t\t} else if ( lwoTree.format === 'LWO2' ) {\r\n\r\n\t\t\t\tmaterials.push( this.parseMaterialLwo2( lwoTree.materials[ name ], name, lwoTree.textures ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn materials;\r\n\r\n\t},\r\n\r\n\tparseMaterial( materialData, name, textures ) {\r\n\r\n\t\tvar params = {\r\n\t\t\tname: name,\r\n\t\t\tside: this.getSide( materialData.attributes ),\r\n\t\t\tflatShading: this.getSmooth( materialData.attributes ),\r\n\t\t};\r\n\r\n\t\tvar connections = this.parseConnections( materialData.connections, materialData.nodes );\r\n\r\n\t\tvar maps = this.parseTextureNodes( connections.maps );\r\n\r\n\t\tthis.parseAttributeImageMaps( connections.attributes, textures, maps, materialData.maps );\r\n\r\n\t\tvar attributes = this.parseAttributes( connections.attributes, maps );\r\n\r\n\t\tthis.parseEnvMap( connections, maps, attributes );\r\n\r\n\t\tparams = Object.assign( maps, params );\r\n\t\tparams = Object.assign( params, attributes );\r\n\r\n\t\tvar materialType = this.getMaterialType( connections.attributes );\r\n\r\n\t\treturn new materialType( params );\r\n\r\n\t},\r\n\r\n\tparseMaterialLwo2( materialData, name/*, textures*/ ) {\r\n\r\n\t\tvar params = {\r\n\t\t\tname: name,\r\n\t\t\tside: this.getSide( materialData.attributes ),\r\n\t\t\tflatShading: this.getSmooth( materialData.attributes ),\r\n\t\t};\r\n\r\n\t\tvar attributes = this.parseAttributes( materialData.attributes, {} );\r\n\t\tparams = Object.assign( params, attributes );\r\n\t\treturn new MeshPhongMaterial( params );\r\n\r\n\t},\r\n\r\n\t// Note: converting from left to right handed coords by switching x -> -x in vertices, and\r\n\t// then switching mat FrontSide -> BackSide\r\n\t// NB: this means that FrontSide and BackSide have been switched!\r\n\tgetSide( attributes ) {\r\n\r\n\t\tif ( ! attributes.side ) return BackSide;\r\n\r\n\t\tswitch ( attributes.side ) {\r\n\r\n\t\t\tcase 0:\r\n\t\t\tcase 1:\r\n\t\t\t\treturn BackSide;\r\n\t\t\tcase 2: return FrontSide;\r\n\t\t\tcase 3: return DoubleSide;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetSmooth( attributes ) {\r\n\r\n\t\tif ( ! attributes.smooth ) return true;\r\n\t\treturn ! attributes.smooth;\r\n\r\n\t},\r\n\r\n\tparseConnections( connections, nodes ) {\r\n\r\n\t\tvar materialConnections = {\r\n\t\t\tmaps: {}\r\n\t\t};\r\n\r\n\t\tvar inputName = connections.inputName;\r\n\t\tvar inputNodeName = connections.inputNodeName;\r\n\t\tvar nodeName = connections.nodeName;\r\n\r\n\t\tvar scope = this;\r\n\t\tinputName.forEach( function ( name, index ) {\r\n\r\n\t\t\tif ( name === 'Material' ) {\r\n\r\n\t\t\t\tvar matNode = scope.getNodeByRefName( inputNodeName[ index ], nodes );\r\n\t\t\t\tmaterialConnections.attributes = matNode.attributes;\r\n\t\t\t\tmaterialConnections.envMap = matNode.fileName;\r\n\t\t\t\tmaterialConnections.name = inputNodeName[ index ];\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tnodeName.forEach( function ( name, index ) {\r\n\r\n\t\t\tif ( name === materialConnections.name ) {\r\n\r\n\t\t\t\tmaterialConnections.maps[ inputName[ index ] ] = scope.getNodeByRefName( inputNodeName[ index ], nodes );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\treturn materialConnections;\r\n\r\n\t},\r\n\r\n\tgetNodeByRefName( refName, nodes ) {\r\n\r\n\t\tfor ( var name in nodes ) {\r\n\r\n\t\t\tif ( nodes[ name ].refName === refName ) return nodes[ name ];\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tparseTextureNodes( textureNodes ) {\r\n\r\n\t\tvar maps = {};\r\n\r\n\t\tfor ( var name in textureNodes ) {\r\n\r\n\t\t\tvar node = textureNodes[ name ];\r\n\t\t\tvar path = node.fileName;\r\n\r\n\t\t\tif ( ! path ) return;\r\n\r\n\t\t\tvar texture = this.loadTexture( path );\r\n\r\n\t\t\tif ( node.widthWrappingMode !== undefined ) texture.wrapS = this.getWrappingType( node.widthWrappingMode );\r\n\t\t\tif ( node.heightWrappingMode !== undefined ) texture.wrapT = this.getWrappingType( node.heightWrappingMode );\r\n\r\n\t\t\tswitch ( name ) {\r\n\r\n\t\t\t\tcase 'Color':\r\n\t\t\t\t\tmaps.map = texture;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Roughness':\r\n\t\t\t\t\tmaps.roughnessMap = texture;\r\n\t\t\t\t\tmaps.roughness = 0.5;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Specular':\r\n\t\t\t\t\tmaps.specularMap = texture;\r\n\t\t\t\t\tmaps.specular = 0xffffff;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Luminous':\r\n\t\t\t\t\tmaps.emissiveMap = texture;\r\n\t\t\t\t\tmaps.emissive = 0x808080;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Luminous Color':\r\n\t\t\t\t\tmaps.emissive = 0x808080;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Metallic':\r\n\t\t\t\t\tmaps.metalnessMap = texture;\r\n\t\t\t\t\tmaps.metalness = 0.5;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Transparency':\r\n\t\t\t\tcase 'Alpha':\r\n\t\t\t\t\tmaps.alphaMap = texture;\r\n\t\t\t\t\tmaps.transparent = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Normal':\r\n\t\t\t\t\tmaps.normalMap = texture;\r\n\t\t\t\t\tif ( node.amplitude !== undefined ) maps.normalScale = new Vector2( node.amplitude, node.amplitude );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Bump':\r\n\t\t\t\t\tmaps.bumpMap = texture;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// LWO BSDF materials can have both spec and rough, but this is not valid in three\r\n\t\tif ( maps.roughnessMap && maps.specularMap ) delete maps.specularMap;\r\n\r\n\t\treturn maps;\r\n\r\n\t},\r\n\r\n\t// maps can also be defined on individual material attributes, parse those here\r\n\t// This occurs on Standard (Phong) surfaces\r\n\tparseAttributeImageMaps( attributes, textures, maps ) {\r\n\r\n\t\tfor ( var name in attributes ) {\r\n\r\n\t\t\tvar attribute = attributes[ name ];\r\n\r\n\t\t\tif ( attribute.maps ) {\r\n\r\n\t\t\t\tvar mapData = attribute.maps[ 0 ];\r\n\r\n\t\t\t\tvar path = this.getTexturePathByIndex( mapData.imageIndex, textures );\r\n\t\t\t\tif ( ! path ) return;\r\n\r\n\t\t\t\tvar texture = this.loadTexture( path );\r\n\r\n\t\t\t\tif ( mapData.wrap !== undefined ) texture.wrapS = this.getWrappingType( mapData.wrap.w );\r\n\t\t\t\tif ( mapData.wrap !== undefined ) texture.wrapT = this.getWrappingType( mapData.wrap.h );\r\n\r\n\t\t\t\tswitch ( name ) {\r\n\r\n\t\t\t\t\tcase 'Color':\r\n\t\t\t\t\t\tmaps.map = texture;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Diffuse':\r\n\t\t\t\t\t\tmaps.aoMap = texture;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Roughness':\r\n\t\t\t\t\t\tmaps.roughnessMap = texture;\r\n\t\t\t\t\t\tmaps.roughness = 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Specular':\r\n\t\t\t\t\t\tmaps.specularMap = texture;\r\n\t\t\t\t\t\tmaps.specular = 0xffffff;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Luminosity':\r\n\t\t\t\t\t\tmaps.emissiveMap = texture;\r\n\t\t\t\t\t\tmaps.emissive = 0x808080;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Metallic':\r\n\t\t\t\t\t\tmaps.metalnessMap = texture;\r\n\t\t\t\t\t\tmaps.metalness = 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Transparency':\r\n\t\t\t\t\tcase 'Alpha':\r\n\t\t\t\t\t\tmaps.alphaMap = texture;\r\n\t\t\t\t\t\tmaps.transparent = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Normal':\r\n\t\t\t\t\t\tmaps.normalMap = texture;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Bump':\r\n\t\t\t\t\t\tmaps.bumpMap = texture;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tparseAttributes( attributes, maps ) {\r\n\r\n\t\tvar params = {};\r\n\r\n\t\t// don't use color data if color map is present\r\n\t\tif ( attributes.Color && ! maps.map ) {\r\n\r\n\t\t\tparams.color = new Color().fromArray( attributes.Color.value );\r\n\r\n\t\t} else params.color = new Color();\r\n\r\n\r\n\t\tif ( attributes.Transparency && attributes.Transparency.value !== 0 ) {\r\n\r\n\t\t\tparams.opacity = 1 - attributes.Transparency.value;\r\n\t\t\tparams.transparent = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( attributes[ 'Bump Height' ] ) params.bumpScale = attributes[ 'Bump Height' ].value * 0.1;\r\n\r\n\t\tif ( attributes[ 'Refraction Index' ] ) params.refractionRatio = 1 / attributes[ 'Refraction Index' ].value;\r\n\r\n\t\tthis.parsePhysicalAttributes( params, attributes, maps );\r\n\t\tthis.parseStandardAttributes( params, attributes, maps );\r\n\t\tthis.parsePhongAttributes( params, attributes, maps );\r\n\r\n\t\treturn params;\r\n\r\n\t},\r\n\r\n\tparsePhysicalAttributes( params, attributes/*, maps*/ ) {\r\n\r\n\t\tif ( attributes.Clearcoat && attributes.Clearcoat.value > 0 ) {\r\n\r\n\t\t\tparams.clearcoat = attributes.Clearcoat.value;\r\n\r\n\t\t\tif ( attributes[ 'Clearcoat Gloss' ] ) {\r\n\r\n\t\t\t\tparams.clearcoatRoughness = 0.5 * ( 1 - attributes[ 'Clearcoat Gloss' ].value );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tparseStandardAttributes( params, attributes, maps ) {\r\n\r\n\r\n\t\tif ( attributes.Luminous ) {\r\n\r\n\t\t\tparams.emissiveIntensity = attributes.Luminous.value;\r\n\r\n\t\t\tif ( attributes[ 'Luminous Color' ] && ! maps.emissive ) {\r\n\r\n\t\t\t\tparams.emissive = new Color().fromArray( attributes[ 'Luminous Color' ].value );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tparams.emissive = new Color( 0x808080 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( attributes.Roughness && ! maps.roughnessMap ) params.roughness = attributes.Roughness.value;\r\n\t\tif ( attributes.Metallic && ! maps.metalnessMap ) params.metalness = attributes.Metallic.value;\r\n\r\n\t},\r\n\r\n\tparsePhongAttributes( params, attributes, maps ) {\r\n\r\n\t\tif ( attributes.Diffuse ) params.color.multiplyScalar( attributes.Diffuse.value );\r\n\r\n\t\tif ( attributes.Reflection ) {\r\n\r\n\t\t\tparams.reflectivity = attributes.Reflection.value;\r\n\t\t\tparams.combine = AddOperation;\r\n\r\n\t\t}\r\n\r\n\t\tif ( attributes.Luminosity ) {\r\n\r\n\t\t\tparams.emissiveIntensity = attributes.Luminosity.value;\r\n\r\n\t\t\tif ( ! maps.emissiveMap && ! maps.map ) {\r\n\r\n\t\t\t\tparams.emissive = params.color;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tparams.emissive = new Color( 0x808080 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// parse specular if there is no roughness - we will interpret the material as 'Phong' in this case\r\n\t\tif ( ! attributes.Roughness && attributes.Specular && ! maps.specularMap ) {\r\n\r\n\t\t\tif ( attributes[ 'Color Highlight' ] ) {\r\n\r\n\t\t\t\tparams.specular = new Color().setScalar( attributes.Specular.value ).lerp( params.color.clone().multiplyScalar( attributes.Specular.value ), attributes[ 'Color Highlight' ].value );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tparams.specular = new Color().setScalar( attributes.Specular.value );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( params.specular && attributes.Glossiness ) params.shininess = 7 + Math.pow( 2, attributes.Glossiness.value * 12 + 2 );\r\n\r\n\t},\r\n\r\n\tparseEnvMap( connections, maps, attributes ) {\r\n\r\n\t\tif ( connections.envMap ) {\r\n\r\n\t\t\tvar envMap = this.loadTexture( connections.envMap );\r\n\r\n\t\t\tif ( attributes.transparent && attributes.opacity < 0.999 ) {\r\n\r\n\t\t\t\tenvMap.mapping = EquirectangularRefractionMapping;\r\n\r\n\t\t\t\t// Reflectivity and refraction mapping don't work well together in Phong materials\r\n\t\t\t\tif ( attributes.reflectivity !== undefined ) {\r\n\r\n\t\t\t\t\tdelete attributes.reflectivity;\r\n\t\t\t\t\tdelete attributes.combine;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( attributes.metalness !== undefined ) {\r\n\r\n\t\t\t\t\tdelete attributes.metalness;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else envMap.mapping = EquirectangularReflectionMapping;\r\n\r\n\t\t\tmaps.envMap = envMap;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t// get texture defined at top level by its index\r\n\tgetTexturePathByIndex( index ) {\r\n\r\n\t\tvar fileName = '';\r\n\r\n\t\tif ( ! lwoTree.textures ) return fileName;\r\n\r\n\t\tlwoTree.textures.forEach( function ( texture ) {\r\n\r\n\t\t\tif ( texture.index === index ) fileName = texture.fileName;\r\n\r\n\t\t} );\r\n\r\n\t\treturn fileName;\r\n\r\n\t},\r\n\r\n\tloadTexture( path ) {\r\n\r\n\t\tif ( ! path ) return null;\r\n\r\n\t\tvar texture;\r\n\r\n\t\ttexture = this.textureLoader.load(\r\n\t\t\tpath,\r\n\t\t\tundefined,\r\n\t\t\tundefined,\r\n\t\t\tfunction () {\r\n\r\n\t\t\t\tconsole.warn( 'LWOLoader: non-standard resource hierarchy. Use \\`resourcePath\\` parameter to specify root content directory.' );\r\n\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\treturn texture;\r\n\r\n\t},\r\n\r\n\t// 0 = Reset, 1 = Repeat, 2 = Mirror, 3 = Edge\r\n\tgetWrappingType( num ) {\r\n\r\n\t\tswitch ( num ) {\r\n\r\n\t\t\tcase 0:\r\n\t\t\t\tconsole.warn( 'LWOLoader: \"Reset\" texture wrapping type is not supported in three.js' );\r\n\t\t\t\treturn ClampToEdgeWrapping;\r\n\t\t\tcase 1: return RepeatWrapping;\r\n\t\t\tcase 2: return MirroredRepeatWrapping;\r\n\t\t\tcase 3: return ClampToEdgeWrapping;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetMaterialType( nodeData ) {\r\n\r\n\t\tif ( nodeData.Clearcoat && nodeData.Clearcoat.value > 0 ) return MeshPhysicalMaterial;\r\n\t\tif ( nodeData.Roughness ) return MeshStandardMaterial;\r\n\t\treturn MeshPhongMaterial;\r\n\r\n\t}\r\n\r\n};\r\n\r\nfunction GeometryParser() {}\r\n\r\nGeometryParser.prototype = {\r\n\r\n\tconstructor: GeometryParser,\r\n\r\n\tparse( geoData, layer ) {\r\n\r\n\t\tvar geometry = new BufferGeometry();\r\n\r\n\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( geoData.points, 3 ) );\r\n\r\n\t\tvar indices = this.splitIndices( geoData.vertexIndices, geoData.polygonDimensions );\r\n\t\tgeometry.setIndex( indices );\r\n\r\n\t\tthis.parseGroups( geometry, geoData );\r\n\r\n\t\tgeometry.computeVertexNormals();\r\n\r\n\t\tthis.parseUVs( geometry, layer, indices );\r\n\t\tthis.parseMorphTargets( geometry, layer, indices );\r\n\r\n\t\t// TODO: z may need to be reversed to account for coordinate system change\r\n\t\tgeometry.translate( - layer.pivot[ 0 ], - layer.pivot[ 1 ], - layer.pivot[ 2 ] );\r\n\r\n\t\t// var userData = geometry.userData;\r\n\t\t// geometry = geometry.toNonIndexed()\r\n\t\t// geometry.userData = userData;\r\n\r\n\t\treturn geometry;\r\n\r\n\t},\r\n\r\n\t// split quads into tris\r\n\tsplitIndices( indices, polygonDimensions ) {\r\n\r\n\t\tvar remappedIndices = [];\r\n\r\n\t\tvar i = 0;\r\n\t\tpolygonDimensions.forEach( function ( dim ) {\r\n\r\n\t\t\tif ( dim < 4 ) {\r\n\r\n\t\t\t\tfor ( var k = 0; k < dim; k ++ ) remappedIndices.push( indices[ i + k ] );\r\n\r\n\t\t\t} else if ( dim === 4 ) {\r\n\r\n\t\t\t\tremappedIndices.push(\r\n\t\t\t\t\tindices[ i ],\r\n\t\t\t\t\tindices[ i + 1 ],\r\n\t\t\t\t\tindices[ i + 2 ],\r\n\r\n\t\t\t\t\tindices[ i ],\r\n\t\t\t\t\tindices[ i + 2 ],\r\n\t\t\t\t\tindices[ i + 3 ]\r\n\r\n\t\t\t\t);\r\n\r\n\t\t\t} else if ( dim > 4 ) {\r\n\r\n\t\t\t\tfor ( var k = 1; k < dim - 1; k ++ ) {\r\n\r\n\t\t\t\t\tremappedIndices.push( indices[ i ], indices[ i + k ], indices[ i + k + 1 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconsole.warn( 'LWOLoader: polygons with greater than 4 sides are not supported' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\ti += dim;\r\n\r\n\t\t} );\r\n\r\n\t\treturn remappedIndices;\r\n\r\n\t},\r\n\r\n\t// NOTE: currently ignoring poly indices and assuming that they are intelligently ordered\r\n\tparseGroups( geometry, geoData ) {\r\n\r\n\t\tvar tags = lwoTree.tags;\r\n\t\tvar matNames = [];\r\n\r\n\t\tvar elemSize = 3;\r\n\t\tif ( geoData.type === 'lines' ) elemSize = 2;\r\n\t\tif ( geoData.type === 'points' ) elemSize = 1;\r\n\r\n\t\tvar remappedIndices = this.splitMaterialIndices( geoData.polygonDimensions, geoData.materialIndices );\r\n\r\n\t\tvar indexNum = 0; // create new indices in numerical order\r\n\t\tvar indexPairs = {}; // original indices mapped to numerical indices\r\n\r\n\t\tvar prevMaterialIndex;\r\n\r\n\t\tvar prevStart = 0;\r\n\t\tvar currentCount = 0;\r\n\r\n\t\tfor ( var i = 0; i < remappedIndices.length; i += 2 ) {\r\n\r\n\t\t\tvar materialIndex = remappedIndices[ i + 1 ];\r\n\r\n\t\t\tif ( i === 0 ) matNames[ indexNum ] = tags[ materialIndex ];\r\n\r\n\t\t\tif ( prevMaterialIndex === undefined ) prevMaterialIndex = materialIndex;\r\n\r\n\t\t\tif ( materialIndex !== prevMaterialIndex ) {\r\n\r\n\t\t\t\tvar currentIndex;\r\n\t\t\t\tif ( indexPairs[ tags[ prevMaterialIndex ] ] ) {\r\n\r\n\t\t\t\t\tcurrentIndex = indexPairs[ tags[ prevMaterialIndex ] ];\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tcurrentIndex = indexNum;\r\n\t\t\t\t\tindexPairs[ tags[ prevMaterialIndex ] ] = indexNum;\r\n\t\t\t\t\tmatNames[ indexNum ] = tags[ prevMaterialIndex ];\r\n\t\t\t\t\tindexNum ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.addGroup( prevStart, currentCount, currentIndex );\r\n\r\n\t\t\t\tprevStart += currentCount;\r\n\r\n\t\t\t\tprevMaterialIndex = materialIndex;\r\n\t\t\t\tcurrentCount = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurrentCount += elemSize;\r\n\r\n\t\t}\r\n\r\n\t\t// the loop above doesn't add the last group, do that here.\r\n\t\tif ( geometry.groups.length > 0 ) {\r\n\r\n\t\t\tvar currentIndex;\r\n\t\t\tif ( indexPairs[ tags[ materialIndex ] ] ) {\r\n\r\n\t\t\t\tcurrentIndex = indexPairs[ tags[ materialIndex ] ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tcurrentIndex = indexNum;\r\n\t\t\t\tindexPairs[ tags[ materialIndex ] ] = indexNum;\r\n\t\t\t\tmatNames[ indexNum ] = tags[ materialIndex ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.addGroup( prevStart, currentCount, currentIndex );\r\n\r\n\t\t}\r\n\r\n\t\t// Mat names from TAGS chunk, used to build up an array of materials for this geometry\r\n\t\tgeometry.userData.matNames = matNames;\r\n\r\n\t},\r\n\r\n\tsplitMaterialIndices( polygonDimensions, indices ) {\r\n\r\n\t\tvar remappedIndices = [];\r\n\r\n\t\tpolygonDimensions.forEach( function ( dim, i ) {\r\n\r\n\t\t\tif ( dim <= 3 ) {\r\n\r\n\t\t\t\tremappedIndices.push( indices[ i * 2 ], indices[ i * 2 + 1 ] );\r\n\r\n\t\t\t} else if ( dim === 4 ) {\r\n\r\n\t\t\t\tremappedIndices.push( indices[ i * 2 ], indices[ i * 2 + 1 ], indices[ i * 2 ], indices[ i * 2 + 1 ] );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t // ignore > 4 for now\r\n\t\t\t\tfor ( var k = 0; k < dim - 2; k ++ ) {\r\n\r\n\t\t\t\t\tremappedIndices.push( indices[ i * 2 ], indices[ i * 2 + 1 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\treturn remappedIndices;\r\n\r\n\t},\r\n\r\n\t// UV maps:\r\n\t// 1: are defined via index into an array of points, not into a geometry\r\n\t// - the geometry is also defined by an index into this array, but the indexes may not match\r\n\t// 2: there can be any number of UV maps for a single geometry. Here these are combined,\r\n\t// \twith preference given to the first map encountered\r\n\t// 3: UV maps can be partial - that is, defined for only a part of the geometry\r\n\t// 4: UV maps can be VMAP or VMAD (discontinuous, to allow for seams). In practice, most\r\n\t// UV maps are defined as partially VMAP and partially VMAD\r\n\t// VMADs are currently not supported\r\n\tparseUVs( geometry, layer ) {\r\n\r\n\t\t// start by creating a UV map set to zero for the whole geometry\r\n\t\tvar remappedUVs = Array.from( Array( geometry.attributes.position.count * 2 ), function () {\r\n\r\n\t\t\treturn 0;\r\n\r\n\t\t} );\r\n\r\n\t\tfor ( var name in layer.uvs ) {\r\n\r\n\t\t\tvar uvs = layer.uvs[ name ].uvs;\r\n\t\t\tvar uvIndices = layer.uvs[ name ].uvIndices;\r\n\r\n\t\t\tuvIndices.forEach( function ( i, j ) {\r\n\r\n\t\t\t\tremappedUVs[ i * 2 ] = uvs[ j * 2 ];\r\n\t\t\t\tremappedUVs[ i * 2 + 1 ] = uvs[ j * 2 + 1 ];\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tgeometry.setAttribute( 'uv', new Float32BufferAttribute( remappedUVs, 2 ) );\r\n\r\n\t},\r\n\r\n\tparseMorphTargets( geometry, layer ) {\r\n\r\n\t\tvar num = 0;\r\n\t\tfor ( var name in layer.morphTargets ) {\r\n\r\n\t\t\tvar remappedPoints = geometry.attributes.position.array.slice();\r\n\r\n\t\t\tif ( ! geometry.morphAttributes.position ) geometry.morphAttributes.position = [];\r\n\r\n\t\t\tvar morphPoints = layer.morphTargets[ name ].points;\r\n\t\t\tvar morphIndices = layer.morphTargets[ name ].indices;\r\n\t\t\tvar type = layer.morphTargets[ name ].type;\r\n\r\n\t\t\tmorphIndices.forEach( function ( i, j ) {\r\n\r\n\t\t\t\tif ( type === 'relative' ) {\r\n\r\n\t\t\t\t\tremappedPoints[ i * 3 ] += morphPoints[ j * 3 ];\r\n\t\t\t\t\tremappedPoints[ i * 3 + 1 ] += morphPoints[ j * 3 + 1 ];\r\n\t\t\t\t\tremappedPoints[ i * 3 + 2 ] += morphPoints[ j * 3 + 2 ];\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tremappedPoints[ i * 3 ] = morphPoints[ j * 3 ];\r\n\t\t\t\t\tremappedPoints[ i * 3 + 1 ] = morphPoints[ j * 3 + 1 ];\r\n\t\t\t\t\tremappedPoints[ i * 3 + 2 ] = morphPoints[ j * 3 + 2 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tgeometry.morphAttributes.position[ num ] = new Float32BufferAttribute( remappedPoints, 3 );\r\n\t\t\tgeometry.morphAttributes.position[ num ].name = name;\r\n\r\n\t\t\tnum ++;\r\n\r\n\t\t}\r\n\r\n\t\tgeometry.morphTargetsRelative = false;\r\n\r\n\t},\r\n\r\n};\r\n\r\n\r\n// ************** UTILITY FUNCTIONS **************\r\n\r\nfunction extractParentUrl( url, dir ) {\r\n\r\n\tvar index = url.indexOf( dir );\r\n\r\n\tif ( index === - 1 ) return './';\r\n\r\n\treturn url.substr( 0, index );\r\n\r\n}\r\n\r\nexport { LWOLoader };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/loaders/LWOLoader.js","function LWO2Parser( IFFParser ) {\r\n\r\n\tthis.IFF = IFFParser;\r\n\r\n}\r\n\r\nLWO2Parser.prototype = {\r\n\r\n\tconstructor: LWO2Parser,\r\n\r\n\tparseBlock: function () {\r\n\r\n\t\tthis.IFF.debugger.offset = this.IFF.reader.offset;\r\n\t\tthis.IFF.debugger.closeForms();\r\n\r\n\t\tvar blockID = this.IFF.reader.getIDTag();\r\n\t\tvar length = this.IFF.reader.getUint32(); // size of data in bytes\r\n\t\tif ( length > this.IFF.reader.dv.byteLength - this.IFF.reader.offset ) {\r\n\r\n\t\t\tthis.IFF.reader.offset -= 4;\r\n\t\t\tlength = this.IFF.reader.getUint16();\r\n\r\n\t\t}\r\n\r\n\t\tthis.IFF.debugger.dataOffset = this.IFF.reader.offset;\r\n\t\tthis.IFF.debugger.length = length;\r\n\r\n\t\t// Data types may be found in either LWO2 OR LWO3 spec\r\n\t\tswitch ( blockID ) {\r\n\r\n\t\t\tcase 'FORM': // form blocks may consist of sub -chunks or sub-forms\r\n\t\t\t\tthis.IFF.parseForm( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// SKIPPED CHUNKS\r\n\t\t\t// if break; is called directly, the position in the lwoTree is not created\r\n\t\t\t// any sub chunks and forms are added to the parent form instead\r\n\t\t\t// MISC skipped\r\n\t\t\tcase 'ICON': // Thumbnail Icon Image\r\n\t\t\tcase 'VMPA': // Vertex Map Parameter\r\n\t\t\tcase 'BBOX': // bounding box\r\n\t\t\t// case 'VMMD':\r\n\t\t\t// case 'VTYP':\r\n\r\n\t\t\t// normal maps can be specified, normally on models imported from other applications. Currently ignored\r\n\t\t\tcase 'NORM':\r\n\r\n\t\t\t// ENVL FORM skipped\r\n\t\t\tcase 'PRE ':\r\n\t\t\tcase 'POST':\r\n\t\t\tcase 'KEY ':\r\n\t\t\tcase 'SPAN':\r\n\r\n\t\t\t// CLIP FORM skipped\r\n\t\t\tcase 'TIME':\r\n\t\t\tcase 'CLRS':\r\n\t\t\tcase 'CLRA':\r\n\t\t\tcase 'FILT':\r\n\t\t\tcase 'DITH':\r\n\t\t\tcase 'CONT':\r\n\t\t\tcase 'BRIT':\r\n\t\t\tcase 'SATR':\r\n\t\t\tcase 'HUE ':\r\n\t\t\tcase 'GAMM':\r\n\t\t\tcase 'NEGA':\r\n\t\t\tcase 'IFLT':\r\n\t\t\tcase 'PFLT':\r\n\r\n\t\t\t// Image Map Layer skipped\r\n\t\t\tcase 'PROJ':\r\n\t\t\tcase 'AXIS':\r\n\t\t\tcase 'AAST':\r\n\t\t\tcase 'PIXB':\r\n\t\t\tcase 'AUVO':\r\n\t\t\tcase 'STCK':\r\n\r\n\t\t\t// Procedural Textures skipped\r\n\t\t\tcase 'PROC':\r\n\t\t\tcase 'VALU':\r\n\t\t\tcase 'FUNC':\r\n\r\n\t\t\t// Gradient Textures skipped\r\n\t\t\tcase 'PNAM':\r\n\t\t\tcase 'INAM':\r\n\t\t\tcase 'GRST':\r\n\t\t\tcase 'GREN':\r\n\t\t\tcase 'GRPT':\r\n\t\t\tcase 'FKEY':\r\n\t\t\tcase 'IKEY':\r\n\r\n\t\t\t// Texture Mapping Form skipped\r\n\t\t\tcase 'CSYS':\r\n\r\n\t\t\t// Surface CHUNKs skipped\r\n\t\t\tcase 'OPAQ': // top level 'opacity' checkbox\r\n\t\t\tcase 'CMAP': // clip map\r\n\r\n\t\t\t// Surface node CHUNKS skipped\r\n\t\t\t// These mainly specify the node editor setup in LW\r\n\t\t\tcase 'NLOC':\r\n\t\t\tcase 'NZOM':\r\n\t\t\tcase 'NVER':\r\n\t\t\tcase 'NSRV':\r\n\t\t\tcase 'NVSK': // unknown\r\n\t\t\tcase 'NCRD':\r\n\t\t\tcase 'WRPW': // image wrap w ( for cylindrical and spherical projections)\r\n\t\t\tcase 'WRPH': // image wrap h\r\n\t\t\tcase 'NMOD':\r\n\t\t\tcase 'NPRW':\r\n\t\t\tcase 'NPLA':\r\n\t\t\tcase 'NODS':\r\n\t\t\tcase 'VERS':\r\n\t\t\tcase 'ENUM':\r\n\t\t\tcase 'TAG ':\r\n\t\t\tcase 'OPAC':\r\n\r\n\t\t\t// Car Material CHUNKS\r\n\t\t\tcase 'CGMD':\r\n\t\t\tcase 'CGTY':\r\n\t\t\tcase 'CGST':\r\n\t\t\tcase 'CGEN':\r\n\t\t\tcase 'CGTS':\r\n\t\t\tcase 'CGTE':\r\n\t\t\tcase 'OSMP':\r\n\t\t\tcase 'OMDE':\r\n\t\t\tcase 'OUTR':\r\n\t\t\tcase 'FLAG':\r\n\r\n\t\t\tcase 'TRNL':\r\n\t\t\tcase 'GLOW':\r\n\t\t\tcase 'GVAL': // glow intensity\r\n\t\t\tcase 'SHRP':\r\n\t\t\tcase 'RFOP':\r\n\t\t\tcase 'RSAN':\r\n\t\t\tcase 'TROP':\r\n\t\t\tcase 'RBLR':\r\n\t\t\tcase 'TBLR':\r\n\t\t\tcase 'CLRH':\r\n\t\t\tcase 'CLRF':\r\n\t\t\tcase 'ADTR':\r\n\t\t\tcase 'LINE':\r\n\t\t\tcase 'ALPH':\r\n\t\t\tcase 'VCOL':\r\n\t\t\tcase 'ENAB':\r\n\t\t\t\tthis.IFF.debugger.skipped = true;\r\n\t\t\t\tthis.IFF.reader.skip( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'SURF':\r\n\t\t\t\tthis.IFF.parseSurfaceLwo2( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'CLIP':\r\n\t\t\t\tthis.IFF.parseClipLwo2( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Texture node chunks (not in spec)\r\n\t\t\tcase 'IPIX': // usePixelBlending\r\n\t\t\tcase 'IMIP': // useMipMaps\r\n\t\t\tcase 'IMOD': // imageBlendingMode\r\n\t\t\tcase 'AMOD': // unknown\r\n\t\t\tcase 'IINV': // imageInvertAlpha\r\n\t\t\tcase 'INCR': // imageInvertColor\r\n\t\t\tcase 'IAXS': // imageAxis ( for non-UV maps)\r\n\t\t\tcase 'IFOT': // imageFallofType\r\n\t\t\tcase 'ITIM': // timing for animated textures\r\n\t\t\tcase 'IWRL':\r\n\t\t\tcase 'IUTI':\r\n\t\t\tcase 'IINX':\r\n\t\t\tcase 'IINY':\r\n\t\t\tcase 'IINZ':\r\n\t\t\tcase 'IREF': // possibly a VX for reused texture nodes\r\n\t\t\t\tif ( length === 4 ) this.IFF.currentNode[ blockID ] = this.IFF.reader.getInt32();\r\n\t\t\t\telse this.IFF.reader.skip( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'OTAG':\r\n\t\t\t\tthis.IFF.parseObjectTag();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'LAYR':\r\n\t\t\t\tthis.IFF.parseLayer( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'PNTS':\r\n\t\t\t\tthis.IFF.parsePoints( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'VMAP':\r\n\t\t\t\tthis.IFF.parseVertexMapping( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'AUVU':\r\n\t\t\tcase 'AUVN':\r\n\t\t\t\tthis.IFF.reader.skip( length - 1 );\r\n\t\t\t\tthis.IFF.reader.getVariableLengthIndex(); // VX\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'POLS':\r\n\t\t\t\tthis.IFF.parsePolygonList( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'TAGS':\r\n\t\t\t\tthis.IFF.parseTagStrings( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'PTAG':\r\n\t\t\t\tthis.IFF.parsePolygonTagMapping( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'VMAD':\r\n\t\t\t\tthis.IFF.parseVertexMapping( length, true );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Misc CHUNKS\r\n\t\t\tcase 'DESC': // Description Line\r\n\t\t\t\tthis.IFF.currentForm.description = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'TEXT':\r\n\t\t\tcase 'CMNT':\r\n\t\t\tcase 'NCOM':\r\n\t\t\t\tthis.IFF.currentForm.comment = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Envelope Form\r\n\t\t\tcase 'NAME':\r\n\t\t\t\tthis.IFF.currentForm.channelName = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Image Map Layer\r\n\t\t\tcase 'WRAP':\r\n\t\t\t\tthis.IFF.currentForm.wrap = { w: this.IFF.reader.getUint16(), h: this.IFF.reader.getUint16() };\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IMAG':\r\n\t\t\t\tvar index = this.IFF.reader.getVariableLengthIndex();\r\n\t\t\t\tthis.IFF.currentForm.imageIndex = index;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Texture Mapping Form\r\n\t\t\tcase 'OREF':\r\n\t\t\t\tthis.IFF.currentForm.referenceObject = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'ROID':\r\n\t\t\t\tthis.IFF.currentForm.referenceObjectID = this.IFF.reader.getUint32();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Surface Blocks\r\n\t\t\tcase 'SSHN':\r\n\t\t\t\tthis.IFF.currentSurface.surfaceShaderName = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'AOVN':\r\n\t\t\t\tthis.IFF.currentSurface.surfaceCustomAOVName = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Nodal Blocks\r\n\t\t\tcase 'NSTA':\r\n\t\t\t\tthis.IFF.currentForm.disabled = this.IFF.reader.getUint16();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'NRNM':\r\n\t\t\t\tthis.IFF.currentForm.realName = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'NNME':\r\n\t\t\t\tthis.IFF.currentForm.refName = this.IFF.reader.getString();\r\n\t\t\t\tthis.IFF.currentSurface.nodes[ this.IFF.currentForm.refName ] = this.IFF.currentForm;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Nodal Blocks : connections\r\n\t\t\tcase 'INME':\r\n\t\t\t\tif ( ! this.IFF.currentForm.nodeName ) this.IFF.currentForm.nodeName = [];\r\n\t\t\t\tthis.IFF.currentForm.nodeName.push( this.IFF.reader.getString() );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IINN':\r\n\t\t\t\tif ( ! this.IFF.currentForm.inputNodeName ) this.IFF.currentForm.inputNodeName = [];\r\n\t\t\t\tthis.IFF.currentForm.inputNodeName.push( this.IFF.reader.getString() );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IINM':\r\n\t\t\t\tif ( ! this.IFF.currentForm.inputName ) this.IFF.currentForm.inputName = [];\r\n\t\t\t\tthis.IFF.currentForm.inputName.push( this.IFF.reader.getString() );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IONM':\r\n\t\t\t\tif ( ! this.IFF.currentForm.inputOutputName ) this.IFF.currentForm.inputOutputName = [];\r\n\t\t\t\tthis.IFF.currentForm.inputOutputName.push( this.IFF.reader.getString() );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'FNAM':\r\n\t\t\t\tthis.IFF.currentForm.fileName = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'CHAN': // NOTE: ENVL Forms may also have CHAN chunk, however ENVL is currently ignored\r\n\t\t\t\tif ( length === 4 ) this.IFF.currentForm.textureChannel = this.IFF.reader.getIDTag();\r\n\t\t\t\telse this.IFF.reader.skip( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// LWO2 Spec chunks: these are needed since the SURF FORMs are often in LWO2 format\r\n\t\t\tcase 'SMAN':\r\n\t\t\t\tvar maxSmoothingAngle = this.IFF.reader.getFloat32();\r\n\t\t\t\tthis.IFF.currentSurface.attributes.smooth = ( maxSmoothingAngle < 0 ) ? false : true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// LWO2: Basic Surface Parameters\r\n\t\t\tcase 'COLR':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.Color = { value: this.IFF.reader.getFloat32Array( 3 ) };\r\n\t\t\t\tthis.IFF.reader.skip( 2 ); // VX: envelope\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'LUMI':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.Luminosity = { value: this.IFF.reader.getFloat32() };\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'SPEC':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.Specular = { value: this.IFF.reader.getFloat32() };\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'DIFF':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.Diffuse = { value: this.IFF.reader.getFloat32() };\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'REFL':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.Reflection = { value: this.IFF.reader.getFloat32() };\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'GLOS':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.Glossiness = { value: this.IFF.reader.getFloat32() };\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'TRAN':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.opacity = this.IFF.reader.getFloat32();\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'BUMP':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.bumpStrength = this.IFF.reader.getFloat32();\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'SIDE':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.side = this.IFF.reader.getUint16();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'RIMG':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.reflectionMap = this.IFF.reader.getVariableLengthIndex();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'RIND':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.refractiveIndex = this.IFF.reader.getFloat32();\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'TIMG':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.refractionMap = this.IFF.reader.getVariableLengthIndex();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IMAP':\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'TMAP':\r\n\t\t\t\tthis.IFF.debugger.skipped = true;\r\n\t\t\t\tthis.IFF.reader.skip( length ); // needs implementing\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IUVI': // uv channel name\r\n\t\t\t\tthis.IFF.currentNode.UVChannel = this.IFF.reader.getString( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IUTL': // widthWrappingMode: 0 = Reset, 1 = Repeat, 2 = Mirror, 3 = Edge\r\n\t\t\t\tthis.IFF.currentNode.widthWrappingMode = this.IFF.reader.getUint32();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'IVTL': // heightWrappingMode\r\n\t\t\t\tthis.IFF.currentNode.heightWrappingMode = this.IFF.reader.getUint32();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// LWO2 USE\r\n\t\t\tcase 'BLOK':\r\n\t\t\t\t// skip\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthis.IFF.parseUnknownCHUNK( blockID, length );\r\n\r\n\t\t}\r\n\r\n\t\tif ( blockID != 'FORM' ) {\r\n\r\n\t\t\tthis.IFF.debugger.node = 1;\r\n\t\t\tthis.IFF.debugger.nodeID = blockID;\r\n\t\t\tthis.IFF.debugger.log();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.IFF.reader.offset >= this.IFF.currentFormEnd ) {\r\n\r\n\t\t\tthis.IFF.currentForm = this.IFF.parentForm;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nexport { LWO2Parser };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/loaders/lwo/LWO2Parser.js","function LWO3Parser( IFFParser ) {\r\n\r\n\tthis.IFF = IFFParser;\r\n\r\n}\r\n\r\nLWO3Parser.prototype = {\r\n\r\n\tconstructor: LWO3Parser,\r\n\r\n\tparseBlock: function () {\r\n\r\n\t\tthis.IFF.debugger.offset = this.IFF.reader.offset;\r\n\t\tthis.IFF.debugger.closeForms();\r\n\r\n\t\tvar blockID = this.IFF.reader.getIDTag();\r\n\t\tvar length = this.IFF.reader.getUint32(); // size of data in bytes\r\n\r\n\t\tthis.IFF.debugger.dataOffset = this.IFF.reader.offset;\r\n\t\tthis.IFF.debugger.length = length;\r\n\r\n\t\t// Data types may be found in either LWO2 OR LWO3 spec\r\n\t\tswitch ( blockID ) {\r\n\r\n\t\t\tcase 'FORM': // form blocks may consist of sub -chunks or sub-forms\r\n\t\t\t\tthis.IFF.parseForm( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// SKIPPED CHUNKS\r\n\t\t\t// MISC skipped\r\n\t\t\tcase 'ICON': // Thumbnail Icon Image\r\n\t\t\tcase 'VMPA': // Vertex Map Parameter\r\n\t\t\tcase 'BBOX': // bounding box\r\n\t\t\t// case 'VMMD':\r\n\t\t\t// case 'VTYP':\r\n\r\n\t\t\t// normal maps can be specified, normally on models imported from other applications. Currently ignored\r\n\t\t\tcase 'NORM':\r\n\r\n\t\t\t// ENVL FORM skipped\r\n\t\t\tcase 'PRE ':\r\n\t\t\tcase 'POST':\r\n\t\t\tcase 'KEY ':\r\n\t\t\tcase 'SPAN':\r\n\r\n\t\t\t// CLIP FORM skipped\r\n\t\t\tcase 'TIME':\r\n\t\t\tcase 'CLRS':\r\n\t\t\tcase 'CLRA':\r\n\t\t\tcase 'FILT':\r\n\t\t\tcase 'DITH':\r\n\t\t\tcase 'CONT':\r\n\t\t\tcase 'BRIT':\r\n\t\t\tcase 'SATR':\r\n\t\t\tcase 'HUE ':\r\n\t\t\tcase 'GAMM':\r\n\t\t\tcase 'NEGA':\r\n\t\t\tcase 'IFLT':\r\n\t\t\tcase 'PFLT':\r\n\r\n\t\t\t// Image Map Layer skipped\r\n\t\t\tcase 'PROJ':\r\n\t\t\tcase 'AXIS':\r\n\t\t\tcase 'AAST':\r\n\t\t\tcase 'PIXB':\r\n\t\t\tcase 'STCK':\r\n\r\n\t\t\t// Procedural Textures skipped\r\n\t\t\tcase 'VALU':\r\n\r\n\t\t\t// Gradient Textures skipped\r\n\t\t\tcase 'PNAM':\r\n\t\t\tcase 'INAM':\r\n\t\t\tcase 'GRST':\r\n\t\t\tcase 'GREN':\r\n\t\t\tcase 'GRPT':\r\n\t\t\tcase 'FKEY':\r\n\t\t\tcase 'IKEY':\r\n\r\n\t\t\t// Texture Mapping Form skipped\r\n\t\t\tcase 'CSYS':\r\n\r\n\t\t\t\t// Surface CHUNKs skipped\r\n\t\t\tcase 'OPAQ': // top level 'opacity' checkbox\r\n\t\t\tcase 'CMAP': // clip map\r\n\r\n\t\t\t// Surface node CHUNKS skipped\r\n\t\t\t// These mainly specify the node editor setup in LW\r\n\t\t\tcase 'NLOC':\r\n\t\t\tcase 'NZOM':\r\n\t\t\tcase 'NVER':\r\n\t\t\tcase 'NSRV':\r\n\t\t\tcase 'NCRD':\r\n\t\t\tcase 'NMOD':\r\n\t\t\tcase 'NSEL':\r\n\t\t\tcase 'NPRW':\r\n\t\t\tcase 'NPLA':\r\n\t\t\tcase 'VERS':\r\n\t\t\tcase 'ENUM':\r\n\t\t\tcase 'TAG ':\r\n\r\n\t\t\t// Car Material CHUNKS\r\n\t\t\tcase 'CGMD':\r\n\t\t\tcase 'CGTY':\r\n\t\t\tcase 'CGST':\r\n\t\t\tcase 'CGEN':\r\n\t\t\tcase 'CGTS':\r\n\t\t\tcase 'CGTE':\r\n\t\t\tcase 'OSMP':\r\n\t\t\tcase 'OMDE':\r\n\t\t\tcase 'OUTR':\r\n\t\t\tcase 'FLAG':\r\n\r\n\t\t\tcase 'TRNL':\r\n\t\t\tcase 'SHRP':\r\n\t\t\tcase 'RFOP':\r\n\t\t\tcase 'RSAN':\r\n\t\t\tcase 'TROP':\r\n\t\t\tcase 'RBLR':\r\n\t\t\tcase 'TBLR':\r\n\t\t\tcase 'CLRH':\r\n\t\t\tcase 'CLRF':\r\n\t\t\tcase 'ADTR':\r\n\t\t\tcase 'GLOW':\r\n\t\t\tcase 'LINE':\r\n\t\t\tcase 'ALPH':\r\n\t\t\tcase 'VCOL':\r\n\t\t\tcase 'ENAB':\r\n\t\t\t\tthis.IFF.debugger.skipped = true;\r\n\t\t\t\tthis.IFF.reader.skip( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Texture node chunks (not in spec)\r\n\t\t\tcase 'IPIX': // usePixelBlending\r\n\t\t\tcase 'IMIP': // useMipMaps\r\n\t\t\tcase 'IMOD': // imageBlendingMode\r\n\t\t\tcase 'AMOD': // unknown\r\n\t\t\tcase 'IINV': // imageInvertAlpha\r\n\t\t\tcase 'INCR': // imageInvertColor\r\n\t\t\tcase 'IAXS': // imageAxis ( for non-UV maps)\r\n\t\t\tcase 'IFOT': // imageFallofType\r\n\t\t\tcase 'ITIM': // timing for animated textures\r\n\t\t\tcase 'IWRL':\r\n\t\t\tcase 'IUTI':\r\n\t\t\tcase 'IINX':\r\n\t\t\tcase 'IINY':\r\n\t\t\tcase 'IINZ':\r\n\t\t\tcase 'IREF': // possibly a VX for reused texture nodes\r\n\t\t\t\tif ( length === 4 ) this.IFF.currentNode[ blockID ] = this.IFF.reader.getInt32();\r\n\t\t\t\telse this.IFF.reader.skip( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'OTAG':\r\n\t\t\t\tthis.IFF.parseObjectTag();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'LAYR':\r\n\t\t\t\tthis.IFF.parseLayer( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'PNTS':\r\n\t\t\t\tthis.IFF.parsePoints( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'VMAP':\r\n\t\t\t\tthis.IFF.parseVertexMapping( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'POLS':\r\n\t\t\t\tthis.IFF.parsePolygonList( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'TAGS':\r\n\t\t\t\tthis.IFF.parseTagStrings( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'PTAG':\r\n\t\t\t\tthis.IFF.parsePolygonTagMapping( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'VMAD':\r\n\t\t\t\tthis.IFF.parseVertexMapping( length, true );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Misc CHUNKS\r\n\t\t\tcase 'DESC': // Description Line\r\n\t\t\t\tthis.IFF.currentForm.description = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'TEXT':\r\n\t\t\tcase 'CMNT':\r\n\t\t\tcase 'NCOM':\r\n\t\t\t\tthis.IFF.currentForm.comment = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Envelope Form\r\n\t\t\tcase 'NAME':\r\n\t\t\t\tthis.IFF.currentForm.channelName = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Image Map Layer\r\n\t\t\tcase 'WRAP':\r\n\t\t\t\tthis.IFF.currentForm.wrap = { w: this.IFF.reader.getUint16(), h: this.IFF.reader.getUint16() };\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IMAG':\r\n\t\t\t\tvar index = this.IFF.reader.getVariableLengthIndex();\r\n\t\t\t\tthis.IFF.currentForm.imageIndex = index;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Texture Mapping Form\r\n\t\t\tcase 'OREF':\r\n\t\t\t\tthis.IFF.currentForm.referenceObject = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'ROID':\r\n\t\t\t\tthis.IFF.currentForm.referenceObjectID = this.IFF.reader.getUint32();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Surface Blocks\r\n\t\t\tcase 'SSHN':\r\n\t\t\t\tthis.IFF.currentSurface.surfaceShaderName = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'AOVN':\r\n\t\t\t\tthis.IFF.currentSurface.surfaceCustomAOVName = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Nodal Blocks\r\n\t\t\tcase 'NSTA':\r\n\t\t\t\tthis.IFF.currentForm.disabled = this.IFF.reader.getUint16();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'NRNM':\r\n\t\t\t\tthis.IFF.currentForm.realName = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'NNME':\r\n\t\t\t\tthis.IFF.currentForm.refName = this.IFF.reader.getString();\r\n\t\t\t\tthis.IFF.currentSurface.nodes[ this.IFF.currentForm.refName ] = this.IFF.currentForm;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// Nodal Blocks : connections\r\n\t\t\tcase 'INME':\r\n\t\t\t\tif ( ! this.IFF.currentForm.nodeName ) this.IFF.currentForm.nodeName = [];\r\n\t\t\t\tthis.IFF.currentForm.nodeName.push( this.IFF.reader.getString() );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IINN':\r\n\t\t\t\tif ( ! this.IFF.currentForm.inputNodeName ) this.IFF.currentForm.inputNodeName = [];\r\n\t\t\t\tthis.IFF.currentForm.inputNodeName.push( this.IFF.reader.getString() );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IINM':\r\n\t\t\t\tif ( ! this.IFF.currentForm.inputName ) this.IFF.currentForm.inputName = [];\r\n\t\t\t\tthis.IFF.currentForm.inputName.push( this.IFF.reader.getString() );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IONM':\r\n\t\t\t\tif ( ! this.IFF.currentForm.inputOutputName ) this.IFF.currentForm.inputOutputName = [];\r\n\t\t\t\tthis.IFF.currentForm.inputOutputName.push( this.IFF.reader.getString() );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'FNAM':\r\n\t\t\t\tthis.IFF.currentForm.fileName = this.IFF.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'CHAN': // NOTE: ENVL Forms may also have CHAN chunk, however ENVL is currently ignored\r\n\t\t\t\tif ( length === 4 ) this.IFF.currentForm.textureChannel = this.IFF.reader.getIDTag();\r\n\t\t\t\telse this.IFF.reader.skip( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// LWO2 Spec chunks: these are needed since the SURF FORMs are often in LWO2 format\r\n\t\t\tcase 'SMAN':\r\n\t\t\t\tvar maxSmoothingAngle = this.IFF.reader.getFloat32();\r\n\t\t\t\tthis.IFF.currentSurface.attributes.smooth = ( maxSmoothingAngle < 0 ) ? false : true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// LWO2: Basic Surface Parameters\r\n\t\t\tcase 'COLR':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.Color = { value: this.IFF.reader.getFloat32Array( 3 ) };\r\n\t\t\t\tthis.IFF.reader.skip( 2 ); // VX: envelope\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'LUMI':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.Luminosity = { value: this.IFF.reader.getFloat32() };\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'SPEC':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.Specular = { value: this.IFF.reader.getFloat32() };\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'DIFF':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.Diffuse = { value: this.IFF.reader.getFloat32() };\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'REFL':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.Reflection = { value: this.IFF.reader.getFloat32() };\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'GLOS':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.Glossiness = { value: this.IFF.reader.getFloat32() };\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'TRAN':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.opacity = this.IFF.reader.getFloat32();\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'BUMP':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.bumpStrength = this.IFF.reader.getFloat32();\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'SIDE':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.side = this.IFF.reader.getUint16();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'RIMG':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.reflectionMap = this.IFF.reader.getVariableLengthIndex();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'RIND':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.refractiveIndex = this.IFF.reader.getFloat32();\r\n\t\t\t\tthis.IFF.reader.skip( 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'TIMG':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.refractionMap = this.IFF.reader.getVariableLengthIndex();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IMAP':\r\n\t\t\t\tthis.IFF.currentSurface.attributes.imageMapIndex = this.IFF.reader.getUint32();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IUVI': // uv channel name\r\n\t\t\t\tthis.IFF.currentNode.UVChannel = this.IFF.reader.getString( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IUTL': // widthWrappingMode: 0 = Reset, 1 = Repeat, 2 = Mirror, 3 = Edge\r\n\t\t\t\tthis.IFF.currentNode.widthWrappingMode = this.IFF.reader.getUint32();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'IVTL': // heightWrappingMode\r\n\t\t\t\tthis.IFF.currentNode.heightWrappingMode = this.IFF.reader.getUint32();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthis.IFF.parseUnknownCHUNK( blockID, length );\r\n\r\n\t\t}\r\n\r\n\t\tif ( blockID != 'FORM' ) {\r\n\r\n\t\t\tthis.IFF.debugger.node = 1;\r\n\t\t\tthis.IFF.debugger.nodeID = blockID;\r\n\t\t\tthis.IFF.debugger.log();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.IFF.reader.offset >= this.IFF.currentFormEnd ) {\r\n\r\n\t\t\tthis.IFF.currentForm = this.IFF.parentForm;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nexport { LWO3Parser };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/loaders/lwo/LWO3Parser.js","/**\r\n * === IFFParser ===\r\n * - Parses data from the IFF buffer.\r\n * - LWO3 files are in IFF format and can contain the following data types, referred to by shorthand codes\r\n *\r\n * ATOMIC DATA TYPES\r\n *  ID Tag - 4x 7 bit uppercase ASCII chars: ID4\r\n *  signed integer, 1, 2, or 4 byte length: I1, I2, I4\r\n *  unsigned integer, 1, 2, or 4 byte length: U1, U2, U4\r\n *  float, 4 byte length: F4\r\n *  string, series of ASCII chars followed by null byte (If the length of the string including the null terminating byte is odd, an extra null is added so that the data that follows will begin on an even byte boundary): S0\r\n *\r\n * COMPOUND DATA TYPES\r\n *  Variable-length Index (index into an array or collection): U2 or U4 : VX\r\n *  Color (RGB): F4 + F4 + F4: COL12\r\n *  Coordinate (x, y, z): F4 + F4 + F4: VEC12\r\n *  Percentage F4 data type from 0->1 with 1 = 100%: FP4\r\n *  Angle in radian F4: ANG4\r\n *  Filename (string) S0: FNAM0\r\n *  XValue F4 + index (VX) + optional envelope( ENVL ): XVAL\r\n *  XValue vector VEC12 + index (VX) + optional envelope( ENVL ): XVAL3\r\n *\r\n *  The IFF file is arranged in chunks:\r\n *  CHUNK = ID4 + length (U4) + length X bytes of data + optional 0 pad byte\r\n *  optional 0 pad byte is there to ensure chunk ends on even boundary, not counted in size\r\n *\r\n * COMPOUND DATA TYPES\r\n * - Chunks are combined in Forms (collections of chunks)\r\n * - FORM = string 'FORM' (ID4) + length (U4) + type (ID4) + optional ( CHUNK | FORM )\r\n * - CHUNKS and FORMS are collectively referred to as blocks\r\n * - The entire file is contained in one top level FORM\r\n *\r\n **/\r\n\r\nimport { LoaderUtils } from \"@/components/build/three.module.js\";\r\nimport { LWO2Parser } from \"./LWO2Parser.js\";\r\nimport { LWO3Parser } from \"./LWO3Parser.js\";\r\n\r\nfunction IFFParser( ) {\r\n\r\n\tthis.debugger = new Debugger();\r\n\t// this.debugger.enable(); // un-comment to log IFF hierarchy.\r\n\r\n}\r\n\r\nIFFParser.prototype = {\r\n\r\n\tconstructor: IFFParser,\r\n\r\n\tparse: function ( buffer ) {\r\n\r\n\t\tthis.reader = new DataViewReader( buffer );\r\n\r\n\t\tthis.tree = {\r\n\t\t\tmaterials: {},\r\n\t\t\tlayers: [],\r\n\t\t\ttags: [],\r\n\t\t\ttextures: [],\r\n\t\t};\r\n\r\n\t\t// start out at the top level to add any data before first layer is encountered\r\n\t\tthis.currentLayer = this.tree;\r\n\t\tthis.currentForm = this.tree;\r\n\r\n\t\tthis.parseTopForm();\r\n\r\n\t\tif ( this.tree.format === undefined ) return;\r\n\r\n\t\tif ( this.tree.format === 'LWO2' ) {\r\n\r\n\t\t\tthis.parser = new LWO2Parser( this );\r\n\t\t\twhile ( ! this.reader.endOfFile() ) this.parser.parseBlock();\r\n\r\n\t\t} else if ( this.tree.format === 'LWO3' ) {\r\n\r\n\t\t\tthis.parser = new LWO3Parser( this );\r\n\t\t\twhile ( ! this.reader.endOfFile() ) this.parser.parseBlock();\r\n\r\n\t\t}\r\n\r\n\t\tthis.debugger.offset = this.reader.offset;\r\n\t\tthis.debugger.closeForms();\r\n\r\n\t\treturn this.tree;\r\n\r\n\t},\r\n\r\n\tparseTopForm() {\r\n\r\n\t\tthis.debugger.offset = this.reader.offset;\r\n\r\n\t\tvar topForm = this.reader.getIDTag();\r\n\r\n\t\tif ( topForm !== 'FORM' ) {\r\n\r\n\t\t\tconsole.warn( \"LWOLoader: Top-level FORM missing.\" );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar length = this.reader.getUint32();\r\n\r\n\t\tthis.debugger.dataOffset = this.reader.offset;\r\n\t\tthis.debugger.length = length;\r\n\r\n\t\tvar type = this.reader.getIDTag();\r\n\r\n\t\tif ( type === 'LWO2' ) {\r\n\r\n\t\t\tthis.tree.format = type;\r\n\r\n\t\t} else if ( type === 'LWO3' ) {\r\n\r\n\t\t\tthis.tree.format = type;\r\n\r\n\t\t}\r\n\r\n\t\tthis.debugger.node = 0;\r\n\t\tthis.debugger.nodeID = type;\r\n\t\tthis.debugger.log();\r\n\r\n\t\treturn;\r\n\r\n\t},\r\n\r\n\r\n\t///\r\n\t// FORM PARSING METHODS\r\n\t///\r\n\r\n\t// Forms are organisational and can contain any number of sub chunks and sub forms\r\n\t// FORM ::= 'FORM'[ID4], length[U4], type[ID4], ( chunk[CHUNK] | form[FORM] ) * }\r\n\tparseForm( length ) {\r\n\r\n\t\tvar type = this.reader.getIDTag();\r\n\r\n\t\tswitch ( type ) {\r\n\r\n\t\t\t// SKIPPED FORMS\r\n\t\t\t// if skipForm( length ) is called, the entire form and any sub forms and chunks are skipped\r\n\r\n\t\t\tcase 'ISEQ': // Image sequence\r\n\t\t\tcase 'ANIM': // plug in animation\r\n\t\t\tcase 'STCC': // Color-cycling Still\r\n\t\t\tcase 'VPVL':\r\n\t\t\tcase 'VPRM':\r\n\t\t\tcase 'NROT':\r\n\t\t\tcase 'WRPW': // image wrap w ( for cylindrical and spherical projections)\r\n\t\t\tcase 'WRPH': // image wrap h\r\n\t\t\tcase 'FUNC':\r\n\t\t\tcase 'FALL':\r\n\t\t\tcase 'OPAC':\r\n\t\t\tcase 'GRAD': // gradient texture\r\n\t\t\tcase 'ENVS':\r\n\t\t\tcase 'VMOP':\r\n\t\t\tcase 'VMBG':\r\n\r\n\t\t\t// Car Material FORMS\r\n\t\t\tcase 'OMAX':\r\n\t\t\tcase 'STEX':\r\n\t\t\tcase 'CKBG':\r\n\t\t\tcase 'CKEY':\r\n\t\t\tcase 'VMLA':\r\n\t\t\tcase 'VMLB':\r\n\t\t\t\tthis.debugger.skipped = true;\r\n\t\t\t\tthis.skipForm( length ); // not currently supported\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t// if break; is called directly, the position in the lwoTree is not created\r\n\t\t\t// any sub chunks and forms are added to the parent form instead\r\n\t\t\tcase 'META':\r\n\t\t\tcase 'NNDS':\r\n\t\t\tcase 'NODS':\r\n\t\t\tcase 'NDTA':\r\n\t\t\tcase 'ADAT':\r\n\t\t\tcase 'AOVS':\r\n\t\t\tcase 'BLOK':\r\n\r\n\t\t\t// used by texture nodes\r\n\t\t\tcase 'IBGC': // imageBackgroundColor\r\n\t\t\tcase 'IOPC': // imageOpacity\r\n\t\t\tcase 'IIMG': // hold reference to image path\r\n\t\t\tcase 'TXTR':\r\n\t\t\t\t// this.setupForm( type, length );\r\n\t\t\t\tthis.debugger.length = 4;\r\n\t\t\t\tthis.debugger.skipped = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IFAL': // imageFallof\r\n\t\t\tcase 'ISCL': // imageScale\r\n\t\t\tcase 'IPOS': // imagePosition\r\n\t\t\tcase 'IROT': // imageRotation\r\n\t\t\tcase 'IBMP':\r\n\t\t\tcase 'IUTD':\r\n\t\t\tcase 'IVTD':\r\n\t\t\t\tthis.parseTextureNodeAttribute( type );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'ENVL':\r\n\t\t\t\tthis.parseEnvelope( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t\t// CLIP FORM AND SUB FORMS\r\n\r\n\t\t\tcase 'CLIP':\r\n\t\t\t\tif ( this.tree.format === 'LWO2' ) {\r\n\r\n\t\t\t\t\tthis.parseForm( length );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis.parseClip( length );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'STIL':\r\n\t\t\t\tthis.parseImage();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'XREF': // clone of another STIL\r\n\t\t\t\tthis.reader.skip( 8 ); // unknown\r\n\t\t\t\tthis.currentForm.referenceTexture = {\r\n\t\t\t\t\tindex: this.reader.getUint32(),\r\n\t\t\t\t\trefName: this.reader.getString() // internal unique ref\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t\t// Not in spec, used by texture nodes\r\n\r\n\t\t\tcase 'IMST':\r\n\t\t\t\tthis.parseImageStateForm( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t\t// SURF FORM AND SUB FORMS\r\n\r\n\t\t\tcase 'SURF':\r\n\t\t\t\tthis.parseSurfaceForm( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'VALU': // Not in spec\r\n\t\t\t\tthis.parseValueForm( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'NTAG':\r\n\t\t\t\tthis.parseSubNode( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'ATTR': // BSDF Node Attributes\r\n\t\t\tcase 'SATR': // Standard Node Attributes\r\n\t\t\t\tthis.setupForm( 'attributes', length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'NCON':\r\n\t\t\t\tthis.parseConnections( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'SSHA':\r\n\t\t\t\tthis.parentForm = this.currentForm;\r\n\t\t\t\tthis.currentForm = this.currentSurface;\r\n\t\t\t\tthis.setupForm( 'surfaceShader', length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'SSHD':\r\n\t\t\t\tthis.setupForm( 'surfaceShaderData', length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'ENTR': // Not in spec\r\n\t\t\t\tthis.parseEntryForm( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t\t// Image Map Layer\r\n\r\n\t\t\tcase 'IMAP':\r\n\t\t\t\tthis.parseImageMap( length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'TAMP':\r\n\t\t\t\tthis.parseXVAL( 'amplitude', length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t\t//Texture Mapping Form\r\n\r\n\t\t\tcase 'TMAP':\r\n\t\t\t\tthis.setupForm( 'textureMap', length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'CNTR':\r\n\t\t\t\tthis.parseXVAL3( 'center', length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'SIZE':\r\n\t\t\t\tthis.parseXVAL3( 'scale', length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'ROTA':\r\n\t\t\t\tthis.parseXVAL3( 'rotation', length );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthis.parseUnknownForm( type, length );\r\n\r\n\t\t}\r\n\r\n\t\tthis.debugger.node = 0;\r\n\t\tthis.debugger.nodeID = type;\r\n\t\tthis.debugger.log();\r\n\r\n\t},\r\n\r\n\tsetupForm( type, length ) {\r\n\r\n\t\tif ( ! this.currentForm ) this.currentForm = this.currentNode;\r\n\r\n\t\tthis.currentFormEnd = this.reader.offset + length;\r\n\t\tthis.parentForm = this.currentForm;\r\n\r\n\t\tif ( ! this.currentForm[ type ] ) {\r\n\r\n\t\t\tthis.currentForm[ type ] = {};\r\n\t\t\tthis.currentForm = this.currentForm[ type ];\r\n\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// should never see this unless there's a bug in the reader\r\n\t\t\tconsole.warn( 'LWOLoader: form already exists on parent: ', type, this.currentForm );\r\n\r\n\t\t\tthis.currentForm = this.currentForm[ type ];\r\n\r\n\t\t}\r\n\r\n\r\n\t},\r\n\r\n\tskipForm( length ) {\r\n\r\n\t\tthis.reader.skip( length - 4 );\r\n\r\n\t},\r\n\r\n\tparseUnknownForm( type, length ) {\r\n\r\n\t\tconsole.warn( 'LWOLoader: unknown FORM encountered: ' + type, length );\r\n\r\n\t\tprintBuffer( this.reader.dv.buffer, this.reader.offset, length - 4 );\r\n\t\tthis.reader.skip( length - 4 );\r\n\r\n\t},\r\n\r\n\tparseSurfaceForm( length ) {\r\n\r\n\t\tthis.reader.skip( 8 ); // unknown Uint32 x2\r\n\r\n\t\tvar name = this.reader.getString();\r\n\r\n\t\tvar surface = {\r\n\t\t\tattributes: {}, // LWO2 style non-node attributes will go here\r\n\t\t\tconnections: {},\r\n\t\t\tname: name,\r\n\t\t\tinputName: name,\r\n\t\t\tnodes: {},\r\n\t\t\tsource: this.reader.getString(),\r\n\t\t};\r\n\r\n\t\tthis.tree.materials[ name ] = surface;\r\n\t\tthis.currentSurface = surface;\r\n\r\n\t\tthis.parentForm = this.tree.materials;\r\n\t\tthis.currentForm = surface;\r\n\t\tthis.currentFormEnd = this.reader.offset + length;\r\n\r\n\t},\r\n\r\n\tparseSurfaceLwo2( length ) {\r\n\r\n\t\tvar name = this.reader.getString();\r\n\r\n\t\tvar surface = {\r\n\t\t\tattributes: {}, // LWO2 style non-node attributes will go here\r\n\t\t\tconnections: {},\r\n\t\t\tname: name,\r\n\t\t\tnodes: {},\r\n\t\t\tsource: this.reader.getString(),\r\n\t\t};\r\n\r\n\t\tthis.tree.materials[ name ] = surface;\r\n\t\tthis.currentSurface = surface;\r\n\r\n\t\tthis.parentForm = this.tree.materials;\r\n\t\tthis.currentForm = surface;\r\n\t\tthis.currentFormEnd = this.reader.offset + length;\r\n\r\n\t},\r\n\r\n\tparseSubNode( length ) {\r\n\r\n\t\t// parse the NRNM CHUNK of the subnode FORM to get\r\n\t\t// a meaningful name for the subNode\r\n\t\t// some subnodes can be renamed, but Input and Surface cannot\r\n\r\n\t\tthis.reader.skip( 8 ); // NRNM + length\r\n\t\tvar name = this.reader.getString();\r\n\r\n\t\tvar node = {\r\n\t\t\tname: name\r\n\t\t};\r\n\t\tthis.currentForm = node;\r\n\t\tthis.currentNode = node;\r\n\r\n\t\tthis.currentFormEnd = this.reader.offset + length;\r\n\r\n\r\n\t},\r\n\r\n\t// collect attributes from all nodes at the top level of a surface\r\n\tparseConnections( length ) {\r\n\r\n\t\tthis.currentFormEnd = this.reader.offset + length;\r\n\t\tthis.parentForm = this.currentForm;\r\n\r\n\t\tthis.currentForm = this.currentSurface.connections;\r\n\r\n\t},\r\n\r\n\t// surface node attribute data, e.g. specular, roughness etc\r\n\tparseEntryForm( length ) {\r\n\r\n\t\tthis.reader.skip( 8 ); // NAME + length\r\n\t\tvar name = this.reader.getString();\r\n\t\tthis.currentForm = this.currentNode.attributes;\r\n\r\n\t\tthis.setupForm( name, length );\r\n\r\n\t},\r\n\r\n\t// parse values from material - doesn't match up to other LWO3 data types\r\n\t// sub form of entry form\r\n\tparseValueForm() {\r\n\r\n\t\tthis.reader.skip( 8 ); // unknown + length\r\n\r\n\t\tvar valueType = this.reader.getString();\r\n\r\n\t\tif ( valueType === 'double' ) {\r\n\r\n\t\t\tthis.currentForm.value = this.reader.getUint64();\r\n\r\n\t\t} else if ( valueType === 'int' ) {\r\n\r\n\t\t\tthis.currentForm.value = this.reader.getUint32();\r\n\r\n\t\t} else if ( valueType === 'vparam' ) {\r\n\r\n\t\t\tthis.reader.skip( 24 );\r\n\t\t\tthis.currentForm.value = this.reader.getFloat64();\r\n\r\n\t\t} else if ( valueType === 'vparam3' ) {\r\n\r\n\t\t\tthis.reader.skip( 24 );\r\n\t\t\tthis.currentForm.value = this.reader.getFloat64Array( 3 );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t// holds various data about texture node image state\r\n\t// Data other thanmipMapLevel unknown\r\n\tparseImageStateForm() {\r\n\r\n\t\tthis.reader.skip( 8 ); // unknown\r\n\r\n\t\tthis.currentForm.mipMapLevel = this.reader.getFloat32();\r\n\r\n\t},\r\n\r\n\t// LWO2 style image data node OR LWO3 textures defined at top level in editor (not as SURF node)\r\n\tparseImageMap( length ) {\r\n\r\n\t\tthis.currentFormEnd = this.reader.offset + length;\r\n\t\tthis.parentForm = this.currentForm;\r\n\r\n\t\tif ( ! this.currentForm.maps ) this.currentForm.maps = [];\r\n\r\n\t\tvar map = {};\r\n\t\tthis.currentForm.maps.push( map );\r\n\t\tthis.currentForm = map;\r\n\r\n\t\tthis.reader.skip( 10 ); // unknown, could be an issue if it contains a VX\r\n\r\n\t},\r\n\r\n\tparseTextureNodeAttribute( type ) {\r\n\r\n\t\tthis.reader.skip( 28 ); // FORM + length + VPRM + unknown + Uint32 x2 + float32\r\n\r\n\t\tthis.reader.skip( 20 ); // FORM + length + VPVL + float32 + Uint32\r\n\r\n\t\tswitch ( type ) {\r\n\r\n\t\t\tcase 'ISCL':\r\n\t\t\t\tthis.currentNode.scale = this.reader.getFloat32Array( 3 );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'IPOS':\r\n\t\t\t\tthis.currentNode.position = this.reader.getFloat32Array( 3 );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'IROT':\r\n\t\t\t\tthis.currentNode.rotation = this.reader.getFloat32Array( 3 );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'IFAL':\r\n\t\t\t\tthis.currentNode.falloff = this.reader.getFloat32Array( 3 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'IBMP':\r\n\t\t\t\tthis.currentNode.amplitude = this.reader.getFloat32();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'IUTD':\r\n\t\t\t\tthis.currentNode.uTiles = this.reader.getFloat32();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'IVTD':\r\n\t\t\t\tthis.currentNode.vTiles = this.reader.getFloat32();\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tthis.reader.skip( 2 ); // unknown\r\n\r\n\r\n\t},\r\n\r\n\t// ENVL forms are currently ignored\r\n\tparseEnvelope( length ) {\r\n\r\n\t\tthis.reader.skip( length - 4 ); // skipping  entirely for now\r\n\r\n\t},\r\n\r\n\t///\r\n\t// CHUNK PARSING METHODS\r\n\t///\r\n\r\n\t// clips can either be defined inside a surface node, or at the top\r\n\t// level and they have a different format in each case\r\n\tparseClip( length ) {\r\n\r\n\t\tvar tag = this.reader.getIDTag();\r\n\r\n\t\t// inside surface node\r\n\t\tif ( tag === 'FORM' ) {\r\n\r\n\t\t\tthis.reader.skip( 16 );\r\n\r\n\t\t\tthis.currentNode.fileName = this.reader.getString();\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t// otherwise top level\r\n\t\tthis.reader.setOffset( this.reader.offset - 4 );\r\n\r\n\t\tthis.currentFormEnd = this.reader.offset + length;\r\n\t\tthis.parentForm = this.currentForm;\r\n\r\n\t\tthis.reader.skip( 8 ); // unknown\r\n\r\n\t\tvar texture = {\r\n\t\t\tindex: this.reader.getUint32()\r\n\t\t};\r\n\t\tthis.tree.textures.push( texture );\r\n\t\tthis.currentForm = texture;\r\n\r\n\t},\r\n\r\n\tparseClipLwo2( length ) {\r\n\r\n\t\tvar texture = {\r\n\t\t\tindex: this.reader.getUint32(),\r\n\t\t\tfileName: \"\"\r\n\t\t};\r\n\r\n\t\t// seach STIL block\r\n\t\twhile ( true ) {\r\n\r\n\t\t\tvar tag = this.reader.getIDTag();\r\n\t\t\tvar n_length = this.reader.getUint16();\r\n\t\t\tif ( tag === 'STIL' ) {\r\n\r\n\t\t\t\ttexture.fileName = this.reader.getString();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( n_length >= length ) {\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.tree.textures.push( texture );\r\n\t\tthis.currentForm = texture;\r\n\r\n\t},\r\n\r\n\tparseImage() {\r\n\r\n\t\tthis.reader.skip( 8 ); // unknown\r\n\t\tthis.currentForm.fileName = this.reader.getString();\r\n\r\n\t},\r\n\r\n\tparseXVAL( type, length ) {\r\n\r\n\t\tvar endOffset = this.reader.offset + length - 4;\r\n\t\tthis.reader.skip( 8 );\r\n\r\n\t\tthis.currentForm[ type ] = this.reader.getFloat32();\r\n\r\n\t\tthis.reader.setOffset( endOffset ); // set end offset directly to skip optional envelope\r\n\r\n\t},\r\n\r\n\tparseXVAL3( type, length ) {\r\n\r\n\t\tvar endOffset = this.reader.offset + length - 4;\r\n\t\tthis.reader.skip( 8 );\r\n\r\n\t\tthis.currentForm[ type ] = {\r\n\t\t\tx: this.reader.getFloat32(),\r\n\t\t\ty: this.reader.getFloat32(),\r\n\t\t\tz: this.reader.getFloat32(),\r\n\t\t};\r\n\r\n\t\tthis.reader.setOffset( endOffset );\r\n\r\n\t},\r\n\r\n\t// Tags associated with an object\r\n\t// OTAG { type[ID4], tag-string[S0] }\r\n\tparseObjectTag() {\r\n\r\n\t\tif ( ! this.tree.objectTags ) this.tree.objectTags = {};\r\n\r\n\t\tthis.tree.objectTags[ this.reader.getIDTag() ] = {\r\n\t\t\ttagString: this.reader.getString()\r\n\t\t};\r\n\r\n\t},\r\n\r\n\t// Signals the start of a new layer. All the data chunks which follow will be included in this layer until another layer chunk is encountered.\r\n\t// LAYR: number[U2], flags[U2], pivot[VEC12], name[S0], parent[U2]\r\n\tparseLayer( length ) {\r\n\r\n\t\tvar layer = {\r\n\t\t\tnumber: this.reader.getUint16(),\r\n\t\t\tflags: this.reader.getUint16(), // If the least significant bit of flags is set, the layer is hidden.\r\n\t\t\tpivot: this.reader.getFloat32Array( 3 ), // Note: this seems to be superflous, as the geometry is translated when pivot is present\r\n\t\t\tname: this.reader.getString(),\r\n\t\t};\r\n\r\n\t\tthis.tree.layers.push( layer );\r\n\t\tthis.currentLayer = layer;\r\n\r\n\t\tvar parsedLength = 16 + stringOffset( this.currentLayer.name ); // index ( 2 ) + flags( 2 ) + pivot( 12 ) + stringlength\r\n\r\n\t\t// if we have not reached then end of the layer block, there must be a parent defined\r\n\t\tthis.currentLayer.parent = ( parsedLength < length ) ? this.reader.getUint16() : - 1; // omitted or -1 for no parent\r\n\r\n\t},\r\n\r\n\t// VEC12 * ( F4 + F4 + F4 ) array of x,y,z vectors\r\n\t// Converting from left to right handed coordinate system:\r\n\t// x -> -x and switch material FrontSide -> BackSide\r\n\tparsePoints( length ) {\r\n\r\n\t\tthis.currentPoints = [];\r\n\t\tfor ( var i = 0; i < length / 4; i += 3 ) {\r\n\r\n\t\t\t// z -> -z to match three.js right handed coords\r\n\t\t\tthis.currentPoints.push( this.reader.getFloat32(), this.reader.getFloat32(), - this.reader.getFloat32() );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t// parse VMAP or VMAD\r\n\t// Associates a set of floating-point vectors with a set of points.\r\n\t// VMAP: { type[ID4], dimension[U2], name[S0], ( vert[VX], value[F4] # dimension ) * }\r\n\r\n\t// VMAD Associates a set of floating-point vectors with the vertices of specific polygons.\r\n\t// Similar to VMAP UVs, but associates with polygon vertices rather than points\r\n\t// to solve to problem of UV seams:  VMAD chunks are paired with VMAPs of the same name,\r\n\t// if they exist. The vector values in the VMAD will then replace those in the\r\n\t// corresponding VMAP, but only for calculations involving the specified polygons.\r\n\t// VMAD { type[ID4], dimension[U2], name[S0], ( vert[VX], poly[VX], value[F4] # dimension ) * }\r\n\tparseVertexMapping( length, discontinuous ) {\r\n\r\n\t\tvar finalOffset = this.reader.offset + length;\r\n\r\n\t\tvar channelName = this.reader.getString();\r\n\r\n\t\tif ( this.reader.offset === finalOffset ) {\r\n\r\n\t\t\t// then we are in a texture node and the VMAP chunk is just a reference to a UV channel name\r\n\t\t\tthis.currentForm.UVChannel = channelName;\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t// otherwise reset to initial length and parse normal VMAP CHUNK\r\n\t\tthis.reader.setOffset( this.reader.offset - stringOffset( channelName ) );\r\n\r\n\t\tvar type = this.reader.getIDTag();\r\n\r\n\t\tthis.reader.getUint16(); // dimension\r\n\t\tvar name = this.reader.getString();\r\n\r\n\t\tvar remainingLength = length - 6 - stringOffset( name );\r\n\r\n\t\tswitch ( type ) {\r\n\r\n\t\t\tcase 'TXUV':\r\n\t\t\t\tthis.parseUVMapping( name, finalOffset, discontinuous );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'MORF':\r\n\t\t\tcase 'SPOT':\r\n\t\t\t\tthis.parseMorphTargets( name, finalOffset, type ); // can't be discontinuous\r\n\t\t\t\tbreak;\r\n\t\t\t// unsupported VMAPs\r\n\t\t\tcase 'APSL':\r\n\t\t\tcase 'NORM':\r\n\t\t\tcase 'WGHT':\r\n\t\t\tcase 'MNVW':\r\n\t\t\tcase 'PICK':\r\n\t\t\tcase 'RGB ':\r\n\t\t\tcase 'RGBA':\r\n\t\t\t\tthis.reader.skip( remainingLength );\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.warn( 'LWOLoader: unknown vertex map type: ' + type );\r\n\t\t\t\tthis.reader.skip( remainingLength );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tparseUVMapping( name, finalOffset, discontinuous ) {\r\n\r\n\t\tvar uvIndices = [];\r\n\t\tvar polyIndices = [];\r\n\t\tvar uvs = [];\r\n\r\n\t\twhile ( this.reader.offset < finalOffset ) {\r\n\r\n\t\t\tuvIndices.push( this.reader.getVariableLengthIndex() );\r\n\r\n\t\t\tif ( discontinuous ) polyIndices.push( this.reader.getVariableLengthIndex() );\r\n\r\n\t\t\tuvs.push( this.reader.getFloat32(), this.reader.getFloat32() );\r\n\r\n\t\t}\r\n\r\n\t\tif ( discontinuous ) {\r\n\r\n\t\t\tif ( ! this.currentLayer.discontinuousUVs ) this.currentLayer.discontinuousUVs = {};\r\n\r\n\t\t\tthis.currentLayer.discontinuousUVs[ name ] = {\r\n\t\t\t\tuvIndices: uvIndices,\r\n\t\t\t\tpolyIndices: polyIndices,\r\n\t\t\t\tuvs: uvs,\r\n\t\t\t};\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( ! this.currentLayer.uvs ) this.currentLayer.uvs = {};\r\n\r\n\t\t\tthis.currentLayer.uvs[ name ] = {\r\n\t\t\t\tuvIndices: uvIndices,\r\n\t\t\t\tuvs: uvs,\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tparseMorphTargets( name, finalOffset, type ) {\r\n\r\n\t\tvar indices = [];\r\n\t\tvar points = [];\r\n\r\n\t\ttype = ( type === 'MORF' ) ? 'relative' : 'absolute';\r\n\r\n\t\twhile ( this.reader.offset < finalOffset ) {\r\n\r\n\t\t\tindices.push( this.reader.getVariableLengthIndex() );\r\n\t\t\t// z -> -z to match three.js right handed coords\r\n\t\t\tpoints.push( this.reader.getFloat32(), this.reader.getFloat32(), - this.reader.getFloat32() );\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! this.currentLayer.morphTargets ) this.currentLayer.morphTargets = {};\r\n\r\n\t\tthis.currentLayer.morphTargets[ name ] = {\r\n\t\t\tindices: indices,\r\n\t\t\tpoints: points,\r\n\t\t\ttype: type,\r\n\t\t};\r\n\r\n\t},\r\n\r\n\t// A list of polygons for the current layer.\r\n\t// POLS { type[ID4], ( numvert+flags[U2], vert[VX] # numvert ) * }\r\n\tparsePolygonList( length ) {\r\n\r\n\t\tvar finalOffset = this.reader.offset + length;\r\n\t\tvar type = this.reader.getIDTag();\r\n\r\n\t\tvar indices = [];\r\n\r\n\t\t// hold a list of polygon sizes, to be split up later\r\n\t\tvar polygonDimensions = [];\r\n\r\n\t\twhile ( this.reader.offset < finalOffset ) {\r\n\r\n\t\t\tvar numverts = this.reader.getUint16();\r\n\r\n\t\t\t//var flags = numverts & 64512; // 6 high order bits are flags - ignoring for now\r\n\t\t\tnumverts = numverts & 1023; // remaining ten low order bits are vertex num\r\n\t\t\tpolygonDimensions.push( numverts );\r\n\r\n\t\t\tfor ( var j = 0; j < numverts; j ++ ) indices.push( this.reader.getVariableLengthIndex() );\r\n\r\n\t\t}\r\n\r\n\t\tvar geometryData = {\r\n\t\t\ttype: type,\r\n\t\t\tvertexIndices: indices,\r\n\t\t\tpolygonDimensions: polygonDimensions,\r\n\t\t\tpoints: this.currentPoints\r\n\t\t};\r\n\r\n\t\t// Note: assuming that all polys will be lines or points if the first is\r\n\t\tif ( polygonDimensions[ 0 ] === 1 ) geometryData.type = 'points';\r\n\t\telse if ( polygonDimensions[ 0 ] === 2 ) geometryData.type = 'lines';\r\n\r\n\t\tthis.currentLayer.geometry = geometryData;\r\n\r\n\t},\r\n\r\n\t// Lists the tag strings that can be associated with polygons by the PTAG chunk.\r\n\t// TAGS { tag-string[S0] * }\r\n\tparseTagStrings( length ) {\r\n\r\n\t\tthis.tree.tags = this.reader.getStringArray( length );\r\n\r\n\t},\r\n\r\n\t// Associates tags of a given type with polygons in the most recent POLS chunk.\r\n\t// PTAG { type[ID4], ( poly[VX], tag[U2] ) * }\r\n\tparsePolygonTagMapping( length ) {\r\n\r\n\t\tvar finalOffset = this.reader.offset + length;\r\n\t\tvar type = this.reader.getIDTag();\r\n\t\tif ( type === 'SURF' ) this.parseMaterialIndices( finalOffset );\r\n\t\telse { //PART, SMGP, COLR not supported\r\n\r\n\t\t\tthis.reader.skip( length - 4 );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tparseMaterialIndices( finalOffset ) {\r\n\r\n\t\t// array holds polygon index followed by material index\r\n\t\tthis.currentLayer.geometry.materialIndices = [];\r\n\r\n\t\twhile ( this.reader.offset < finalOffset ) {\r\n\r\n\t\t\tvar polygonIndex = this.reader.getVariableLengthIndex();\r\n\t\t\tvar materialIndex = this.reader.getUint16();\r\n\r\n\t\t\tthis.currentLayer.geometry.materialIndices.push( polygonIndex, materialIndex );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tparseUnknownCHUNK( blockID, length ) {\r\n\r\n\t\tconsole.warn( 'LWOLoader: unknown chunk type: ' + blockID + ' length: ' + length );\r\n\r\n\t\t// print the chunk plus some bytes padding either side\r\n\t\t// printBuffer( this.reader.dv.buffer, this.reader.offset - 20, length + 40 );\r\n\r\n\t\tvar data = this.reader.getString( length );\r\n\r\n\t\tthis.currentForm[ blockID ] = data;\r\n\r\n\t}\r\n\r\n};\r\n\r\nfunction DataViewReader( buffer ) {\r\n\r\n\tthis.dv = new DataView( buffer );\r\n\tthis.offset = 0;\r\n\r\n}\r\n\r\nDataViewReader.prototype = {\r\n\r\n\tconstructor: DataViewReader,\r\n\r\n\tsize: function () {\r\n\r\n\t\treturn this.dv.buffer.byteLength;\r\n\r\n\t},\r\n\r\n\tsetOffset( offset ) {\r\n\r\n\t\tif ( offset > 0 && offset < this.dv.buffer.byteLength ) {\r\n\r\n\t\t\tthis.offset = offset;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.error( 'LWOLoader: invalid buffer offset' );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tendOfFile: function () {\r\n\r\n\t\tif ( this.offset >= this.size() ) return true;\r\n\t\treturn false;\r\n\r\n\t},\r\n\r\n\tskip: function ( length ) {\r\n\r\n\t\tthis.offset += length;\r\n\r\n\t},\r\n\r\n\tgetUint8: function () {\r\n\r\n\t\tvar value = this.dv.getUint8( this.offset );\r\n\t\tthis.offset += 1;\r\n\t\treturn value;\r\n\r\n\t},\r\n\r\n\tgetUint16: function () {\r\n\r\n\t\tvar value = this.dv.getUint16( this.offset );\r\n\t\tthis.offset += 2;\r\n\t\treturn value;\r\n\r\n\t},\r\n\r\n\tgetInt32: function () {\r\n\r\n\t\tvar value = this.dv.getInt32( this.offset, false );\r\n\t\tthis.offset += 4;\r\n\t\treturn value;\r\n\r\n\t},\r\n\r\n\tgetUint32: function () {\r\n\r\n\t\tvar value = this.dv.getUint32( this.offset, false );\r\n\t\tthis.offset += 4;\r\n\t\treturn value;\r\n\r\n\t},\r\n\r\n\tgetUint64: function () {\r\n\r\n\t\tvar low, high;\r\n\r\n\t\thigh = this.getUint32();\r\n\t\tlow = this.getUint32();\r\n\t\treturn high * 0x100000000 + low;\r\n\r\n\t},\r\n\r\n\tgetFloat32: function () {\r\n\r\n\t\tvar value = this.dv.getFloat32( this.offset, false );\r\n\t\tthis.offset += 4;\r\n\t\treturn value;\r\n\r\n\t},\r\n\r\n\tgetFloat32Array: function ( size ) {\r\n\r\n\t\tvar a = [];\r\n\r\n\t\tfor ( var i = 0; i < size; i ++ ) {\r\n\r\n\t\t\ta.push( this.getFloat32() );\r\n\r\n\t\t}\r\n\r\n\t\treturn a;\r\n\r\n\t},\r\n\r\n\tgetFloat64: function () {\r\n\r\n\t\tvar value = this.dv.getFloat64( this.offset, this.littleEndian );\r\n\t\tthis.offset += 8;\r\n\t\treturn value;\r\n\r\n\t},\r\n\r\n\tgetFloat64Array: function ( size ) {\r\n\r\n\t\tvar a = [];\r\n\r\n\t\tfor ( var i = 0; i < size; i ++ ) {\r\n\r\n\t\t\ta.push( this.getFloat64() );\r\n\r\n\t\t}\r\n\r\n\t\treturn a;\r\n\r\n\t},\r\n\r\n\t// get variable-length index data type\r\n\t// VX ::= index[U2] | (index + 0xFF000000)[U4]\r\n\t// If the index value is less than 65,280 (0xFF00),then VX === U2\r\n\t// otherwise VX === U4 with bits 24-31 set\r\n\t// When reading an index, if the first byte encountered is 255 (0xFF), then\r\n\t// the four-byte form is being used and the first byte should be discarded or masked out.\r\n\tgetVariableLengthIndex() {\r\n\r\n\t\tvar firstByte = this.getUint8();\r\n\r\n\t\tif ( firstByte === 255 ) {\r\n\r\n\t\t\treturn this.getUint8() * 65536 + this.getUint8() * 256 + this.getUint8();\r\n\r\n\t\t}\r\n\r\n\t\treturn firstByte * 256 + this.getUint8();\r\n\r\n\t},\r\n\r\n\t// An ID tag is a sequence of 4 bytes containing 7-bit ASCII values\r\n\tgetIDTag() {\r\n\r\n\t\treturn this.getString( 4 );\r\n\r\n\t},\r\n\r\n\tgetString: function ( size ) {\r\n\r\n\t\tif ( size === 0 ) return;\r\n\r\n\t\t// note: safari 9 doesn't support Uint8Array.indexOf; create intermediate array instead\r\n\t\tvar a = [];\r\n\r\n\t\tif ( size ) {\r\n\r\n\t\t\tfor ( var i = 0; i < size; i ++ ) {\r\n\r\n\t\t\t\ta[ i ] = this.getUint8();\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar currentChar;\r\n\t\t\tvar len = 0;\r\n\r\n\t\t\twhile ( currentChar !== 0 ) {\r\n\r\n\t\t\t\tcurrentChar = this.getUint8();\r\n\t\t\t\tif ( currentChar !== 0 ) a.push( currentChar );\r\n\t\t\t\tlen ++;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! isEven( len + 1 ) ) this.getUint8(); // if string with terminating nullbyte is uneven, extra nullbyte is added\r\n\r\n\t\t}\r\n\r\n\t\treturn LoaderUtils.decodeText( new Uint8Array( a ) );\r\n\r\n\t},\r\n\r\n\tgetStringArray: function ( size ) {\r\n\r\n\t\tvar a = this.getString( size );\r\n\t\ta = a.split( '\\0' );\r\n\r\n\t\treturn a.filter( Boolean ); // return array with any empty strings removed\r\n\r\n\t}\r\n\r\n};\r\n\r\n// ************** DEBUGGER  **************\r\n\r\nfunction Debugger( ) {\r\n\r\n\tthis.active = false;\r\n\tthis.depth = 0;\r\n\tthis.formList = [];\r\n\r\n}\r\n\r\nDebugger.prototype = {\r\n\r\n\tconstructor: Debugger,\r\n\r\n\tenable: function () {\r\n\r\n\t\tthis.active = true;\r\n\r\n\t},\r\n\r\n\tlog: function () {\r\n\r\n\t\tif ( ! this.active ) return;\r\n\r\n\t\tvar nodeType;\r\n\r\n\t\tswitch ( this.node ) {\r\n\r\n\t\t\tcase 0:\r\n\t\t\t\tnodeType = \"FORM\";\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\tnodeType = \"CHK\";\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2:\r\n\t\t\t\tnodeType = \"S-CHK\";\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tconsole.log(\r\n\t\t\t\"| \".repeat( this.depth ) +\r\n\t\t\tnodeType,\r\n\t\t\tthis.nodeID,\r\n\t\t\t`( ${this.offset} ) -> ( ${this.dataOffset + this.length} )`,\r\n\t\t\t( ( this.node == 0 ) ? \" {\" : \"\" ),\r\n\t\t\t( ( this.skipped ) ? \"SKIPPED\" : \"\" ),\r\n\t\t\t( ( this.node == 0 && this.skipped ) ? \"}\" : \"\" )\r\n\t\t);\r\n\r\n\t\tif ( this.node == 0 && ! this.skipped ) {\r\n\r\n\t\t\tthis.depth += 1;\r\n\t\t\tthis.formList.push( this.dataOffset + this.length );\r\n\r\n\t\t}\r\n\r\n\t\tthis.skipped = false;\r\n\r\n\t},\r\n\r\n\tcloseForms: function () {\r\n\r\n\t\tif ( ! this.active ) return;\r\n\r\n\t\tfor ( var i = this.formList.length - 1; i >= 0; i -- ) {\r\n\r\n\t\t\tif ( this.offset >= this.formList[ i ] ) {\r\n\r\n\t\t\t\tthis.depth -= 1;\r\n\t\t\t\tconsole.log( \"| \".repeat( this.depth ) + \"}\" );\r\n\t\t\t\tthis.formList.splice( - 1, 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\n// ************** UTILITY FUNCTIONS **************\r\n\r\nfunction isEven( num ) {\r\n\r\n\treturn num % 2;\r\n\r\n}\r\n\r\n// calculate the length of the string in the buffer\r\n// this will be string.length + nullbyte + optional padbyte to make the length even\r\nfunction stringOffset( string ) {\r\n\r\n\treturn string.length + 1 + ( isEven( string.length + 1 ) ? 1 : 0 );\r\n\r\n}\r\n\r\n// for testing purposes, dump buffer to console\r\n// printBuffer( this.reader.dv.buffer, this.reader.offset, length );\r\nfunction printBuffer( buffer, from, to ) {\r\n\r\n\tconsole.log( LoaderUtils.decodeText( new Uint8Array( buffer, from, to ) ) );\r\n\r\n}\r\n\r\nexport { IFFParser };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/loaders/lwo/IFFParser.js","<template>\r\n    <div class=\"webglLoaderLwo-container\">\r\n        <div id=\"info\">\r\n\t\t\t<a href=\"https://threejs.org\" target=\"_blank\" rel=\"noopener\">three.js</a> - LWOLoader\r\n\t\t\t<P>Lightwave Object loader by <a href=\"https://discoverthreejs.com/\" target=\"_blank\" rel=\"noopener\">Discover three.js</a></P>\r\n\t\t\tModels by <a href=\"https://onthez.com/\" target=\"_blank\" rel=\"noopener\">on the z</a> - Environment images by <a href=\"https://hdrihaven.com/\" target=\"_blank\" rel=\"noopener\">HDRI Haven</a>\r\n\t\t</div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { OrbitControls } from '@/components/jsm/controls/OrbitControls.js';\r\nimport { LWOLoader } from '@/components/jsm/loaders/LWOLoader.js'\r\nexport default {\r\n    data() {\r\n        return {\r\n            camera: null,\r\n            scene: null,\r\n            renderer: null,\r\n        }\r\n    },\r\n    mounted() {\r\n        this.init()\r\n    },\r\n    methods: {\r\n        init() {\r\n            var container = document.createElement('div')\r\n            document.getElementsByClassName('webglLoaderLwo-container')[0].appendChild(container)\r\n            this.camera = new this.$THREE.PerspectiveCamera(45, this.$webglInnerWidth / window.innerHeight, 1, 200)\r\n            this.camera.position.set(- 0.7, 14.6, 43.2)\r\n            this.scene = new this.$THREE.Scene()\r\n            this.scene.background = new this.$THREE.Color(0xa0a0a0)\r\n            var ambientLight = new this.$THREE.AmbientLight(0xaaaaaa, 1.75)\r\n            this.scene.add(ambientLight)\r\n            var light1 = new this.$THREE.DirectionalLight(0xffffff, 1)\r\n            light1.position.set(0, 200, 100)\r\n            light1.castShadow = true\r\n            light1.shadow.camera.top = 180\r\n            light1.shadow.camera.bottom = - 100\r\n            light1.shadow.camera.left = - 120\r\n            light1.shadow.camera.right = 120\r\n            this.scene.add(light1)\r\n            var light2 = new this.$THREE.DirectionalLight(0xffffff, 0.7)\r\n            light2.position.set(- 100, 200, - 100)\r\n            this.scene.add(light2)\r\n            var light3 = new this.$THREE.DirectionalLight(0xffffff, 0.4)\r\n            light3.position.set(100, - 200, 100)\r\n            this.scene.add(light3)\r\n            var light4 = new this.$THREE.DirectionalLight(0xffffff, 1)\r\n            light4.position.set(- 100, - 100, 100)\r\n            this.scene.add(light4)\r\n            var grid = new this.$THREE.GridHelper(200, 20, 0x000000, 0x000000)\r\n            grid.material.opacity = 0.3\r\n            grid.material.transparent = true\r\n            this.scene.add(grid)\r\n            var loader = new LWOLoader()\r\n            loader.load('static/models/lwo/Objects/LWO3/Demo.lwo', (object) => {\r\n                var phong = object.meshes[ 0 ]\r\n                phong.position.set(- 2, 12, 0)\r\n                var standard = object.meshes[ 1 ]\r\n                standard.position.set(2, 12, 0)\r\n                var rocket = object.meshes[ 2 ]\r\n                rocket.position.set(0, 10.5, - 1)\r\n                this.scene.add(phong, standard, rocket)\r\n            })\r\n            this.renderer = new this.$THREE.WebGLRenderer({ antialias: true })\r\n            this.renderer.setPixelRatio(window.devicePixelRatio)\r\n            this.renderer.setSize(this.$webglInnerWidth, window.innerHeight)\r\n            this.renderer.shadowMap.enabled = true\r\n            this.renderer.physicallyCorrectLights = true\r\n            this.renderer.gammaFactor = 1.18\r\n            this.renderer.outputEncoding = this.$THREE.sRGBEncoding\r\n            container.appendChild(this.renderer.domElement)\r\n            var controls = new OrbitControls(this.camera, this.renderer.domElement)\r\n            controls.target.set(1.33, 10, - 6.7)\r\n            controls.update()\r\n            this.renderer.setAnimationLoop(() => {\r\n                this.renderer.render(this.scene, this.camera)\r\n            })\r\n            window.addEventListener('resize', this.onWindowResize, false)\r\n        },\r\n        onWindowResize() {\r\n            this.$onWindowResize(this.camera, this.renderer)\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.webglLoaderLwo-container {\r\n    width: 100%;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/views/loader/webglLoaderLwo.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"webglLoaderLwo-container\"},[_c('div',{attrs:{\"id\":\"info\"}},[_c('a',{attrs:{\"href\":\"https://threejs.org\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"three.js\")]),_vm._v(\" - LWOLoader\\n\\t\\t\\t\"),_c('P',[_vm._v(\"Lightwave Object loader by \"),_c('a',{attrs:{\"href\":\"https://discoverthreejs.com/\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"Discover three.js\")])]),_vm._v(\"\\n\\t\\t\\tModels by \"),_c('a',{attrs:{\"href\":\"https://onthez.com/\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"on the z\")]),_vm._v(\" - Environment images by \"),_c('a',{attrs:{\"href\":\"https://hdrihaven.com/\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"HDRI Haven\")])],1)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-f7784c4a\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/loader/webglLoaderLwo.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-f7784c4a\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./webglLoaderLwo.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglLoaderLwo.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglLoaderLwo.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-f7784c4a\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./webglLoaderLwo.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-f7784c4a\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/loader/webglLoaderLwo.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}