webpackJsonp([289],{QRWm:function(t,e){},r5Oh:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("wIBv"),a={data:function(){return{container:null,stats:null,camera:null,controls:null,scene:null,renderer:null,textureLoader:null,clock:null,gravityConstant:-9.8,physicsWorld:null,rigidBodies:[],margin:.05,hinge:null,cloth:null,transformAux1:null,armMovement:0}},mounted:function(){var t=this;this.clock=new this.$THREE.Clock,Ammo().then(function(e){Ammo=e,t.init(),t.animate()})},methods:{init:function(){this.initGraphics(),this.initPhysics(),this.createObjects(),this.initInput()},initGraphics:function(){this.container=document.getElementById("container"),this.camera=new this.$THREE.PerspectiveCamera(60,this.$webglInnerWidth/window.innerHeight,.2,2e3),this.scene=new this.$THREE.Scene,this.scene.background=new this.$THREE.Color(12571109),this.camera.position.set(-12,7,4),this.renderer=new this.$THREE.WebGLRenderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.$webglInnerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.container.appendChild(this.renderer.domElement),this.controls=new s.b(this.camera,this.renderer.domElement),this.controls.target.set(0,2,0),this.controls.update(),this.textureLoader=new this.$THREE.TextureLoader;var t=new this.$THREE.AmbientLight(4210752);this.scene.add(t);var e=new this.$THREE.DirectionalLight(16777215,1);e.position.set(-7,10,15),e.castShadow=!0;e.shadow.camera.left=-10,e.shadow.camera.right=10,e.shadow.camera.top=10,e.shadow.camera.bottom=-10,e.shadow.camera.near=2,e.shadow.camera.far=50,e.shadow.mapSize.x=1024,e.shadow.mapSize.y=1024,e.shadow.bias=-.003,this.scene.add(e),this.stats=new this.$Stats,this.stats.dom.style.left="280px",this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.container.appendChild(this.stats.domElement),window.addEventListener("resize",this.onWindowResize,!1)},initPhysics:function(){var t=new Ammo.btSoftBodyRigidBodyCollisionConfiguration,e=new Ammo.btCollisionDispatcher(t),i=new Ammo.btDbvtBroadphase,s=new Ammo.btSequentialImpulseConstraintSolver,a=new Ammo.btDefaultSoftBodySolver;this.physicsWorld=new Ammo.btSoftRigidDynamicsWorld(e,i,s,t,a),this.physicsWorld.setGravity(new Ammo.btVector3(0,this.gravityConstant,0)),this.physicsWorld.getWorldInfo().set_m_gravity(new Ammo.btVector3(0,this.gravityConstant,0)),this.transformAux1=new Ammo.btTransform},createObjects:function(){var t=this,e=new this.$THREE.Vector3,i=new this.$THREE.Quaternion;e.set(0,-.5,0),i.set(0,0,0,1);var s=this.createParalellepiped(40,1,40,0,e,i,new this.$THREE.MeshPhongMaterial({color:16777215}));s.castShadow=!0,s.receiveShadow=!0,this.textureLoader.load("static/textures/grid.png",function(e){e.wrapS=t.$THREE.RepeatWrapping,e.wrapT=t.$THREE.RepeatWrapping,e.repeat.set(40,40),s.material.map=e,s.material.needsUpdate=!0});var a=1.2*-6*.5;e.set(0,.3,a),i.set(0,0,0,1);for(var o=0;o<8;o++){var n=o%2==1;e.z=a,n&&(e.z-=.3);for(var r=n?7:6,h=0;h<r;h++){var c=1.2,d=.5;!n||0!=h&&h!=r-1||(c*=.5,d*=.5);var l=this.createParalellepiped(.6,.6,c,d,e,i,this.createMaterial());l.castShadow=!0,l.receiveShadow=!0,e.z+=!n||0!=h&&h!=r-2?1.2:.75*1.2}e.y+=.6}var m=new this.$THREE.Vector3(-3,3,2),p=new this.$THREE.PlaneBufferGeometry(4,3,20,15);p.rotateY(.5*Math.PI),p.translate(m.x,m.y+1.5,m.z-2);var u=new this.$THREE.MeshLambertMaterial({color:16777215,side:this.$THREE.DoubleSide});this.cloth=new this.$THREE.Mesh(p,u),this.cloth.castShadow=!0,this.cloth.receiveShadow=!0,this.scene.add(this.cloth),this.textureLoader.load("static/textures/grid.png",function(e){e.wrapS=t.$THREE.RepeatWrapping,e.wrapT=t.$THREE.RepeatWrapping,e.repeat.set(20,15),t.cloth.material.map=e,t.cloth.material.needsUpdate=!0});var w=new Ammo.btSoftBodyHelpers,y=new Ammo.btVector3(m.x,m.y+3,m.z),v=new Ammo.btVector3(m.x,m.y+3,m.z-4),g=new Ammo.btVector3(m.x,m.y,m.z),f=new Ammo.btVector3(m.x,m.y,m.z-4),E=w.CreatePatch(this.physicsWorld.getWorldInfo(),y,v,g,f,21,16,0,!0),b=E.get_m_cfg();b.set_viterations(10),b.set_piterations(10),E.setTotalMass(.9,!1),Ammo.castObject(E,Ammo.btCollisionObject).getCollisionShape().setMargin(3*this.margin),this.physicsWorld.addSoftBody(E,1,-1),this.cloth.userData.physicsBody=E,E.setActivationState(4);var R=m.y+3,A=new this.$THREE.MeshPhongMaterial({color:6316128});e.set(m.x,.1,m.z-7),i.set(0,0,0,1);var S=this.createParalellepiped(1,.2,1,0,e,i,A);S.castShadow=!0,S.receiveShadow=!0,e.set(m.x,.5*R,m.z-7);var x=this.createParalellepiped(.4,R,.4,0,e,i,A);x.castShadow=!0,x.receiveShadow=!0,e.set(m.x,R+.2,m.z-3.5);var T=this.createParalellepiped(.4,.4,7.4,2,e,i,A);T.castShadow=!0,T.receiveShadow=!0;E.appendAnchor(0,T.userData.physicsBody,!1,.5),E.appendAnchor(20,T.userData.physicsBody,!1,.5);var $=new Ammo.btVector3(0,.5*R,0),B=new Ammo.btVector3(0,-.2,-3.5),H=new Ammo.btVector3(0,1,0);this.hinge=new Ammo.btHingeConstraint(x.userData.physicsBody,T.userData.physicsBody,$,B,H,H,!0),this.physicsWorld.addConstraint(this.hinge,!0)},createParalellepiped:function(t,e,i,s,a,o,n){var r=new this.$THREE.Mesh(new this.$THREE.BoxBufferGeometry(t,e,i,1,1,1),n),h=new Ammo.btBoxShape(new Ammo.btVector3(.5*t,.5*e,.5*i));return h.setMargin(this.margin),this.createRigidBody(r,h,s,a,o),r},createRigidBody:function(t,e,i,s,a){t.position.copy(s),t.quaternion.copy(a);var o=new Ammo.btTransform;o.setIdentity(),o.setOrigin(new Ammo.btVector3(s.x,s.y,s.z)),o.setRotation(new Ammo.btQuaternion(a.x,a.y,a.z,a.w));var n=new Ammo.btDefaultMotionState(o),r=new Ammo.btVector3(0,0,0);e.calculateLocalInertia(i,r);var h=new Ammo.btRigidBodyConstructionInfo(i,n,e,r),c=new Ammo.btRigidBody(h);t.userData.physicsBody=c,this.scene.add(t),i>0&&(this.rigidBodies.push(t),c.setActivationState(4)),this.physicsWorld.addRigidBody(c)},createRandomColor:function(){return Math.floor(Math.random()*(1<<24))},createMaterial:function(){return new this.$THREE.MeshPhongMaterial({color:this.createRandomColor()})},initInput:function(){var t=this;window.addEventListener("keydown",function(e){switch(e.keyCode){case 81:t.armMovement=1;break;case 65:t.armMovement=-1}},!1),window.addEventListener("keyup",function(){t.armMovement=0},!1)},onWindowResize:function(){this.$onWindowResize(this.camera,this.renderer)},animate:function(){requestAnimationFrame(this.animate),this.render(),this.stats.update()},render:function(){var t=this.clock.getDelta();this.updatePhysics(t),this.renderer.render(this.scene,this.camera)},updatePhysics:function(t){this.hinge.enableAngularMotor(!0,.8*this.armMovement,50),this.physicsWorld.stepSimulation(t,10);for(var e=this.cloth.userData.physicsBody,i=this.cloth.geometry.attributes.position.array,s=i.length/3,a=e.get_m_nodes(),o=0,n=0;n<s;n++){var r=a.at(n).get_m_x();i[o++]=r.x(),i[o++]=r.y(),i[o++]=r.z()}this.cloth.geometry.computeVertexNormals(),this.cloth.geometry.attributes.position.needsUpdate=!0,this.cloth.geometry.attributes.normal.needsUpdate=!0;n=0;for(var h=this.rigidBodies.length;n<h;n++){var c=this.rigidBodies[n],d=c.userData.physicsBody.getMotionState();if(d){d.getWorldTransform(this.transformAux1);var l=this.transformAux1.getOrigin(),m=this.transformAux1.getRotation();c.position.set(l.x(),l.y(),l.z()),c.quaternion.set(m.x(),m.y(),m.z(),m.w())}}}}},o={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"physicsAmmoCloth-container"},[e("div",{attrs:{id:"info"}},[this._v("Ammo.js physics soft body cloth demo"),e("br"),this._v("Press Q or A to move the arm.")]),this._v(" "),e("div",{attrs:{id:"container"}})])}]};var n=i("VU/8")(a,o,!1,function(t){i("QRWm")},"data-v-291531da",null);e.default=n.exports}});
//# sourceMappingURL=289.92b1a70af558a8493d50.js.map