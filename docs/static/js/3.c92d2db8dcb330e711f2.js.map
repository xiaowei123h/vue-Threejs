{"version":3,"sources":["webpack:///./src/components/jsm/loaders/GLTFLoader.js","webpack:///./src/components/jsm/loaders/DRACOLoader.js","webpack:///src/views/animation/webglAnimationKeyframes.vue","webpack:///./src/views/animation/webglAnimationKeyframes.vue?1f5c","webpack:///./src/views/animation/webglAnimationKeyframes.vue"],"names":["GLTFLoader","manager","Loader","call","this","dracoLoader","ddsLoader","ktx2Loader","meshoptDecoder","pluginCallbacks","register","parser","GLTFMaterialsClearcoatExtension","GLTFTextureBasisUExtension","GLTFTextureWebPExtension","GLTFMaterialsTransmissionExtension","GLTFLightsExtension","GLTFMeshoptCompression","prototype","Object","assign","create","constructor","load","url","onLoad","onProgress","onError","resourcePath","scope","path","LoaderUtils","extractUrlBase","itemStart","_onError","e","console","error","itemError","itemEnd","loader","FileLoader","setPath","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","data","parse","gltf","setDRACOLoader","setDDSLoader","setKTX2Loader","setMeshoptDecoder","callback","indexOf","push","unregister","splice","content","extensions","plugins","decodeText","Uint8Array","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","KHR_BINARY_GLTF","name","body","headerView","DataView","BINARY_EXTENSION_HEADER_LENGTH","header","magic","slice","version","getUint32","length","Error","chunkView","chunkIndex","byteLength","chunkLength","chunkType","BINARY_EXTENSION_CHUNK_TYPES","JSON","contentArray","BIN","byteOffset","json","undefined","asset","GLTFParser","crossOrigin","fileLoader","i","plugin","extensionsUsed","extensionName","extensionsRequired","KHR_MATERIALS_UNLIT","GLTFMaterialsUnlitExtension","KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS","GLTFMaterialsPbrSpecularGlossinessExtension","KHR_DRACO_MESH_COMPRESSION","GLTFDracoMeshCompressionExtension","MSFT_TEXTURE_DDS","GLTFTextureDDSExtension","KHR_TEXTURE_TRANSFORM","GLTFTextureTransformExtension","KHR_MESH_QUANTIZATION","GLTFMeshQuantizationExtension","warn","setExtensions","setPlugins","KHR_LIGHTS_PUNCTUAL","KHR_MATERIALS_CLEARCOAT","KHR_MATERIALS_TRANSMISSION","KHR_TEXTURE_BASISU","EXT_TEXTURE_WEBP","EXT_MESHOPT_COMPRESSION","cache","refs","uses","isSupported","_markDefs","nodeDefs","nodes","nodeIndex","nodeLength","nodeDef","light","_addNodeRef","_loadLight","lightIndex","cacheKey","dependency","get","lightNode","lightDef","lights","color","Color","fromArray","range","type","DirectionalLight","target","position","set","add","PointLight","distance","SpotLight","spot","innerConeAngle","outerConeAngle","Math","PI","angle","penumbra","decay","intensity","createUniqueName","Promise","resolve","createNodeAttachment","self","then","_getNodeRef","getMaterialType","MeshBasicMaterial","extendParams","materialParams","materialDef","pending","opacity","metallicRoughness","pbrMetallicRoughness","Array","isArray","baseColorFactor","array","baseColorTexture","assignTexture","all","materialIndex","materials","MeshPhysicalMaterial","extendMaterialParams","extension","clearcoatFactor","clearcoat","clearcoatTexture","clearcoatRoughnessFactor","clearcoatRoughness","clearcoatRoughnessTexture","clearcoatNormalTexture","scale","clearcoatNormalScale","Vector2","transmissionFactor","transmission","transmissionTexture","loadTexture","textureIndex","textureDef","textures","source","images","options","loadTextureImage","uri","getHandler","textureLoader","detectSupport","image","Image","src","onload","onerror","height","loadBufferView","index","bufferView","bufferViews","extensionDef","buffer","getDependency","decoder","supported","ready","res","count","stride","byteStride","result","ArrayBuffer","decodeGltfBuffer","mode","filter","preload","GLTFMeshStandardSGMaterial","params","MeshStandardMaterial","isGLTFSpecularGlossinessMaterial","specularMapParsFragmentChunk","join","glossinessMapParsFragmentChunk","specularMapFragmentChunk","glossinessMapFragmentChunk","lightPhysicalFragmentChunk","uniforms","specular","value","setHex","glossiness","specularMap","glossinessMap","_extraUniforms","onBeforeCompile","shader","uniformName","fragmentShader","replace","defineProperties","v","defines","USE_SPECULARMAP","USE_GLOSSINESSMAP","USE_UV","metalness","roughness","metalnessMap","roughnessMap","setValues","specularGlossinessParams","pbrSpecularGlossiness","diffuseFactor","diffuseTexture","emissive","glossinessFactor","specularFactor","specularGlossinessTexture","specGlossMapDef","createMaterial","material","fog","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","TangentSpaceNormalMap","normalScale","displacementMap","displacementScale","displacementBias","alphaMap","envMap","envMapIntensity","refractionRatio","GLTFCubicSplineInterpolant","parameterPositions","sampleValues","sampleSize","resultBuffer","Interpolant","decodePrimitive","primitive","bufferViewIndex","gltfAttributeMap","attributes","threeAttributeMap","attributeNormalizedMap","attributeTypeMap","attributeName","threeAttributeName","ATTRIBUTES","toLowerCase","accessorDef","accessors","componentType","WEBGL_COMPONENT_TYPES","normalized","decodeDracoFile","geometry","attribute","extendTexture","texture","transform","clone","offset","rotation","repeat","texCoord","needsUpdate","copy","copySampleValue_","values","valueSize","beforeStart_","afterEnd_","interpolate_","i1","t0","t","t1","stride2","stride3","td","p","pp","ppp","offset1","offset0","s2","s3","s0","s1","p0","m0","p1","m1","WEBGL_CONSTANTS","5120","Int8Array","5121","5122","Int16Array","5123","Uint16Array","5125","Uint32Array","5126","Float32Array","WEBGL_FILTERS","9728","NearestFilter","9729","LinearFilter","9984","NearestMipmapNearestFilter","9985","LinearMipmapNearestFilter","9986","NearestMipmapLinearFilter","9987","LinearMipmapLinearFilter","WEBGL_WRAPPINGS","33071","ClampToEdgeWrapping","33648","MirroredRepeatWrapping","10497","RepeatWrapping","WEBGL_TYPE_SIZES","SCALAR","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","WEIGHTS_0","JOINTS_0","PATH_PROPERTIES","translation","weights","INTERPOLATION","CUBICSPLINE","LINEAR","InterpolateLinear","STEP","InterpolateDiscrete","ALPHA_MODES","resolveURL","test","addUnknownExtensionsToUserData","knownExtensions","object","objectDef","userData","gltfExtensions","assignExtrasToUserData","gltfDef","extras","_typeof","updateMorphTargets","mesh","meshDef","il","morphTargetInfluences","targetNames","morphTargetDictionary","createAttributesKey","attributesKey","keys","sort","objects","key","remove","removeAll","associations","Map","primitiveCache","meshCache","cameraCache","lightCache","nodeNamesUsed","createImageBitmap","navigator","userAgent","ImageBitmapLoader","TextureLoader","setCrossOrigin","addPrimitiveAttributes","primitiveDef","assignAttributeAccessor","accessorIndex","accessor","setAttribute","gltfAttributeName","indices","setIndex","box","Box3","min","max","Vector3","targets","maxDisplacement","vector","setX","abs","setY","setZ","expandByVector","boundingBox","sphere","Sphere","getCenter","center","radius","distanceTo","boundingSphere","computeBounds","hasMorphPosition","hasMorphNormal","pendingPositionAccessors","pendingNormalAccessors","pendingAccessor","normal","morphPositions","morphNormals","morphAttributes","morphTargetsRelative","addMorphTargets","toTrianglesDrawMode","drawMode","getIndex","getAttribute","numberOfTriangles","newIndices","TriangleFanDrawMode","getX","newGeometry","_invokeAll","ext","getDependencies","dependencies","scene","scenes","animations","cameras","catch","skinDefs","skins","meshDefs","meshes","skinIndex","skinLength","joints","isBone","skin","isSkinnedMesh","camera","ref","_invokeOne","func","unshift","loadScene","loadNode","loadMesh","loadAccessor","loadBuffer","loadMaterial","loadSkin","loadAnimation","loadCamera","defs","def","bufferIndex","bufferDef","buffers","reject","bufferViewDef","sparse","pendingBufferViews","bufferAttribute","itemSize","TypedArray","elementBytes","BYTES_PER_ELEMENT","itemBytes","ibSlice","floor","ibCacheKey","ib","InterleavedBuffer","InterleavedBufferAttribute","BufferAttribute","itemSizeIndices","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","setW","textureExtensions","URL","webkitURL","sourceURI","isObjectURL","hasAlpha","mimeType","colorType","getUint8","blob","Blob","createObjectURL","isImageBitmapLoader","imageBitmap","CanvasTexture","revokeObjectURL","flipY","format","RGBFormat","sampler","samplers","magFilter","minFilter","wrapS","wrapT","mapName","mapDef","gltfReference","assignFinalMaterial","useVertexTangents","tangent","useVertexColors","useFlatShading","useSkinning","useMorphTargets","useMorphNormals","isPoints","uuid","pointsMaterial","PointsMaterial","Material","sizeAttenuation","isLine","lineMaterial","LineBasicMaterial","cachedMaterial","skinning","vertexTangents","vertexColors","flatShading","morphTargets","uv2","uv","y","materialType","materialExtensions","sgExtension","kmuExtension","metallicFactor","roughnessFactor","metallicRoughnessTexture","doubleSided","side","DoubleSide","alphaMode","transparent","depthWrite","alphaTest","alphaCutoff","normalTexture","occlusionTexture","strength","emissiveFactor","emissiveTexture","encoding","sRGBEncoding","originalName","PropertyBinding","sanitizeNodeName","loadGeometries","primitives","createDracoPrimitive","dracoExtension","geometryPromise","cached","promise","BufferGeometry","meshIndex","depthTest","FrontSide","results","geometries","SkinnedMesh","Mesh","skinWeight","normalizeSkinWeights","TriangleStripDrawMode","LineSegments","Line","LineLoop","Points","group","Group","cameraIndex","cameraDef","PerspectiveCamera","MathUtils","radToDeg","yfov","aspectRatio","znear","zfar","OrthographicCamera","xmag","ymag","skinDef","skinEntry","inverseBindMatrices","animationIndex","animationDef","pendingNodes","pendingInputAccessors","pendingOutputAccessors","pendingSamplers","pendingTargets","channels","channel","node","id","input","parameters","output","inputAccessors","outputAccessors","tracks","inputAccessor","outputAccessor","TypedKeyframeTrack","updateMatrix","matrixAutoUpdate","NumberKeyframeTrack","QuaternionKeyframeTrack","VectorKeyframeTrack","targetName","interpolation","traverse","isMesh","outputArray","scaled","j","jl","track","createInterpolant","times","getValueSize","isInterpolantFactoryMethodGLTFCubicSpline","AnimationClip","nodeName","o","forEach","Bone","Object3D","matrix","Matrix4","applyMatrix4","quaternion","buildNodeHierachy","nodeId","parentObject","pendingJoints","jointNodes","bones","boneInverses","jointNode","mat","bind","Skeleton","matrixWorld","children","child","sceneIndex","sceneDef","nodeIds","DRACOLoader","decoderPath","decoderConfig","decoderBinary","decoderPending","workerLimit","workerPool","workerNextTaskID","workerSourceURL","defaultAttributeIDs","defaultAttributeTypes","setDecoderPath","setDecoderConfig","config","setWorkerLimit","setVerbosity","setDrawMode","setSkipDequantization","_this","taskConfig","attributeIDs","attributeTypes","useUniqueIDs","decodeGeometry","_this2","worker","taskKey","stringify","taskCache","has","cachedTask","taskID","taskCost","geometryPending","_getWorker","_worker","_callbacks","postMessage","message","_createGeometry","_releaseTask","geometryData","_loadLibrary","responseType","_initDecoder","_this3","useJS","WebAssembly","DRACOLoader__typeof","librariesPending","libraries","jsContent","wasmBinary","fn","DRACOWorker","toString","substring","lastIndexOf","_this4","Worker","_taskCosts","_taskLoad","onmessage","a","b","debug","log","dispose","terminate","decodeAttribute","draco","dracoGeometry","attributeType","numComponents","num_components","numValues","num_points","dataType","DT_FLOAT32","DT_INT8","DT_INT16","Int32Array","DT_INT32","DT_UINT8","DT_UINT16","DT_UINT32","getDracoDataType","ptr","_malloc","GetAttributeDataArrayForAllPoints","HEAPF32","_free","onModuleLoaded","DracoDecoderModule","module","Decoder","decoderBuffer","DecoderBuffer","Init","decodingStatus","geometryType","GetEncodedGeometryType","TRIANGULAR_MESH","DecodeBufferToMesh","POINT_CLOUD","PointCloud","DecodeBufferToPointCloud","ok","error_msg","attributeID","GetAttributeByUniqueId","GetAttributeId","GetAttribute","numIndices","num_faces","GetTrianglesUInt32Array","decodeIndex","destroy","attr","WeakMap","releaseDecoderModule","getDecoderModule","webglAnimationKeyframes","mixer","clock","container","stats","renderer","dirLight","mounted","$THREE","Clock","init","methods","document","getElementById","$Stats","appendChild","dom","WebGLRenderer","antialias","setPixelRatio","window","devicePixelRatio","setSize","innerWidth","innerHeight","outputEncoding","domElement","Scene","background","controls","OrbitControls","update","enablePan","enableDamping","HemisphereLight","CubeTextureLoader","DRACOLoader_DRACOLoader","GLTFLoader_GLTFLoader","model","that","AnimationMixer","clipAction","play","animate","onresize","aspect","updateProjectionMatrix","requestAnimationFrame","delta","getDelta","render","animation_webglAnimationKeyframes","$createElement","_self","_c","_m","staticRenderFns","_vm","_h","staticClass","attrs","_v","href","rel","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/3.c92d2db8dcb330e711f2.js","sourcesContent":["import {\r\n\tAnimationClip,\r\n\tBone,\r\n\tBox3,\r\n\tBufferAttribute,\r\n\tBufferGeometry,\r\n\tCanvasTexture,\r\n\tClampToEdgeWrapping,\r\n\tColor,\r\n\tDirectionalLight,\r\n\tDoubleSide,\r\n\tFileLoader,\r\n\tFrontSide,\r\n\tGroup,\r\n\tImageBitmapLoader,\r\n\tInterleavedBuffer,\r\n\tInterleavedBufferAttribute,\r\n\tInterpolant,\r\n\tInterpolateDiscrete,\r\n\tInterpolateLinear,\r\n\tLine,\r\n\tLineBasicMaterial,\r\n\tLineLoop,\r\n\tLineSegments,\r\n\tLinearFilter,\r\n\tLinearMipmapLinearFilter,\r\n\tLinearMipmapNearestFilter,\r\n\tLoader,\r\n\tLoaderUtils,\r\n\tMaterial,\r\n\tMathUtils,\r\n\tMatrix4,\r\n\tMesh,\r\n\tMeshBasicMaterial,\r\n\tMeshPhysicalMaterial,\r\n\tMeshStandardMaterial,\r\n\tMirroredRepeatWrapping,\r\n\tNearestFilter,\r\n\tNearestMipmapLinearFilter,\r\n\tNearestMipmapNearestFilter,\r\n\tNumberKeyframeTrack,\r\n\tObject3D,\r\n\tOrthographicCamera,\r\n\tPerspectiveCamera,\r\n\tPointLight,\r\n\tPoints,\r\n\tPointsMaterial,\r\n\tPropertyBinding,\r\n\tQuaternionKeyframeTrack,\r\n\tRGBFormat,\r\n\tRepeatWrapping,\r\n\tSkeleton,\r\n\tSkinnedMesh,\r\n\tSphere,\r\n\tSpotLight,\r\n\tTangentSpaceNormalMap,\r\n\tTextureLoader,\r\n\tTriangleFanDrawMode,\r\n\tTriangleStripDrawMode,\r\n\tVector2,\r\n\tVector3,\r\n\tVectorKeyframeTrack,\r\n\tsRGBEncoding\r\n} from \"@/components/build/three.module.js\";\r\n\r\nvar GLTFLoader = ( function () {\r\n\r\n\tfunction GLTFLoader( manager ) {\r\n\r\n\t\tLoader.call( this, manager );\r\n\r\n\t\tthis.dracoLoader = null;\r\n\t\tthis.ddsLoader = null;\r\n\t\tthis.ktx2Loader = null;\r\n\t\tthis.meshoptDecoder = null;\r\n\r\n\t\tthis.pluginCallbacks = [];\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFMaterialsClearcoatExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFTextureBasisUExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFTextureWebPExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFMaterialsTransmissionExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFLightsExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFMeshoptCompression( parser );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tGLTFLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\t\tconstructor: GLTFLoader,\r\n\r\n\t\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\t\tvar scope = this;\r\n\r\n\t\t\tvar resourcePath;\r\n\r\n\t\t\tif ( this.resourcePath !== '' ) {\r\n\r\n\t\t\t\tresourcePath = this.resourcePath;\r\n\r\n\t\t\t} else if ( this.path !== '' ) {\r\n\r\n\t\t\t\tresourcePath = this.path;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Tells the LoadingManager to track an extra item, which resolves after\r\n\t\t\t// the model is fully loaded. This means the count of items loaded will\r\n\t\t\t// be incorrect, but ensures manager.onLoad() does not fire early.\r\n\t\t\tthis.manager.itemStart( url );\r\n\r\n\t\t\tvar _onError = function ( e ) {\r\n\r\n\t\t\t\tif ( onError ) {\r\n\r\n\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.manager.itemError( url );\r\n\t\t\t\tscope.manager.itemEnd( url );\r\n\r\n\t\t\t};\r\n\r\n\t\t\tvar loader = new FileLoader( this.manager );\r\n\r\n\t\t\tloader.setPath( this.path );\r\n\t\t\tloader.setResponseType( 'arraybuffer' );\r\n\t\t\tloader.setRequestHeader( this.requestHeader );\r\n\t\t\tloader.setWithCredentials( this.withCredentials );\r\n\r\n\t\t\tloader.load( url, function ( data ) {\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tscope.parse( data, resourcePath, function ( gltf ) {\r\n\r\n\t\t\t\t\t\tonLoad( gltf );\r\n\r\n\t\t\t\t\t\tscope.manager.itemEnd( url );\r\n\r\n\t\t\t\t\t}, _onError );\r\n\r\n\t\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\t\t_onError( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}, onProgress, _onError );\r\n\r\n\t\t},\r\n\r\n\t\tsetDRACOLoader: function ( dracoLoader ) {\r\n\r\n\t\t\tthis.dracoLoader = dracoLoader;\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tsetDDSLoader: function ( ddsLoader ) {\r\n\r\n\t\t\tthis.ddsLoader = ddsLoader;\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tsetKTX2Loader: function ( ktx2Loader ) {\r\n\r\n\t\t\tthis.ktx2Loader = ktx2Loader;\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tsetMeshoptDecoder: function ( meshoptDecoder ) {\r\n\r\n\t\t\tthis.meshoptDecoder = meshoptDecoder;\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tregister: function ( callback ) {\r\n\r\n\t\t\tif ( this.pluginCallbacks.indexOf( callback ) === - 1 ) {\r\n\r\n\t\t\t\tthis.pluginCallbacks.push( callback );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tunregister: function ( callback ) {\r\n\r\n\t\t\tif ( this.pluginCallbacks.indexOf( callback ) !== - 1 ) {\r\n\r\n\t\t\t\tthis.pluginCallbacks.splice( this.pluginCallbacks.indexOf( callback ), 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tparse: function ( data, path, onLoad, onError ) {\r\n\r\n\t\t\tvar content;\r\n\t\t\tvar extensions = {};\r\n\t\t\tvar plugins = {};\r\n\r\n\t\t\tif ( typeof data === 'string' ) {\r\n\r\n\t\t\t\tcontent = data;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar magic = LoaderUtils.decodeText( new Uint8Array( data, 0, 4 ) );\r\n\r\n\t\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\r\n\r\n\t\t\t\t\ttry {\r\n\r\n\t\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\r\n\r\n\t\t\t\t\t} catch ( error ) {\r\n\r\n\t\t\t\t\t\tif ( onError ) onError( error );\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcontent = extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tcontent = LoaderUtils.decodeText( new Uint8Array( data ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar json = JSON.parse( content );\r\n\r\n\t\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\r\n\r\n\t\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.' ) );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar parser = new GLTFParser( json, {\r\n\r\n\t\t\t\tpath: path || this.resourcePath || '',\r\n\t\t\t\tcrossOrigin: this.crossOrigin,\r\n\t\t\t\tmanager: this.manager,\r\n\t\t\t\tktx2Loader: this.ktx2Loader,\r\n\t\t\t\tmeshoptDecoder: this.meshoptDecoder\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tparser.fileLoader.setRequestHeader( this.requestHeader );\r\n\r\n\t\t\tfor ( var i = 0; i < this.pluginCallbacks.length; i ++ ) {\r\n\r\n\t\t\t\tvar plugin = this.pluginCallbacks[ i ]( parser );\r\n\t\t\t\tplugins[ plugin.name ] = plugin;\r\n\r\n\t\t\t\t// Workaround to avoid determining as unknown extension\r\n\t\t\t\t// in addUnknownExtensionsToUserData().\r\n\t\t\t\t// Remove this workaround if we move all the existing\r\n\t\t\t\t// extension handlers to plugin system\r\n\t\t\t\textensions[ plugin.name ] = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( json.extensionsUsed ) {\r\n\r\n\t\t\t\tfor ( var i = 0; i < json.extensionsUsed.length; ++ i ) {\r\n\r\n\t\t\t\t\tvar extensionName = json.extensionsUsed[ i ];\r\n\t\t\t\t\tvar extensionsRequired = json.extensionsRequired || [];\r\n\r\n\t\t\t\t\tswitch ( extensionName ) {\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_UNLIT:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsUnlitExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsPbrSpecularGlossinessExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFDracoMeshCompressionExtension( json, this.dracoLoader );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.MSFT_TEXTURE_DDS:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureDDSExtension( this.ddsLoader );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_TEXTURE_TRANSFORM:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureTransformExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_MESH_QUANTIZATION:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFMeshQuantizationExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t\tif ( extensionsRequired.indexOf( extensionName ) >= 0 && plugins[ extensionName ] === undefined ) {\r\n\r\n\t\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".' );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tparser.setExtensions( extensions );\r\n\t\t\tparser.setPlugins( plugins );\r\n\t\t\tparser.parse( onLoad, onError );\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\r\n\t/* GLTFREGISTRY */\r\n\r\n\tfunction GLTFRegistry() {\r\n\r\n\t\tvar objects = {};\r\n\r\n\t\treturn\t{\r\n\r\n\t\t\tget: function ( key ) {\r\n\r\n\t\t\t\treturn objects[ key ];\r\n\r\n\t\t\t},\r\n\r\n\t\t\tadd: function ( key, object ) {\r\n\r\n\t\t\t\tobjects[ key ] = object;\r\n\r\n\t\t\t},\r\n\r\n\t\t\tremove: function ( key ) {\r\n\r\n\t\t\t\tdelete objects[ key ];\r\n\r\n\t\t\t},\r\n\r\n\t\t\tremoveAll: function () {\r\n\r\n\t\t\t\tobjects = {};\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/*********************************/\r\n\t/********** EXTENSIONS ***********/\r\n\t/*********************************/\r\n\r\n\tvar EXTENSIONS = {\r\n\t\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\r\n\t\tKHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\r\n\t\tKHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\r\n\t\tKHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',\r\n\t\tKHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness',\r\n\t\tKHR_MATERIALS_TRANSMISSION: 'KHR_materials_transmission',\r\n\t\tKHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\r\n\t\tKHR_TEXTURE_BASISU: 'KHR_texture_basisu',\r\n\t\tKHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\r\n\t\tKHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\r\n\t\tEXT_TEXTURE_WEBP: 'EXT_texture_webp',\r\n\t\tEXT_MESHOPT_COMPRESSION: 'EXT_meshopt_compression',\r\n\t\tMSFT_TEXTURE_DDS: 'MSFT_texture_dds'\r\n\t};\r\n\r\n\t/**\r\n\t * DDS Texture Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/MSFT_texture_dds\r\n\t *\r\n\t */\r\n\tfunction GLTFTextureDDSExtension( ddsLoader ) {\r\n\r\n\t\tif ( ! ddsLoader ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader' );\r\n\r\n\t\t}\r\n\r\n\t\tthis.name = EXTENSIONS.MSFT_TEXTURE_DDS;\r\n\t\tthis.ddsLoader = ddsLoader;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Punctual Lights Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\r\n\t */\r\n\tfunction GLTFLightsExtension( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\r\n\r\n\t\t// Object3D instance caches\r\n\t\tthis.cache = { refs: {}, uses: {} };\r\n\r\n\t}\r\n\r\n\tGLTFLightsExtension.prototype._markDefs = function () {\r\n\r\n\t\tvar parser = this.parser;\r\n\t\tvar nodeDefs = this.parser.json.nodes || [];\r\n\r\n\t\tfor ( var nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\r\n\r\n\t\t\tvar nodeDef = nodeDefs[ nodeIndex ];\r\n\r\n\t\t\tif ( nodeDef.extensions\r\n\t\t\t\t&& nodeDef.extensions[ this.name ]\r\n\t\t\t\t&& nodeDef.extensions[ this.name ].light !== undefined ) {\r\n\r\n\t\t\t\tparser._addNodeRef( this.cache, nodeDef.extensions[ this.name ].light );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tGLTFLightsExtension.prototype._loadLight = function ( lightIndex ) {\r\n\r\n\t\tvar parser = this.parser;\r\n\t\tvar cacheKey = 'light:' + lightIndex;\r\n\t\tvar dependency = parser.cache.get( cacheKey );\r\n\r\n\t\tif ( dependency ) return dependency;\r\n\r\n\t\tvar json = parser.json;\r\n\t\tvar extensions = ( json.extensions && json.extensions[ this.name ] ) || {};\r\n\t\tvar lightDefs = extensions.lights || [];\r\n\t\tvar lightDef = lightDefs[ lightIndex ];\r\n\t\tvar lightNode;\r\n\r\n\t\tvar color = new Color( 0xffffff );\r\n\r\n\t\tif ( lightDef.color !== undefined ) color.fromArray( lightDef.color );\r\n\r\n\t\tvar range = lightDef.range !== undefined ? lightDef.range : 0;\r\n\r\n\t\tswitch ( lightDef.type ) {\r\n\r\n\t\t\tcase 'directional':\r\n\t\t\t\tlightNode = new DirectionalLight( color );\r\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\r\n\t\t\t\tlightNode.add( lightNode.target );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'point':\r\n\t\t\t\tlightNode = new PointLight( color );\r\n\t\t\t\tlightNode.distance = range;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'spot':\r\n\t\t\t\tlightNode = new SpotLight( color );\r\n\t\t\t\tlightNode.distance = range;\r\n\t\t\t\t// Handle spotlight properties.\r\n\t\t\t\tlightDef.spot = lightDef.spot || {};\r\n\t\t\t\tlightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\r\n\t\t\t\tlightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\r\n\t\t\t\tlightNode.angle = lightDef.spot.outerConeAngle;\r\n\t\t\t\tlightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\r\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\r\n\t\t\t\tlightNode.add( lightNode.target );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unexpected light type, \"' + lightDef.type + '\".' );\r\n\r\n\t\t}\r\n\r\n\t\t// Some lights (e.g. spot) default to a position other than the origin. Reset the position\r\n\t\t// here, because node-level parsing will only override position if explicitly specified.\r\n\t\tlightNode.position.set( 0, 0, 0 );\r\n\r\n\t\tlightNode.decay = 2;\r\n\r\n\t\tif ( lightDef.intensity !== undefined ) lightNode.intensity = lightDef.intensity;\r\n\r\n\t\tlightNode.name = parser.createUniqueName( lightDef.name || ( 'light_' + lightIndex ) );\r\n\r\n\t\tdependency = Promise.resolve( lightNode );\r\n\r\n\t\tparser.cache.add( cacheKey, dependency );\r\n\r\n\t\treturn dependency;\r\n\r\n\t};\r\n\r\n\tGLTFLightsExtension.prototype.createNodeAttachment = function ( nodeIndex ) {\r\n\r\n\t\tvar self = this;\r\n\t\tvar parser = this.parser;\r\n\t\tvar json = parser.json;\r\n\t\tvar nodeDef = json.nodes[ nodeIndex ];\r\n\t\tvar lightDef = ( nodeDef.extensions && nodeDef.extensions[ this.name ] ) || {};\r\n\t\tvar lightIndex = lightDef.light;\r\n\r\n\t\tif ( lightIndex === undefined ) return null;\r\n\r\n\t\treturn this._loadLight( lightIndex ).then( function ( light ) {\r\n\r\n\t\t\treturn parser._getNodeRef( self.cache, lightIndex, light );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Unlit Materials Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\r\n\t */\r\n\tfunction GLTFMaterialsUnlitExtension() {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\r\n\r\n\t}\r\n\r\n\tGLTFMaterialsUnlitExtension.prototype.getMaterialType = function () {\r\n\r\n\t\treturn MeshBasicMaterial;\r\n\r\n\t};\r\n\r\n\tGLTFMaterialsUnlitExtension.prototype.extendParams = function ( materialParams, materialDef, parser ) {\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\r\n\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\tvar metallicRoughness = materialDef.pbrMetallicRoughness;\r\n\r\n\t\tif ( metallicRoughness ) {\r\n\r\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\r\n\r\n\t\t\t\tvar array = metallicRoughness.baseColorFactor;\r\n\r\n\t\t\t\tmaterialParams.color.fromArray( array );\r\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Clearcoat Materials Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat\r\n\t */\r\n\tfunction GLTFMaterialsClearcoatExtension( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;\r\n\r\n\t}\r\n\r\n\tGLTFMaterialsClearcoatExtension.prototype.getMaterialType = function ( materialIndex ) {\r\n\r\n\t\tvar parser = this.parser;\r\n\t\tvar materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\r\n\r\n\t\treturn MeshPhysicalMaterial;\r\n\r\n\t};\r\n\r\n\tGLTFMaterialsClearcoatExtension.prototype.extendMaterialParams = function ( materialIndex, materialParams ) {\r\n\r\n\t\tvar parser = this.parser;\r\n\t\tvar materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\r\n\r\n\t\t\treturn Promise.resolve();\r\n\r\n\t\t}\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tvar extension = materialDef.extensions[ this.name ];\r\n\r\n\t\tif ( extension.clearcoatFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.clearcoat = extension.clearcoatFactor;\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.clearcoatTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatMap', extension.clearcoatTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.clearcoatRoughnessFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.clearcoatRoughnessTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatRoughnessMap', extension.clearcoatRoughnessTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.clearcoatNormalTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatNormalMap', extension.clearcoatNormalTexture ) );\r\n\r\n\t\t\tif ( extension.clearcoatNormalTexture.scale !== undefined ) {\r\n\r\n\t\t\t\tvar scale = extension.clearcoatNormalTexture.scale;\r\n\r\n\t\t\t\tmaterialParams.clearcoatNormalScale = new Vector2( scale, scale );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Transmission Materials Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_transmission\r\n\t * Draft: https://github.com/KhronosGroup/glTF/pull/1698\r\n\t */\r\n\tfunction GLTFMaterialsTransmissionExtension( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_TRANSMISSION;\r\n\r\n\t}\r\n\r\n\tGLTFMaterialsTransmissionExtension.prototype.getMaterialType = function ( materialIndex ) {\r\n\r\n\t\tvar parser = this.parser;\r\n\t\tvar materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\r\n\r\n\t\treturn MeshPhysicalMaterial;\r\n\r\n\t};\r\n\r\n\tGLTFMaterialsTransmissionExtension.prototype.extendMaterialParams = function ( materialIndex, materialParams ) {\r\n\r\n\t\tvar parser = this.parser;\r\n\t\tvar materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\r\n\r\n\t\t\treturn Promise.resolve();\r\n\r\n\t\t}\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tvar extension = materialDef.extensions[ this.name ];\r\n\r\n\t\tif ( extension.transmissionFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.transmission = extension.transmissionFactor;\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.transmissionTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'transmissionMap', extension.transmissionTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * BasisU Texture Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu\r\n\t */\r\n\tfunction GLTFTextureBasisUExtension( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_BASISU;\r\n\r\n\t}\r\n\r\n\tGLTFTextureBasisUExtension.prototype.loadTexture = function ( textureIndex ) {\r\n\r\n\t\tvar parser = this.parser;\r\n\t\tvar json = parser.json;\r\n\r\n\t\tvar textureDef = json.textures[ textureIndex ];\r\n\r\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ this.name ] ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tvar extension = textureDef.extensions[ this.name ];\r\n\t\tvar source = json.images[ extension.source ];\r\n\t\tvar loader = parser.options.ktx2Loader;\r\n\r\n\t\tif ( ! loader ) {\r\n\r\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\r\n\r\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures' );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// Assumes that the extension is optional and that a fallback texture is present\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn parser.loadTextureImage( textureIndex, source, loader );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * WebP Texture Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp\r\n\t */\r\n\tfunction GLTFTextureWebPExtension( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_WEBP;\r\n\t\tthis.isSupported = null;\r\n\r\n\t}\r\n\r\n\tGLTFTextureWebPExtension.prototype.loadTexture = function ( textureIndex ) {\r\n\r\n\t\tvar name = this.name;\r\n\t\tvar parser = this.parser;\r\n\t\tvar json = parser.json;\r\n\r\n\t\tvar textureDef = json.textures[ textureIndex ];\r\n\r\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tvar extension = textureDef.extensions[ name ];\r\n\t\tvar source = json.images[ extension.source ];\r\n\t\tvar loader = source.uri ? parser.options.manager.getHandler( source.uri ) : parser.textureLoader;\r\n\r\n\t\treturn this.detectSupport().then( function ( isSupported ) {\r\n\r\n\t\t\tif ( isSupported ) return parser.loadTextureImage( textureIndex, source, loader );\r\n\r\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {\r\n\r\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: WebP required by asset but unsupported.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Fall back to PNG or JPEG.\r\n\t\t\treturn parser.loadTexture( textureIndex );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\tGLTFTextureWebPExtension.prototype.detectSupport = function () {\r\n\r\n\t\tif ( ! this.isSupported ) {\r\n\r\n\t\t\tthis.isSupported = new Promise( function ( resolve ) {\r\n\r\n\t\t\t\tvar image = new Image();\r\n\r\n\t\t\t\t// Lossy test image. Support for lossy images doesn't guarantee support for all\r\n\t\t\t\t// WebP images, unfortunately.\r\n\t\t\t\timage.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';\r\n\r\n\t\t\t\timage.onload = image.onerror = function () {\r\n\r\n\t\t\t\t\tresolve( image.height === 1 );\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.isSupported;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t* meshopt BufferView Compression Extension\r\n\t*\r\n\t* Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_meshopt_compression\r\n\t*/\r\n\tfunction GLTFMeshoptCompression( parser ) {\r\n\r\n\t\tthis.name = EXTENSIONS.EXT_MESHOPT_COMPRESSION;\r\n\t\tthis.parser = parser;\r\n\r\n\t}\r\n\r\n\tGLTFMeshoptCompression.prototype.loadBufferView = function ( index ) {\r\n\r\n\t\tvar json = this.parser.json;\r\n\t\tvar bufferView = json.bufferViews[ index ];\r\n\r\n\t\tif ( bufferView.extensions && bufferView.extensions[ this.name ] ) {\r\n\r\n\t\t\tvar extensionDef = bufferView.extensions[ this.name ];\r\n\r\n\t\t\tvar buffer = this.parser.getDependency( 'buffer', extensionDef.buffer );\r\n\t\t\tvar decoder = this.parser.options.meshoptDecoder;\r\n\r\n\t\t\tif ( ! decoder || ! decoder.supported ) {\r\n\r\n\t\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\r\n\r\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files' );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// Assumes that the extension is optional and that fallback buffer data is present\r\n\t\t\t\t\treturn null;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn Promise.all( [ buffer, decoder.ready ] ).then( function ( res ) {\r\n\r\n\t\t\t\tvar byteOffset = extensionDef.byteOffset || 0;\r\n\t\t\t\tvar byteLength = extensionDef.byteLength || 0;\r\n\r\n\t\t\t\tvar count = extensionDef.count;\r\n\t\t\t\tvar stride = extensionDef.byteStride;\r\n\r\n\t\t\t\tvar result = new ArrayBuffer( count * stride );\r\n\t\t\t\tvar source = new Uint8Array( res[ 0 ], byteOffset, byteLength );\r\n\r\n\t\t\t\tdecoder.decodeGltfBuffer( new Uint8Array( result ), count, stride, source, extensionDef.mode, extensionDef.filter );\r\n\t\t\t\treturn result;\r\n\r\n\t\t\t} );\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t/* BINARY EXTENSION */\r\n\tvar BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\r\n\tvar BINARY_EXTENSION_HEADER_LENGTH = 12;\r\n\tvar BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\r\n\r\n\tfunction GLTFBinaryExtension( data ) {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\r\n\t\tthis.content = null;\r\n\t\tthis.body = null;\r\n\r\n\t\tvar headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\r\n\r\n\t\tthis.header = {\r\n\t\t\tmagic: LoaderUtils.decodeText( new Uint8Array( data.slice( 0, 4 ) ) ),\r\n\t\t\tversion: headerView.getUint32( 4, true ),\r\n\t\t\tlength: headerView.getUint32( 8, true )\r\n\t\t};\r\n\r\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\r\n\r\n\t\t} else if ( this.header.version < 2.0 ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected.' );\r\n\r\n\t\t}\r\n\r\n\t\tvar chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\r\n\t\tvar chunkIndex = 0;\r\n\r\n\t\twhile ( chunkIndex < chunkView.byteLength ) {\r\n\r\n\t\t\tvar chunkLength = chunkView.getUint32( chunkIndex, true );\r\n\t\t\tchunkIndex += 4;\r\n\r\n\t\t\tvar chunkType = chunkView.getUint32( chunkIndex, true );\r\n\t\t\tchunkIndex += 4;\r\n\r\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\r\n\r\n\t\t\t\tvar contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\r\n\t\t\t\tthis.content = LoaderUtils.decodeText( contentArray );\r\n\r\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\r\n\r\n\t\t\t\tvar byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\r\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Clients must ignore chunks with unknown types.\r\n\r\n\t\t\tchunkIndex += chunkLength;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.content === null ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * DRACO Mesh Compression Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\r\n\t */\r\n\tfunction GLTFDracoMeshCompressionExtension( json, dracoLoader ) {\r\n\r\n\t\tif ( ! dracoLoader ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: No DRACOLoader instance provided.' );\r\n\r\n\t\t}\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\r\n\t\tthis.json = json;\r\n\t\tthis.dracoLoader = dracoLoader;\r\n\t\tthis.dracoLoader.preload();\r\n\r\n\t}\r\n\r\n\tGLTFDracoMeshCompressionExtension.prototype.decodePrimitive = function ( primitive, parser ) {\r\n\r\n\t\tvar json = this.json;\r\n\t\tvar dracoLoader = this.dracoLoader;\r\n\t\tvar bufferViewIndex = primitive.extensions[ this.name ].bufferView;\r\n\t\tvar gltfAttributeMap = primitive.extensions[ this.name ].attributes;\r\n\t\tvar threeAttributeMap = {};\r\n\t\tvar attributeNormalizedMap = {};\r\n\t\tvar attributeTypeMap = {};\r\n\r\n\t\tfor ( var attributeName in gltfAttributeMap ) {\r\n\r\n\t\t\tvar threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\r\n\r\n\t\t\tthreeAttributeMap[ threeAttributeName ] = gltfAttributeMap[ attributeName ];\r\n\r\n\t\t}\r\n\r\n\t\tfor ( attributeName in primitive.attributes ) {\r\n\r\n\t\t\tvar threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\r\n\r\n\t\t\tif ( gltfAttributeMap[ attributeName ] !== undefined ) {\r\n\r\n\t\t\t\tvar accessorDef = json.accessors[ primitive.attributes[ attributeName ] ];\r\n\t\t\t\tvar componentType = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\r\n\r\n\t\t\t\tattributeTypeMap[ threeAttributeName ] = componentType;\r\n\t\t\t\tattributeNormalizedMap[ threeAttributeName ] = accessorDef.normalized === true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn parser.getDependency( 'bufferView', bufferViewIndex ).then( function ( bufferView ) {\r\n\r\n\t\t\treturn new Promise( function ( resolve ) {\r\n\r\n\t\t\t\tdracoLoader.decodeDracoFile( bufferView, function ( geometry ) {\r\n\r\n\t\t\t\t\tfor ( var attributeName in geometry.attributes ) {\r\n\r\n\t\t\t\t\t\tvar attribute = geometry.attributes[ attributeName ];\r\n\t\t\t\t\t\tvar normalized = attributeNormalizedMap[ attributeName ];\r\n\r\n\t\t\t\t\t\tif ( normalized !== undefined ) attribute.normalized = normalized;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tresolve( geometry );\r\n\r\n\t\t\t\t}, threeAttributeMap, attributeTypeMap );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Texture Transform Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\r\n\t */\r\n\tfunction GLTFTextureTransformExtension() {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\r\n\r\n\t}\r\n\r\n\tGLTFTextureTransformExtension.prototype.extendTexture = function ( texture, transform ) {\r\n\r\n\t\ttexture = texture.clone();\r\n\r\n\t\tif ( transform.offset !== undefined ) {\r\n\r\n\t\t\ttexture.offset.fromArray( transform.offset );\r\n\r\n\t\t}\r\n\r\n\t\tif ( transform.rotation !== undefined ) {\r\n\r\n\t\t\ttexture.rotation = transform.rotation;\r\n\r\n\t\t}\r\n\r\n\t\tif ( transform.scale !== undefined ) {\r\n\r\n\t\t\ttexture.repeat.fromArray( transform.scale );\r\n\r\n\t\t}\r\n\r\n\t\tif ( transform.texCoord !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV sets in \"' + this.name + '\" extension not yet supported.' );\r\n\r\n\t\t}\r\n\r\n\t\ttexture.needsUpdate = true;\r\n\r\n\t\treturn texture;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specular-Glossiness Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness\r\n\t */\r\n\r\n\t/**\r\n\t * A sub class of StandardMaterial with some of the functionality\r\n\t * changed via the `onBeforeCompile` callback\r\n\t * @pailhead\r\n\t */\r\n\r\n\tfunction GLTFMeshStandardSGMaterial( params ) {\r\n\r\n\t\tMeshStandardMaterial.call( this );\r\n\r\n\t\tthis.isGLTFSpecularGlossinessMaterial = true;\r\n\r\n\t\t//various chunks that need replacing\r\n\t\tvar specularMapParsFragmentChunk = [\r\n\t\t\t'#ifdef USE_SPECULARMAP',\r\n\t\t\t'\tuniform sampler2D specularMap;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar glossinessMapParsFragmentChunk = [\r\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\r\n\t\t\t'\tuniform sampler2D glossinessMap;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar specularMapFragmentChunk = [\r\n\t\t\t'vec3 specularFactor = specular;',\r\n\t\t\t'#ifdef USE_SPECULARMAP',\r\n\t\t\t'\tvec4 texelSpecular = texture2D( specularMap, vUv );',\r\n\t\t\t'\ttexelSpecular = sRGBToLinear( texelSpecular );',\r\n\t\t\t'\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n\t\t\t'\tspecularFactor *= texelSpecular.rgb;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar glossinessMapFragmentChunk = [\r\n\t\t\t'float glossinessFactor = glossiness;',\r\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\r\n\t\t\t'\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\r\n\t\t\t'\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n\t\t\t'\tglossinessFactor *= texelGlossiness.a;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar lightPhysicalFragmentChunk = [\r\n\t\t\t'PhysicalMaterial material;',\r\n\t\t\t'material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );',\r\n\t\t\t'vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );',\r\n\t\t\t'float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );',\r\n\t\t\t'material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.',\r\n\t\t\t'material.specularRoughness += geometryRoughness;',\r\n\t\t\t'material.specularRoughness = min( material.specularRoughness, 1.0 );',\r\n\t\t\t'material.specularColor = specularFactor;',\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar uniforms = {\r\n\t\t\tspecular: { value: new Color().setHex( 0xffffff ) },\r\n\t\t\tglossiness: { value: 1 },\r\n\t\t\tspecularMap: { value: null },\r\n\t\t\tglossinessMap: { value: null }\r\n\t\t};\r\n\r\n\t\tthis._extraUniforms = uniforms;\r\n\r\n\t\tthis.onBeforeCompile = function ( shader ) {\r\n\r\n\t\t\tfor ( var uniformName in uniforms ) {\r\n\r\n\t\t\t\tshader.uniforms[ uniformName ] = uniforms[ uniformName ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tshader.fragmentShader = shader.fragmentShader\r\n\t\t\t\t.replace( 'uniform float roughness;', 'uniform vec3 specular;' )\r\n\t\t\t\t.replace( 'uniform float metalness;', 'uniform float glossiness;' )\r\n\t\t\t\t.replace( '#include <roughnessmap_pars_fragment>', specularMapParsFragmentChunk )\r\n\t\t\t\t.replace( '#include <metalnessmap_pars_fragment>', glossinessMapParsFragmentChunk )\r\n\t\t\t\t.replace( '#include <roughnessmap_fragment>', specularMapFragmentChunk )\r\n\t\t\t\t.replace( '#include <metalnessmap_fragment>', glossinessMapFragmentChunk )\r\n\t\t\t\t.replace( '#include <lights_physical_fragment>', lightPhysicalFragmentChunk );\r\n\r\n\t\t};\r\n\r\n\t\tObject.defineProperties( this, {\r\n\r\n\t\t\tspecular: {\r\n\t\t\t\tget: function () {\r\n\r\n\t\t\t\t\treturn uniforms.specular.value;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function ( v ) {\r\n\r\n\t\t\t\t\tuniforms.specular.value = v;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tspecularMap: {\r\n\t\t\t\tget: function () {\r\n\r\n\t\t\t\t\treturn uniforms.specularMap.value;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function ( v ) {\r\n\r\n\t\t\t\t\tuniforms.specularMap.value = v;\r\n\r\n\t\t\t\t\tif ( v ) {\r\n\r\n\t\t\t\t\t\tthis.defines.USE_SPECULARMAP = ''; // USE_UV is set by the renderer for specular maps\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tdelete this.defines.USE_SPECULARMAP;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tglossiness: {\r\n\t\t\t\tget: function () {\r\n\r\n\t\t\t\t\treturn uniforms.glossiness.value;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function ( v ) {\r\n\r\n\t\t\t\t\tuniforms.glossiness.value = v;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tglossinessMap: {\r\n\t\t\t\tget: function () {\r\n\r\n\t\t\t\t\treturn uniforms.glossinessMap.value;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function ( v ) {\r\n\r\n\t\t\t\t\tuniforms.glossinessMap.value = v;\r\n\r\n\t\t\t\t\tif ( v ) {\r\n\r\n\t\t\t\t\t\tthis.defines.USE_GLOSSINESSMAP = '';\r\n\t\t\t\t\t\tthis.defines.USE_UV = '';\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tdelete this.defines.USE_GLOSSINESSMAP;\r\n\t\t\t\t\t\tdelete this.defines.USE_UV;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tdelete this.metalness;\r\n\t\tdelete this.roughness;\r\n\t\tdelete this.metalnessMap;\r\n\t\tdelete this.roughnessMap;\r\n\r\n\t\tthis.setValues( params );\r\n\r\n\t}\r\n\r\n\tGLTFMeshStandardSGMaterial.prototype = Object.create( MeshStandardMaterial.prototype );\r\n\tGLTFMeshStandardSGMaterial.prototype.constructor = GLTFMeshStandardSGMaterial;\r\n\r\n\tGLTFMeshStandardSGMaterial.prototype.copy = function ( source ) {\r\n\r\n\t\tMeshStandardMaterial.prototype.copy.call( this, source );\r\n\t\tthis.specularMap = source.specularMap;\r\n\t\tthis.specular.copy( source.specular );\r\n\t\tthis.glossinessMap = source.glossinessMap;\r\n\t\tthis.glossiness = source.glossiness;\r\n\t\tdelete this.metalness;\r\n\t\tdelete this.roughness;\r\n\t\tdelete this.metalnessMap;\r\n\t\tdelete this.roughnessMap;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tfunction GLTFMaterialsPbrSpecularGlossinessExtension() {\r\n\r\n\t\treturn {\r\n\r\n\t\t\tname: EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,\r\n\r\n\t\t\tspecularGlossinessParams: [\r\n\t\t\t\t'color',\r\n\t\t\t\t'map',\r\n\t\t\t\t'lightMap',\r\n\t\t\t\t'lightMapIntensity',\r\n\t\t\t\t'aoMap',\r\n\t\t\t\t'aoMapIntensity',\r\n\t\t\t\t'emissive',\r\n\t\t\t\t'emissiveIntensity',\r\n\t\t\t\t'emissiveMap',\r\n\t\t\t\t'bumpMap',\r\n\t\t\t\t'bumpScale',\r\n\t\t\t\t'normalMap',\r\n\t\t\t\t'normalMapType',\r\n\t\t\t\t'displacementMap',\r\n\t\t\t\t'displacementScale',\r\n\t\t\t\t'displacementBias',\r\n\t\t\t\t'specularMap',\r\n\t\t\t\t'specular',\r\n\t\t\t\t'glossinessMap',\r\n\t\t\t\t'glossiness',\r\n\t\t\t\t'alphaMap',\r\n\t\t\t\t'envMap',\r\n\t\t\t\t'envMapIntensity',\r\n\t\t\t\t'refractionRatio',\r\n\t\t\t],\r\n\r\n\t\t\tgetMaterialType: function () {\r\n\r\n\t\t\t\treturn GLTFMeshStandardSGMaterial;\r\n\r\n\t\t\t},\r\n\r\n\t\t\textendParams: function ( materialParams, materialDef, parser ) {\r\n\r\n\t\t\t\tvar pbrSpecularGlossiness = materialDef.extensions[ this.name ];\r\n\r\n\t\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\r\n\t\t\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\t\t\tvar pending = [];\r\n\r\n\t\t\t\tif ( Array.isArray( pbrSpecularGlossiness.diffuseFactor ) ) {\r\n\r\n\t\t\t\t\tvar array = pbrSpecularGlossiness.diffuseFactor;\r\n\r\n\t\t\t\t\tmaterialParams.color.fromArray( array );\r\n\t\t\t\t\tmaterialParams.opacity = array[ 3 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pbrSpecularGlossiness.diffuseTexture !== undefined ) {\r\n\r\n\t\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', pbrSpecularGlossiness.diffuseTexture ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmaterialParams.emissive = new Color( 0.0, 0.0, 0.0 );\r\n\t\t\t\tmaterialParams.glossiness = pbrSpecularGlossiness.glossinessFactor !== undefined ? pbrSpecularGlossiness.glossinessFactor : 1.0;\r\n\t\t\t\tmaterialParams.specular = new Color( 1.0, 1.0, 1.0 );\r\n\r\n\t\t\t\tif ( Array.isArray( pbrSpecularGlossiness.specularFactor ) ) {\r\n\r\n\t\t\t\t\tmaterialParams.specular.fromArray( pbrSpecularGlossiness.specularFactor );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pbrSpecularGlossiness.specularGlossinessTexture !== undefined ) {\r\n\r\n\t\t\t\t\tvar specGlossMapDef = pbrSpecularGlossiness.specularGlossinessTexture;\r\n\t\t\t\t\tpending.push( parser.assignTexture( materialParams, 'glossinessMap', specGlossMapDef ) );\r\n\t\t\t\t\tpending.push( parser.assignTexture( materialParams, 'specularMap', specGlossMapDef ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn Promise.all( pending );\r\n\r\n\t\t\t},\r\n\r\n\t\t\tcreateMaterial: function ( materialParams ) {\r\n\r\n\t\t\t\tvar material = new GLTFMeshStandardSGMaterial( materialParams );\r\n\t\t\t\tmaterial.fog = true;\r\n\r\n\t\t\t\tmaterial.color = materialParams.color;\r\n\r\n\t\t\t\tmaterial.map = materialParams.map === undefined ? null : materialParams.map;\r\n\r\n\t\t\t\tmaterial.lightMap = null;\r\n\t\t\t\tmaterial.lightMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.aoMap = materialParams.aoMap === undefined ? null : materialParams.aoMap;\r\n\t\t\t\tmaterial.aoMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.emissive = materialParams.emissive;\r\n\t\t\t\tmaterial.emissiveIntensity = 1.0;\r\n\t\t\t\tmaterial.emissiveMap = materialParams.emissiveMap === undefined ? null : materialParams.emissiveMap;\r\n\r\n\t\t\t\tmaterial.bumpMap = materialParams.bumpMap === undefined ? null : materialParams.bumpMap;\r\n\t\t\t\tmaterial.bumpScale = 1;\r\n\r\n\t\t\t\tmaterial.normalMap = materialParams.normalMap === undefined ? null : materialParams.normalMap;\r\n\t\t\t\tmaterial.normalMapType = TangentSpaceNormalMap;\r\n\r\n\t\t\t\tif ( materialParams.normalScale ) material.normalScale = materialParams.normalScale;\r\n\r\n\t\t\t\tmaterial.displacementMap = null;\r\n\t\t\t\tmaterial.displacementScale = 1;\r\n\t\t\t\tmaterial.displacementBias = 0;\r\n\r\n\t\t\t\tmaterial.specularMap = materialParams.specularMap === undefined ? null : materialParams.specularMap;\r\n\t\t\t\tmaterial.specular = materialParams.specular;\r\n\r\n\t\t\t\tmaterial.glossinessMap = materialParams.glossinessMap === undefined ? null : materialParams.glossinessMap;\r\n\t\t\t\tmaterial.glossiness = materialParams.glossiness;\r\n\r\n\t\t\t\tmaterial.alphaMap = null;\r\n\r\n\t\t\t\tmaterial.envMap = materialParams.envMap === undefined ? null : materialParams.envMap;\r\n\t\t\t\tmaterial.envMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.refractionRatio = 0.98;\r\n\r\n\t\t\t\treturn material;\r\n\r\n\t\t\t},\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Mesh Quantization Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\r\n\t */\r\n\tfunction GLTFMeshQuantizationExtension() {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\r\n\r\n\t}\r\n\r\n\t/*********************************/\r\n\t/********** INTERPOLATION ********/\r\n\t/*********************************/\r\n\r\n\t// Spline Interpolation\r\n\t// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\r\n\tfunction GLTFCubicSplineInterpolant( parameterPositions, sampleValues, sampleSize, resultBuffer ) {\r\n\r\n\t\tInterpolant.call( this, parameterPositions, sampleValues, sampleSize, resultBuffer );\r\n\r\n\t}\r\n\r\n\tGLTFCubicSplineInterpolant.prototype = Object.create( Interpolant.prototype );\r\n\tGLTFCubicSplineInterpolant.prototype.constructor = GLTFCubicSplineInterpolant;\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.copySampleValue_ = function ( index ) {\r\n\r\n\t\t// Copies a sample value to the result buffer. See description of glTF\r\n\t\t// CUBICSPLINE values layout in interpolate_() function below.\r\n\r\n\t\tvar result = this.resultBuffer,\r\n\t\t\tvalues = this.sampleValues,\r\n\t\t\tvalueSize = this.valueSize,\r\n\t\t\toffset = index * valueSize * 3 + valueSize;\r\n\r\n\t\tfor ( var i = 0; i !== valueSize; i ++ ) {\r\n\r\n\t\t\tresult[ i ] = values[ offset + i ];\r\n\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\r\n\t};\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.beforeStart_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.afterEnd_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.interpolate_ = function ( i1, t0, t, t1 ) {\r\n\r\n\t\tvar result = this.resultBuffer;\r\n\t\tvar values = this.sampleValues;\r\n\t\tvar stride = this.valueSize;\r\n\r\n\t\tvar stride2 = stride * 2;\r\n\t\tvar stride3 = stride * 3;\r\n\r\n\t\tvar td = t1 - t0;\r\n\r\n\t\tvar p = ( t - t0 ) / td;\r\n\t\tvar pp = p * p;\r\n\t\tvar ppp = pp * p;\r\n\r\n\t\tvar offset1 = i1 * stride3;\r\n\t\tvar offset0 = offset1 - stride3;\r\n\r\n\t\tvar s2 = - 2 * ppp + 3 * pp;\r\n\t\tvar s3 = ppp - pp;\r\n\t\tvar s0 = 1 - s2;\r\n\t\tvar s1 = s3 - pp + p;\r\n\r\n\t\t// Layout of keyframe output values for CUBICSPLINE animations:\r\n\t\t//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\r\n\t\tfor ( var i = 0; i !== stride; i ++ ) {\r\n\r\n\t\t\tvar p0 = values[ offset0 + i + stride ]; // splineVertex_k\r\n\t\t\tvar m0 = values[ offset0 + i + stride2 ] * td; // outTangent_k * (t_k+1 - t_k)\r\n\t\t\tvar p1 = values[ offset1 + i + stride ]; // splineVertex_k+1\r\n\t\t\tvar m1 = values[ offset1 + i ] * td; // inTangent_k+1 * (t_k+1 - t_k)\r\n\r\n\t\t\tresult[ i ] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\r\n\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\r\n\t};\r\n\r\n\t/*********************************/\r\n\t/********** INTERNALS ************/\r\n\t/*********************************/\r\n\r\n\t/* CONSTANTS */\r\n\r\n\tvar WEBGL_CONSTANTS = {\r\n\t\tFLOAT: 5126,\r\n\t\t//FLOAT_MAT2: 35674,\r\n\t\tFLOAT_MAT3: 35675,\r\n\t\tFLOAT_MAT4: 35676,\r\n\t\tFLOAT_VEC2: 35664,\r\n\t\tFLOAT_VEC3: 35665,\r\n\t\tFLOAT_VEC4: 35666,\r\n\t\tLINEAR: 9729,\r\n\t\tREPEAT: 10497,\r\n\t\tSAMPLER_2D: 35678,\r\n\t\tPOINTS: 0,\r\n\t\tLINES: 1,\r\n\t\tLINE_LOOP: 2,\r\n\t\tLINE_STRIP: 3,\r\n\t\tTRIANGLES: 4,\r\n\t\tTRIANGLE_STRIP: 5,\r\n\t\tTRIANGLE_FAN: 6,\r\n\t\tUNSIGNED_BYTE: 5121,\r\n\t\tUNSIGNED_SHORT: 5123\r\n\t};\r\n\r\n\tvar WEBGL_COMPONENT_TYPES = {\r\n\t\t5120: Int8Array,\r\n\t\t5121: Uint8Array,\r\n\t\t5122: Int16Array,\r\n\t\t5123: Uint16Array,\r\n\t\t5125: Uint32Array,\r\n\t\t5126: Float32Array\r\n\t};\r\n\r\n\tvar WEBGL_FILTERS = {\r\n\t\t9728: NearestFilter,\r\n\t\t9729: LinearFilter,\r\n\t\t9984: NearestMipmapNearestFilter,\r\n\t\t9985: LinearMipmapNearestFilter,\r\n\t\t9986: NearestMipmapLinearFilter,\r\n\t\t9987: LinearMipmapLinearFilter\r\n\t};\r\n\r\n\tvar WEBGL_WRAPPINGS = {\r\n\t\t33071: ClampToEdgeWrapping,\r\n\t\t33648: MirroredRepeatWrapping,\r\n\t\t10497: RepeatWrapping\r\n\t};\r\n\r\n\tvar WEBGL_TYPE_SIZES = {\r\n\t\t'SCALAR': 1,\r\n\t\t'VEC2': 2,\r\n\t\t'VEC3': 3,\r\n\t\t'VEC4': 4,\r\n\t\t'MAT2': 4,\r\n\t\t'MAT3': 9,\r\n\t\t'MAT4': 16\r\n\t};\r\n\r\n\tvar ATTRIBUTES = {\r\n\t\tPOSITION: 'position',\r\n\t\tNORMAL: 'normal',\r\n\t\tTANGENT: 'tangent',\r\n\t\tTEXCOORD_0: 'uv',\r\n\t\tTEXCOORD_1: 'uv2',\r\n\t\tCOLOR_0: 'color',\r\n\t\tWEIGHTS_0: 'skinWeight',\r\n\t\tJOINTS_0: 'skinIndex',\r\n\t};\r\n\r\n\tvar PATH_PROPERTIES = {\r\n\t\tscale: 'scale',\r\n\t\ttranslation: 'position',\r\n\t\trotation: 'quaternion',\r\n\t\tweights: 'morphTargetInfluences'\r\n\t};\r\n\r\n\tvar INTERPOLATION = {\r\n\t\tCUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\r\n\t\t                        // keyframe track will be initialized with a default interpolation type, then modified.\r\n\t\tLINEAR: InterpolateLinear,\r\n\t\tSTEP: InterpolateDiscrete\r\n\t};\r\n\r\n\tvar ALPHA_MODES = {\r\n\t\tOPAQUE: 'OPAQUE',\r\n\t\tMASK: 'MASK',\r\n\t\tBLEND: 'BLEND'\r\n\t};\r\n\r\n\t/* UTILITY FUNCTIONS */\r\n\r\n\tfunction resolveURL( url, path ) {\r\n\r\n\t\t// Invalid URL\r\n\t\tif ( typeof url !== 'string' || url === '' ) return '';\r\n\r\n\t\t// Host Relative URL\r\n\t\tif ( /^https?:\\/\\//i.test( path ) && /^\\//.test( url ) ) {\r\n\r\n\t\t\tpath = path.replace( /(^https?:\\/\\/[^\\/]+).*/i, '$1' );\r\n\r\n\t\t}\r\n\r\n\t\t// Absolute URL http://,https://,//\r\n\t\tif ( /^(https?:)?\\/\\//i.test( url ) ) return url;\r\n\r\n\t\t// Data URI\r\n\t\tif ( /^data:.*,.*$/i.test( url ) ) return url;\r\n\r\n\t\t// Blob URL\r\n\t\tif ( /^blob:.*$/i.test( url ) ) return url;\r\n\r\n\t\t// Relative URL\r\n\t\treturn path + url;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\r\n\t */\r\n\tfunction createDefaultMaterial( cache ) {\r\n\r\n\t\tif ( cache[ 'DefaultMaterial' ] === undefined ) {\r\n\r\n\t\t\tcache[ 'DefaultMaterial' ] = new MeshStandardMaterial( {\r\n\t\t\t\tcolor: 0xFFFFFF,\r\n\t\t\t\temissive: 0x000000,\r\n\t\t\t\tmetalness: 1,\r\n\t\t\t\troughness: 1,\r\n\t\t\t\ttransparent: false,\r\n\t\t\t\tdepthTest: true,\r\n\t\t\t\tside: FrontSide\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn cache[ 'DefaultMaterial' ];\r\n\r\n\t}\r\n\r\n\tfunction addUnknownExtensionsToUserData( knownExtensions, object, objectDef ) {\r\n\r\n\t\t// Add unknown glTF extensions to an object's userData.\r\n\r\n\t\tfor ( var name in objectDef.extensions ) {\r\n\r\n\t\t\tif ( knownExtensions[ name ] === undefined ) {\r\n\r\n\t\t\t\tobject.userData.gltfExtensions = object.userData.gltfExtensions || {};\r\n\t\t\t\tobject.userData.gltfExtensions[ name ] = objectDef.extensions[ name ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object3D|Material|BufferGeometry} object\r\n\t * @param {GLTF.definition} gltfDef\r\n\t */\r\n\tfunction assignExtrasToUserData( object, gltfDef ) {\r\n\r\n\t\tif ( gltfDef.extras !== undefined ) {\r\n\r\n\t\t\tif ( typeof gltfDef.extras === 'object' ) {\r\n\r\n\t\t\t\tObject.assign( object.userData, gltfDef.extras );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\r\n\t *\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {Array<GLTF.Target>} targets\r\n\t * @param {GLTFParser} parser\r\n\t * @return {Promise<BufferGeometry>}\r\n\t */\r\n\tfunction addMorphTargets( geometry, targets, parser ) {\r\n\r\n\t\tvar hasMorphPosition = false;\r\n\t\tvar hasMorphNormal = false;\r\n\r\n\t\tfor ( var i = 0, il = targets.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar target = targets[ i ];\r\n\r\n\t\t\tif ( target.POSITION !== undefined ) hasMorphPosition = true;\r\n\t\t\tif ( target.NORMAL !== undefined ) hasMorphNormal = true;\r\n\r\n\t\t\tif ( hasMorphPosition && hasMorphNormal ) break;\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! hasMorphPosition && ! hasMorphNormal ) return Promise.resolve( geometry );\r\n\r\n\t\tvar pendingPositionAccessors = [];\r\n\t\tvar pendingNormalAccessors = [];\r\n\r\n\t\tfor ( var i = 0, il = targets.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar target = targets[ i ];\r\n\r\n\t\t\tif ( hasMorphPosition ) {\r\n\r\n\t\t\t\tvar pendingAccessor = target.POSITION !== undefined\r\n\t\t\t\t\t? parser.getDependency( 'accessor', target.POSITION )\r\n\t\t\t\t\t: geometry.attributes.position;\r\n\r\n\t\t\t\tpendingPositionAccessors.push( pendingAccessor );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasMorphNormal ) {\r\n\r\n\t\t\t\tvar pendingAccessor = target.NORMAL !== undefined\r\n\t\t\t\t\t? parser.getDependency( 'accessor', target.NORMAL )\r\n\t\t\t\t\t: geometry.attributes.normal;\r\n\r\n\t\t\t\tpendingNormalAccessors.push( pendingAccessor );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( [\r\n\t\t\tPromise.all( pendingPositionAccessors ),\r\n\t\t\tPromise.all( pendingNormalAccessors )\r\n\t\t] ).then( function ( accessors ) {\r\n\r\n\t\t\tvar morphPositions = accessors[ 0 ];\r\n\t\t\tvar morphNormals = accessors[ 1 ];\r\n\r\n\t\t\tif ( hasMorphPosition ) geometry.morphAttributes.position = morphPositions;\r\n\t\t\tif ( hasMorphNormal ) geometry.morphAttributes.normal = morphNormals;\r\n\t\t\tgeometry.morphTargetsRelative = true;\r\n\r\n\t\t\treturn geometry;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Mesh} mesh\r\n\t * @param {GLTF.Mesh} meshDef\r\n\t */\r\n\tfunction updateMorphTargets( mesh, meshDef ) {\r\n\r\n\t\tmesh.updateMorphTargets();\r\n\r\n\t\tif ( meshDef.weights !== undefined ) {\r\n\r\n\t\t\tfor ( var i = 0, il = meshDef.weights.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// .extras has user-defined data, so check that .extras.targetNames is an array.\r\n\t\tif ( meshDef.extras && Array.isArray( meshDef.extras.targetNames ) ) {\r\n\r\n\t\t\tvar targetNames = meshDef.extras.targetNames;\r\n\r\n\t\t\tif ( mesh.morphTargetInfluences.length === targetNames.length ) {\r\n\r\n\t\t\t\tmesh.morphTargetDictionary = {};\r\n\r\n\t\t\t\tfor ( var i = 0, il = targetNames.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tmesh.morphTargetDictionary[ targetNames[ i ] ] = i;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction createPrimitiveKey( primitiveDef ) {\r\n\r\n\t\tvar dracoExtension = primitiveDef.extensions && primitiveDef.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ];\r\n\t\tvar geometryKey;\r\n\r\n\t\tif ( dracoExtension ) {\r\n\r\n\t\t\tgeometryKey = 'draco:' + dracoExtension.bufferView\r\n\t\t\t\t+ ':' + dracoExtension.indices\r\n\t\t\t\t+ ':' + createAttributesKey( dracoExtension.attributes );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tgeometryKey = primitiveDef.indices + ':' + createAttributesKey( primitiveDef.attributes ) + ':' + primitiveDef.mode;\r\n\r\n\t\t}\r\n\r\n\t\treturn geometryKey;\r\n\r\n\t}\r\n\r\n\tfunction createAttributesKey( attributes ) {\r\n\r\n\t\tvar attributesKey = '';\r\n\r\n\t\tvar keys = Object.keys( attributes ).sort();\r\n\r\n\t\tfor ( var i = 0, il = keys.length; i < il; i ++ ) {\r\n\r\n\t\t\tattributesKey += keys[ i ] + ':' + attributes[ keys[ i ] ] + ';';\r\n\r\n\t\t}\r\n\r\n\t\treturn attributesKey;\r\n\r\n\t}\r\n\r\n\t/* GLTF PARSER */\r\n\r\n\tfunction GLTFParser( json, options ) {\r\n\r\n\t\tthis.json = json || {};\r\n\t\tthis.extensions = {};\r\n\t\tthis.plugins = {};\r\n\t\tthis.options = options || {};\r\n\r\n\t\t// loader object cache\r\n\t\tthis.cache = new GLTFRegistry();\r\n\r\n\t\t// associations between Three.js objects and glTF elements\r\n\t\tthis.associations = new Map();\r\n\r\n\t\t// BufferGeometry caching\r\n\t\tthis.primitiveCache = {};\r\n\r\n\t\t// Object3D instance caches\r\n\t\tthis.meshCache = { refs: {}, uses: {} };\r\n\t\tthis.cameraCache = { refs: {}, uses: {} };\r\n\t\tthis.lightCache = { refs: {}, uses: {} };\r\n\r\n\t\t// Track node names, to ensure no duplicates\r\n\t\tthis.nodeNamesUsed = {};\r\n\r\n\t\t// Use an ImageBitmapLoader if imageBitmaps are supported. Moves much of the\r\n\t\t// expensive work of uploading a texture to the GPU off the main thread.\r\n\t\tif ( typeof createImageBitmap !== 'undefined' && /Firefox/.test( navigator.userAgent ) === false ) {\r\n\t\t\tthis.textureLoader = new ImageBitmapLoader( this.options.manager );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.textureLoader = new TextureLoader( this.options.manager );\r\n\r\n\t\t}\r\n\r\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\r\n\r\n\t\tthis.fileLoader = new FileLoader( this.options.manager );\r\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\r\n\r\n\t\tif ( this.options.crossOrigin === 'use-credentials' ) {\r\n\r\n\t\t\tthis.fileLoader.setWithCredentials( true );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tGLTFParser.prototype.setExtensions = function ( extensions ) {\r\n\r\n\t\tthis.extensions = extensions;\r\n\r\n\t};\r\n\r\n\tGLTFParser.prototype.setPlugins = function ( plugins ) {\r\n\r\n\t\tthis.plugins = plugins;\r\n\r\n\t};\r\n\r\n\tGLTFParser.prototype.parse = function ( onLoad, onError ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\r\n\t\t// Clear the loader cache\r\n\t\tthis.cache.removeAll();\r\n\r\n\t\t// Mark the special nodes/meshes in json for efficient parse\r\n\t\tthis._invokeAll( function ( ext ) {\r\n\r\n\t\t\treturn ext._markDefs && ext._markDefs();\r\n\r\n\t\t} );\r\n\r\n\t\tPromise.all( [\r\n\r\n\t\t\tthis.getDependencies( 'scene' ),\r\n\t\t\tthis.getDependencies( 'animation' ),\r\n\t\t\tthis.getDependencies( 'camera' ),\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tvar result = {\r\n\t\t\t\tscene: dependencies[ 0 ][ json.scene || 0 ],\r\n\t\t\t\tscenes: dependencies[ 0 ],\r\n\t\t\t\tanimations: dependencies[ 1 ],\r\n\t\t\t\tcameras: dependencies[ 2 ],\r\n\t\t\t\tasset: json.asset,\r\n\t\t\t\tparser: parser,\r\n\t\t\t\tuserData: {}\r\n\t\t\t};\r\n\r\n\t\t\taddUnknownExtensionsToUserData( extensions, result, json );\r\n\r\n\t\t\tassignExtrasToUserData( result, json );\r\n\r\n\t\t\tonLoad( result );\r\n\r\n\t\t} ).catch( onError );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Marks the special nodes/meshes in json for efficient parse.\r\n\t */\r\n\tGLTFParser.prototype._markDefs = function () {\r\n\r\n\t\tvar nodeDefs = this.json.nodes || [];\r\n\t\tvar skinDefs = this.json.skins || [];\r\n\t\tvar meshDefs = this.json.meshes || [];\r\n\r\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\r\n\t\t// Object3D. Use the skins' joint references to mark bones.\r\n\t\tfor ( var skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\r\n\r\n\t\t\tvar joints = skinDefs[ skinIndex ].joints;\r\n\r\n\t\t\tfor ( var i = 0, il = joints.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Iterate over all nodes, marking references to shared resources,\r\n\t\t// as well as skeleton joints.\r\n\t\tfor ( var nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\r\n\r\n\t\t\tvar nodeDef = nodeDefs[ nodeIndex ];\r\n\r\n\t\t\tif ( nodeDef.mesh !== undefined ) {\r\n\r\n\t\t\t\tthis._addNodeRef( this.meshCache, nodeDef.mesh );\r\n\r\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\r\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\r\n\t\t\t\t// to mark SkinnedMesh if node has skin.\r\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\r\n\r\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.camera !== undefined ) {\r\n\r\n\t\t\t\tthis._addNodeRef( this.cameraCache, nodeDef.camera );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Counts references to shared node / Object3D resources. These resources\r\n\t * can be reused, or \"instantiated\", at multiple nodes in the scene\r\n\t * hierarchy. Mesh, Camera, and Light instances are instantiated and must\r\n\t * be marked. Non-scenegraph resources (like Materials, Geometries, and\r\n\t * Textures) can be reused directly and are not marked here.\r\n\t *\r\n\t * Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\r\n\t */\r\n\tGLTFParser.prototype._addNodeRef = function ( cache, index ) {\r\n\r\n\t\tif ( index === undefined ) return;\r\n\r\n\t\tif ( cache.refs[ index ] === undefined ) {\r\n\r\n\t\t\tcache.refs[ index ] = cache.uses[ index ] = 0;\r\n\r\n\t\t}\r\n\r\n\t\tcache.refs[ index ] ++;\r\n\r\n\t};\r\n\r\n\t/** Returns a reference to a shared resource, cloning it if necessary. */\r\n\tGLTFParser.prototype._getNodeRef = function ( cache, index, object ) {\r\n\r\n\t\tif ( cache.refs[ index ] <= 1 ) return object;\r\n\r\n\t\tvar ref = object.clone();\r\n\r\n\t\tref.name += '_instance_' + ( cache.uses[ index ] ++ );\r\n\r\n\t\treturn ref;\r\n\r\n\t};\r\n\r\n\tGLTFParser.prototype._invokeOne = function ( func ) {\r\n\r\n\t\tvar extensions = Object.values( this.plugins );\r\n\t\textensions.push( this );\r\n\r\n\t\tfor ( var i = 0; i < extensions.length; i ++ ) {\r\n\r\n\t\t\tvar result = func( extensions[ i ] );\r\n\r\n\t\t\tif ( result ) return result;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tGLTFParser.prototype._invokeAll = function ( func ) {\r\n\r\n\t\tvar extensions = Object.values( this.plugins );\r\n\t\textensions.unshift( this );\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tfor ( var i = 0; i < extensions.length; i ++ ) {\r\n\r\n\t\t\tvar result = func( extensions[ i ] );\r\n\r\n\t\t\tif ( result ) pending.push( result );\r\n\r\n\t\t}\r\n\r\n\t\treturn pending;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Requests the specified dependency asynchronously, with caching.\r\n\t * @param {string} type\r\n\t * @param {number} index\r\n\t * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}\r\n\t */\r\n\tGLTFParser.prototype.getDependency = function ( type, index ) {\r\n\r\n\t\tvar cacheKey = type + ':' + index;\r\n\t\tvar dependency = this.cache.get( cacheKey );\r\n\r\n\t\tif ( ! dependency ) {\r\n\r\n\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\tcase 'scene':\r\n\t\t\t\t\tdependency = this.loadScene( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'node':\r\n\t\t\t\t\tdependency = this.loadNode( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'mesh':\r\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\t\t\treturn ext.loadMesh && ext.loadMesh( index );\r\n\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'accessor':\r\n\t\t\t\t\tdependency = this.loadAccessor( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'bufferView':\r\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\t\t\treturn ext.loadBufferView && ext.loadBufferView( index );\r\n\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'buffer':\r\n\t\t\t\t\tdependency = this.loadBuffer( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'material':\r\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\t\t\treturn ext.loadMaterial && ext.loadMaterial( index );\r\n\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'texture':\r\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\t\t\treturn ext.loadTexture && ext.loadTexture( index );\r\n\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'skin':\r\n\t\t\t\t\tdependency = this.loadSkin( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'animation':\r\n\t\t\t\t\tdependency = this.loadAnimation( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'camera':\r\n\t\t\t\t\tdependency = this.loadCamera( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow new Error( 'Unknown type: ' + type );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.cache.add( cacheKey, dependency );\r\n\r\n\t\t}\r\n\r\n\t\treturn dependency;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Requests all dependencies of the specified type asynchronously, with caching.\r\n\t * @param {string} type\r\n\t * @return {Promise<Array<Object>>}\r\n\t */\r\n\tGLTFParser.prototype.getDependencies = function ( type ) {\r\n\r\n\t\tvar dependencies = this.cache.get( type );\r\n\r\n\t\tif ( ! dependencies ) {\r\n\r\n\t\t\tvar parser = this;\r\n\t\t\tvar defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\r\n\r\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\r\n\r\n\t\t\t\treturn parser.getDependency( type, index );\r\n\r\n\t\t\t} ) );\r\n\r\n\t\t\tthis.cache.add( type, dependencies );\r\n\r\n\t\t}\r\n\r\n\t\treturn dependencies;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n\t * @param {number} bufferIndex\r\n\t * @return {Promise<ArrayBuffer>}\r\n\t */\r\n\tGLTFParser.prototype.loadBuffer = function ( bufferIndex ) {\r\n\r\n\t\tvar bufferDef = this.json.buffers[ bufferIndex ];\r\n\t\tvar loader = this.fileLoader;\r\n\r\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\r\n\r\n\t\t}\r\n\r\n\t\t// If present, GLB container is required to be the first buffer.\r\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\r\n\r\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\r\n\r\n\t\t}\r\n\r\n\t\tvar options = this.options;\r\n\r\n\t\treturn new Promise( function ( resolve, reject ) {\r\n\r\n\t\t\tloader.load( resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\r\n\r\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n\t * @param {number} bufferViewIndex\r\n\t * @return {Promise<ArrayBuffer>}\r\n\t */\r\n\tGLTFParser.prototype.loadBufferView = function ( bufferViewIndex ) {\r\n\r\n\t\tvar bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\r\n\r\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\r\n\r\n\t\t\tvar byteLength = bufferViewDef.byteLength || 0;\r\n\t\t\tvar byteOffset = bufferViewDef.byteOffset || 0;\r\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\r\n\t * @param {number} accessorIndex\r\n\t * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\r\n\t */\r\n\tGLTFParser.prototype.loadAccessor = function ( accessorIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\r\n\t\tvar accessorDef = this.json.accessors[ accessorIndex ];\r\n\r\n\t\tif ( accessorDef.bufferView === undefined && accessorDef.sparse === undefined ) {\r\n\r\n\t\t\t// Ignore empty accessors, which may be used to declare runtime\r\n\t\t\t// information about attributes coming from another source (e.g. Draco\r\n\t\t\t// compression extension).\r\n\t\t\treturn Promise.resolve( null );\r\n\r\n\t\t}\r\n\r\n\t\tvar pendingBufferViews = [];\r\n\r\n\t\tif ( accessorDef.bufferView !== undefined ) {\r\n\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tpendingBufferViews.push( null );\r\n\r\n\t\t}\r\n\r\n\t\tif ( accessorDef.sparse !== undefined ) {\r\n\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\r\n\r\n\t\t\tvar bufferView = bufferViews[ 0 ];\r\n\r\n\t\t\tvar itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\r\n\t\t\tvar TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\r\n\r\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\r\n\t\t\tvar elementBytes = TypedArray.BYTES_PER_ELEMENT;\r\n\t\t\tvar itemBytes = elementBytes * itemSize;\r\n\t\t\tvar byteOffset = accessorDef.byteOffset || 0;\r\n\t\t\tvar byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[ accessorDef.bufferView ].byteStride : undefined;\r\n\t\t\tvar normalized = accessorDef.normalized === true;\r\n\t\t\tvar array, bufferAttribute;\r\n\r\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\r\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\r\n\r\n\t\t\t\t// Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\r\n\t\t\t\t// This makes sure that IBA.count reflects accessor.count properly\r\n\t\t\t\tvar ibSlice = Math.floor( byteOffset / byteStride );\r\n\t\t\t\tvar ibCacheKey = 'InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;\r\n\t\t\t\tvar ib = parser.cache.get( ibCacheKey );\r\n\r\n\t\t\t\tif ( ! ib ) {\r\n\r\n\t\t\t\t\tarray = new TypedArray( bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes );\r\n\r\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\r\n\t\t\t\t\tib = new InterleavedBuffer( array, byteStride / elementBytes );\r\n\r\n\t\t\t\t\tparser.cache.add( ibCacheKey, ib );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbufferAttribute = new InterleavedBufferAttribute( ib, itemSize, ( byteOffset % byteStride ) / elementBytes, normalized );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( bufferView === null ) {\r\n\r\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tarray = new TypedArray( bufferView, byteOffset, accessorDef.count * itemSize );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbufferAttribute = new BufferAttribute( array, itemSize, normalized );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\r\n\t\t\tif ( accessorDef.sparse !== undefined ) {\r\n\r\n\t\t\t\tvar itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\r\n\t\t\t\tvar TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\r\n\r\n\t\t\t\tvar byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\r\n\t\t\t\tvar byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\r\n\r\n\t\t\t\tvar sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\r\n\t\t\t\tvar sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\r\n\r\n\t\t\t\tif ( bufferView !== null ) {\r\n\r\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\r\n\t\t\t\t\tbufferAttribute = new BufferAttribute( bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( var i = 0, il = sparseIndices.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tvar index = sparseIndices[ i ];\r\n\r\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\r\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\r\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\r\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\r\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn bufferAttribute;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\r\n\t * @param {number} textureIndex\r\n\t * @return {Promise<THREE.Texture>}\r\n\t */\r\n\tGLTFParser.prototype.loadTexture = function ( textureIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar options = this.options;\r\n\r\n\t\tvar textureDef = json.textures[ textureIndex ];\r\n\r\n\t\tvar textureExtensions = textureDef.extensions || {};\r\n\r\n\t\tvar source;\r\n\r\n\t\tif ( textureExtensions[ EXTENSIONS.MSFT_TEXTURE_DDS ] ) {\r\n\r\n\t\t\tsource = json.images[ textureExtensions[ EXTENSIONS.MSFT_TEXTURE_DDS ].source ];\r\n\r\n\t\t} else {\r\n\r\n\t\t\tsource = json.images[ textureDef.source ];\r\n\r\n\t\t}\r\n\r\n\t\tvar loader;\r\n\r\n\t\tif ( source.uri ) {\r\n\r\n\t\t\tloader = options.manager.getHandler( source.uri );\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! loader ) {\r\n\r\n\t\t\tloader = textureExtensions[ EXTENSIONS.MSFT_TEXTURE_DDS ]\r\n\t\t\t\t? parser.extensions[ EXTENSIONS.MSFT_TEXTURE_DDS ].ddsLoader\r\n\t\t\t\t: this.textureLoader;\r\n\r\n\t\t}\r\n\r\n\t\treturn this.loadTextureImage( textureIndex, source, loader );\r\n\r\n\t};\r\n\r\n\tGLTFParser.prototype.loadTextureImage = function ( textureIndex, source, loader ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar options = this.options;\r\n\r\n\t\tvar textureDef = json.textures[ textureIndex ];\r\n\r\n\t\tvar URL = self.URL || self.webkitURL;\r\n\r\n\t\tvar sourceURI = source.uri;\r\n\t\tvar isObjectURL = false;\r\n\t\tvar hasAlpha = true;\r\n\r\n\t\tif ( source.mimeType === 'image/jpeg' ) hasAlpha = false;\r\n\r\n\t\tif ( source.bufferView !== undefined ) {\r\n\r\n\t\t\t// Load binary image data from bufferView, if provided.\r\n\t\t\t\r\n\t\t\tsourceURI = parser.getDependency( 'bufferView', source.bufferView ).then( function ( bufferView ) {\r\n\r\n\t\t\t\tif ( source.mimeType === 'image/png' ) {\r\n\r\n\t\t\t\t\t// Inspect the PNG 'IHDR' chunk to determine whether the image could have an\r\n\t\t\t\t\t// alpha channel. This check is conservative  the image could have an alpha\r\n\t\t\t\t\t// channel with all values == 1, and the indexed type (colorType == 3) only\r\n\t\t\t\t\t// sometimes contains alpha.\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// https://en.wikipedia.org/wiki/Portable_Network_Graphics#File_header\r\n\t\t\t\t\tvar colorType = new DataView( bufferView, 25, 1 ).getUint8( 0, false );\r\n\t\t\t\t\thasAlpha = colorType === 6 || colorType === 4 || colorType === 3;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tisObjectURL = true;\r\n\t\t\t\tvar blob = new Blob( [ bufferView ], { type: source.mimeType } );\r\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\r\n\t\t\t\treturn sourceURI;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve( sourceURI ).then( function ( sourceURI ) {\r\n\r\n\t\t\treturn new Promise( function ( resolve, reject ) {\r\n\r\n\t\t\t\tvar onLoad = resolve;\r\n\r\n\t\t\t\tif ( loader.isImageBitmapLoader === true ) {\r\n\r\n\t\t\t\t\tonLoad = function ( imageBitmap ) {\r\n\r\n\t\t\t\t\t\tresolve( new CanvasTexture( imageBitmap ) );\r\n\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tloader.load( resolveURL( sourceURI, options.path ), onLoad, undefined, reject );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} ).then( function ( texture ) {\r\n\r\n\t\t\t// Clean up resources and configure Texture.\r\n\r\n\t\t\tif ( isObjectURL === true ) {\r\n\r\n\t\t\t\tURL.revokeObjectURL( sourceURI );\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture.flipY = false;\r\n\r\n\t\t\tif ( textureDef.name ) texture.name = textureDef.name;\r\n\r\n\t\t\t// When there is definitely no alpha channel in the texture, set RGBFormat to save space.\r\n\t\t\tif ( ! hasAlpha ) texture.format = RGBFormat;\r\n\r\n\t\t\tvar samplers = json.samplers || {};\r\n\t\t\tvar sampler = samplers[ textureDef.sampler ] || {};\r\n\r\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;\r\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || LinearMipmapLinearFilter;\r\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;\r\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;\r\n\r\n\t\t\tparser.associations.set( texture, {\r\n\t\t\t\ttype: 'textures',\r\n\t\t\t\tindex: textureIndex\r\n\t\t\t} );\r\n\r\n\t\t\treturn texture;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Asynchronously assigns a texture to the given material parameters.\r\n\t * @param {Object} materialParams\r\n\t * @param {string} mapName\r\n\t * @param {Object} mapDef\r\n\t * @return {Promise}\r\n\t */\r\n\tGLTFParser.prototype.assignTexture = function ( materialParams, mapName, mapDef ) {\r\n\r\n\t\tvar parser = this;\r\n\r\n\t\treturn this.getDependency( 'texture', mapDef.index ).then( function ( texture ) {\r\n\r\n\t\t\t// Materials sample aoMap from UV set 1 and other maps from UV set 0 - this can't be configured\r\n\t\t\t// However, we will copy UV set 0 to UV set 1 on demand for aoMap\r\n\t\t\tif ( mapDef.texCoord !== undefined && mapDef.texCoord != 0 && ! ( mapName === 'aoMap' && mapDef.texCoord == 1 ) ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV set ' + mapDef.texCoord + ' for texture ' + mapName + ' not yet supported.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] ) {\r\n\r\n\t\t\t\tvar transform = mapDef.extensions !== undefined ? mapDef.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] : undefined;\r\n\r\n\t\t\t\tif ( transform ) {\r\n\r\n\t\t\t\t\tvar gltfReference = parser.associations.get( texture );\r\n\t\t\t\t\ttexture = parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ].extendTexture( texture, transform );\r\n\t\t\t\t\tparser.associations.set( texture, gltfReference );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterialParams[ mapName ] = texture;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Assigns final material to a Mesh, Line, or Points instance. The instance\r\n\t * already has a material (generated from the glTF material options alone)\r\n\t * but reuse of the same glTF material may require multiple threejs materials\r\n\t * to accomodate different primitive types, defines, etc. New materials will\r\n\t * be created if necessary, and reused from a cache.\r\n\t * @param  {Object3D} mesh Mesh, Line, or Points instance.\r\n\t */\r\n\tGLTFParser.prototype.assignFinalMaterial = function ( mesh ) {\r\n\r\n\t\tvar geometry = mesh.geometry;\r\n\t\tvar material = mesh.material;\r\n\r\n\t\tvar useVertexTangents = geometry.attributes.tangent !== undefined;\r\n\t\tvar useVertexColors = geometry.attributes.color !== undefined;\r\n\t\tvar useFlatShading = geometry.attributes.normal === undefined;\r\n\t\tvar useSkinning = mesh.isSkinnedMesh === true;\r\n\t\tvar useMorphTargets = Object.keys( geometry.morphAttributes ).length > 0;\r\n\t\tvar useMorphNormals = useMorphTargets && geometry.morphAttributes.normal !== undefined;\r\n\r\n\t\tif ( mesh.isPoints ) {\r\n\r\n\t\t\tvar cacheKey = 'PointsMaterial:' + material.uuid;\r\n\r\n\t\t\tvar pointsMaterial = this.cache.get( cacheKey );\r\n\r\n\t\t\tif ( ! pointsMaterial ) {\r\n\r\n\t\t\t\tpointsMaterial = new PointsMaterial();\r\n\t\t\t\tMaterial.prototype.copy.call( pointsMaterial, material );\r\n\t\t\t\tpointsMaterial.color.copy( material.color );\r\n\t\t\t\tpointsMaterial.map = material.map;\r\n\t\t\t\tpointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\r\n\r\n\t\t\t\tthis.cache.add( cacheKey, pointsMaterial );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = pointsMaterial;\r\n\r\n\t\t} else if ( mesh.isLine ) {\r\n\r\n\t\t\tvar cacheKey = 'LineBasicMaterial:' + material.uuid;\r\n\r\n\t\t\tvar lineMaterial = this.cache.get( cacheKey );\r\n\r\n\t\t\tif ( ! lineMaterial ) {\r\n\r\n\t\t\t\tlineMaterial = new LineBasicMaterial();\r\n\t\t\t\tMaterial.prototype.copy.call( lineMaterial, material );\r\n\t\t\t\tlineMaterial.color.copy( material.color );\r\n\r\n\t\t\t\tthis.cache.add( cacheKey, lineMaterial );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = lineMaterial;\r\n\r\n\t\t}\r\n\r\n\t\t// Clone the material if it will be modified\r\n\t\tif ( useVertexTangents || useVertexColors || useFlatShading || useSkinning || useMorphTargets ) {\r\n\r\n\t\t\tvar cacheKey = 'ClonedMaterial:' + material.uuid + ':';\r\n\r\n\t\t\tif ( material.isGLTFSpecularGlossinessMaterial ) cacheKey += 'specular-glossiness:';\r\n\t\t\tif ( useSkinning ) cacheKey += 'skinning:';\r\n\t\t\tif ( useVertexTangents ) cacheKey += 'vertex-tangents:';\r\n\t\t\tif ( useVertexColors ) cacheKey += 'vertex-colors:';\r\n\t\t\tif ( useFlatShading ) cacheKey += 'flat-shading:';\r\n\t\t\tif ( useMorphTargets ) cacheKey += 'morph-targets:';\r\n\t\t\tif ( useMorphNormals ) cacheKey += 'morph-normals:';\r\n\r\n\t\t\tvar cachedMaterial = this.cache.get( cacheKey );\r\n\r\n\t\t\tif ( ! cachedMaterial ) {\r\n\r\n\t\t\t\tcachedMaterial = material.clone();\r\n\r\n\t\t\t\tif ( useSkinning ) cachedMaterial.skinning = true;\r\n\t\t\t\tif ( useVertexTangents ) cachedMaterial.vertexTangents = true;\r\n\t\t\t\tif ( useVertexColors ) cachedMaterial.vertexColors = true;\r\n\t\t\t\tif ( useFlatShading ) cachedMaterial.flatShading = true;\r\n\t\t\t\tif ( useMorphTargets ) cachedMaterial.morphTargets = true;\r\n\t\t\t\tif ( useMorphNormals ) cachedMaterial.morphNormals = true;\r\n\r\n\t\t\t\tthis.cache.add( cacheKey, cachedMaterial );\r\n\r\n\t\t\t\tthis.associations.set( cachedMaterial, this.associations.get( material ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = cachedMaterial;\r\n\r\n\t\t}\r\n\r\n\t\t// workarounds for mesh and geometry\r\n\r\n\t\tif ( material.aoMap && geometry.attributes.uv2 === undefined && geometry.attributes.uv !== undefined ) {\r\n\r\n\t\t\tgeometry.setAttribute( 'uv2', geometry.attributes.uv );\r\n\r\n\t\t}\r\n\r\n\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\r\n\t\tif ( material.normalScale && ! useVertexTangents ) {\r\n\r\n\t\t\tmaterial.normalScale.y = - material.normalScale.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.clearcoatNormalScale && ! useVertexTangents ) {\r\n\r\n\t\t\tmaterial.clearcoatNormalScale.y = - material.clearcoatNormalScale.y;\r\n\r\n\t\t}\r\n\r\n\t\tmesh.material = material;\r\n\r\n\t};\r\n\r\n\tGLTFParser.prototype.getMaterialType = function ( /* materialIndex */ ) {\r\n\r\n\t\treturn MeshStandardMaterial;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\r\n\t * @param {number} materialIndex\r\n\t * @return {Promise<Material>}\r\n\t */\r\n\tGLTFParser.prototype.loadMaterial = function ( materialIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\t\tvar materialDef = json.materials[ materialIndex ];\r\n\r\n\t\tvar materialType;\r\n\t\tvar materialParams = {};\r\n\t\tvar materialExtensions = materialDef.extensions || {};\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] ) {\r\n\r\n\t\t\tvar sgExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\r\n\t\t\tmaterialType = sgExtension.getMaterialType();\r\n\t\t\tpending.push( sgExtension.extendParams( materialParams, materialDef, parser ) );\r\n\r\n\t\t} else if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ] ) {\r\n\r\n\t\t\tvar kmuExtension = extensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ];\r\n\t\t\tmaterialType = kmuExtension.getMaterialType();\r\n\t\t\tpending.push( kmuExtension.extendParams( materialParams, materialDef, parser ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// Specification:\r\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\r\n\r\n\t\t\tvar metallicRoughness = materialDef.pbrMetallicRoughness || {};\r\n\r\n\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\r\n\t\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\r\n\r\n\t\t\t\tvar array = metallicRoughness.baseColorFactor;\r\n\r\n\t\t\t\tmaterialParams.color.fromArray( array );\r\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\r\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\r\n\r\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture ) );\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterialType = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\treturn ext.getMaterialType && ext.getMaterialType( materialIndex );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tpending.push( Promise.all( this._invokeAll( function ( ext ) {\r\n\r\n\t\t\t\treturn ext.extendMaterialParams && ext.extendMaterialParams( materialIndex, materialParams );\r\n\r\n\t\t\t} ) ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.doubleSided === true ) {\r\n\r\n\t\t\tmaterialParams.side = DoubleSide;\r\n\r\n\t\t}\r\n\r\n\t\tvar alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\r\n\r\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\r\n\r\n\t\t\tmaterialParams.transparent = true;\r\n\r\n\t\t\t// See: https://github.com/mrdoob/three.js/issues/17706\r\n\t\t\tmaterialParams.depthWrite = false;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmaterialParams.transparent = false;\r\n\r\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\r\n\r\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture ) );\r\n\r\n\t\t\tmaterialParams.normalScale = new Vector2( 1, 1 );\r\n\r\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\r\n\r\n\t\t\t\tmaterialParams.normalScale.set( materialDef.normalTexture.scale, materialDef.normalTexture.scale );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture ) );\r\n\r\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\r\n\r\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tmaterialParams.emissive = new Color().fromArray( materialDef.emissiveFactor );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending ).then( function () {\r\n\r\n\t\t\tvar material;\r\n\r\n\t\t\tif ( materialType === GLTFMeshStandardSGMaterial ) {\r\n\r\n\t\t\t\tmaterial = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].createMaterial( materialParams );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmaterial = new materialType( materialParams );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialDef.name ) material.name = materialDef.name;\r\n\r\n\t\t\t// baseColorTexture, emissiveTexture, and specularGlossinessTexture use sRGB encoding.\r\n\t\t\tif ( material.map ) material.map.encoding = sRGBEncoding;\r\n\t\t\tif ( material.emissiveMap ) material.emissiveMap.encoding = sRGBEncoding;\r\n\r\n\t\t\tassignExtrasToUserData( material, materialDef );\r\n\r\n\t\t\tparser.associations.set( material, { type: 'materials', index: materialIndex } );\r\n\r\n\t\t\tif ( materialDef.extensions ) addUnknownExtensionsToUserData( extensions, material, materialDef );\r\n\r\n\t\t\treturn material;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/** When Object3D instances are targeted by animation, they need unique names. */\r\n\tGLTFParser.prototype.createUniqueName = function ( originalName ) {\r\n\r\n\t\tvar name = PropertyBinding.sanitizeNodeName( originalName || '' );\r\n\r\n\t\tfor ( var i = 1; this.nodeNamesUsed[ name ]; ++ i ) {\r\n\r\n\t\t\tname = originalName + '_' + i;\r\n\r\n\t\t}\r\n\r\n\t\tthis.nodeNamesUsed[ name ] = true;\r\n\r\n\t\treturn name;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {GLTF.Primitive} primitiveDef\r\n\t * @param {GLTFParser} parser\r\n\t */\r\n\tfunction computeBounds( geometry, primitiveDef, parser ) {\r\n\r\n\t\tvar attributes = primitiveDef.attributes;\r\n\r\n\t\tvar box = new Box3();\r\n\r\n\t\tif ( attributes.POSITION !== undefined ) {\r\n\r\n\t\t\tvar accessor = parser.json.accessors[ attributes.POSITION ];\r\n\r\n\t\t\tvar min = accessor.min;\r\n\t\t\tvar max = accessor.max;\r\n\r\n\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\r\n\r\n\t\t\tif ( min !== undefined && max !== undefined ) {\r\n\r\n\t\t\t\tbox.set(\r\n\t\t\t\t\tnew Vector3( min[ 0 ], min[ 1 ], min[ 2 ] ),\r\n\t\t\t\t\tnew Vector3( max[ 0 ], max[ 1 ], max[ 2 ] ) );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar targets = primitiveDef.targets;\r\n\r\n\t\tif ( targets !== undefined ) {\r\n\r\n\t\t\tvar maxDisplacement = new Vector3();\r\n\t\t\tvar vector = new Vector3();\r\n\r\n\t\t\tfor ( var i = 0, il = targets.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar target = targets[ i ];\r\n\r\n\t\t\t\tif ( target.POSITION !== undefined ) {\r\n\r\n\t\t\t\t\tvar accessor = parser.json.accessors[ target.POSITION ];\r\n\t\t\t\t\tvar min = accessor.min;\r\n\t\t\t\t\tvar max = accessor.max;\r\n\r\n\t\t\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\r\n\r\n\t\t\t\t\tif ( min !== undefined && max !== undefined ) {\r\n\r\n\t\t\t\t\t\t// we need to get max of absolute components because target weight is [-1,1]\r\n\t\t\t\t\t\tvector.setX( Math.max( Math.abs( min[ 0 ] ), Math.abs( max[ 0 ] ) ) );\r\n\t\t\t\t\t\tvector.setY( Math.max( Math.abs( min[ 1 ] ), Math.abs( max[ 1 ] ) ) );\r\n\t\t\t\t\t\tvector.setZ( Math.max( Math.abs( min[ 2 ] ), Math.abs( max[ 2 ] ) ) );\r\n\r\n\t\t\t\t\t\t// Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative\r\n\t\t\t\t\t\t// to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets\r\n\t\t\t\t\t\t// are used to implement key-frame animations and as such only two are active at a time - this results in very large\r\n\t\t\t\t\t\t// boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.\r\n\t\t\t\t\t\tmaxDisplacement.max( vector );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.\r\n\t\t\tbox.expandByVector( maxDisplacement );\r\n\r\n\t\t}\r\n\r\n\t\tgeometry.boundingBox = box;\r\n\r\n\t\tvar sphere = new Sphere();\r\n\r\n\t\tbox.getCenter( sphere.center );\r\n\t\tsphere.radius = box.min.distanceTo( box.max ) / 2;\r\n\r\n\t\tgeometry.boundingSphere = sphere;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {GLTF.Primitive} primitiveDef\r\n\t * @param {GLTFParser} parser\r\n\t * @return {Promise<BufferGeometry>}\r\n\t */\r\n\tfunction addPrimitiveAttributes( geometry, primitiveDef, parser ) {\r\n\r\n\t\tvar attributes = primitiveDef.attributes;\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tfunction assignAttributeAccessor( accessorIndex, attributeName ) {\r\n\r\n\t\t\treturn parser.getDependency( 'accessor', accessorIndex )\r\n\t\t\t\t.then( function ( accessor ) {\r\n\r\n\t\t\t\t\tgeometry.setAttribute( attributeName, accessor );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var gltfAttributeName in attributes ) {\r\n\r\n\t\t\tvar threeAttributeName = ATTRIBUTES[ gltfAttributeName ] || gltfAttributeName.toLowerCase();\r\n\r\n\t\t\t// Skip attributes already provided by e.g. Draco extension.\r\n\t\t\tif ( threeAttributeName in geometry.attributes ) continue;\r\n\r\n\t\t\tpending.push( assignAttributeAccessor( attributes[ gltfAttributeName ], threeAttributeName ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( primitiveDef.indices !== undefined && ! geometry.index ) {\r\n\r\n\t\t\tvar accessor = parser.getDependency( 'accessor', primitiveDef.indices ).then( function ( accessor ) {\r\n\r\n\t\t\t\tgeometry.setIndex( accessor );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tpending.push( accessor );\r\n\r\n\t\t}\r\n\r\n\t\tassignExtrasToUserData( geometry, primitiveDef );\r\n\r\n\t\tcomputeBounds( geometry, primitiveDef, parser );\r\n\r\n\t\treturn Promise.all( pending ).then( function () {\r\n\r\n\t\t\treturn primitiveDef.targets !== undefined\r\n\t\t\t\t? addMorphTargets( geometry, primitiveDef.targets, parser )\r\n\t\t\t\t: geometry;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {Number} drawMode\r\n\t * @return {BufferGeometry}\r\n\t */\r\n\tfunction toTrianglesDrawMode( geometry, drawMode ) {\r\n\r\n\t\tvar index = geometry.getIndex();\r\n\r\n\t\t// generate index if not present\r\n\r\n\t\tif ( index === null ) {\r\n\r\n\t\t\tvar indices = [];\r\n\r\n\t\t\tvar position = geometry.getAttribute( 'position' );\r\n\r\n\t\t\tif ( position !== undefined ) {\r\n\r\n\t\t\t\tfor ( var i = 0; i < position.count; i ++ ) {\r\n\r\n\t\t\t\t\tindices.push( i );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.setIndex( indices );\r\n\t\t\t\tindex = geometry.getIndex();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.error( 'THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );\r\n\t\t\t\treturn geometry;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tvar numberOfTriangles = index.count - 2;\r\n\t\tvar newIndices = [];\r\n\r\n\t\tif ( drawMode === TriangleFanDrawMode ) {\r\n\r\n\t\t\t// gl.TRIANGLE_FAN\r\n\r\n\t\t\tfor ( var i = 1; i <= numberOfTriangles; i ++ ) {\r\n\r\n\t\t\t\tnewIndices.push( index.getX( 0 ) );\r\n\t\t\t\tnewIndices.push( index.getX( i ) );\r\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// gl.TRIANGLE_STRIP\r\n\r\n\t\t\tfor ( var i = 0; i < numberOfTriangles; i ++ ) {\r\n\r\n\t\t\t\tif ( i % 2 === 0 ) {\r\n\r\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\r\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\r\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\r\n\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\r\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\r\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( ( newIndices.length / 3 ) !== numberOfTriangles ) {\r\n\r\n\t\t\tconsole.error( 'THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );\r\n\r\n\t\t}\r\n\r\n\t\t// build final geometry\r\n\r\n\t\tvar newGeometry = geometry.clone();\r\n\t\tnewGeometry.setIndex( newIndices );\r\n\r\n\t\treturn newGeometry;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\r\n\t *\r\n\t * Creates BufferGeometries from primitives.\r\n\t *\r\n\t * @param {Array<GLTF.Primitive>} primitives\r\n\t * @return {Promise<Array<BufferGeometry>>}\r\n\t */\r\n\tGLTFParser.prototype.loadGeometries = function ( primitives ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar extensions = this.extensions;\r\n\t\tvar cache = this.primitiveCache;\r\n\r\n\t\tfunction createDracoPrimitive( primitive ) {\r\n\r\n\t\t\treturn extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ]\r\n\t\t\t\t.decodePrimitive( primitive, parser )\r\n\t\t\t\t.then( function ( geometry ) {\r\n\r\n\t\t\t\t\treturn addPrimitiveAttributes( geometry, primitive, parser );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tfor ( var i = 0, il = primitives.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar primitive = primitives[ i ];\r\n\t\t\tvar cacheKey = createPrimitiveKey( primitive );\r\n\r\n\t\t\t// See if we've already created this geometry\r\n\t\t\tvar cached = cache[ cacheKey ];\r\n\r\n\t\t\tif ( cached ) {\r\n\r\n\t\t\t\t// Use the cached geometry if it exists\r\n\t\t\t\tpending.push( cached.promise );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar geometryPromise;\r\n\r\n\t\t\t\tif ( primitive.extensions && primitive.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ] ) {\r\n\r\n\t\t\t\t\t// Use DRACO geometry if available\r\n\t\t\t\t\tgeometryPromise = createDracoPrimitive( primitive );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// Otherwise create a new geometry\r\n\t\t\t\t\tgeometryPromise = addPrimitiveAttributes( new BufferGeometry(), primitive, parser );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Cache this geometry\r\n\t\t\t\tcache[ cacheKey ] = { primitive: primitive, promise: geometryPromise };\r\n\r\n\t\t\t\tpending.push( geometryPromise );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\r\n\t * @param {number} meshIndex\r\n\t * @return {Promise<Group|Mesh|SkinnedMesh>}\r\n\t */\r\n\tGLTFParser.prototype.loadMesh = function ( meshIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\r\n\t\tvar meshDef = json.meshes[ meshIndex ];\r\n\t\tvar primitives = meshDef.primitives;\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tfor ( var i = 0, il = primitives.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar material = primitives[ i ].material === undefined\r\n\t\t\t\t? createDefaultMaterial( this.cache )\r\n\t\t\t\t: this.getDependency( 'material', primitives[ i ].material );\r\n\r\n\t\t\tpending.push( material );\r\n\r\n\t\t}\r\n\r\n\t\tpending.push( parser.loadGeometries( primitives ) );\r\n\r\n\t\treturn Promise.all( pending ).then( function ( results ) {\r\n\r\n\t\t\tvar materials = results.slice( 0, results.length - 1 );\r\n\t\t\tvar geometries = results[ results.length - 1 ];\r\n\r\n\t\t\tvar meshes = [];\r\n\r\n\t\t\tfor ( var i = 0, il = geometries.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar geometry = geometries[ i ];\r\n\t\t\t\tvar primitive = primitives[ i ];\r\n\r\n\t\t\t\t// 1. create Mesh\r\n\r\n\t\t\t\tvar mesh;\r\n\r\n\t\t\t\tvar material = materials[ i ];\r\n\r\n\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\r\n\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\r\n\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\r\n\t\t\t\t\tprimitive.mode === undefined ) {\r\n\r\n\t\t\t\t\t// .isSkinnedMesh isn't in glTF spec. See ._markDefs()\r\n\t\t\t\t\tmesh = meshDef.isSkinnedMesh === true\r\n\t\t\t\t\t\t? new SkinnedMesh( geometry, material )\r\n\t\t\t\t\t\t: new Mesh( geometry, material );\r\n\r\n\t\t\t\t\tif ( mesh.isSkinnedMesh === true && ! mesh.geometry.attributes.skinWeight.normalized ) {\r\n\r\n\t\t\t\t\t\t// we normalize floating point skin weight array to fix malformed assets (see #15319)\r\n\t\t\t\t\t\t// it's important to skip this for non-float32 data since normalizeSkinWeights assumes non-normalized inputs\r\n\t\t\t\t\t\tmesh.normalizeSkinWeights();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\r\n\r\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleStripDrawMode );\r\n\r\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\r\n\r\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleFanDrawMode );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\r\n\r\n\t\t\t\t\tmesh = new LineSegments( geometry, material );\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\r\n\r\n\t\t\t\t\tmesh = new Line( geometry, material );\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\r\n\r\n\t\t\t\t\tmesh = new LineLoop( geometry, material );\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\r\n\r\n\t\t\t\t\tmesh = new Points( geometry, material );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( Object.keys( mesh.geometry.morphAttributes ).length > 0 ) {\r\n\r\n\t\t\t\t\tupdateMorphTargets( mesh, meshDef );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmesh.name = parser.createUniqueName( meshDef.name || ( 'mesh_' + meshIndex ) );\r\n\r\n\t\t\t\tassignExtrasToUserData( mesh, meshDef );\r\n\r\n\t\t\t\tif ( primitive.extensions ) addUnknownExtensionsToUserData( extensions, mesh, primitive );\r\n\r\n\t\t\t\tparser.assignFinalMaterial( mesh );\r\n\r\n\t\t\t\tmeshes.push( mesh );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( meshes.length === 1 ) {\r\n\r\n\t\t\t\treturn meshes[ 0 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar group = new Group();\r\n\r\n\t\t\tfor ( var i = 0, il = meshes.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tgroup.add( meshes[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn group;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\r\n\t * @param {number} cameraIndex\r\n\t * @return {Promise<THREE.Camera>}\r\n\t */\r\n\tGLTFParser.prototype.loadCamera = function ( cameraIndex ) {\r\n\r\n\t\tvar camera;\r\n\t\tvar cameraDef = this.json.cameras[ cameraIndex ];\r\n\t\tvar params = cameraDef[ cameraDef.type ];\r\n\r\n\t\tif ( ! params ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( cameraDef.type === 'perspective' ) {\r\n\r\n\t\t\tcamera = new PerspectiveCamera( MathUtils.radToDeg( params.yfov ), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6 );\r\n\r\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\r\n\r\n\t\t\tcamera = new OrthographicCamera( - params.xmag, params.xmag, params.ymag, - params.ymag, params.znear, params.zfar );\r\n\r\n\t\t}\r\n\r\n\t\tif ( cameraDef.name ) camera.name = this.createUniqueName( cameraDef.name );\r\n\r\n\t\tassignExtrasToUserData( camera, cameraDef );\r\n\r\n\t\treturn Promise.resolve( camera );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\r\n\t * @param {number} skinIndex\r\n\t * @return {Promise<Object>}\r\n\t */\r\n\tGLTFParser.prototype.loadSkin = function ( skinIndex ) {\r\n\r\n\t\tvar skinDef = this.json.skins[ skinIndex ];\r\n\r\n\t\tvar skinEntry = { joints: skinDef.joints };\r\n\r\n\t\tif ( skinDef.inverseBindMatrices === undefined ) {\r\n\r\n\t\t\treturn Promise.resolve( skinEntry );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.getDependency( 'accessor', skinDef.inverseBindMatrices ).then( function ( accessor ) {\r\n\r\n\t\t\tskinEntry.inverseBindMatrices = accessor;\r\n\r\n\t\t\treturn skinEntry;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\r\n\t * @param {number} animationIndex\r\n\t * @return {Promise<AnimationClip>}\r\n\t */\r\n\tGLTFParser.prototype.loadAnimation = function ( animationIndex ) {\r\n\r\n\t\tvar json = this.json;\r\n\r\n\t\tvar animationDef = json.animations[ animationIndex ];\r\n\r\n\t\tvar pendingNodes = [];\r\n\t\tvar pendingInputAccessors = [];\r\n\t\tvar pendingOutputAccessors = [];\r\n\t\tvar pendingSamplers = [];\r\n\t\tvar pendingTargets = [];\r\n\r\n\t\tfor ( var i = 0, il = animationDef.channels.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar channel = animationDef.channels[ i ];\r\n\t\t\tvar sampler = animationDef.samplers[ channel.sampler ];\r\n\t\t\tvar target = channel.target;\r\n\t\t\tvar name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\r\n\t\t\tvar input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\r\n\t\t\tvar output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\r\n\r\n\t\t\tpendingNodes.push( this.getDependency( 'node', name ) );\r\n\t\t\tpendingInputAccessors.push( this.getDependency( 'accessor', input ) );\r\n\t\t\tpendingOutputAccessors.push( this.getDependency( 'accessor', output ) );\r\n\t\t\tpendingSamplers.push( sampler );\r\n\t\t\tpendingTargets.push( target );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( [\r\n\r\n\t\t\tPromise.all( pendingNodes ),\r\n\t\t\tPromise.all( pendingInputAccessors ),\r\n\t\t\tPromise.all( pendingOutputAccessors ),\r\n\t\t\tPromise.all( pendingSamplers ),\r\n\t\t\tPromise.all( pendingTargets )\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tvar nodes = dependencies[ 0 ];\r\n\t\t\tvar inputAccessors = dependencies[ 1 ];\r\n\t\t\tvar outputAccessors = dependencies[ 2 ];\r\n\t\t\tvar samplers = dependencies[ 3 ];\r\n\t\t\tvar targets = dependencies[ 4 ];\r\n\r\n\t\t\tvar tracks = [];\r\n\r\n\t\t\tfor ( var i = 0, il = nodes.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar node = nodes[ i ];\r\n\t\t\t\tvar inputAccessor = inputAccessors[ i ];\r\n\t\t\t\tvar outputAccessor = outputAccessors[ i ];\r\n\t\t\t\tvar sampler = samplers[ i ];\r\n\t\t\t\tvar target = targets[ i ];\r\n\r\n\t\t\t\tif ( node === undefined ) continue;\r\n\r\n\t\t\t\tnode.updateMatrix();\r\n\t\t\t\tnode.matrixAutoUpdate = true;\r\n\r\n\t\t\t\tvar TypedKeyframeTrack;\r\n\r\n\t\t\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\r\n\r\n\t\t\t\t\tcase PATH_PROPERTIES.weights:\r\n\r\n\t\t\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase PATH_PROPERTIES.rotation:\r\n\r\n\t\t\t\t\t\tTypedKeyframeTrack = QuaternionKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase PATH_PROPERTIES.position:\r\n\t\t\t\t\tcase PATH_PROPERTIES.scale:\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar targetName = node.name ? node.name : node.uuid;\r\n\r\n\t\t\t\tvar interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;\r\n\r\n\t\t\t\tvar targetNames = [];\r\n\r\n\t\t\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\r\n\r\n\t\t\t\t\t// Node may be a Group (glTF mesh with several primitives) or a Mesh.\r\n\t\t\t\t\tnode.traverse( function ( object ) {\r\n\r\n\t\t\t\t\t\tif ( object.isMesh === true && object.morphTargetInfluences ) {\r\n\r\n\t\t\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttargetNames.push( targetName );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar outputArray = outputAccessor.array;\r\n\r\n\t\t\t\tif ( outputAccessor.normalized ) {\r\n\r\n\t\t\t\t\tvar scale;\r\n\r\n\t\t\t\t\tif ( outputArray.constructor === Int8Array ) {\r\n\r\n\t\t\t\t\t\tscale = 1 / 127;\r\n\r\n\t\t\t\t\t} else if ( outputArray.constructor === Uint8Array ) {\r\n\r\n\t\t\t\t\t\tscale = 1 / 255;\r\n\r\n\t\t\t\t\t} else if ( outputArray.constructor == Int16Array ) {\r\n\r\n\t\t\t\t\t\tscale = 1 / 32767;\r\n\r\n\t\t\t\t\t} else if ( outputArray.constructor === Uint16Array ) {\r\n\r\n\t\t\t\t\t\tscale = 1 / 65535;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported output accessor component type.' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar scaled = new Float32Array( outputArray.length );\r\n\r\n\t\t\t\t\tfor ( var j = 0, jl = outputArray.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\tscaled[ j ] = outputArray[ j ] * scale;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\toutputArray = scaled;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( var j = 0, jl = targetNames.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tvar track = new TypedKeyframeTrack(\r\n\t\t\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\r\n\t\t\t\t\t\tinputAccessor.array,\r\n\t\t\t\t\t\toutputArray,\r\n\t\t\t\t\t\tinterpolation\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// Override interpolation with custom factory method.\r\n\t\t\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\r\n\r\n\t\t\t\t\t\ttrack.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline( result ) {\r\n\r\n\t\t\t\t\t\t\t// A CUBICSPLINE keyframe in glTF has three output values for each input value,\r\n\t\t\t\t\t\t\t// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\r\n\t\t\t\t\t\t\t// must be divided by three to get the interpolant's sampleSize argument.\r\n\r\n\t\t\t\t\t\t\treturn new GLTFCubicSplineInterpolant( this.times, this.values, this.getValueSize() / 3, result );\r\n\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\r\n\t\t\t\t\t\ttrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttracks.push( track );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar name = animationDef.name ? animationDef.name : 'animation_' + animationIndex;\r\n\r\n\t\t\treturn new AnimationClip( name, undefined, tracks );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\r\n\t * @param {number} nodeIndex\r\n\t * @return {Promise<Object3D>}\r\n\t */\r\n\tGLTFParser.prototype.loadNode = function ( nodeIndex ) {\r\n\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\t\tvar parser = this;\r\n\r\n\t\tvar nodeDef = json.nodes[ nodeIndex ];\r\n\r\n\t\t// reserve node's name before its dependencies, so the root has the intended name.\r\n\t\tvar nodeName = nodeDef.name ? parser.createUniqueName( nodeDef.name ) : '';\r\n\r\n\t\treturn ( function () {\r\n\r\n\t\t\tvar pending = [];\r\n\r\n\t\t\tif ( nodeDef.mesh !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.getDependency( 'mesh', nodeDef.mesh ).then( function ( mesh ) {\r\n\r\n\t\t\t\t\tvar node = parser._getNodeRef( parser.meshCache, nodeDef.mesh, mesh );\r\n\r\n\t\t\t\t\t// if weights are provided on the node, override weights on the mesh.\r\n\t\t\t\t\tif ( nodeDef.weights !== undefined ) {\r\n\r\n\t\t\t\t\t\tnode.traverse( function ( o ) {\r\n\r\n\t\t\t\t\t\t\tif ( ! o.isMesh ) return;\r\n\r\n\t\t\t\t\t\t\tfor ( var i = 0, il = nodeDef.weights.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\t\t\to.morphTargetInfluences[ i ] = nodeDef.weights[ i ];\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn node;\r\n\r\n\t\t\t\t} ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.camera !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.getDependency( 'camera', nodeDef.camera ).then( function ( camera ) {\r\n\r\n\t\t\t\t\treturn parser._getNodeRef( parser.cameraCache, nodeDef.camera, camera );\r\n\r\n\t\t\t\t} ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tparser._invokeAll( function ( ext ) {\r\n\r\n\t\t\t\treturn ext.createNodeAttachment && ext.createNodeAttachment( nodeIndex );\r\n\r\n\t\t\t} ).forEach( function ( promise ) {\r\n\r\n\t\t\t\tpending.push( promise );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\treturn Promise.all( pending );\r\n\r\n\t\t}() ).then( function ( objects ) {\r\n\r\n\t\t\tvar node;\r\n\r\n\t\t\t// .isBone isn't in glTF spec. See ._markDefs\r\n\t\t\tif ( nodeDef.isBone === true ) {\r\n\r\n\t\t\t\tnode = new Bone();\r\n\r\n\t\t\t} else if ( objects.length > 1 ) {\r\n\r\n\t\t\t\tnode = new Group();\r\n\r\n\t\t\t} else if ( objects.length === 1 ) {\r\n\r\n\t\t\t\tnode = objects[ 0 ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tnode = new Object3D();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( node !== objects[ 0 ] ) {\r\n\r\n\t\t\t\tfor ( var i = 0, il = objects.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tnode.add( objects[ i ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.name ) {\r\n\r\n\t\t\t\tnode.userData.name = nodeDef.name;\r\n\t\t\t\tnode.name = nodeName;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tassignExtrasToUserData( node, nodeDef );\r\n\r\n\t\t\tif ( nodeDef.extensions ) addUnknownExtensionsToUserData( extensions, node, nodeDef );\r\n\r\n\t\t\tif ( nodeDef.matrix !== undefined ) {\r\n\r\n\t\t\t\tvar matrix = new Matrix4();\r\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\r\n\t\t\t\tnode.applyMatrix4( matrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\r\n\r\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\r\n\r\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\r\n\r\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tparser.associations.set( node, { type: 'nodes', index: nodeIndex } );\r\n\r\n\t\t\treturn node;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\r\n\t * @param {number} sceneIndex\r\n\t * @return {Promise<Group>}\r\n\t */\r\n\tGLTFParser.prototype.loadScene = function () {\r\n\r\n\t\t// scene node hierachy builder\r\n\r\n\t\tfunction buildNodeHierachy( nodeId, parentObject, json, parser ) {\r\n\r\n\t\t\tvar nodeDef = json.nodes[ nodeId ];\r\n\r\n\t\t\treturn parser.getDependency( 'node', nodeId ).then( function ( node ) {\r\n\r\n\t\t\t\tif ( nodeDef.skin === undefined ) return node;\r\n\r\n\t\t\t\t// build skeleton here as well\r\n\r\n\t\t\t\tvar skinEntry;\r\n\r\n\t\t\t\treturn parser.getDependency( 'skin', nodeDef.skin ).then( function ( skin ) {\r\n\r\n\t\t\t\t\tskinEntry = skin;\r\n\r\n\t\t\t\t\tvar pendingJoints = [];\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = skinEntry.joints.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tpendingJoints.push( parser.getDependency( 'node', skinEntry.joints[ i ] ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn Promise.all( pendingJoints );\r\n\r\n\t\t\t\t} ).then( function ( jointNodes ) {\r\n\r\n\t\t\t\t\tnode.traverse( function ( mesh ) {\r\n\r\n\t\t\t\t\t\tif ( ! mesh.isMesh ) return;\r\n\r\n\t\t\t\t\t\tvar bones = [];\r\n\t\t\t\t\t\tvar boneInverses = [];\r\n\r\n\t\t\t\t\t\tfor ( var j = 0, jl = jointNodes.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\t\tvar jointNode = jointNodes[ j ];\r\n\r\n\t\t\t\t\t\t\tif ( jointNode ) {\r\n\r\n\t\t\t\t\t\t\t\tbones.push( jointNode );\r\n\r\n\t\t\t\t\t\t\t\tvar mat = new Matrix4();\r\n\r\n\t\t\t\t\t\t\t\tif ( skinEntry.inverseBindMatrices !== undefined ) {\r\n\r\n\t\t\t\t\t\t\t\t\tmat.fromArray( skinEntry.inverseBindMatrices.array, j * 16 );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tboneInverses.push( mat );\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', skinEntry.joints[ j ] );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tmesh.bind( new Skeleton( bones, boneInverses ), mesh.matrixWorld );\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\treturn node;\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t} ).then( function ( node ) {\r\n\r\n\t\t\t\t// build node hierachy\r\n\r\n\t\t\t\tparentObject.add( node );\r\n\r\n\t\t\t\tvar pending = [];\r\n\r\n\t\t\t\tif ( nodeDef.children ) {\r\n\r\n\t\t\t\t\tvar children = nodeDef.children;\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = children.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar child = children[ i ];\r\n\t\t\t\t\t\tpending.push( buildNodeHierachy( child, node, json, parser ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn Promise.all( pending );\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn function loadScene( sceneIndex ) {\r\n\r\n\t\t\tvar json = this.json;\r\n\t\t\tvar extensions = this.extensions;\r\n\t\t\tvar sceneDef = this.json.scenes[ sceneIndex ];\r\n\t\t\tvar parser = this;\r\n\r\n\t\t\t// Loader returns Group, not Scene.\r\n\t\t\t// See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172\r\n\t\t\tvar scene = new Group();\r\n\t\t\tif ( sceneDef.name ) scene.name = parser.createUniqueName( sceneDef.name );\r\n\r\n\t\t\tassignExtrasToUserData( scene, sceneDef );\r\n\r\n\t\t\tif ( sceneDef.extensions ) addUnknownExtensionsToUserData( extensions, scene, sceneDef );\r\n\r\n\t\t\tvar nodeIds = sceneDef.nodes || [];\r\n\r\n\t\t\tvar pending = [];\r\n\r\n\t\t\tfor ( var i = 0, il = nodeIds.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tpending.push( buildNodeHierachy( nodeIds[ i ], scene, json, parser ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn Promise.all( pending ).then( function () {\r\n\r\n\t\t\t\treturn scene;\r\n\r\n\t\t\t} );\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\treturn GLTFLoader;\r\n\r\n} )();\r\n\r\nexport { GLTFLoader };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/loaders/GLTFLoader.js","import {\r\n\tBufferAttribute,\r\n\tBufferGeometry,\r\n\tFileLoader,\r\n\tLoader\r\n} from \"@/components/build/three.module.js\";\r\n\r\nvar DRACOLoader = function ( manager ) {\r\n\r\n\tLoader.call( this, manager );\r\n\r\n\tthis.decoderPath = '';\r\n\tthis.decoderConfig = {};\r\n\tthis.decoderBinary = null;\r\n\tthis.decoderPending = null;\r\n\r\n\tthis.workerLimit = 4;\r\n\tthis.workerPool = [];\r\n\tthis.workerNextTaskID = 1;\r\n\tthis.workerSourceURL = '';\r\n\r\n\tthis.defaultAttributeIDs = {\r\n\t\tposition: 'POSITION',\r\n\t\tnormal: 'NORMAL',\r\n\t\tcolor: 'COLOR',\r\n\t\tuv: 'TEX_COORD'\r\n\t};\r\n\tthis.defaultAttributeTypes = {\r\n\t\tposition: 'Float32Array',\r\n\t\tnormal: 'Float32Array',\r\n\t\tcolor: 'Float32Array',\r\n\t\tuv: 'Float32Array'\r\n\t};\r\n\r\n};\r\n\r\nDRACOLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\tconstructor: DRACOLoader,\r\n\r\n\tsetDecoderPath: function ( path ) {\r\n\r\n\t\tthis.decoderPath = path;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetDecoderConfig: function ( config ) {\r\n\r\n\t\tthis.decoderConfig = config;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetWorkerLimit: function ( workerLimit ) {\r\n\r\n\t\tthis.workerLimit = workerLimit;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\t/** @deprecated */\r\n\tsetVerbosity: function () {\r\n\r\n\t\tconsole.warn( 'THREE.DRACOLoader: The .setVerbosity() method has been removed.' );\r\n\r\n\t},\r\n\r\n\t/** @deprecated */\r\n\tsetDrawMode: function () {\r\n\r\n\t\tconsole.warn( 'THREE.DRACOLoader: The .setDrawMode() method has been removed.' );\r\n\r\n\t},\r\n\r\n\t/** @deprecated */\r\n\tsetSkipDequantization: function () {\r\n\r\n\t\tconsole.warn( 'THREE.DRACOLoader: The .setSkipDequantization() method has been removed.' );\r\n\r\n\t},\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar loader = new FileLoader( this.manager );\r\n\r\n\t\tloader.setPath( this.path );\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\t\tloader.setRequestHeader( this.requestHeader );\r\n\t\tloader.setWithCredentials( this.withCredentials );\r\n\r\n\t\tloader.load( url, ( buffer ) => {\r\n\r\n\t\t\tvar taskConfig = {\r\n\t\t\t\tattributeIDs: this.defaultAttributeIDs,\r\n\t\t\t\tattributeTypes: this.defaultAttributeTypes,\r\n\t\t\t\tuseUniqueIDs: false\r\n\t\t\t};\r\n\r\n\t\t\tthis.decodeGeometry( buffer, taskConfig )\r\n\t\t\t\t.then( onLoad )\r\n\t\t\t\t.catch( onError );\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\t/** @deprecated Kept for backward-compatibility with previous DRACOLoader versions. */\r\n\tdecodeDracoFile: function ( buffer, callback, attributeIDs, attributeTypes ) {\r\n\r\n\t\tvar taskConfig = {\r\n\t\t\tattributeIDs: attributeIDs || this.defaultAttributeIDs,\r\n\t\t\tattributeTypes: attributeTypes || this.defaultAttributeTypes,\r\n\t\t\tuseUniqueIDs: !! attributeIDs\r\n\t\t};\r\n\r\n\t\tthis.decodeGeometry( buffer, taskConfig ).then( callback );\r\n\r\n\t},\r\n\r\n\tdecodeGeometry: function ( buffer, taskConfig ) {\r\n\r\n\t\t// TODO: For backward-compatibility, support 'attributeTypes' objects containing\r\n\t\t// references (rather than names) to typed array constructors. These must be\r\n\t\t// serialized before sending them to the worker.\r\n\t\tfor ( var attribute in taskConfig.attributeTypes ) {\r\n\r\n\t\t\tvar type = taskConfig.attributeTypes[ attribute ];\r\n\r\n\t\t\tif ( type.BYTES_PER_ELEMENT !== undefined ) {\r\n\r\n\t\t\t\ttaskConfig.attributeTypes[ attribute ] = type.name;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tvar taskKey = JSON.stringify( taskConfig );\r\n\r\n\t\t// Check for an existing task using this buffer. A transferred buffer cannot be transferred\r\n\t\t// again from this thread.\r\n\t\tif ( DRACOLoader.taskCache.has( buffer ) ) {\r\n\r\n\t\t\tvar cachedTask = DRACOLoader.taskCache.get( buffer );\r\n\r\n\t\t\tif ( cachedTask.key === taskKey ) {\r\n\r\n\t\t\t\treturn cachedTask.promise;\r\n\r\n\t\t\t} else if ( buffer.byteLength === 0 ) {\r\n\r\n\t\t\t\t// Technically, it would be possible to wait for the previous task to complete,\r\n\t\t\t\t// transfer the buffer back, and decode again with the second configuration. That\r\n\t\t\t\t// is complex, and I don't know of any reason to decode a Draco buffer twice in\r\n\t\t\t\t// different ways, so this is left unimplemented.\r\n\t\t\t\tthrow new Error(\r\n\r\n\t\t\t\t\t'THREE.DRACOLoader: Unable to re-decode a buffer with different ' +\r\n\t\t\t\t\t'settings. Buffer has already been transferred.'\r\n\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tvar worker;\r\n\t\tvar taskID = this.workerNextTaskID ++;\r\n\t\tvar taskCost = buffer.byteLength;\r\n\r\n\t\t// Obtain a worker and assign a task, and construct a geometry instance\r\n\t\t// when the task completes.\r\n\t\tvar geometryPending = this._getWorker( taskID, taskCost )\r\n\t\t\t.then( ( _worker ) => {\r\n\r\n\t\t\t\tworker = _worker;\r\n\t\t\t\treturn new Promise( ( resolve, reject ) => {\r\n\r\n\t\t\t\t\tworker._callbacks[ taskID ] = { resolve, reject };\r\n\r\n\t\t\t\t\tworker.postMessage( { type: 'decode', id: taskID, taskConfig, buffer }, [ buffer ] );\r\n\r\n\t\t\t\t\t// this.debug();\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t} )\r\n\t\t\t.then( ( message ) => this._createGeometry( message.geometry ) );\r\n\r\n\t\t// Remove task from the task list.\r\n\t\t// Note: replaced '.finally()' with '.catch().then()' block - iOS 11 support (#19416)\r\n\t\tgeometryPending\r\n\t\t\t.catch( () => true )\r\n\t\t\t.then( () => {\r\n\r\n\t\t\t\tif ( worker && taskID ) {\r\n\r\n\t\t\t\t\tthis._releaseTask( worker, taskID );\r\n\r\n\t\t\t\t\t// this.debug();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t// Cache the task result.\r\n\t\tDRACOLoader.taskCache.set( buffer, {\r\n\r\n\t\t\tkey: taskKey,\r\n\t\t\tpromise: geometryPending\r\n\r\n\t\t} );\r\n\r\n\t\treturn geometryPending;\r\n\r\n\t},\r\n\r\n\t_createGeometry: function ( geometryData ) {\r\n\r\n\t\tvar geometry = new BufferGeometry();\r\n\r\n\t\tif ( geometryData.index ) {\r\n\r\n\t\t\tgeometry.setIndex( new BufferAttribute( geometryData.index.array, 1 ) );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0; i < geometryData.attributes.length; i ++ ) {\r\n\r\n\t\t\tvar attribute = geometryData.attributes[ i ];\r\n\t\t\tvar name = attribute.name;\r\n\t\t\tvar array = attribute.array;\r\n\t\t\tvar itemSize = attribute.itemSize;\r\n\r\n\t\t\tgeometry.setAttribute( name, new BufferAttribute( array, itemSize ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn geometry;\r\n\r\n\t},\r\n\r\n\t_loadLibrary: function ( url, responseType ) {\r\n\r\n\t\tvar loader = new FileLoader( this.manager );\r\n\t\tloader.setPath( this.decoderPath );\r\n\t\tloader.setResponseType( responseType );\r\n\t\tloader.setWithCredentials( this.withCredentials );\r\n\r\n\t\treturn new Promise( ( resolve, reject ) => {\r\n\r\n\t\t\tloader.load( url, resolve, undefined, reject );\r\n\r\n\t\t} );\r\n\r\n\t},\r\n\r\n\tpreload: function () {\r\n\r\n\t\tthis._initDecoder();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\t_initDecoder: function () {\r\n\r\n\t\tif ( this.decoderPending ) return this.decoderPending;\r\n\r\n\t\tvar useJS = typeof WebAssembly !== 'object' || this.decoderConfig.type === 'js';\r\n\t\tvar librariesPending = [];\r\n\r\n\t\tif ( useJS ) {\r\n\r\n\t\t\tlibrariesPending.push( this._loadLibrary( 'draco_decoder.js', 'text' ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tlibrariesPending.push( this._loadLibrary( 'draco_wasm_wrapper.js', 'text' ) );\r\n\t\t\tlibrariesPending.push( this._loadLibrary( 'draco_decoder.wasm', 'arraybuffer' ) );\r\n\r\n\t\t}\r\n\r\n\t\tthis.decoderPending = Promise.all( librariesPending )\r\n\t\t\t.then( ( libraries ) => {\r\n\r\n\t\t\t\tvar jsContent = libraries[ 0 ];\r\n\r\n\t\t\t\tif ( ! useJS ) {\r\n\r\n\t\t\t\t\tthis.decoderConfig.wasmBinary = libraries[ 1 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar fn = DRACOLoader.DRACOWorker.toString();\r\n\r\n\t\t\t\tvar body = [\r\n\t\t\t\t\t'/* draco decoder */',\r\n\t\t\t\t\tjsContent,\r\n\t\t\t\t\t'',\r\n\t\t\t\t\t'/* worker */',\r\n\t\t\t\t\tfn.substring( fn.indexOf( '{' ) + 1, fn.lastIndexOf( '}' ) )\r\n\t\t\t\t].join( '\\n' );\r\n\r\n\t\t\t\tthis.workerSourceURL = URL.createObjectURL( new Blob( [ body ] ) );\r\n\r\n\t\t\t} );\r\n\r\n\t\treturn this.decoderPending;\r\n\r\n\t},\r\n\r\n\t_getWorker: function ( taskID, taskCost ) {\r\n\r\n\t\treturn this._initDecoder().then( () => {\r\n\r\n\t\t\tif ( this.workerPool.length < this.workerLimit ) {\r\n\r\n\t\t\t\tvar worker = new Worker( this.workerSourceURL );\r\n\r\n\t\t\t\tworker._callbacks = {};\r\n\t\t\t\tworker._taskCosts = {};\r\n\t\t\t\tworker._taskLoad = 0;\r\n\r\n\t\t\t\tworker.postMessage( { type: 'init', decoderConfig: this.decoderConfig } );\r\n\r\n\t\t\t\tworker.onmessage = function ( e ) {\r\n\r\n\t\t\t\t\tvar message = e.data;\r\n\r\n\t\t\t\t\tswitch ( message.type ) {\r\n\r\n\t\t\t\t\t\tcase 'decode':\r\n\t\t\t\t\t\t\tworker._callbacks[ message.id ].resolve( message );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 'error':\r\n\t\t\t\t\t\t\tworker._callbacks[ message.id ].reject( message );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tconsole.error( 'THREE.DRACOLoader: Unexpected message, \"' + message.type + '\"' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t\tthis.workerPool.push( worker );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.workerPool.sort( function ( a, b ) {\r\n\r\n\t\t\t\t\treturn a._taskLoad > b._taskLoad ? - 1 : 1;\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar worker = this.workerPool[ this.workerPool.length - 1 ];\r\n\t\t\tworker._taskCosts[ taskID ] = taskCost;\r\n\t\t\tworker._taskLoad += taskCost;\r\n\t\t\treturn worker;\r\n\r\n\t\t} );\r\n\r\n\t},\r\n\r\n\t_releaseTask: function ( worker, taskID ) {\r\n\r\n\t\tworker._taskLoad -= worker._taskCosts[ taskID ];\r\n\t\tdelete worker._callbacks[ taskID ];\r\n\t\tdelete worker._taskCosts[ taskID ];\r\n\r\n\t},\r\n\r\n\tdebug: function () {\r\n\r\n\t\tconsole.log( 'Task load: ', this.workerPool.map( ( worker ) => worker._taskLoad ) );\r\n\r\n\t},\r\n\r\n\tdispose: function () {\r\n\r\n\t\tfor ( var i = 0; i < this.workerPool.length; ++ i ) {\r\n\r\n\t\t\tthis.workerPool[ i ].terminate();\r\n\r\n\t\t}\r\n\r\n\t\tthis.workerPool.length = 0;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n} );\r\n\r\n/* WEB WORKER */\r\n\r\nDRACOLoader.DRACOWorker = function () {\r\n\r\n\tvar decoderConfig;\r\n\tvar decoderPending;\r\n\r\n\tonmessage = function ( e ) {\r\n\r\n\t\tvar message = e.data;\r\n\r\n\t\tswitch ( message.type ) {\r\n\r\n\t\t\tcase 'init':\r\n\t\t\t\tdecoderConfig = message.decoderConfig;\r\n\t\t\t\tdecoderPending = new Promise(resolve => {\r\n\t\t\t\t\tdecoderConfig.onModuleLoaded = function ( draco ) {\r\n\r\n\t\t\t\t\t\t// Module is Promise-like. Wrap before resolving to avoid loop.\r\n\t\t\t\t\t\tresolve( { draco: draco } );\r\n\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tDracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef\r\n\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'decode':\r\n\t\t\t\tvar buffer = message.buffer;\r\n\t\t\t\tvar taskConfig = message.taskConfig;\r\n\t\t\t\tdecoderPending.then( ( module ) => {\r\n\r\n\t\t\t\t\tvar draco = module.draco;\r\n\t\t\t\t\tvar decoder = new draco.Decoder();\r\n\t\t\t\t\tvar decoderBuffer = new draco.DecoderBuffer();\r\n\t\t\t\t\tdecoderBuffer.Init( new Int8Array( buffer ), buffer.byteLength );\r\n\r\n\t\t\t\t\ttry {\r\n\r\n\t\t\t\t\t\tvar geometry = decodeGeometry( draco, decoder, decoderBuffer, taskConfig );\r\n\r\n\t\t\t\t\t\tvar buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );\r\n\r\n\t\t\t\t\t\tif ( geometry.index ) buffers.push( geometry.index.array.buffer );\r\n\r\n\t\t\t\t\t\tself.postMessage( { type: 'decode', id: message.id, geometry }, buffers );\r\n\r\n\t\t\t\t\t} catch ( error ) {\r\n\r\n\t\t\t\t\t\tconsole.error( error );\r\n\r\n\t\t\t\t\t\tself.postMessage( { type: 'error', id: message.id, error: error.message } );\r\n\r\n\t\t\t\t\t} finally {\r\n\r\n\t\t\t\t\t\tdraco.destroy( decoderBuffer );\r\n\t\t\t\t\t\tdraco.destroy( decoder );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tfunction decodeGeometry( draco, decoder, decoderBuffer, taskConfig ) {\r\n\r\n\t\tvar attributeIDs = taskConfig.attributeIDs;\r\n\t\tvar attributeTypes = taskConfig.attributeTypes;\r\n\r\n\t\tvar dracoGeometry;\r\n\t\tvar decodingStatus;\r\n\r\n\t\tvar geometryType = decoder.GetEncodedGeometryType( decoderBuffer );\r\n\r\n\t\tif ( geometryType === draco.TRIANGULAR_MESH ) {\r\n\r\n\t\t\tdracoGeometry = new draco.Mesh();\r\n\t\t\tdecodingStatus = decoder.DecodeBufferToMesh( decoderBuffer, dracoGeometry );\r\n\r\n\t\t} else if ( geometryType === draco.POINT_CLOUD ) {\r\n\r\n\t\t\tdracoGeometry = new draco.PointCloud();\r\n\t\t\tdecodingStatus = decoder.DecodeBufferToPointCloud( decoderBuffer, dracoGeometry );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthrow new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );\r\n\r\n\t\t}\r\n\r\n\t\tvar geometry = { index: null, attributes: [] };\r\n\r\n\t\t// Gather all vertex attributes.\r\n\t\tfor ( var attributeName in attributeIDs ) {\r\n\r\n\t\t\tvar attributeType = self[ attributeTypes[ attributeName ] ];\r\n\r\n\t\t\tvar attribute;\r\n\t\t\tvar attributeID;\r\n\r\n\t\t\t// A Draco file may be created with default vertex attributes, whose attribute IDs\r\n\t\t\t// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,\r\n\t\t\t// a Draco file may contain a custom set of attributes, identified by known unique\r\n\t\t\t// IDs. glTF files always do the latter, and `.drc` files typically do the former.\r\n\t\t\tif ( taskConfig.useUniqueIDs ) {\r\n\r\n\t\t\t\tattributeID = attributeIDs[ attributeName ];\r\n\t\t\t\tattribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tattributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );\r\n\r\n\t\t\t\tif ( attributeID === - 1 ) continue;\r\n\r\n\t\t\t\tattribute = decoder.GetAttribute( dracoGeometry, attributeID );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.attributes.push( decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) );\r\n\r\n\t\t}\r\n\r\n\t\t// Add index.\r\n\t\tif ( geometryType === draco.TRIANGULAR_MESH ) {\r\n\r\n\t\t\tgeometry.index = decodeIndex( draco, decoder, dracoGeometry );\r\n\r\n\t\t}\r\n\r\n\t\tdraco.destroy( dracoGeometry );\r\n\r\n\t\treturn geometry;\r\n\r\n\t}\r\n\r\n\tfunction decodeIndex( draco, decoder, dracoGeometry ) {\r\n\r\n\t\tvar numFaces = dracoGeometry.num_faces();\r\n\t\tvar numIndices = numFaces * 3;\r\n\t\tvar byteLength = numIndices * 4;\r\n\r\n\t\tvar ptr = draco._malloc( byteLength );\r\n\t\tdecoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );\r\n\t\tvar index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();\r\n\t\tdraco._free( ptr );\r\n\r\n\t\treturn { array: index, itemSize: 1 };\r\n\r\n\t}\r\n\r\n\tfunction decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {\r\n\r\n\t\tvar numComponents = attribute.num_components();\r\n\t\tvar numPoints = dracoGeometry.num_points();\r\n\t\tvar numValues = numPoints * numComponents;\r\n\t\tvar byteLength = numValues * attributeType.BYTES_PER_ELEMENT;\r\n\t\tvar dataType = getDracoDataType( draco, attributeType );\r\n\r\n\t\tvar ptr = draco._malloc( byteLength );\r\n\t\tdecoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );\r\n\t\tvar array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();\r\n\t\tdraco._free( ptr );\r\n\r\n\t\treturn {\r\n\t\t\tname: attributeName,\r\n\t\t\tarray: array,\r\n\t\t\titemSize: numComponents\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tfunction getDracoDataType( draco, attributeType ) {\r\n\r\n\t\tswitch ( attributeType ) {\r\n\r\n\t\t\tcase Float32Array: return draco.DT_FLOAT32;\r\n\t\t\tcase Int8Array: return draco.DT_INT8;\r\n\t\t\tcase Int16Array: return draco.DT_INT16;\r\n\t\t\tcase Int32Array: return draco.DT_INT32;\r\n\t\t\tcase Uint8Array: return draco.DT_UINT8;\r\n\t\t\tcase Uint16Array: return draco.DT_UINT16;\r\n\t\t\tcase Uint32Array: return draco.DT_UINT32;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nDRACOLoader.taskCache = new WeakMap();\r\n\r\n/** Deprecated static methods */\r\n\r\n/** @deprecated */\r\nDRACOLoader.setDecoderPath = function () {\r\n\r\n\tconsole.warn( 'THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.' );\r\n\r\n};\r\n\r\n/** @deprecated */\r\nDRACOLoader.setDecoderConfig = function () {\r\n\r\n\tconsole.warn( 'THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.' );\r\n\r\n};\r\n\r\n/** @deprecated */\r\nDRACOLoader.releaseDecoderModule = function () {\r\n\r\n\tconsole.warn( 'THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.' );\r\n\r\n};\r\n\r\n/** @deprecated */\r\nDRACOLoader.getDecoderModule = function () {\r\n\r\n\tconsole.warn( 'THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.' );\r\n\r\n};\r\n\r\nexport { DRACOLoader };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/loaders/DRACOLoader.js","<template>\r\n    <div class=\"webglAnimationKeyframes-container\">\r\n        <div id=\"container\"></div>\r\n\r\n\t\t<div id=\"info\">\r\n\t\t\t<a href=\"https://threejs.org\" target=\"_blank\" rel=\"noopener\">three.js</a> webgl - animation - keyframes<br/>\r\n\t\t\tModel: <a href=\"https://www.artstation.com/artwork/1AGwX\" target=\"_blank\" rel=\"noopener\">Littlest Tokyo</a> by\r\n\t\t\t<a href=\"https://www.artstation.com/glenatron\" target=\"_blank\" rel=\"noopener\">Glen Fox</a>, CC Attribution.\r\n\t\t</div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { OrbitControls } from '@/components/jsm/controls/OrbitControls.js'\r\nimport { GLTFLoader } from '@/components/jsm/loaders/GLTFLoader.js'\r\nimport { DRACOLoader } from '@/components/jsm/loaders/DRACOLoader.js'\r\nexport default {\r\n    data() {\r\n        return {\r\n            mixer: null,\r\n            clock: null,\r\n            container: null,\r\n            stats: null,\r\n            renderer: null,\r\n            scene: null,\r\n            camera: null,\r\n            dirLight: null\r\n        }\r\n    },\r\n    mounted() {\r\n        this.clock = new this.$THREE.Clock()\r\n        this.init()\r\n    },\r\n    methods: {\r\n        init() {\r\n            this.container = document.getElementById('container')\r\n            this.stats = new this.$Stats()\r\n            this.container.appendChild(this.stats.dom)\r\n            this.renderer = new this.$THREE.WebGLRenderer({antialias: true})\r\n            this.renderer.setPixelRatio(window.devicePixelRatio)\r\n            this.renderer.setSize(window.innerWidth, window.innerHeight)\r\n            this.renderer.outputEncoding = this.$THREE.sRGBEncoding\r\n            this.container.appendChild(this.renderer.domElement)\r\n            this.scene = new this.$THREE.Scene()\r\n            this.scene.background = new this.$THREE.Color(0xbfe3dd)\r\n            this.camera = new this.$THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 100)\r\n            this.camera.position.set(5, 2, 8)\r\n            this.controls = new OrbitControls(this.camera, this.renderer.domElement)\r\n            this.controls.target.set(0, 0.5, 0)\r\n            this.controls.update()\r\n            this.controls.enablePan = false\r\n            this.controls.enableDamping = true\r\n            this.scene.add(new this.$THREE.HemisphereLight(0xffffff, 0x000000, 0.4))\r\n            this.dirLight = new this.$THREE.DirectionalLight(0xffffff, 1)\r\n            this.dirLight.position.set(5, 2, 8)\r\n            this.scene.add(this.dirLight)\r\n            // envmap\r\n\t\t\tvar path = 'static/textures/cube/Park2/'\r\n\t\t\tvar format = '.jpg'\r\n\t\t\tconst envMap = new this.$THREE.CubeTextureLoader().load([\r\n\t\t\t\tpath + 'posx' + format, path + 'negx' + format,\r\n\t\t\t\tpath + 'posy' + format, path + 'negy' + format,\r\n\t\t\t\tpath + 'posz' + format, path + 'negz' + format\r\n            ])\r\n\t\t\tvar dracoLoader = new DRACOLoader()\r\n            dracoLoader.setDecoderPath('static/js/libs/draco/gltf/')\r\n            var loader = new GLTFLoader()\r\n            loader.setDRACOLoader(dracoLoader)\r\n\t\t\tloader.load('static/models/gltf/LittlestTokyo.glb', (gltf) => {\r\n\t\t\t\tvar model = gltf.scene\r\n\t\t\t\tmodel.position.set(1, 1, 0)\r\n\t\t\t\tmodel.scale.set(0.01, 0.01, 0.01)\r\n\t\t\t\tmodel.traverse(function (child) {\r\n\t\t\t\t\tif (child.isMesh) child.material.envMap = envMap\r\n                })\r\n                var that = this\r\n\t\t\t\tthat.scene.add(model)\r\n\t\t\t\tthat.mixer = new that.$THREE.AnimationMixer(model)\r\n\t\t\t\tthat.mixer.clipAction(gltf.animations[0]).play()\r\n\t\t\t\tthat.animate()\r\n\t\t\t}, undefined, function(e) {\r\n\t\t\t\tconsole.error(e)\r\n\t\t\t})\r\n        },\r\n        onresize() {\r\n            this.camera.aspect = window.innerWidth / window.innerHeight\r\n            this.camera.updateProjectionMatrix()\r\n            this.renderer.setSize(window.innerWidth, window.innerHeight)\r\n        },\r\n        animate() {\r\n            requestAnimationFrame(this.animate)\r\n            var delta = this.clock.getDelta()\r\n            this.mixer.update(delta)\r\n            this.controls.update()\r\n            this.stats.update()\r\n            this.renderer.render(this.scene, this.camera)\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.webglAnimationKeyframes-container {\r\n    background-color: #bfe3dd;\r\n\tcolor: #000;\r\n}\r\na {\r\n    color: #2983ff;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/views/animation/webglAnimationKeyframes.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"webglAnimationKeyframes-container\"},[_c('div',{attrs:{\"id\":\"container\"}}),_vm._v(\" \"),_c('div',{attrs:{\"id\":\"info\"}},[_c('a',{attrs:{\"href\":\"https://threejs.org\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"three.js\")]),_vm._v(\" webgl - animation - keyframes\"),_c('br'),_vm._v(\"\\n\\t\\t\\tModel: \"),_c('a',{attrs:{\"href\":\"https://www.artstation.com/artwork/1AGwX\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"Littlest Tokyo\")]),_vm._v(\" by\\n\\t\\t\\t\"),_c('a',{attrs:{\"href\":\"https://www.artstation.com/glenatron\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"Glen Fox\")]),_vm._v(\", CC Attribution.\\n\\t\\t\")])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-7db00cfa\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/animation/webglAnimationKeyframes.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-7db00cfa\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./webglAnimationKeyframes.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglAnimationKeyframes.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglAnimationKeyframes.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-7db00cfa\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./webglAnimationKeyframes.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-7db00cfa\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/animation/webglAnimationKeyframes.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}