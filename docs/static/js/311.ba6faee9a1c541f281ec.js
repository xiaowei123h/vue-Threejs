webpackJsonp([311],{"7l2+":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("wIBv"),o=i("FktL"),a={data:function(){return{container:null,stats:null,camera:null,controls:null,scene:null,renderer:null,textureLoader:null,clock:null,clickRequest:!1,mouseCoords:null,raycaster:null,ballMaterial:null,pos:null,quat:null,gravityConstant:-9.8,physicsWorld:null,rigidBodies:[],softBodies:[],margin:.05,transformAux1:null,softBodyHelpers:null}},mounted:function(){var t=this;this.clock=new this.$THREE.Clock,this.mouseCoords=new this.$THREE.Vector2,this.raycaster=new this.$THREE.Raycaster,this.ballMaterial=new this.$THREE.MeshPhongMaterial({color:2105376}),this.pos=new this.$THREE.Vector3,this.quat=new this.$THREE.Quaternion,Ammo().then(function(e){Ammo=e,t.init(),t.animate()})},methods:{init:function(){this.initGraphics(),this.initPhysics(),this.createObjects(),this.initInput()},initGraphics:function(){this.container=document.getElementById("container"),this.camera=new this.$THREE.PerspectiveCamera(60,this.$webglInnerWidth/window.innerHeight,.2,2e3),this.scene=new this.$THREE.Scene,this.scene.background=new this.$THREE.Color(12571109),this.camera.position.set(-7,5,8),this.renderer=new this.$THREE.WebGLRenderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.$webglInnerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.container.appendChild(this.renderer.domElement),this.controls=new s.b(this.camera,this.renderer.domElement),this.controls.target.set(0,2,0),this.controls.update(),this.textureLoader=new this.$THREE.TextureLoader;var t=new this.$THREE.AmbientLight(4210752);this.scene.add(t);var e=new this.$THREE.DirectionalLight(16777215,1);e.position.set(-10,10,5),e.castShadow=!0;e.shadow.camera.left=-20,e.shadow.camera.right=20,e.shadow.camera.top=20,e.shadow.camera.bottom=-20,e.shadow.camera.near=2,e.shadow.camera.far=50,e.shadow.mapSize.x=1024,e.shadow.mapSize.y=1024,this.scene.add(e),this.stats=new this.$Stats,this.stats.dom.style.left="280px",this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.container.appendChild(this.stats.domElement),window.addEventListener("resize",this.onWindowResize,!1)},initPhysics:function(){var t=new Ammo.btSoftBodyRigidBodyCollisionConfiguration,e=new Ammo.btCollisionDispatcher(t),i=new Ammo.btDbvtBroadphase,s=new Ammo.btSequentialImpulseConstraintSolver,o=new Ammo.btDefaultSoftBodySolver;this.physicsWorld=new Ammo.btSoftRigidDynamicsWorld(e,i,s,t,o),this.physicsWorld.setGravity(new Ammo.btVector3(0,this.gravityConstant,0)),this.physicsWorld.getWorldInfo().set_m_gravity(new Ammo.btVector3(0,this.gravityConstant,0)),this.transformAux1=new Ammo.btTransform,this.softBodyHelpers=new Ammo.btSoftBodyHelpers},createObjects:function(){var t=this;this.pos.set(0,-.5,0),this.quat.set(0,0,0,1);var e=this.createParalellepiped(40,1,40,0,this.pos,this.quat,new this.$THREE.MeshPhongMaterial({color:16777215}));e.castShadow=!0,e.receiveShadow=!0,this.textureLoader.load("static/textures/grid.png",function(i){i.wrapS=t.$THREE.RepeatWrapping,i.wrapT=t.$THREE.RepeatWrapping,i.repeat.set(40,40),e.material.map=i,e.material.needsUpdate=!0});var i=new this.$THREE.SphereBufferGeometry(1.5,40,25);i.translate(5,5,0),this.createSoftVolume(i,15,250);var s=new this.$THREE.BoxBufferGeometry(1,1,5,4,4,20);s.translate(-2,5,0),this.createSoftVolume(s,15,120),this.pos.set(3,1,0),this.quat.setFromAxisAngle(new this.$THREE.Vector3(0,0,1),30*Math.PI/180);var o=this.createParalellepiped(10,1,4,0,this.pos,this.quat,new this.$THREE.MeshPhongMaterial({color:6316128}));o.castShadow=!0,o.receiveShadow=!0},processGeometry:function(t){var e=new this.$THREE.BufferGeometry;e.setAttribute("position",t.getAttribute("position")),e.setIndex(t.getIndex());var i=o.a.mergeVertices(e);this.mapIndices(t,i)},isEqual:function(t,e,i,s,o,a){return Math.abs(s-t)<1e-6&&Math.abs(o-e)<1e-6&&Math.abs(a-i)<1e-6},mapIndices:function(t,e){var i=t.attributes.position.array,s=e.attributes.position.array,o=e.index.array,a=s.length/3,r=i.length/3;t.ammoVertices=s,t.ammoIndices=o,t.ammoIndexAssociation=[];for(var n=0;n<a;n++){var h=[];t.ammoIndexAssociation.push(h);for(var c=3*n,d=0;d<r;d++){var l=3*d;this.isEqual(s[c],s[c+1],s[c+2],i[l],i[l+1],i[l+2])&&h.push(l)}}},createSoftVolume:function(t,e,i){this.processGeometry(t);var s=new this.$THREE.Mesh(t,new this.$THREE.MeshPhongMaterial({color:16777215}));s.castShadow=!0,s.receiveShadow=!0,s.frustumCulled=!1,this.scene.add(s),this.textureLoader.load("static/textures/colors.png",function(t){s.material.map=t,s.material.needsUpdate=!0});var o=this.softBodyHelpers.CreateFromTriMesh(this.physicsWorld.getWorldInfo(),t.ammoVertices,t.ammoIndices,t.ammoIndices.length/3,!0),a=o.get_m_cfg();a.set_viterations(40),a.set_piterations(40),a.set_collisions(17),a.set_kDF(.1),a.set_kDP(.01),a.set_kPR(i),o.get_m_materials().at(0).set_m_kLST(.9),o.get_m_materials().at(0).set_m_kAST(.9),o.setTotalMass(e,!1),Ammo.castObject(o,Ammo.btCollisionObject).getCollisionShape().setMargin(this.margin),this.physicsWorld.addSoftBody(o,1,-1),s.userData.physicsBody=o,o.setActivationState(4),this.softBodies.push(s)},createParalellepiped:function(t,e,i,s,o,a,r){var n=new this.$THREE.Mesh(new this.$THREE.BoxBufferGeometry(t,e,i,1,1,1),r),h=new Ammo.btBoxShape(new Ammo.btVector3(.5*t,.5*e,.5*i));return h.setMargin(this.margin),this.createRigidBody(n,h,s,o,a),n},createRigidBody:function(t,e,i,s,o){t.position.copy(s),t.quaternion.copy(o);var a=new Ammo.btTransform;a.setIdentity(),a.setOrigin(new Ammo.btVector3(s.x,s.y,s.z)),a.setRotation(new Ammo.btQuaternion(o.x,o.y,o.z,o.w));var r=new Ammo.btDefaultMotionState(a),n=new Ammo.btVector3(0,0,0);e.calculateLocalInertia(i,n);var h=new Ammo.btRigidBodyConstructionInfo(i,r,e,n),c=new Ammo.btRigidBody(h);return t.userData.physicsBody=c,this.scene.add(t),i>0&&(this.rigidBodies.push(t),c.setActivationState(4)),this.physicsWorld.addRigidBody(c),c},initInput:function(){var t=this;window.addEventListener("pointerdown",function(e){t.clickRequest||(t.mouseCoords.set(e.clientX/(window.innerWidth+281)*2-1,-e.clientY/window.innerHeight*2+1),t.clickRequest=!0)},!1)},processClick:function(){if(this.clickRequest){this.raycaster.setFromCamera(this.mouseCoords,this.camera);var t=new this.$THREE.Mesh(new this.$THREE.SphereBufferGeometry(.4,18,16),this.ballMaterial);t.castShadow=!0,t.receiveShadow=!0;var e=new Ammo.btSphereShape(.4);e.setMargin(this.margin),this.pos.copy(this.raycaster.ray.direction),this.pos.add(this.raycaster.ray.origin),this.quat.set(0,0,0,1);var i=this.createRigidBody(t,e,3,this.pos,this.quat);i.setFriction(.5),this.pos.copy(this.raycaster.ray.direction),this.pos.multiplyScalar(14),i.setLinearVelocity(new Ammo.btVector3(this.pos.x,this.pos.y,this.pos.z)),this.clickRequest=!1}},onWindowResize:function(){this.$onWindowResize(this.camera,this.renderer)},animate:function(){requestAnimationFrame(this.animate),this.render(),this.stats.update()},render:function(){var t=this.clock.getDelta();this.updatePhysics(t),this.processClick(),this.renderer.render(this.scene,this.camera)},updatePhysics:function(t){this.physicsWorld.stepSimulation(t,10);for(var e=0,i=this.softBodies.length;e<i;e++){for(var s=this.softBodies[e],o=s.geometry,a=s.userData.physicsBody,r=o.attributes.position.array,n=o.attributes.normal.array,h=o.ammoIndexAssociation,c=h.length,d=a.get_m_nodes(),l=0;l<c;l++)for(var m=d.at(l),u=m.get_m_x(),p=u.x(),w=u.y(),f=u.z(),y=m.get_m_n(),g=y.x(),E=y.y(),v=y.z(),b=h[l],R=0,A=b.length;R<A;R++){var S=b[R];r[S]=p,n[S]=g,r[++S]=w,n[S]=E,r[++S]=f,n[S]=v}o.attributes.position.needsUpdate=!0,o.attributes.normal.needsUpdate=!0}for(e=0,i=this.rigidBodies.length;e<i;e++){var B=this.rigidBodies[e],x=B.userData.physicsBody.getMotionState();if(x){x.getWorldTransform(this.transformAux1);var T=this.transformAux1.getOrigin(),H=this.transformAux1.getRotation();B.position.set(T.x(),T.y(),T.z()),B.quaternion.set(H.x(),H.y(),H.z(),H.w())}}}}},r={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"physicsAmmoVolume-container"},[e("div",{attrs:{id:"info"}},[this._v("\n\t\t\tAmmo.js physics soft body volume demo"),e("br"),this._v("\n\t\t\tClick to throw a ball\n\t\t")]),this._v(" "),e("div",{attrs:{id:"container"}})])}]};var n=i("VU/8")(a,r,!1,function(t){i("S8KZ")},"data-v-1c594f1b",null);e.default=n.exports},S8KZ:function(t,e){}});
//# sourceMappingURL=311.ba6faee9a1c541f281ec.js.map