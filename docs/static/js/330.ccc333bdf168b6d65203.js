webpackJsonp([330],{J4Ly:function(t,e){},ZQn3:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("wIBv"),r={data:function(){return{terrainWidthExtents:100,terrainDepthExtents:100,terrainWidth:128,terrainDepth:128,terrainHalfWidth:null,terrainHalfDepth:null,terrainMaxHeight:8,terrainMinHeight:-2,container:null,stats:null,camera:null,scene:null,renderer:null,terrainMesh:null,clock:null,collisionConfiguration:null,dispatcher:null,broadphase:null,solver:null,physicsWorld:null,dynamicObjects:[],transformAux1:null,heightData:null,ammoHeightData:null,time:0,objectTimePeriod:3,timeNextSpawn:null,maxNumObjects:30}},mounted:function(){var t=this;this.clock=new this.$THREE.Clock,this.terrainHalfWidth=this.terrainWidth/2,this.terrainHalfDepth=this.terrainDepth/2,this.timeNextSpawn=this.time+this.objectTimePeriod,Ammo().then(function(e){Ammo=e,t.init(),t.animate()})},methods:{init:function(){this.heightData=this.generateHeight(this.terrainWidth,this.terrainDepth,this.terrainMinHeight,this.terrainMaxHeight),this.initGraphics(),this.initPhysics()},initGraphics:function(){var t=this;this.container=document.getElementById("container"),this.renderer=new this.$THREE.WebGLRenderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.$webglInnerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.container.appendChild(this.renderer.domElement),this.stats=new this.$Stats,this.stats.dom.style.left="280px",this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.container.appendChild(this.stats.domElement),this.camera=new this.$THREE.PerspectiveCamera(60,this.$webglInnerWidth/window.innerHeight,.2,2e3),this.scene=new this.$THREE.Scene,this.scene.background=new this.$THREE.Color(12571109),this.camera.position.y=this.heightData[this.terrainHalfWidth+this.terrainHalfDepth*this.terrainWidth]*(this.terrainMaxHeight-this.terrainMinHeight)+5,this.camera.position.z=this.terrainDepthExtents/2,this.camera.lookAt(0,0,0),new a.b(this.camera,this.renderer.domElement).enableZoom=!1;var e=new this.$THREE.PlaneBufferGeometry(this.terrainWidthExtents,this.terrainDepthExtents,this.terrainWidth-1,this.terrainDepth-1);e.rotateX(-Math.PI/2);for(var i=e.attributes.position.array,r=0,n=0,s=i.length;r<s;r++,n+=3)i[n+1]=this.heightData[r];e.computeVertexNormals();var h=new this.$THREE.MeshPhongMaterial({color:13092807});this.terrainMesh=new this.$THREE.Mesh(e,h),this.terrainMesh.receiveShadow=!0,this.terrainMesh.castShadow=!0,this.scene.add(this.terrainMesh),(new this.$THREE.TextureLoader).load("static/textures/grid.png",function(e){e.wrapS=t.$THREE.RepeatWrapping,e.wrapT=t.$THREE.RepeatWrapping,e.repeat.set(t.terrainWidth-1,t.terrainDepth-1),h.map=e,h.needsUpdate=!0});var o=new this.$THREE.DirectionalLight(16777215,1);o.position.set(100,100,50),o.castShadow=!0;o.shadow.camera.left=-50,o.shadow.camera.right=50,o.shadow.camera.top=50,o.shadow.camera.bottom=-50,o.shadow.camera.near=200/30,o.shadow.camera.far=200,o.shadow.mapSize.x=2048,o.shadow.mapSize.y=2048,this.scene.add(o),window.addEventListener("resize",this.onWindowResize,!1)},onWindowResize:function(){this.$onWindowResize(this.camera,this.renderer)},initPhysics:function(){this.collisionConfiguration=new Ammo.btDefaultCollisionConfiguration,this.dispatcher=new Ammo.btCollisionDispatcher(this.collisionConfiguration),this.broadphase=new Ammo.btDbvtBroadphase,this.solver=new Ammo.btSequentialImpulseConstraintSolver,this.physicsWorld=new Ammo.btDiscreteDynamicsWorld(this.dispatcher,this.broadphase,this.solver,this.collisionConfiguration),this.physicsWorld.setGravity(new Ammo.btVector3(0,-6,0));var t=this.createTerrainShape(),e=new Ammo.btTransform;e.setIdentity(),e.setOrigin(new Ammo.btVector3(0,(this.terrainMaxHeight+this.terrainMinHeight)/2,0));var i=new Ammo.btVector3(0,0,0),a=new Ammo.btDefaultMotionState(e),r=new Ammo.btRigidBody(new Ammo.btRigidBodyConstructionInfo(0,a,t,i));this.physicsWorld.addRigidBody(r),this.transformAux1=new Ammo.btTransform},generateHeight:function(t,e,i,a){for(var r=new Float32Array(t*e),n=a-i,s=t/2,h=e/2,o=0,m=0;m<e;m++)for(var d=0;d<t;d++){var c=Math.sqrt(Math.pow((d-s)/s,2)+Math.pow((m-h)/h,2)),l=.5*(Math.sin(12*c)+1)*n+i;r[o]=l,o++}return r},createTerrainShape:function(){this.ammoHeightData=Ammo._malloc(4*this.terrainWidth*this.terrainDepth);for(var t=0,e=0,i=0;i<this.terrainDepth;i++)for(var a=0;a<this.terrainWidth;a++)Ammo.HEAPF32[this.ammoHeightData+e>>2]=this.heightData[t],t++,e+=4;var r=new Ammo.btHeightfieldTerrainShape(this.terrainWidth,this.terrainDepth,this.ammoHeightData,1,this.terrainMinHeight,this.terrainMaxHeight,1,"PHY_FLOAT",!1),n=this.terrainWidthExtents/(this.terrainWidth-1),s=this.terrainDepthExtents/(this.terrainDepth-1);return r.setLocalScaling(new Ammo.btVector3(n,1,s)),r.setMargin(.05),r},generateObject:function(){var t,e,i=null,a=null;switch(Math.ceil(4*Math.random())){case 1:t=1+3*Math.random(),i=new this.$THREE.Mesh(new this.$THREE.SphereBufferGeometry(t,20,20),this.createObjectMaterial()),(a=new Ammo.btSphereShape(t)).setMargin(.05);break;case 2:var r=1+3*Math.random(),n=1+3*Math.random(),s=1+3*Math.random();i=new this.$THREE.Mesh(new this.$THREE.BoxBufferGeometry(r,n,s,1,1,1),this.createObjectMaterial()),(a=new Ammo.btBoxShape(new Ammo.btVector3(.5*r,.5*n,.5*s))).setMargin(.05);break;case 3:t=1+3*Math.random(),e=1+3*Math.random(),i=new this.$THREE.Mesh(new this.$THREE.CylinderBufferGeometry(t,t,e,20,1),this.createObjectMaterial()),(a=new Ammo.btCylinderShape(new Ammo.btVector3(t,.5*e,t))).setMargin(.05);break;default:t=1+3*Math.random(),e=2+3*Math.random(),i=new this.$THREE.Mesh(new this.$THREE.ConeBufferGeometry(t,e,20,2),this.createObjectMaterial()),a=new Ammo.btConeShape(t,e)}i.position.set((Math.random()-.5)*this.terrainWidth*.6,this.terrainMaxHeight+3+2,(Math.random()-.5)*this.terrainDepth*.6);var h=new Ammo.btVector3(0,0,0);a.calculateLocalInertia(15,h);var o=new Ammo.btTransform;o.setIdentity();var m=i.position;o.setOrigin(new Ammo.btVector3(m.x,m.y,m.z));var d=new Ammo.btDefaultMotionState(o),c=new Ammo.btRigidBodyConstructionInfo(15,d,a,h),l=new Ammo.btRigidBody(c);i.userData.physicsBody=l,i.receiveShadow=!0,i.castShadow=!0,this.scene.add(i),this.dynamicObjects.push(i),this.physicsWorld.addRigidBody(l)},createObjectMaterial:function(){var t=Math.floor(Math.random()*(1<<24));return new this.$THREE.MeshPhongMaterial({color:t})},animate:function(){requestAnimationFrame(this.animate),this.render(),this.stats.update()},render:function(){var t=this.clock.getDelta();this.dynamicObjects.length<this.maxNumObjects&&this.time>this.timeNextSpawn&&(this.generateObject(),this.timeNextSpawn=this.time+this.objectTimePeriod),this.updatePhysics(t),this.renderer.render(this.scene,this.camera),this.time+=t},updatePhysics:function(t){this.physicsWorld.stepSimulation(t,10);for(var e=0,i=this.dynamicObjects.length;e<i;e++){var a=this.dynamicObjects[e],r=a.userData.physicsBody.getMotionState();if(r){r.getWorldTransform(this.transformAux1);var n=this.transformAux1.getOrigin(),s=this.transformAux1.getRotation();a.position.set(n.x(),n.y(),n.z()),a.quaternion.set(s.x(),s.y(),s.z(),s.w())}}}}},n={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"physicsAmmoTerrain-container"},[e("div",{attrs:{id:"container"}}),this._v(" "),e("div",{attrs:{id:"info"}},[this._v("Ammo.js physics terrain heightfield demo")])])}]};var s=i("VU/8")(r,n,!1,function(t){i("J4Ly")},"data-v-109edab3",null);e.default=s.exports}});
//# sourceMappingURL=330.ccc333bdf168b6d65203.js.map