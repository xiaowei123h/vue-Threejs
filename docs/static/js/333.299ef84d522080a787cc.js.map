{"version":3,"sources":["webpack:///./src/components/jsm/loaders/XLoader.js","webpack:///src/views/loader/webglLoaderX.vue","webpack:///./src/views/loader/webglLoaderX.vue?90e1","webpack:///./src/views/loader/webglLoaderX.vue"],"names":["classCallCheck","createClass","XAnimationInfo","XAnimationObj","XKeyFrameInfo","XLoader","instance","Constructor","TypeError","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","this","animeName","boneName","targetBone","keyType","frameStartLv","keyFrames","InverseMx","_flags","fps","name","hierarchy","putFlags","undefined","putPos","putRot","putScl","value","XAnimationInfoArray","push","makeBonekeys","keys","time","assign","refObj","parent","keyFrameRefactor","copy","keyframe","pos","rot","scl","matrix","Vector3","setFromMatrixPosition","Quaternion","setFromRotationMatrix","setFromMatrixScale","index","Frame","manager","Loader","call","debug","texloader","TextureLoader","url","_putMatLength","_nowMat","_nowFrameName","frameHierarchie","Hierarchies","HieStack","_currentObject","_currentFrame","_data","onLoad","IsUvYReverse","Meshes","animations","animTicksPerSecond","_currentGeo","_currentAnime","_currentAnimeFrames","_arg","_start","arguments","options","onProgress","onError","_this","_setArgOption","loader","FileLoader","setPath","path","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","load","response","parse","e","console","error","itemError","line","readed","find","indexOf","foundNewLine","substr","binData","reader","DataView","getUint32","byteLength","fileLength","getUint8","buf","array_buffer","Uint8Array","charCodeAt","buffer","LoaderUtils","decodeText","data","_ensureBinary","_ensureString","_isBinary","_parseBinary","_parseASCII","resourcePath","extractUrlBase","setCrossOrigin","crossOrigin","children","_hierarchieParse","_changeRoot","shift","_mainloop","_parent","_end","endRead","find1","findEnd","findNext","nameData","_readLine","trim","word","split","type","refs","end","DataEnder","lastIndexOf","Math","min","nextStart","max","_refs","_this2","_mainProc","worked","setTimeout","models","breakFlag","parseInt","_setFrame","_setFrameTransformMatrix","parentName","_getParentName","VertexSetedBoneCount","GeometryData","vertices","normals","uvs","skinIndices","skinWeights","indices","materialIndices","Materials","normalVectors","BoneInfs","baseFrame","_makeBoneFrom_CurrentFrame","_readVertexDatas","_setMeshTextureCoords","_setMeshMaterialList","_setMaterial","_setSkinWeights","AnimeFrames","_readAnimationKey","log","_makeOutputGeometry","_makeOutputAnimation","_obj","FrameTransformMatrix","Matrix4","_ParseMatrixData","b","Bone","applyMatrix4","matrixWorld","putBone","frame","add","mode","mode_local","maxLength","changeMode","_readInt1","_readVertex1","_readFace1","_readNormalVector1","start","refI","parseFloat","bufferGeometry","BufferGeometry","position","l","stride2","stride3","stride4","setAttribute","Float32BufferAttribute","Uint16BufferAttribute","_computeGroups","group","groups","materialIndex","currentMaterialIndex","count","MeshPhongMaterial","color","random","side","FrontSide","r","g","shininess","data2","specular","data3","emissive","localObject","fileName","map","bumpMap","bumpScale","normalMap","normalScale","Vector2","emissiveMap","lightMap","boneInf","XboneInf","BoneIndex","Indeces","Weights","initMatrix","OffsetMatrix","_i","_RootName","_bones","putting","toArray","rotq","mesh","putBones","_makePutBoneList","bi","boneIndex","bb","vi","nowVertexID","nowVal","stride","sk","skinning","offsetList","_bi","_buildGeometry","SkinnedMesh","_initSkeleton","_bufferGeometry","Mesh","worldBaseMx","currentMxFrame","multiply","boneList","boneInverses","bone","gbone","il","bones","fromArray","quaternion","scale","updateMatrixWorld","skeleton","Skeleton","bind","nowKeyType","keyInfo","frameFound","mm","frameValue","animationObj","make","_model","_animation","model","animation","put","findAnimation","c_key","_c_key","k","set","geometry","AnimationClip","parseAnimation","animationMixer","AnimationMixer","targetMatrix","webglLoaderX","container","stats","controls","camera","scene","renderer","clock","skeletonHelper","animates","actions","Models","mounted","$moduleTHREE","Clock","init","methods","xhr","lengthComputable","percentComplete","loaded","total","round","document","createElement","getElementsByClassName","appendChild","Scene","AmbientLight","gridHelper","GridHelper","$Stats","dom","style","left","WebGLRenderer","setPixelRatio","window","devicePixelRatio","setSize","$webglInnerWidth","innerHeight","setClearColor","domElement","PerspectiveCamera","up","OrbitControls","update","light","DirectionalLight","normalize","light2","addEventListener","onWindowResize","animate","LoadingManager","item","XLoader_XLoader","object","x","loadAnimation","SkeletonHelper","play","getElementById","mech1_changeAnime","$onWindowResize","requestAnimationFrame","delta","getDelta","render","modelId","_callback","loader2","assignAnimation","clipAction","setLoop","LoopOnce","clampWhenFinished","event","_this3","val","forEach","p","stop","loader_webglLoaderX","$createElement","_self","_c","_m","staticRenderFns","_vm","_h","staticClass","attrs","id","href","_v","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/333.299ef84d522080a787cc.js","sourcesContent":["import {\r\n\tAnimationClip,\r\n\tAnimationMixer,\r\n\tBone,\r\n\tBufferGeometry,\r\n\tFileLoader,\r\n\tFloat32BufferAttribute,\r\n\tFrontSide,\r\n\tLoader,\r\n\tLoaderUtils,\r\n\tMatrix4,\r\n\tMesh,\r\n\tMeshPhongMaterial,\r\n\tQuaternion,\r\n\tSkeleton,\r\n\tSkinnedMesh,\r\n\tTextureLoader,\r\n\tUint16BufferAttribute,\r\n\tVector2,\r\n\tVector3\r\n} from \"@/components/build/three.module.js\";\r\n\r\nvar XLoader = ( function () {\r\n\r\n\tvar classCallCheck = function ( instance, Constructor ) {\r\n\r\n\t\tif ( ! ( instance instanceof Constructor ) ) {\r\n\r\n\t\t\tthrow new TypeError( \"Cannot call a class as a function\" );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tvar createClass = function () {\r\n\r\n\t\tfunction defineProperties( target, props ) {\r\n\r\n\t\t\tfor ( var i = 0; i < props.length; i ++ ) {\r\n\r\n\t\t\t\tvar descriptor = props[ i ];\r\n\t\t\t\tdescriptor.enumerable = descriptor.enumerable || false;\r\n\t\t\t\tdescriptor.configurable = true;\r\n\t\t\t\tif ( \"value\" in descriptor ) descriptor.writable = true;\r\n\t\t\t\tObject.defineProperty( target, descriptor.key, descriptor );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn function ( Constructor, protoProps, staticProps ) {\r\n\r\n\t\t\tif ( protoProps ) defineProperties( Constructor.prototype, protoProps );\r\n\t\t\tif ( staticProps ) defineProperties( Constructor, staticProps );\r\n\t\t\treturn Constructor;\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\tvar XboneInf = function XboneInf() {\r\n\r\n\t\tclassCallCheck( this, XboneInf );\r\n\r\n\t\tthis.boneName = \"\";\r\n\t\tthis.BoneIndex = 0;\r\n\t\tthis.Indeces = [];\r\n\t\tthis.Weights = [];\r\n\t\tthis.initMatrix = null;\r\n\t\tthis.OffsetMatrix = null;\r\n\r\n\t};\r\n\r\n\tvar XAnimationInfo = function XAnimationInfo() {\r\n\r\n\t\tclassCallCheck( this, XAnimationInfo );\r\n\r\n\t\tthis.animeName = \"\";\r\n\t\tthis.boneName = \"\";\r\n\t\tthis.targetBone = null;\r\n\t\tthis.keyType = 4;\r\n\t\tthis.frameStartLv = 0;\r\n\t\tthis.keyFrames = [];\r\n\t\tthis.InverseMx = null;\r\n\r\n\t};\r\n\r\n\tvar XAnimationObj = function () {\r\n\r\n\t\tfunction XAnimationObj( _flags ) {\r\n\r\n\t\t\tclassCallCheck( this, XAnimationObj );\r\n\r\n\t\t\tthis.fps = 30;\r\n\t\t\tthis.name = 'xanimation';\r\n\t\t\tthis.length = 0;\r\n\t\t\tthis.hierarchy = [];\r\n\t\t\tthis.putFlags = _flags;\r\n\t\t\tif ( this.putFlags.putPos === undefined ) {\r\n\r\n\t\t\t\tthis.putFlags.putPos = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.putFlags.putRot === undefined ) {\r\n\r\n\t\t\t\tthis.putFlags.putRot = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.putFlags.putScl === undefined ) {\r\n\r\n\t\t\t\tthis.putFlags.putScl = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tcreateClass( XAnimationObj, [ {\r\n\t\t\tkey: \"make\",\r\n\t\t\tvalue: function make( XAnimationInfoArray ) {\r\n\r\n\t\t\t\tfor ( var i = 0; i < XAnimationInfoArray.length; i ++ ) {\r\n\r\n\t\t\t\t\tthis.hierarchy.push( this.makeBonekeys( XAnimationInfoArray[ i ] ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.length = this.hierarchy[ 0 ].keys[ this.hierarchy[ 0 ].keys.length - 1 ].time;\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: \"clone\",\r\n\t\t\tvalue: function clone() {\r\n\r\n\t\t\t\treturn Object.assign( {}, this );\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: \"makeBonekeys\",\r\n\t\t\tvalue: function makeBonekeys( XAnimationInfo ) {\r\n\r\n\t\t\t\tvar refObj = {};\r\n\t\t\t\trefObj.name = XAnimationInfo.boneName;\r\n\t\t\t\trefObj.parent = \"\";\r\n\t\t\t\trefObj.keys = this.keyFrameRefactor( XAnimationInfo );\r\n\t\t\t\trefObj.copy = function () {\r\n\r\n\t\t\t\t\treturn Object.assign( {}, this );\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn refObj;\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: \"keyFrameRefactor\",\r\n\t\t\tvalue: function keyFrameRefactor( XAnimationInfo ) {\r\n\r\n\t\t\t\tvar keys = [];\r\n\t\t\t\tfor ( var i = 0; i < XAnimationInfo.keyFrames.length; i ++ ) {\r\n\r\n\t\t\t\t\tvar keyframe = {};\r\n\t\t\t\t\tkeyframe.time = XAnimationInfo.keyFrames[ i ].time * this.fps;\r\n\t\t\t\t\tif ( XAnimationInfo.keyFrames[ i ].pos && this.putFlags.putPos ) {\r\n\r\n\t\t\t\t\t\tkeyframe.pos = XAnimationInfo.keyFrames[ i ].pos;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( XAnimationInfo.keyFrames[ i ].rot && this.putFlags.putRot ) {\r\n\r\n\t\t\t\t\t\tkeyframe.rot = XAnimationInfo.keyFrames[ i ].rot;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( XAnimationInfo.keyFrames[ i ].scl && this.putFlags.putScl ) {\r\n\r\n\t\t\t\t\t\tkeyframe.scl = XAnimationInfo.keyFrames[ i ].scl;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( XAnimationInfo.keyFrames[ i ].matrix ) {\r\n\r\n\t\t\t\t\t\tkeyframe.matrix = XAnimationInfo.keyFrames[ i ].matrix;\r\n\t\t\t\t\t\tif ( this.putFlags.putPos ) {\r\n\r\n\t\t\t\t\t\t\tkeyframe.pos = new Vector3().setFromMatrixPosition( keyframe.matrix );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( this.putFlags.putRot ) {\r\n\r\n\t\t\t\t\t\t\tkeyframe.rot = new Quaternion().setFromRotationMatrix( keyframe.matrix );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( this.putFlags.putScl ) {\r\n\r\n\t\t\t\t\t\t\tkeyframe.scl = new Vector3().setFromMatrixScale( keyframe.matrix );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tkeys.push( keyframe );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn keys;\r\n\r\n\t\t\t}\r\n\t\t} ] );\r\n\t\treturn XAnimationObj;\r\n\r\n\t}();\r\n\r\n\tvar XKeyFrameInfo = function XKeyFrameInfo() {\r\n\r\n\t\tclassCallCheck( this, XKeyFrameInfo );\r\n\r\n\t\tthis.index = 0;\r\n\t\tthis.Frame = 0;\r\n\t\tthis.time = 0.0;\r\n\t\tthis.matrix = null;\r\n\r\n\t};\r\n\r\n\tvar XLoader = function () {\r\n\r\n\t\tfunction XLoader( manager ) {\r\n\r\n\t\t\tLoader.call( this, manager );\r\n\r\n\t\t\tclassCallCheck( this, XLoader );\r\n\r\n\t\t\tthis.debug = false;\r\n\t\t\tthis.texloader = new TextureLoader( this.manager );\r\n\t\t\tthis.url = \"\";\r\n\t\t\tthis._putMatLength = 0;\r\n\t\t\tthis._nowMat = null;\r\n\t\t\tthis._nowFrameName = \"\";\r\n\t\t\tthis.frameHierarchie = [];\r\n\t\t\tthis.Hierarchies = {};\r\n\t\t\tthis.HieStack = [];\r\n\t\t\tthis._currentObject = {};\r\n\t\t\tthis._currentFrame = {};\r\n\t\t\tthis._data = null;\r\n\t\t\tthis.onLoad = null;\r\n\t\t\tthis.IsUvYReverse = true;\r\n\t\t\tthis.Meshes = [];\r\n\t\t\tthis.animations = [];\r\n\t\t\tthis.animTicksPerSecond = 30;\r\n\t\t\tthis._currentGeo = null;\r\n\t\t\tthis._currentAnime = null;\r\n\t\t\tthis._currentAnimeFrames = null;\r\n\r\n\t\t}\r\n\r\n\t\tcreateClass( XLoader, [ {\r\n\t\t\tkey: '_setArgOption',\r\n\t\t\tvalue: function _setArgOption( _arg ) {\r\n\r\n\t\t\t\tvar _start = arguments.length > 1 && arguments[ 1 ] !== undefined ? arguments[ 1 ] : 0;\r\n\r\n\t\t\t\tif ( ! _arg ) {\r\n\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( var i = _start; i < _arg.length; i ++ ) {\r\n\r\n\t\t\t\t\tswitch ( i ) {\r\n\r\n\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\tthis.url = _arg[ i ];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\tthis.options = _arg[ i ];\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( this.options === undefined ) {\r\n\r\n\t\t\t\t\tthis.options = {};\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: 'load',\r\n\t\t\tvalue: function load( _arg, onLoad, onProgress, onError ) {\r\n\r\n\t\t\t\tvar _this = this;\r\n\r\n\t\t\t\tthis._setArgOption( _arg );\r\n\t\t\t\tvar loader = new FileLoader( this.manager );\r\n\t\t\t\tloader.setPath( this.path );\r\n\t\t\t\tloader.setResponseType( 'arraybuffer' );\r\n\t\t\t\tloader.setRequestHeader( this.requestHeader );\r\n\t\t\t\tloader.setWithCredentials( this.withCredentials );\r\n\t\t\t\tloader.load( this.url, function ( response ) {\r\n\r\n\t\t\t\t\ttry {\r\n\r\n\t\t\t\t\t\t_this.parse( response, onLoad );\r\n\r\n\t\t\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\t\t\tif ( onError ) {\r\n\r\n\t\t\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_this.manager.itemError( _this.url );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}, onProgress, onError );\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_readLine',\r\n\t\t\tvalue: function _readLine( line ) {\r\n\r\n\t\t\t\tvar readed = 0;\r\n\t\t\t\twhile ( true ) {\r\n\r\n\t\t\t\t\tvar find = - 1;\r\n\t\t\t\t\tfind = line.indexOf( '//', readed );\r\n\t\t\t\t\tif ( find === - 1 ) {\r\n\r\n\t\t\t\t\t\tfind = line.indexOf( '#', readed );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( find > - 1 && find < 2 ) {\r\n\r\n\t\t\t\t\t\tvar foundNewLine = - 1;\r\n\t\t\t\t\t\tfoundNewLine = line.indexOf( \"\\r\\n\", readed );\r\n\t\t\t\t\t\tif ( foundNewLine > 0 ) {\r\n\r\n\t\t\t\t\t\t\treaded = foundNewLine + 2;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tfoundNewLine = line.indexOf( \"\\r\", readed );\r\n\t\t\t\t\t\t\tif ( foundNewLine > 0 ) {\r\n\r\n\t\t\t\t\t\t\t\treaded = foundNewLine + 1;\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\treaded = line.indexOf( \"\\n\", readed ) + 1;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn line.substr( readed );\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_readLine',\r\n\t\t\tvalue: function _readLine( line ) {\r\n\r\n\t\t\t\tvar readed = 0;\r\n\t\t\t\twhile ( true ) {\r\n\r\n\t\t\t\t\tvar find = - 1;\r\n\t\t\t\t\tfind = line.indexOf( '//', readed );\r\n\t\t\t\t\tif ( find === - 1 ) {\r\n\r\n\t\t\t\t\t\tfind = line.indexOf( '#', readed );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( find > - 1 && find < 2 ) {\r\n\r\n\t\t\t\t\t\tvar foundNewLine = - 1;\r\n\t\t\t\t\t\tfoundNewLine = line.indexOf( \"\\r\\n\", readed );\r\n\t\t\t\t\t\tif ( foundNewLine > 0 ) {\r\n\r\n\t\t\t\t\t\t\treaded = foundNewLine + 2;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tfoundNewLine = line.indexOf( \"\\r\", readed );\r\n\t\t\t\t\t\t\tif ( foundNewLine > 0 ) {\r\n\r\n\t\t\t\t\t\t\t\treaded = foundNewLine + 1;\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\treaded = line.indexOf( \"\\n\", readed ) + 1;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn line.substr( readed );\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_isBinary',\r\n\t\t\tvalue: function _isBinary( binData ) {\r\n\r\n\t\t\t\tvar reader = new DataView( binData );\r\n\t\t\t\tvar face_size = 32 / 8 * 3 + 32 / 8 * 3 * 3 + 16 / 8;\r\n\t\t\t\tvar n_faces = reader.getUint32( 80, true );\r\n\t\t\t\tvar expect = 80 + 32 / 8 + n_faces * face_size;\r\n\t\t\t\tif ( expect === reader.byteLength ) {\r\n\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar fileLength = reader.byteLength;\r\n\t\t\t\tfor ( var index = 0; index < fileLength; index ++ ) {\r\n\r\n\t\t\t\t\tif ( reader.getUint8( index, false ) > 127 ) {\r\n\r\n\t\t\t\t\t\treturn true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_ensureBinary',\r\n\t\t\tvalue: function _ensureBinary( buf ) {\r\n\r\n\t\t\t\tif ( typeof buf === \"string\" ) {\r\n\r\n\t\t\t\t\tvar array_buffer = new Uint8Array( buf.length );\r\n\t\t\t\t\tfor ( var i = 0; i < buf.length; i ++ ) {\r\n\r\n\t\t\t\t\t\tarray_buffer[ i ] = buf.charCodeAt( i ) & 0xff;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn array_buffer.buffer || array_buffer;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\treturn buf;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_ensureString',\r\n\t\t\tvalue: function _ensureString( buf ) {\r\n\r\n\t\t\t\tif ( typeof buf !== \"string\" ) {\r\n\r\n\t\t\t\t\treturn LoaderUtils.decodeText( new Uint8Array( buf ) );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\treturn buf;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: 'parse',\r\n\t\t\tvalue: function _parse( data, onLoad ) {\r\n\r\n\t\t\t\tvar binData = this._ensureBinary( data );\r\n\t\t\t\tthis._data = this._ensureString( data );\r\n\t\t\t\tthis.onLoad = onLoad;\r\n\t\t\t\treturn this._isBinary( binData ) ? this._parseBinary( binData ) : this._parseASCII();\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_parseBinary',\r\n\t\t\tvalue: function _parseBinary( data ) {\r\n\r\n\t\t\t\treturn this._parseASCII( LoaderUtils.decodeText( new Uint8Array( data ) ) );\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_parseASCII',\r\n\t\t\tvalue: function _parseASCII() {\r\n\r\n\t\t\t\tvar path;\r\n\r\n\t\t\t\tif ( this.resourcePath !== '' ) {\r\n\r\n\t\t\t\t\tpath = this.resourcePath;\r\n\r\n\t\t\t\t} else if ( this.path !== '' ) {\r\n\r\n\t\t\t\t\tpath = this.path;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tpath = LoaderUtils.extractUrlBase( this.url );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.texloader.setPath( path ).setCrossOrigin( this.crossOrigin );\r\n\r\n\t\t\t\tvar endRead = 16;\r\n\t\t\t\tthis.Hierarchies.children = [];\r\n\t\t\t\tthis._hierarchieParse( this.Hierarchies, endRead );\r\n\t\t\t\tthis._changeRoot();\r\n\t\t\t\tthis._currentObject = this.Hierarchies.children.shift();\r\n\t\t\t\tthis._mainloop();\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_hierarchieParse',\r\n\t\t\tvalue: function _hierarchieParse( _parent, _end ) {\r\n\r\n\t\t\t\tvar endRead = _end;\r\n\t\t\t\twhile ( true ) {\r\n\r\n\t\t\t\t\tvar find1 = this._data.indexOf( '{', endRead ) + 1;\r\n\t\t\t\t\tvar findEnd = this._data.indexOf( '}', endRead );\r\n\t\t\t\t\tvar findNext = this._data.indexOf( '{', find1 ) + 1;\r\n\t\t\t\t\tif ( find1 > 0 && findEnd > find1 ) {\r\n\r\n\t\t\t\t\t\tvar _currentObject = {};\r\n\t\t\t\t\t\t_currentObject.children = [];\r\n\t\t\t\t\t\tvar nameData = this._readLine( this._data.substr( endRead, find1 - endRead - 1 ) ).trim();\r\n\t\t\t\t\t\tvar word = nameData.split( / /g );\r\n\t\t\t\t\t\tif ( word.length > 0 ) {\r\n\r\n\t\t\t\t\t\t\t_currentObject.type = word[ 0 ];\r\n\t\t\t\t\t\t\tif ( word.length >= 2 ) {\r\n\r\n\t\t\t\t\t\t\t\t_currentObject.name = word[ 1 ];\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\t_currentObject.name = word[ 0 ] + this.Hierarchies.children.length;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t_currentObject.name = nameData;\r\n\t\t\t\t\t\t\t_currentObject.type = \"\";\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( _currentObject.type === \"Animation\" ) {\r\n\r\n\t\t\t\t\t\t\t_currentObject.data = this._data.substr( findNext, findEnd - findNext ).trim();\r\n\t\t\t\t\t\t\tvar refs = this._hierarchieParse( _currentObject, findEnd + 1 );\r\n\t\t\t\t\t\t\tendRead = refs.end;\r\n\t\t\t\t\t\t\t_currentObject.children = refs.parent.children;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tvar DataEnder = this._data.lastIndexOf( ';', findNext > 0 ? Math.min( findNext, findEnd ) : findEnd );\r\n\t\t\t\t\t\t\t_currentObject.data = this._data.substr( find1, DataEnder - find1 ).trim();\r\n\t\t\t\t\t\t\tif ( findNext <= 0 || findEnd < findNext ) {\r\n\r\n\t\t\t\t\t\t\t\tendRead = findEnd + 1;\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\tvar nextStart = Math.max( DataEnder + 1, find1 );\r\n\t\t\t\t\t\t\t\tvar _refs = this._hierarchieParse( _currentObject, nextStart );\r\n\t\t\t\t\t\t\t\tendRead = _refs.end;\r\n\t\t\t\t\t\t\t\t_currentObject.children = _refs.parent.children;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_currentObject.parent = _parent;\r\n\t\t\t\t\t\tif ( _currentObject.type != \"template\" ) {\r\n\r\n\t\t\t\t\t\t\t_parent.children.push( _currentObject );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tendRead = find1 === - 1 ? this._data.length : findEnd + 1;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tparent: _parent,\r\n\t\t\t\t\tend: endRead\r\n\t\t\t\t};\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_mainloop',\r\n\t\t\tvalue: function _mainloop() {\r\n\r\n\t\t\t\tvar _this2 = this;\r\n\r\n\t\t\t\tthis._mainProc();\r\n\t\t\t\tif ( this._currentObject.parent || this._currentObject.children.length > 0 || ! this._currentObject.worked ) {\r\n\r\n\t\t\t\t\tsetTimeout( function () {\r\n\r\n\t\t\t\t\t\t_this2._mainloop();\r\n\r\n\t\t\t\t\t}, 1 );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tsetTimeout( function () {\r\n\r\n\t\t\t\t\t\t_this2.onLoad( {\r\n\t\t\t\t\t\t\tmodels: _this2.Meshes,\r\n\t\t\t\t\t\t\tanimations: _this2.animations\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t}, 1 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_mainProc',\r\n\t\t\tvalue: function _mainProc() {\r\n\r\n\t\t\t\tvar breakFlag = false;\r\n\t\t\t\twhile ( true ) {\r\n\r\n\t\t\t\t\tif ( ! this._currentObject.worked ) {\r\n\r\n\t\t\t\t\t\tswitch ( this._currentObject.type ) {\r\n\r\n\t\t\t\t\t\t\tcase \"template\":\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"AnimTicksPerSecond\":\r\n\t\t\t\t\t\t\t\tthis.animTicksPerSecond = parseInt( this._currentObject.data );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"Frame\":\r\n\t\t\t\t\t\t\t\tthis._setFrame();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"FrameTransformMatrix\":\r\n\t\t\t\t\t\t\t\tthis._setFrameTransformMatrix();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"Mesh\":\r\n\t\t\t\t\t\t\t\tthis._changeRoot();\r\n\t\t\t\t\t\t\t\tthis._currentGeo = {};\r\n\t\t\t\t\t\t\t\tthis._currentGeo.name = this._currentObject.name.trim();\r\n\t\t\t\t\t\t\t\tthis._currentGeo.parentName = this._getParentName( this._currentObject ).trim();\r\n\t\t\t\t\t\t\t\tthis._currentGeo.VertexSetedBoneCount = [];\r\n\t\t\t\t\t\t\t\tthis._currentGeo.GeometryData = {\r\n\t\t\t\t\t\t\t\t\tvertices: [],\r\n\t\t\t\t\t\t\t\t\tnormals: [],\r\n\t\t\t\t\t\t\t\t\tuvs: [],\r\n\t\t\t\t\t\t\t\t\tskinIndices: [],\r\n\t\t\t\t\t\t\t\t\tskinWeights: [],\r\n\t\t\t\t\t\t\t\t\tindices: [],\r\n\t\t\t\t\t\t\t\t\tmaterialIndices: []\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\tthis._currentGeo.Materials = [];\r\n\t\t\t\t\t\t\t\tthis._currentGeo.normalVectors = [];\r\n\t\t\t\t\t\t\t\tthis._currentGeo.BoneInfs = [];\r\n\t\t\t\t\t\t\t\tthis._currentGeo.baseFrame = this._currentFrame;\r\n\t\t\t\t\t\t\t\tthis._makeBoneFrom_CurrentFrame();\r\n\t\t\t\t\t\t\t\tthis._readVertexDatas();\r\n\t\t\t\t\t\t\t\tbreakFlag = true;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"MeshNormals\":\r\n\t\t\t\t\t\t\t\tthis._readVertexDatas();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"MeshTextureCoords\":\r\n\t\t\t\t\t\t\t\tthis._setMeshTextureCoords();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"VertexDuplicationIndices\":\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"MeshMaterialList\":\r\n\t\t\t\t\t\t\t\tthis._setMeshMaterialList();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"Material\":\r\n\t\t\t\t\t\t\t\tthis._setMaterial();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"SkinWeights\":\r\n\t\t\t\t\t\t\t\tthis._setSkinWeights();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"AnimationSet\":\r\n\t\t\t\t\t\t\t\tthis._changeRoot();\r\n\t\t\t\t\t\t\t\tthis._currentAnime = {};\r\n\t\t\t\t\t\t\t\tthis._currentAnime.name = this._currentObject.name.trim();\r\n\t\t\t\t\t\t\t\tthis._currentAnime.AnimeFrames = [];\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"Animation\":\r\n\t\t\t\t\t\t\t\tif ( this._currentAnimeFrames ) {\r\n\r\n\t\t\t\t\t\t\t\t\tthis._currentAnime.AnimeFrames.push( this._currentAnimeFrames );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tthis._currentAnimeFrames = new XAnimationInfo();\r\n\t\t\t\t\t\t\t\tthis._currentAnimeFrames.boneName = this._currentObject.data.trim();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"AnimationKey\":\r\n\t\t\t\t\t\t\t\tthis._readAnimationKey();\r\n\t\t\t\t\t\t\t\tbreakFlag = true;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis._currentObject.worked = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( this._currentObject.children.length > 0 ) {\r\n\r\n\t\t\t\t\t\tthis._currentObject = this._currentObject.children.shift();\r\n\t\t\t\t\t\tif ( this.debug ) {\r\n\r\n\t\t\t\t\t\t\tconsole.log( 'processing ' + this._currentObject.name );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( breakFlag ) break;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tif ( this._currentObject.worked ) {\r\n\r\n\t\t\t\t\t\t\tif ( this._currentObject.parent && ! this._currentObject.parent.parent ) {\r\n\r\n\t\t\t\t\t\t\t\tthis._changeRoot();\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( this._currentObject.parent ) {\r\n\r\n\t\t\t\t\t\t\tthis._currentObject = this._currentObject.parent;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tbreakFlag = true;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( breakFlag ) break;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_changeRoot',\r\n\t\t\tvalue: function _changeRoot() {\r\n\r\n\t\t\t\tif ( this._currentGeo != null && this._currentGeo.name ) {\r\n\r\n\t\t\t\t\tthis._makeOutputGeometry();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._currentGeo = {};\r\n\t\t\t\tif ( this._currentAnime != null && this._currentAnime.name ) {\r\n\r\n\t\t\t\t\tif ( this._currentAnimeFrames ) {\r\n\r\n\t\t\t\t\t\tthis._currentAnime.AnimeFrames.push( this._currentAnimeFrames );\r\n\t\t\t\t\t\tthis._currentAnimeFrames = null;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis._makeOutputAnimation();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._currentAnime = {};\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_getParentName',\r\n\t\t\tvalue: function _getParentName( _obj ) {\r\n\r\n\t\t\t\tif ( _obj.parent ) {\r\n\r\n\t\t\t\t\tif ( _obj.parent.name ) {\r\n\r\n\t\t\t\t\t\treturn _obj.parent.name;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\treturn this._getParentName( _obj.parent );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\treturn \"\";\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_setFrame',\r\n\t\t\tvalue: function _setFrame() {\r\n\r\n\t\t\t\tthis._nowFrameName = this._currentObject.name.trim();\r\n\t\t\t\tthis._currentFrame = {};\r\n\t\t\t\tthis._currentFrame.name = this._nowFrameName;\r\n\t\t\t\tthis._currentFrame.children = [];\r\n\t\t\t\tif ( this._currentObject.parent && this._currentObject.parent.name ) {\r\n\r\n\t\t\t\t\tthis._currentFrame.parentName = this._currentObject.parent.name;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.frameHierarchie.push( this._nowFrameName );\r\n\t\t\t\tthis.HieStack[ this._nowFrameName ] = this._currentFrame;\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_setFrameTransformMatrix',\r\n\t\t\tvalue: function _setFrameTransformMatrix() {\r\n\r\n\t\t\t\tthis._currentFrame.FrameTransformMatrix = new Matrix4();\r\n\t\t\t\tvar data = this._currentObject.data.split( \",\" );\r\n\t\t\t\tthis._ParseMatrixData( this._currentFrame.FrameTransformMatrix, data );\r\n\t\t\t\tthis._makeBoneFrom_CurrentFrame();\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_makeBoneFrom_CurrentFrame',\r\n\t\t\tvalue: function _makeBoneFrom_CurrentFrame() {\r\n\r\n\t\t\t\tif ( ! this._currentFrame.FrameTransformMatrix ) {\r\n\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar b = new Bone();\r\n\t\t\t\tb.name = this._currentFrame.name;\r\n\t\t\t\tb.applyMatrix4( this._currentFrame.FrameTransformMatrix );\r\n\t\t\t\tb.matrixWorld = b.matrix;\r\n\t\t\t\tb.FrameTransformMatrix = this._currentFrame.FrameTransformMatrix;\r\n\t\t\t\tthis._currentFrame.putBone = b;\r\n\t\t\t\tif ( this._currentFrame.parentName ) {\r\n\r\n\t\t\t\t\tfor ( var frame in this.HieStack ) {\r\n\r\n\t\t\t\t\t\tif ( this.HieStack[ frame ].name === this._currentFrame.parentName ) {\r\n\r\n\t\t\t\t\t\t\tthis.HieStack[ frame ].putBone.add( this._currentFrame.putBone );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_readVertexDatas',\r\n\t\t\tvalue: function _readVertexDatas() {\r\n\r\n\t\t\t\tvar endRead = 0;\r\n\t\t\t\tvar mode = 0;\r\n\t\t\t\tvar mode_local = 0;\r\n\t\t\t\tvar maxLength = 0;\r\n\t\t\t\twhile ( true ) {\r\n\r\n\t\t\t\t\tvar changeMode = false;\r\n\t\t\t\t\tif ( mode_local === 0 ) {\r\n\r\n\t\t\t\t\t\tvar refO = this._readInt1( endRead );\r\n\t\t\t\t\t\tendRead = refO.endRead;\r\n\t\t\t\t\t\tmode_local = 1;\r\n\t\t\t\t\t\tmaxLength = this._currentObject.data.indexOf( ';;', endRead ) + 1;\r\n\t\t\t\t\t\tif ( maxLength <= 0 ) {\r\n\r\n\t\t\t\t\t\t\tmaxLength = this._currentObject.data.length;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tvar find = 0;\r\n\t\t\t\t\t\tswitch ( mode ) {\r\n\r\n\t\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\t\tfind = this._currentObject.data.indexOf( ',', endRead ) + 1;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\t\tfind = this._currentObject.data.indexOf( ';,', endRead ) + 1;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( find === 0 || find > maxLength ) {\r\n\r\n\t\t\t\t\t\t\tfind = maxLength;\r\n\t\t\t\t\t\t\tmode_local = 0;\r\n\t\t\t\t\t\t\tchangeMode = true;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tswitch ( this._currentObject.type ) {\r\n\r\n\t\t\t\t\t\t\tcase \"Mesh\":\r\n\t\t\t\t\t\t\t\tswitch ( mode ) {\r\n\r\n\t\t\t\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\t\t\t\tthis._readVertex1( this._currentObject.data.substr( endRead, find - endRead ) );\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\t\t\t\tthis._readFace1( this._currentObject.data.substr( endRead, find - endRead ) );\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"MeshNormals\":\r\n\t\t\t\t\t\t\t\tswitch ( mode ) {\r\n\r\n\t\t\t\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\t\t\t\tthis._readNormalVector1( this._currentObject.data.substr( endRead, find - endRead ) );\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tendRead = find + 1;\r\n\t\t\t\t\t\tif ( changeMode ) {\r\n\r\n\t\t\t\t\t\t\tmode ++;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( endRead >= this._currentObject.data.length ) {\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_readInt1',\r\n\t\t\tvalue: function _readInt1( start ) {\r\n\r\n\t\t\t\tvar find = this._currentObject.data.indexOf( ';', start );\r\n\t\t\t\treturn {\r\n\t\t\t\t\trefI: parseInt( this._currentObject.data.substr( start, find - start ) ),\r\n\t\t\t\t\tendRead: find + 1\r\n\t\t\t\t};\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_readVertex1',\r\n\t\t\tvalue: function _readVertex1( line ) {\r\n\r\n\t\t\t\tvar data = this._readLine( line.trim() ).substr( 0, line.length - 2 ).split( \";\" );\r\n\t\t\t\tthis._currentGeo.GeometryData.vertices.push( parseFloat( data[ 0 ] ), parseFloat( data[ 1 ] ), parseFloat( data[ 2 ] ) );\r\n\t\t\t\tthis._currentGeo.GeometryData.skinIndices.push( 0, 0, 0, 0 );\r\n\t\t\t\tthis._currentGeo.GeometryData.skinWeights.push( 1, 0, 0, 0 );\r\n\t\t\t\tthis._currentGeo.VertexSetedBoneCount.push( 0 );\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_readFace1',\r\n\t\t\tvalue: function _readFace1( line ) {\r\n\r\n\t\t\t\tvar data = this._readLine( line.trim() ).substr( 2, line.length - 4 ).split( \",\" );\r\n\t\t\t\tthis._currentGeo.GeometryData.indices.push( parseInt( data[ 0 ], 10 ), parseInt( data[ 1 ], 10 ), parseInt( data[ 2 ], 10 ) );\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_readNormalVector1',\r\n\t\t\tvalue: function _readNormalVector1( line ) {\r\n\r\n\t\t\t\tvar data = this._readLine( line.trim() ).substr( 0, line.length - 2 ).split( \";\" );\r\n\t\t\t\tthis._currentGeo.GeometryData.normals.push( parseFloat( data[ 0 ] ), parseFloat( data[ 1 ] ), parseFloat( data[ 2 ] ) );\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_buildGeometry',\r\n\t\t\tvalue: function _buildGeometry() {\r\n\r\n\t\t\t\tvar bufferGeometry = new BufferGeometry();\r\n\t\t\t\tvar position = [];\r\n\t\t\t\tvar normals = [];\r\n\t\t\t\tvar uvs = [];\r\n\t\t\t\tvar skinIndices = [];\r\n\t\t\t\tvar skinWeights = [];\r\n\r\n\t\t\t\t//\r\n\r\n\t\t\t\tvar data = this._currentGeo.GeometryData;\r\n\r\n\t\t\t\tfor ( var i = 0, l = data.indices.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\tvar stride2 = data.indices[ i ] * 2;\r\n\t\t\t\t\tvar stride3 = data.indices[ i ] * 3;\r\n\t\t\t\t\tvar stride4 = data.indices[ i ] * 4;\r\n\r\n\t\t\t\t\tposition.push( data.vertices[ stride3 ], data.vertices[ stride3 + 1 ], data.vertices[ stride3 + 2 ] );\r\n\t\t\t\t\tnormals.push( data.normals[ stride3 ], data.normals[ stride3 + 1 ], data.normals[ stride3 + 2 ] );\r\n\t\t\t\t\tskinIndices.push( data.skinIndices[ stride4 ], data.skinIndices[ stride4 + 1 ], data.skinIndices[ stride4 + 2 ], data.skinIndices[ stride4 + 3 ] );\r\n\t\t\t\t\tskinWeights.push( data.skinWeights[ stride4 ], data.skinWeights[ stride4 + 1 ], data.skinWeights[ stride4 + 2 ], data.skinWeights[ stride4 + 3 ] );\r\n\t\t\t\t\tuvs.push( data.uvs[ stride2 ], data.uvs[ stride2 + 1 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//\r\n\r\n\t\t\t\tbufferGeometry.setAttribute( 'position', new Float32BufferAttribute( position, 3 ) );\r\n\t\t\t\tbufferGeometry.setAttribute( 'normal', new Float32BufferAttribute( normals, 3 ) );\r\n\t\t\t\tbufferGeometry.setAttribute( 'uv', new Float32BufferAttribute( uvs, 2 ) );\r\n\t\t\t\tbufferGeometry.setAttribute( 'skinIndex', new Uint16BufferAttribute( skinIndices, 4 ) );\r\n\t\t\t\tbufferGeometry.setAttribute( 'skinWeight', new Float32BufferAttribute( skinWeights, 4 ) );\r\n\r\n\t\t\t\tthis._computeGroups( bufferGeometry, data.materialIndices );\r\n\r\n\t\t\t\treturn bufferGeometry;\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_computeGroups',\r\n\t\t\tvalue: function _computeGroups( bufferGeometry, materialIndices ) {\r\n\r\n\t\t\t\tvar group;\r\n\t\t\t\tvar groups = [];\r\n\t\t\t\tvar materialIndex = undefined;\r\n\r\n\t\t\t\tfor ( var i = 0; i < materialIndices.length; i ++ ) {\r\n\r\n\t\t\t\t\tvar currentMaterialIndex = materialIndices[ i ];\r\n\r\n\t\t\t\t\tif ( currentMaterialIndex !== materialIndex ) {\r\n\r\n\t\t\t\t\t\tmaterialIndex = currentMaterialIndex;\r\n\r\n\t\t\t\t\t\tif ( group !== undefined ) {\r\n\r\n\t\t\t\t\t\t\tgroup.count = ( i * 3 ) - group.start;\r\n\t\t\t\t\t\t\tgroups.push( group );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tgroup = {\r\n\t\t\t\t\t\t\tstart: i * 3,\r\n\t\t\t\t\t\t\tmaterialIndex: materialIndex\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( group !== undefined ) {\r\n\r\n\t\t\t\t\tgroup.count = ( i * 3 ) - group.start;\r\n\t\t\t\t\tgroups.push( group );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbufferGeometry.groups = groups;\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_setMeshTextureCoords',\r\n\t\t\tvalue: function _setMeshTextureCoords() {\r\n\r\n\t\t\t\tvar endRead = 0;\r\n\t\t\t\tvar mode = 0;\r\n\t\t\t\tvar mode_local = 0;\r\n\t\t\t\twhile ( true ) {\r\n\r\n\t\t\t\t\tswitch ( mode ) {\r\n\r\n\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\tif ( mode_local === 0 ) {\r\n\r\n\t\t\t\t\t\t\t\tvar refO = this._readInt1( 0 );\r\n\t\t\t\t\t\t\t\tendRead = refO.endRead;\r\n\t\t\t\t\t\t\t\tmode_local = 1;\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\tvar find = this._currentObject.data.indexOf( ',', endRead ) + 1;\r\n\t\t\t\t\t\t\t\tif ( find === 0 ) {\r\n\r\n\t\t\t\t\t\t\t\t\tfind = this._currentObject.data.length;\r\n\t\t\t\t\t\t\t\t\tmode = 2;\r\n\t\t\t\t\t\t\t\t\tmode_local = 0;\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tvar line = this._currentObject.data.substr( endRead, find - endRead );\r\n\t\t\t\t\t\t\t\tvar data = this._readLine( line.trim() ).split( \";\" );\r\n\t\t\t\t\t\t\t\tif ( this.IsUvYReverse ) {\r\n\r\n\t\t\t\t\t\t\t\t\tthis._currentGeo.GeometryData.uvs.push( parseFloat( data[ 0 ] ), 1 - parseFloat( data[ 1 ] ) );\r\n\r\n\t\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\t\tthis._currentGeo.GeometryData.uvs.push( parseFloat( data[ 0 ] ), parseFloat( data[ 1 ] ) );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tendRead = find + 1;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( endRead >= this._currentObject.data.length ) {\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_setMeshMaterialList',\r\n\t\t\tvalue: function _setMeshMaterialList() {\r\n\r\n\t\t\t\tvar endRead = 0;\r\n\t\t\t\tvar mode = 0;\r\n\t\t\t\tvar mode_local = 0;\r\n\t\t\t\twhile ( true ) {\r\n\r\n\t\t\t\t\tif ( mode_local < 2 ) {\r\n\r\n\t\t\t\t\t\tvar refO = this._readInt1( endRead );\r\n\t\t\t\t\t\tendRead = refO.endRead;\r\n\t\t\t\t\t\tmode_local ++;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tvar find = this._currentObject.data.indexOf( ';', endRead );\r\n\t\t\t\t\t\tif ( find === - 1 ) {\r\n\r\n\t\t\t\t\t\t\tfind = this._currentObject.data.length;\r\n\t\t\t\t\t\t\tmode = 3;\r\n\t\t\t\t\t\t\tmode_local = 0;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar line = this._currentObject.data.substr( endRead, find - endRead );\r\n\t\t\t\t\t\tvar data = this._readLine( line.trim() ).split( \",\" );\r\n\t\t\t\t\t\tfor ( var i = 0; i < data.length; i ++ ) {\r\n\r\n\t\t\t\t\t\t\tthis._currentGeo.GeometryData.materialIndices[ i ] = parseInt( data[ i ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tendRead = this._currentObject.data.length;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( endRead >= this._currentObject.data.length || mode >= 3 ) {\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_setMaterial',\r\n\t\t\tvalue: function _setMaterial() {\r\n\r\n\t\t\t\tvar _nowMat = new MeshPhongMaterial( {\r\n\t\t\t\t\tcolor: Math.random() * 0xffffff\r\n\t\t\t\t} );\r\n\t\t\t\t_nowMat.side = FrontSide;\r\n\t\t\t\t_nowMat.name = this._currentObject.name;\r\n\t\t\t\tvar endRead = 0;\r\n\t\t\t\tvar find = this._currentObject.data.indexOf( ';;', endRead );\r\n\t\t\t\tvar line = this._currentObject.data.substr( endRead, find - endRead );\r\n\t\t\t\tvar data = this._readLine( line.trim() ).split( \";\" );\r\n\t\t\t\t_nowMat.color.r = parseFloat( data[ 0 ] );\r\n\t\t\t\t_nowMat.color.g = parseFloat( data[ 1 ] );\r\n\t\t\t\t_nowMat.color.b = parseFloat( data[ 2 ] );\r\n\t\t\t\tendRead = find + 2;\r\n\t\t\t\tfind = this._currentObject.data.indexOf( ';', endRead );\r\n\t\t\t\tline = this._currentObject.data.substr( endRead, find - endRead );\r\n\t\t\t\t_nowMat.shininess = parseFloat( this._readLine( line ) );\r\n\t\t\t\tendRead = find + 1;\r\n\t\t\t\tfind = this._currentObject.data.indexOf( ';;', endRead );\r\n\t\t\t\tline = this._currentObject.data.substr( endRead, find - endRead );\r\n\t\t\t\tvar data2 = this._readLine( line.trim() ).split( \";\" );\r\n\t\t\t\t_nowMat.specular.r = parseFloat( data2[ 0 ] );\r\n\t\t\t\t_nowMat.specular.g = parseFloat( data2[ 1 ] );\r\n\t\t\t\t_nowMat.specular.b = parseFloat( data2[ 2 ] );\r\n\t\t\t\tendRead = find + 2;\r\n\t\t\t\tfind = this._currentObject.data.indexOf( ';;', endRead );\r\n\t\t\t\tif ( find === - 1 ) {\r\n\r\n\t\t\t\t\tfind = this._currentObject.data.length;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tline = this._currentObject.data.substr( endRead, find - endRead );\r\n\t\t\t\tvar data3 = this._readLine( line.trim() ).split( \";\" );\r\n\t\t\t\t_nowMat.emissive.r = parseFloat( data3[ 0 ] );\r\n\t\t\t\t_nowMat.emissive.g = parseFloat( data3[ 1 ] );\r\n\t\t\t\t_nowMat.emissive.b = parseFloat( data3[ 2 ] );\r\n\t\t\t\tvar localObject = null;\r\n\t\t\t\twhile ( true ) {\r\n\r\n\t\t\t\t\tif ( this._currentObject.children.length > 0 ) {\r\n\r\n\t\t\t\t\t\tlocalObject = this._currentObject.children.shift();\r\n\t\t\t\t\t\tif ( this.debug ) {\r\n\r\n\t\t\t\t\t\t\tconsole.log( 'processing ' + localObject.name );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar fileName = localObject.data.substr( 1, localObject.data.length - 2 );\r\n\t\t\t\t\t\tswitch ( localObject.type ) {\r\n\r\n\t\t\t\t\t\t\tcase \"TextureFilename\":\r\n\t\t\t\t\t\t\t\t_nowMat.map = this.texloader.load( fileName );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"BumpMapFilename\":\r\n\t\t\t\t\t\t\t\t_nowMat.bumpMap = this.texloader.load( fileName );\r\n\t\t\t\t\t\t\t\t_nowMat.bumpScale = 0.05;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"NormalMapFilename\":\r\n\t\t\t\t\t\t\t\t_nowMat.normalMap = this.texloader.load( fileName );\r\n\t\t\t\t\t\t\t\t_nowMat.normalScale = new Vector2( 2, 2 );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"EmissiveMapFilename\":\r\n\t\t\t\t\t\t\t\t_nowMat.emissiveMap = this.texloader.load( fileName );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"LightMapFilename\":\r\n\t\t\t\t\t\t\t\t_nowMat.lightMap = this.texloader.load( fileName );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._currentGeo.Materials.push( _nowMat );\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_setSkinWeights',\r\n\t\t\tvalue: function _setSkinWeights() {\r\n\r\n\t\t\t\tvar boneInf = new XboneInf();\r\n\t\t\t\tvar endRead = 0;\r\n\t\t\t\tvar find = this._currentObject.data.indexOf( ';', endRead );\r\n\t\t\t\tvar line = this._currentObject.data.substr( endRead, find - endRead );\r\n\t\t\t\tendRead = find + 1;\r\n\t\t\t\tboneInf.boneName = line.substr( 1, line.length - 2 );\r\n\t\t\t\tboneInf.BoneIndex = this._currentGeo.BoneInfs.length;\r\n\t\t\t\tfind = this._currentObject.data.indexOf( ';', endRead );\r\n\t\t\t\tendRead = find + 1;\r\n\t\t\t\tfind = this._currentObject.data.indexOf( ';', endRead );\r\n\t\t\t\tline = this._currentObject.data.substr( endRead, find - endRead );\r\n\t\t\t\tvar data = this._readLine( line.trim() ).split( \",\" );\r\n\t\t\t\tfor ( var i = 0; i < data.length; i ++ ) {\r\n\r\n\t\t\t\t\tboneInf.Indeces.push( parseInt( data[ i ] ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tendRead = find + 1;\r\n\t\t\t\tfind = this._currentObject.data.indexOf( ';', endRead );\r\n\t\t\t\tline = this._currentObject.data.substr( endRead, find - endRead );\r\n\t\t\t\tvar data2 = this._readLine( line.trim() ).split( \",\" );\r\n\t\t\t\tfor ( var _i = 0; _i < data2.length; _i ++ ) {\r\n\r\n\t\t\t\t\tboneInf.Weights.push( parseFloat( data2[ _i ] ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tendRead = find + 1;\r\n\t\t\t\tfind = this._currentObject.data.indexOf( ';', endRead );\r\n\t\t\t\tif ( find <= 0 ) {\r\n\r\n\t\t\t\t\tfind = this._currentObject.data.length;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tline = this._currentObject.data.substr( endRead, find - endRead );\r\n\t\t\t\tvar data3 = this._readLine( line.trim() ).split( \",\" );\r\n\t\t\t\tboneInf.OffsetMatrix = new Matrix4();\r\n\t\t\t\tthis._ParseMatrixData( boneInf.OffsetMatrix, data3 );\r\n\t\t\t\tthis._currentGeo.BoneInfs.push( boneInf );\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_makePutBoneList',\r\n\t\t\tvalue: function _makePutBoneList( _RootName, _bones ) {\r\n\r\n\t\t\t\tvar putting = false;\r\n\t\t\t\tfor ( var frame in this.HieStack ) {\r\n\r\n\t\t\t\t\tif ( this.HieStack[ frame ].name === _RootName || putting ) {\r\n\r\n\t\t\t\t\t\tputting = true;\r\n\t\t\t\t\t\tvar b = new Bone();\r\n\t\t\t\t\t\tb.name = this.HieStack[ frame ].name;\r\n\t\t\t\t\t\tb.applyMatrix4( this.HieStack[ frame ].FrameTransformMatrix );\r\n\t\t\t\t\t\tb.matrixWorld = b.matrix;\r\n\t\t\t\t\t\tb.FrameTransformMatrix = this.HieStack[ frame ].FrameTransformMatrix;\r\n\t\t\t\t\t\tb.pos = new Vector3().setFromMatrixPosition( b.FrameTransformMatrix ).toArray();\r\n\t\t\t\t\t\tb.rotq = new Quaternion().setFromRotationMatrix( b.FrameTransformMatrix ).toArray();\r\n\t\t\t\t\t\tb.scl = new Vector3().setFromMatrixScale( b.FrameTransformMatrix ).toArray();\r\n\t\t\t\t\t\tif ( this.HieStack[ frame ].parentName && this.HieStack[ frame ].parentName.length > 0 ) {\r\n\r\n\t\t\t\t\t\t\tfor ( var i = 0; i < _bones.length; i ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tif ( this.HieStack[ frame ].parentName === _bones[ i ].name ) {\r\n\r\n\t\t\t\t\t\t\t\t\t_bones[ i ].add( b );\r\n\t\t\t\t\t\t\t\t\tb.parent = i;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_bones.push( b );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_makeOutputGeometry',\r\n\t\t\tvalue: function _makeOutputGeometry() {\r\n\r\n\t\t\t\tvar mesh = null;\r\n\t\t\t\tif ( this._currentGeo.BoneInfs.length > 0 ) {\r\n\r\n\t\t\t\t\tvar putBones = [];\r\n\t\t\t\t\tthis._makePutBoneList( this._currentGeo.baseFrame.parentName, putBones );\r\n\t\t\t\t\tfor ( var bi = 0; bi < this._currentGeo.BoneInfs.length; bi ++ ) {\r\n\r\n\t\t\t\t\t\tvar boneIndex = 0;\r\n\t\t\t\t\t\tfor ( var bb = 0; bb < putBones.length; bb ++ ) {\r\n\r\n\t\t\t\t\t\t\tif ( putBones[ bb ].name === this._currentGeo.BoneInfs[ bi ].boneName ) {\r\n\r\n\t\t\t\t\t\t\t\tboneIndex = bb;\r\n\t\t\t\t\t\t\t\tputBones[ bb ].OffsetMatrix = new Matrix4();\r\n\t\t\t\t\t\t\t\tputBones[ bb ].OffsetMatrix.copy( this._currentGeo.BoneInfs[ bi ].OffsetMatrix );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor ( var vi = 0; vi < this._currentGeo.BoneInfs[ bi ].Indeces.length; vi ++ ) {\r\n\r\n\t\t\t\t\t\t\tvar nowVertexID = this._currentGeo.BoneInfs[ bi ].Indeces[ vi ];\r\n\t\t\t\t\t\t\tvar nowVal = this._currentGeo.BoneInfs[ bi ].Weights[ vi ];\r\n\r\n\t\t\t\t\t\t\tvar stride = nowVertexID * 4;\r\n\r\n\t\t\t\t\t\t\tswitch ( this._currentGeo.VertexSetedBoneCount[ nowVertexID ] ) {\r\n\r\n\t\t\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\t\t\tthis._currentGeo.GeometryData.skinIndices[ stride ] = boneIndex;\r\n\t\t\t\t\t\t\t\t\tthis._currentGeo.GeometryData.skinWeights[ stride ] = nowVal;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\t\t\tthis._currentGeo.GeometryData.skinIndices[ stride + 1 ] = boneIndex;\r\n\t\t\t\t\t\t\t\t\tthis._currentGeo.GeometryData.skinWeights[ stride + 1 ] = nowVal;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\t\t\tthis._currentGeo.GeometryData.skinIndices[ stride + 2 ] = boneIndex;\r\n\t\t\t\t\t\t\t\t\tthis._currentGeo.GeometryData.skinWeights[ stride + 2 ] = nowVal;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t\t\t\tthis._currentGeo.GeometryData.skinIndices[ stride + 3 ] = boneIndex;\r\n\t\t\t\t\t\t\t\t\tthis._currentGeo.GeometryData.skinWeights[ stride + 3 ] = nowVal;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis._currentGeo.VertexSetedBoneCount[ nowVertexID ] ++;\r\n\t\t\t\t\t\t\tif ( this._currentGeo.VertexSetedBoneCount[ nowVertexID ] > 4 ) {\r\n\r\n\t\t\t\t\t\t\t\tconsole.log( 'warn! over 4 bone weight! :' + nowVertexID );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var sk = 0; sk < this._currentGeo.Materials.length; sk ++ ) {\r\n\r\n\t\t\t\t\t\tthis._currentGeo.Materials[ sk ].skinning = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar offsetList = [];\r\n\t\t\t\t\tfor ( var _bi = 0; _bi < putBones.length; _bi ++ ) {\r\n\r\n\t\t\t\t\t\tif ( putBones[ _bi ].OffsetMatrix ) {\r\n\r\n\t\t\t\t\t\t\toffsetList.push( putBones[ _bi ].OffsetMatrix );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\toffsetList.push( new Matrix4() );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar bufferGeometry = this._buildGeometry();\r\n\t\t\t\t\tmesh = new SkinnedMesh( bufferGeometry, this._currentGeo.Materials.length === 1 ? this._currentGeo.Materials[ 0 ] : this._currentGeo.Materials );\r\n\r\n\t\t\t\t\tthis._initSkeleton( mesh, putBones, offsetList );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tvar _bufferGeometry = this._buildGeometry();\r\n\t\t\t\t\tmesh = new Mesh( _bufferGeometry, this._currentGeo.Materials.length === 1 ? this._currentGeo.Materials[ 0 ] : this._currentGeo.Materials );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmesh.name = this._currentGeo.name;\r\n\t\t\t\tvar worldBaseMx = new Matrix4();\r\n\t\t\t\tvar currentMxFrame = this._currentGeo.baseFrame.putBone;\r\n\t\t\t\tif ( currentMxFrame && currentMxFrame.parent ) {\r\n\r\n\t\t\t\t\twhile ( true ) {\r\n\r\n\t\t\t\t\t\tcurrentMxFrame = currentMxFrame.parent;\r\n\t\t\t\t\t\tif ( currentMxFrame ) {\r\n\r\n\t\t\t\t\t\t\tworldBaseMx.multiply( currentMxFrame.FrameTransformMatrix );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tmesh.applyMatrix4( worldBaseMx );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.Meshes.push( mesh );\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_initSkeleton',\r\n\t\t\tvalue: function _initSkeleton( mesh, boneList, boneInverses ) {\r\n\r\n\t\t\t\tvar bones = [], bone, gbone;\r\n\t\t\t\tvar i, il;\r\n\r\n\t\t\t\tfor ( i = 0, il = boneList.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tgbone = boneList[ i ];\r\n\r\n\t\t\t\t\tbone = new Bone();\r\n\t\t\t\t\tbones.push( bone );\r\n\r\n\t\t\t\t\tbone.name = gbone.name;\r\n\t\t\t\t\tbone.position.fromArray( gbone.pos );\r\n\t\t\t\t\tbone.quaternion.fromArray( gbone.rotq );\r\n\t\t\t\t\tif ( gbone.scl !== undefined ) bone.scale.fromArray( gbone.scl );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( i = 0, il = boneList.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tgbone = boneList[ i ];\r\n\r\n\t\t\t\t\tif ( ( gbone.parent !== - 1 ) && ( gbone.parent !== null ) && ( bones[ gbone.parent ] !== undefined ) ) {\r\n\r\n\t\t\t\t\t\tbones[ gbone.parent ].add( bones[ i ] );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tmesh.add( bones[ i ] );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmesh.updateMatrixWorld( true );\r\n\r\n\t\t\t\tvar skeleton = new Skeleton( bones, boneInverses );\r\n\t\t\t\tmesh.bind( skeleton, mesh.matrixWorld );\r\n\r\n\t\t\t}\r\n\r\n\t\t}, {\r\n\t\t\tkey: '_readAnimationKey',\r\n\t\t\tvalue: function _readAnimationKey() {\r\n\r\n\t\t\t\tvar endRead = 0;\r\n\t\t\t\tvar find = this._currentObject.data.indexOf( ';', endRead );\r\n\t\t\t\tvar line = this._currentObject.data.substr( endRead, find - endRead );\r\n\t\t\t\tendRead = find + 1;\r\n\t\t\t\tvar nowKeyType = parseInt( this._readLine( line ) );\r\n\t\t\t\tfind = this._currentObject.data.indexOf( ';', endRead );\r\n\t\t\t\tendRead = find + 1;\r\n\t\t\t\tline = this._currentObject.data.substr( endRead );\r\n\t\t\t\tvar data = this._readLine( line.trim() ).split( \";;,\" );\r\n\t\t\t\tfor ( var i = 0; i < data.length; i ++ ) {\r\n\r\n\t\t\t\t\tvar data2 = data[ i ].split( \";\" );\r\n\t\t\t\t\tvar keyInfo = new XKeyFrameInfo();\r\n\t\t\t\t\tkeyInfo.type = nowKeyType;\r\n\t\t\t\t\tkeyInfo.Frame = parseInt( data2[ 0 ] );\r\n\t\t\t\t\tkeyInfo.index = this._currentAnimeFrames.keyFrames.length;\r\n\t\t\t\t\tkeyInfo.time = keyInfo.Frame;\r\n\t\t\t\t\tif ( nowKeyType != 4 ) {\r\n\r\n\t\t\t\t\t\tvar frameFound = false;\r\n\t\t\t\t\t\tfor ( var mm = 0; mm < this._currentAnimeFrames.keyFrames.length; mm ++ ) {\r\n\r\n\t\t\t\t\t\t\tif ( this._currentAnimeFrames.keyFrames[ mm ].Frame === keyInfo.Frame ) {\r\n\r\n\t\t\t\t\t\t\t\tkeyInfo = this._currentAnimeFrames.keyFrames[ mm ];\r\n\t\t\t\t\t\t\t\tframeFound = true;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar frameValue = data2[ 2 ].split( \",\" );\r\n\t\t\t\t\t\tswitch ( nowKeyType ) {\r\n\r\n\t\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\t\tkeyInfo.rot = new Quaternion( parseFloat( frameValue[ 1 ] ), parseFloat( frameValue[ 2 ] ), parseFloat( frameValue[ 3 ] ), parseFloat( frameValue[ 0 ] ) * - 1 );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\t\tkeyInfo.scl = new Vector3( parseFloat( frameValue[ 0 ] ), parseFloat( frameValue[ 1 ] ), parseFloat( frameValue[ 2 ] ) );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\t\tkeyInfo.pos = new Vector3( parseFloat( frameValue[ 0 ] ), parseFloat( frameValue[ 1 ] ), parseFloat( frameValue[ 2 ] ) );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( ! frameFound ) {\r\n\r\n\t\t\t\t\t\t\tthis._currentAnimeFrames.keyFrames.push( keyInfo );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tkeyInfo.matrix = new Matrix4();\r\n\t\t\t\t\t\tthis._ParseMatrixData( keyInfo.matrix, data2[ 2 ].split( \",\" ) );\r\n\t\t\t\t\t\tthis._currentAnimeFrames.keyFrames.push( keyInfo );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_makeOutputAnimation',\r\n\t\t\tvalue: function _makeOutputAnimation() {\r\n\r\n\t\t\t\tvar animationObj = new XAnimationObj( this.options );\r\n\t\t\t\tanimationObj.fps = this.animTicksPerSecond;\r\n\t\t\t\tanimationObj.name = this._currentAnime.name;\r\n\t\t\t\tanimationObj.make( this._currentAnime.AnimeFrames );\r\n\t\t\t\tthis.animations.push( animationObj );\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: 'assignAnimation',\r\n\t\t\tvalue: function assignAnimation( _model, _animation ) {\r\n\r\n\t\t\t\tvar model = _model;\r\n\t\t\t\tvar animation = _animation;\r\n\t\t\t\tif ( ! model ) {\r\n\r\n\t\t\t\t\tmodel = this.Meshes[ 0 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( ! animation ) {\r\n\r\n\t\t\t\t\tanimation = this.animations[ 0 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( ! model || ! animation ) {\r\n\r\n\t\t\t\t\treturn null;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar put = {};\r\n\t\t\t\tput.fps = animation.fps;\r\n\t\t\t\tput.name = animation.name;\r\n\t\t\t\tput.length = animation.length;\r\n\t\t\t\tput.hierarchy = [];\r\n\t\t\t\tfor ( var b = 0; b < model.skeleton.bones.length; b ++ ) {\r\n\r\n\t\t\t\t\tvar findAnimation = false;\r\n\t\t\t\t\tfor ( var i = 0; i < animation.hierarchy.length; i ++ ) {\r\n\r\n\t\t\t\t\t\tif ( model.skeleton.bones[ b ].name === animation.hierarchy[ i ].name ) {\r\n\r\n\t\t\t\t\t\t\tfindAnimation = true;\r\n\t\t\t\t\t\t\tvar c_key = animation.hierarchy[ i ].copy();\r\n\t\t\t\t\t\t\tc_key.parent = - 1;\r\n\t\t\t\t\t\t\tif ( model.skeleton.bones[ b ].parent && model.skeleton.bones[ b ].parent.type === \"Bone\" ) {\r\n\r\n\t\t\t\t\t\t\t\tfor ( var bb = 0; bb < put.hierarchy.length; bb ++ ) {\r\n\r\n\t\t\t\t\t\t\t\t\tif ( put.hierarchy[ bb ].name === model.skeleton.bones[ b ].parent.name ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tc_key.parent = bb;\r\n\t\t\t\t\t\t\t\t\t\tc_key.parentName = model.skeleton.bones[ b ].parent.name;\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tput.hierarchy.push( c_key );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( ! findAnimation ) {\r\n\r\n\t\t\t\t\t\tvar _c_key = animation.hierarchy[ 0 ].copy();\r\n\t\t\t\t\t\t_c_key.name = model.skeleton.bones[ b ].name;\r\n\t\t\t\t\t\t_c_key.parent = - 1;\r\n\t\t\t\t\t\tfor ( var k = 0; k < _c_key.keys.length; k ++ ) {\r\n\r\n\t\t\t\t\t\t\tif ( _c_key.keys[ k ].pos ) {\r\n\r\n\t\t\t\t\t\t\t\t_c_key.keys[ k ].pos.set( 0, 0, 0 );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif ( _c_key.keys[ k ].scl ) {\r\n\r\n\t\t\t\t\t\t\t\t_c_key.keys[ k ].scl.set( 1, 1, 1 );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif ( _c_key.keys[ k ].rot ) {\r\n\r\n\t\t\t\t\t\t\t\t_c_key.keys[ k ].rot.set( 0, 0, 0, 1 );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tput.hierarchy.push( _c_key );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( ! model.geometry.animations ) {\r\n\r\n\t\t\t\t\tmodel.geometry.animations = [];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmodel.geometry.animations.push( AnimationClip.parseAnimation( put, model.skeleton.bones ) );\r\n\t\t\t\tif ( ! model.animationMixer ) {\r\n\r\n\t\t\t\t\tmodel.animationMixer = new AnimationMixer( model );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn put;\r\n\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tkey: '_ParseMatrixData',\r\n\t\t\tvalue: function _ParseMatrixData( targetMatrix, data ) {\r\n\r\n\t\t\t\ttargetMatrix.set( parseFloat( data[ 0 ] ), parseFloat( data[ 4 ] ), parseFloat( data[ 8 ] ), parseFloat( data[ 12 ] ), parseFloat( data[ 1 ] ), parseFloat( data[ 5 ] ), parseFloat( data[ 9 ] ), parseFloat( data[ 13 ] ), parseFloat( data[ 2 ] ), parseFloat( data[ 6 ] ), parseFloat( data[ 10 ] ), parseFloat( data[ 14 ] ), parseFloat( data[ 3 ] ), parseFloat( data[ 7 ] ), parseFloat( data[ 11 ] ), parseFloat( data[ 15 ] ) );\r\n\r\n\t\t\t}\r\n\t\t} ] );\r\n\t\treturn XLoader;\r\n\r\n\t}();\r\n\r\n\treturn XLoader;\r\n\r\n} )();\r\n\r\nexport { XLoader };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/loaders/XLoader.js","<template>\r\n    <div class=\"webglLoaderX-container\">\r\n        <div id=\"info\">\r\n            <a href=\"https://threejs.org\" target=\"_blank\">three.js</a> - X-File Loader <br>\r\n            <a href=\"https://github.com/adrs2002/threeXfileLoader\" target=\"_new\">see more info and samples</a> <br /><br/>\r\n            <select id=\"mech1_anime\">\r\n                <option value=\"stand\">stand</option>\r\n                <option value=\"wark\">walk</option>\r\n                <option value=\"attack\">attack</option>\r\n            </select>\r\n        </div>\r\n        <div id=\"canvase3d\"></div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { OrbitControls } from '@/components/jsm/controls/OrbitControls.js'\r\nimport { XLoader } from '@/components/jsm/loaders/XLoader.js'\r\nexport default {\r\n    data() {\r\n        return {\r\n            container: null,\r\n            stats: null,\r\n            controls: null,\r\n            camera: null,\r\n            scene: null,\r\n            renderer: null,\r\n            clock: null,\r\n            manager: null,\r\n            skeletonHelper: null,\r\n            animates: [],\r\n            actions: [],\r\n            Models: [],\r\n        }\r\n    },\r\n    mounted() {\r\n        this.clock = new this.$moduleTHREE.Clock()\r\n        this.init()\r\n    },\r\n    methods: {\r\n        onProgress(xhr) {\r\n\t\t\tif (xhr.lengthComputable) {\r\n\t\t\t\tvar percentComplete = xhr.loaded / xhr.total * 100\r\n\t\t\t\tconsole.log(Math.round(percentComplete, 2) + '% downloaded')\r\n\t\t\t}\r\n        },\r\n        onError() {},\r\n        init() {\r\n\t\t\tthis.container = document.createElement('div')\r\n\t\t\tdocument.getElementsByClassName('webglLoaderX-container')[0].appendChild(this.container)\r\n\t\t\tthis.scene = new this.$moduleTHREE.Scene()\r\n\t\t\tthis.scene.add(new this.$moduleTHREE.AmbientLight(0xaaaaaa))\r\n\t\t\t// grid\r\n\t\t\tvar gridHelper = new this.$moduleTHREE.GridHelper(14, 1, 0x303030, 0x303030)\r\n\t\t\tthis.scene.add(gridHelper)\r\n\t\t\t// stats\r\n            this.stats = new this.$Stats()\r\n            this.stats.dom.style.left = '280px'\r\n\t\t\tthis.container.appendChild(this.stats.dom)\r\n\t\t\tthis.renderer = new this.$moduleTHREE.WebGLRenderer()\r\n\t\t\tthis.renderer.setPixelRatio(window.devicePixelRatio)\r\n\t\t\tthis.renderer.setSize(this.$webglInnerWidth, window.innerHeight)\r\n\t\t\tthis.renderer.setClearColor(0x666666)\r\n\t\t\tthis.container.appendChild(this.renderer.domElement)\r\n\t\t\tthis.camera = new this.$moduleTHREE.PerspectiveCamera(45, this.$webglInnerWidth / window.innerHeight, 1, 2000)\r\n\t\t\tthis.camera.position.set(2, 10, - 28)\r\n\t\t\tthis.camera.up.set(0, 1, 0)\r\n\t\t\tthis.controls = new OrbitControls(this.camera, this.renderer.domElement)\r\n\t\t\tthis.controls.target.set(0, 5, 0)\r\n\t\t\tthis.controls.update()\r\n\t\t\tvar light = new this.$moduleTHREE.DirectionalLight(0xffffff, 1)\r\n\t\t\tlight.position.set(10, 100, - 10).normalize()\r\n\t\t\tthis.scene.add(light)\r\n\t\t\tvar light2 = new this.$moduleTHREE.DirectionalLight(0x777666, 1)\r\n\t\t\tlight2.position.set(- 1, - 1, - 1).normalize()\r\n\t\t\tthis.scene.add(light2)\r\n\t\t\twindow.addEventListener('resize', this.onWindowResize, false)\r\n\t\t\tthis.animate()\r\n\t\t\t// model loading\r\n\t\t\tthis.manager = new this.$moduleTHREE.LoadingManager()\r\n\t\t\tthis.manager.onProgress = (item, loaded, total) => {\r\n\t\t\t\tconsole.log(item, loaded, total)\r\n\t\t\t}\r\n\t\t\tvar loader = new XLoader(this.manager)\r\n\t\t\tthis.actions[ 0 ] = {}\r\n\t\t\t//download Model file\r\n\t\t\tloader.load([ 'static/models/xfile/SSR06_model.x' ], (object) => {\r\n\t\t\t\tfor (var i = 0; i < object.models.length; i ++) {\r\n\t\t\t\t\tvar model = object.models[ i ]\r\n\t\t\t\t\tmodel.scale.x *= - 1\r\n\t\t\t\t\tthis.Models.push(model)\r\n\t\t\t\t}\r\n\t\t\t\tthis.loadAnimation('stand', 0, () => {\r\n\t\t\t\t\tthis.scene.add(this.Models[ 0 ])\r\n\t\t\t\t\tif (this.Models[ 0 ] instanceof this.$moduleTHREE.SkinnedMesh) {\r\n\t\t\t\t\t\tthis.skeletonHelper = new this.$moduleTHREE.SkeletonHelper(this.Models[ 0 ])\r\n\t\t\t\t\t\tthis.scene.add(this.skeletonHelper)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.actions[ 0 ][ 'stand' ].play()\r\n\t\t\t\t})\r\n\t\t\t\tobject = null\r\n\t\t\t}, this.onProgress, this.onError)\r\n\t\t\t//\r\n\t\t\tvar animationSelection = document.getElementById('mech1_anime')\r\n\t\t\tanimationSelection.addEventListener('change', this.mech1_changeAnime)\r\n        },\r\n        onWindowResize() {\r\n\t\t\tthis.$onWindowResize(this.camera, this.renderer)\r\n        },\r\n        animate() {\r\n\t\t\trequestAnimationFrame(this.animate)\r\n\t\t\tvar delta = this.clock.getDelta()\r\n\t\t\tif (this.animates != null && this.animates.length > 0) {\r\n\t\t\t\tfor (var i = 0; i < this.animates.length; i ++) {\r\n\t\t\t\t\tthis.animates[ i ].update(delta * 1000)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.stats.update()\r\n\t\t\tthis.render()\r\n        },\r\n        render() {\r\n\t\t\tthis.renderer.render(this.scene, this.camera)\r\n        },\r\n        loadAnimation(animeName, modelId, _callback) {\r\n\t\t\tif (this.actions[ modelId ][ animeName ]) {\r\n\t\t\t\tif (_callback) {\r\n\t\t\t\t\t_callback()\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar loader2 = new XLoader(this.manager)\r\n\t\t\t\tloader2.load([ 'static/models/xfile/' + animeName + '.x', { putPos: false, putScl: false } ], () => {\r\n\t\t\t\t\t// !! important!\r\n\t\t\t\t\t// associate divided model and animation.\r\n\t\t\t\t\tloader2.assignAnimation(this.Models[ modelId ])\r\n\t\t\t\t\tif (! this.animates[ modelId ]) {\r\n\t\t\t\t\t\tthis.animates[ modelId ] = this.Models[ modelId ].animationMixer\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.actions[ modelId ][ animeName ] = this.Models[ modelId ].animationMixer.clipAction(animeName)\r\n\t\t\t\t\tif (animeName == 'stand') {\r\n\t\t\t\t\t\tthis.actions[ modelId ][ animeName ].setLoop(this.$moduleTHREE.LoopOnce)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.actions[ modelId ][ animeName ].clampWhenFinished = true\r\n\t\t\t\t\tif (_callback) {\r\n\t\t\t\t\t\t_callback(); return\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.actions[ modelId ][ animeName ].play()\r\n\t\t\t\t}, this.onProgress, this.onError)\r\n\t\t\t}\r\n        },\r\n        mech1_changeAnime(event) {\r\n\t\t\tvar val = event.target.value\r\n\t\t\tthis.loadAnimation(val, 0, () => {\r\n\t\t\t\tObject.keys(this.actions[ 0 ]).forEach((p) => {\r\n\t\t\t\t\tif (p == val) {\r\n\t\t\t\t\t\tthis.actions[ 0 ][ p ].play()\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.actions[ 0 ][ p ].stop()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}\r\n    },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.webglLoaderX-container {\r\n    width: 100%;\r\n}\r\n#info {\r\n\tmargin-left: 35px;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/views/loader/webglLoaderX.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"webglLoaderX-container\"},[_c('div',{attrs:{\"id\":\"info\"}},[_c('a',{attrs:{\"href\":\"https://threejs.org\",\"target\":\"_blank\"}},[_vm._v(\"three.js\")]),_vm._v(\" - X-File Loader \"),_c('br'),_vm._v(\" \"),_c('a',{attrs:{\"href\":\"https://github.com/adrs2002/threeXfileLoader\",\"target\":\"_new\"}},[_vm._v(\"see more info and samples\")]),_vm._v(\" \"),_c('br'),_c('br'),_vm._v(\" \"),_c('select',{attrs:{\"id\":\"mech1_anime\"}},[_c('option',{attrs:{\"value\":\"stand\"}},[_vm._v(\"stand\")]),_vm._v(\" \"),_c('option',{attrs:{\"value\":\"wark\"}},[_vm._v(\"walk\")]),_vm._v(\" \"),_c('option',{attrs:{\"value\":\"attack\"}},[_vm._v(\"attack\")])])]),_vm._v(\" \"),_c('div',{attrs:{\"id\":\"canvase3d\"}})])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-0eeafe1e\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/loader/webglLoaderX.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-0eeafe1e\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./webglLoaderX.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglLoaderX.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglLoaderX.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-0eeafe1e\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./webglLoaderX.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-0eeafe1e\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/loader/webglLoaderX.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}