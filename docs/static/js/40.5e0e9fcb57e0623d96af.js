webpackJsonp([40],{"/wAK":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("Iu6k"),r=n("4CE/"),s={data:function(){return{ACTION_SELECT:1,ACTION_NONE:0,curveHandles:[],mouse:null,stats:null,scene:null,camera:null,renderer:null,rayCaster:null,control:null,flow:null,action:null}},mounted:function(){this.mouse=new this.$THREE.Vector2,this.action=this.ACTION_NONE,this.init(),this.animate()},methods:{init:function(){var e=this;this.scene=new this.$THREE.Scene,this.camera=new this.$THREE.PerspectiveCamera(40,this.$webglInnerWidth/window.innerHeight,1,1e3),this.camera.position.set(2,2,4),this.camera.lookAt(this.scene.position);var t=new this.$THREE.BoxBufferGeometry(.1,.1,.1),n=new this.$THREE.MeshBasicMaterial(10092441),s=!0,a=!1,o=void 0;try{for(var l,c=[{x:1,y:0,z:-1},{x:1,y:0,z:1},{x:-1,y:0,z:1},{x:-1,y:0,z:-1}][Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var h=l.value,f=new this.$THREE.Mesh(t,n);f.position.copy(h),this.curveHandles.push(f),this.scene.add(f)}}catch(e){a=!0,o=e}finally{try{!s&&c.return&&c.return()}finally{if(a)throw o}}var u=new this.$THREE.CatmullRomCurve3(this.curveHandles.map(function(e){return e.position}));u.curveType="centripetal",u.closed=!0;var d=u.getPoints(50),v=new this.$THREE.LineLoop((new this.$THREE.BufferGeometry).setFromPoints(d),new this.$THREE.LineBasicMaterial({color:65280}));this.scene.add(v);var m=new this.$THREE.DirectionalLight(16755251);m.position.set(-10,10,10),m.intensity=1,this.scene.add(m);var p=new this.$THREE.AmbientLight(14707);p.intensity=1,this.scene.add(p),(new this.$THREE.FontLoader).load("static/fonts/helvetiker_regular.typeface.json",function(t){var n=new e.$THREE.TextBufferGeometry("Hello three.js!",{font:t,size:.2,height:.05,curveSegments:12,bevelEnabled:!0,bevelThickness:.02,bevelSize:.01,bevelOffset:0,bevelSegments:5});n.rotateX(Math.PI);var i=new e.$THREE.MeshStandardMaterial({color:10092543}),s=new e.$THREE.Mesh(n,i);e.flow=new r.a(s),e.flow.updateCurve(0,u),e.scene.add(e.flow.object3D)}),this.renderer=new this.$THREE.WebGLRenderer({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.$webglInnerWidth,window.innerHeight),document.getElementsByClassName("webglModifierCurve-container")[0].appendChild(this.renderer.domElement),this.renderer.domElement.addEventListener("pointerdown",this.onPointerDown,!1),this.rayCaster=new this.$THREE.Raycaster,this.control=new i.a(this.camera,this.renderer.domElement),this.control.addEventListener("dragging-changed",function(t){if(!t.value){var n=u.getPoints(50);v.geometry.setFromPoints(n),e.flow.updateCurve(0,u)}}),this.stats=new this.$Stats,this.stats.dom.style.left="280px",document.getElementsByClassName("webglModifierCurve-container")[0].appendChild(this.stats.dom),window.addEventListener("resize",this.onWindowResize,!1)},onWindowResize:function(){this.$onWindowResize(this.camera,this.renderer)},onPointerDown:function(e){this.action=this.ACTION_SELECT,this.mouse.x=e.clientX/(window.innerWidth-281)*2-1,this.mouse.y=-e.clientY/window.innerHeight*2+1},animate:function(){if(requestAnimationFrame(this.animate),this.action===this.ACTION_SELECT){this.rayCaster.setFromCamera(this.mouse,this.camera),this.action=this.ACTION_NONE;var e=this.rayCaster.intersectObjects(this.curveHandles);if(e.length){var t=e[0].object;this.control.attach(t),this.scene.add(this.control)}}this.flow&&this.flow.moveAlongCurve(.001),this.render()},render:function(){this.renderer.render(this.scene,this.camera),this.stats.update()}}},a={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"webglModifierCurve-container"},[t("div",{attrs:{id:"info"}},[t("a",{attrs:{href:"https://threejs.org",target:"_blank",rel:"noopener"}},[this._v("three.js")]),this._v(" webgl - curve modifier\n\t\t")])])}]};var o=n("VU/8")(s,a,!1,function(e){n("COL+")},"data-v-526e0f10",null);t.default=o.exports},"4CE/":function(e,t,n){"use strict";n.d(t,"a",function(){return h}),n.d(t,"b",function(){return u});var i=n("6+nK"),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=3,o=1024,l=4;function c(e,t,n,i,r,s){var l=e.image.data,c=a*o*s;l[t*a+c+0]=n,l[t*a+c+1]=i,l[t*a+c+2]=r}var h=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s(this,e);var r=t.clone(),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=new Float32Array(o*l*e*a),n=new i.DataTexture(t,o,l*e,i.RGBFormat,i.FloatType);return n.wrapS=i.RepeatWrapping,n.wrapY=i.RepeatWrapping,n.magFilter=i.NearestFilter,n.needsUpdate=!0,n}(n),h={spineTexture:{value:c},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}};r.traverse(function(e){(e instanceof i.Mesh||e instanceof i.InstancedMesh)&&(e.material=e.material.clone(),function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;e.__ok||(e.__ok=!0,e.onBeforeCompile=function(e){if(!e.__modified){e.__modified=!0,Object.assign(e.uniforms,t);var i=("\n\t\t#define USE_ENVMAP\n\t\tuniform sampler2D spineTexture;\n\t\tuniform float pathOffset;\n\t\tuniform float pathSegment;\n\t\tuniform float spineOffset;\n\t\tuniform float spineLength;\n\t\tuniform int flow;\n\n\t\tfloat textureLayers = "+l*n+".;\n\t\tfloat textureStacks = "+l/4+".;\n\n\t\t"+e.vertexShader+"\n\t\t").replace("#include <defaultnormal_vertex>","\n\t\tvec4 worldPos = modelMatrix * vec4(position, 1.);\n\n\t\tbool bend = flow > 0;\n\t\tfloat xWeight = bend ? 0. : 1.;\n\n\t\t#ifdef USE_INSTANCING\n\t\tfloat pathOffsetFromInstanceMatrix = instanceMatrix[3][2];\n\t\tfloat spineLengthFromInstanceMatrix = instanceMatrix[3][0];\n\t\tfloat spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;\n\t\tfloat mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;\n\t\t#else\n\t\tfloat spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;\n\t\tfloat mt = (spinePortion * pathSegment + pathOffset)*textureStacks;\n\t\t#endif\n\n\t\tmt = mod(mt, textureStacks);\n\t\tfloat rowOffset = floor(mt);\n\n\t\t#ifdef USE_INSTANCING\n\t\trowOffset += instanceMatrix[3][1] * "+l+".;\n\t\t#endif\n\n\t\tvec3 spinePos = texture(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;\n\t\tvec3 a =        texture(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;\n\t\tvec3 b =        texture(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;\n\t\tvec3 c =        texture(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;\n\t\tmat3 basis = mat3(a, b, c);\n\n\t\tvec3 transformed = basis\n\t\t\t* vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)\n\t\t\t+ spinePos;\n\n\t\tvec3 transformedNormal = normalMatrix * (basis * objectNormal);\n\t\t").replace("#include <begin_vertex>","").replace("#include <project_vertex>","\n\t\t\tvec4 mvPosition = viewMatrix * vec4( transformed, 1.0 );\n\t\t\t// vec4 mvPosition = viewMatrix * worldPos;\n\t\t\tgl_Position = projectionMatrix * mvPosition;\n\t\t\t");e.vertexShader=i}})}(e.material,h,n))}),this.curveArray=new Array(n),this.curveLengthArray=new Array(n),this.object3D=r,this.splineTexure=c,this.uniforms=h}return r(e,[{key:"updateCurve",value:function(e,t){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");var n=t.getLength();this.uniforms.spineLength.value=n,this.curveLengthArray[e]=n,this.curveArray[e]=t,function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Math.floor(o*(l/4));t.arcLengthDivisions=i/2,t.updateArcLengths();for(var r=t.getSpacedPoints(i),s=t.computeFrenetFrames(i,!0),a=0;a<i;a++){var h=Math.floor(a/o),f=a%o,u=r[a];c(e,f,u.x,u.y,u.z,0+h+l*n),c(e,f,(u=s.tangents[a]).x,u.y,u.z,1+h+l*n),c(e,f,(u=s.normals[a]).x,u.y,u.z,2+h+l*n),c(e,f,(u=s.binormals[a]).x,u.y,u.z,3+h+l*n)}e.needsUpdate=!0}(this.splineTexure,t,e)}},{key:"moveAlongCurve",value:function(e){this.uniforms.pathOffset.value+=e}}]),e}(),f=new i.Matrix4,u=function(e){function t(e,n,r,a){s(this,t);var o=new i.InstancedMesh(r,a,e);o.instanceMatrix.setUsage(i.DynamicDrawUsage);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,o,n));return l.offsets=new Array(e).fill(0),l.whichCurve=new Array(e).fill(0),l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,h),r(t,[{key:"writeChanges",value:function(e){f.makeTranslation(this.curveLengthArray[this.whichCurve[e]],this.whichCurve[e],this.offsets[e]),this.object3D.setMatrixAt(e,f),this.object3D.instanceMatrix.needsUpdate=!0}},{key:"moveIndividualAlongCurve",value:function(e,t){this.offsets[e]+=t,this.writeChanges(e)}},{key:"setCurve",value:function(e,t){if(isNaN(t))throw Error("curve index being set is Not a Number (NaN)");this.whichCurve[e]=t,this.writeChanges(e)}}]),t}()},"COL+":function(e,t){}});
//# sourceMappingURL=40.5e0e9fcb57e0623d96af.js.map