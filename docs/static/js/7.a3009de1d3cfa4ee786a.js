webpackJsonp([7],{M2Ih:function(t,e,r){"use strict";r.d(e,"a",function(){return a});var i=r("6+nK"),a=function(t,e,r){this.variables=[],this.currentTextureIndex=0;var a=i.J,n=new i._58,s=new i.l;s.position.z=1;var o={passThruTexture:{value:null}},h=m("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",o),l=new i._16(new i._37(2,2),h);function u(r){r.defines.resolution="vec2( "+t.toFixed(1)+", "+e.toFixed(1)+" )"}function m(t,e){e=e||{};var r=new i._60({uniforms:e,vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:t});return u(r),r}n.add(l),this.setDataType=function(t){return a=t,this},this.addVariable=function(t,e,r){var a={name:t,initialValueTexture:r,material:this.createShaderMaterial(e),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:i._23,magFilter:i._23};return this.variables.push(a),a},this.setVariableDependencies=function(t,e){t.dependencies=e},this.init=function(){if(!1===r.capabilities.isWebGL2&&!1===r.extensions.has("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===r.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(var i=0;i<this.variables.length;i++){var a=this.variables[i];a.renderTargets[0]=this.createRenderTarget(t,e,a.wrapS,a.wrapT,a.minFilter,a.magFilter),a.renderTargets[1]=this.createRenderTarget(t,e,a.wrapS,a.wrapT,a.minFilter,a.magFilter),this.renderTexture(a.initialValueTexture,a.renderTargets[0]),this.renderTexture(a.initialValueTexture,a.renderTargets[1]);var n=a.material,s=n.uniforms;if(null!==a.dependencies)for(var o=0;o<a.dependencies.length;o++){var h=a.dependencies[o];if(h.name!==a.name){for(var l=!1,u=0;u<this.variables.length;u++)if(h.name===this.variables[u].name){l=!0;break}if(!l)return"Variable dependency not found. Variable="+a.name+", dependency="+h.name}s[h.name]={value:null},n.fragmentShader="\nuniform sampler2D "+h.name+";\n"+n.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){for(var t=this.currentTextureIndex,e=0===this.currentTextureIndex?1:0,r=0,i=this.variables.length;r<i;r++){var a=this.variables[r];if(null!==a.dependencies)for(var n=a.material.uniforms,s=0,o=a.dependencies.length;s<o;s++){var h=a.dependencies[s];n[h.name].value=h.renderTargets[t].texture}this.doRenderTarget(a.material,a.renderTargets[e])}this.currentTextureIndex=e},this.getCurrentRenderTarget=function(t){return t.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(t){return t.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=u,this.createShaderMaterial=m,this.createRenderTarget=function(r,n,s,o,h,l){return r=r||t,n=n||e,s=s||i.n,o=o||i.n,h=h||i._23,l=l||i._23,new i._87(r,n,{wrapS:s,wrapT:o,minFilter:h,magFilter:l,format:i._44,type:a,depthBuffer:!1})},this.createTexture=function(){var r=new Float32Array(t*e*4);return new i.x(r,t,e,i._44,i.J)},this.renderTexture=function(t,e){o.passThruTexture.value=t,this.doRenderTarget(h,e),o.passThruTexture.value=null},this.doRenderTarget=function(t,e){var i=r.getRenderTarget();l.material=t,r.setRenderTarget(e),r.render(n,s),l.material=h,r.setRenderTarget(i)}}},aLER:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r("QEtz"),a=r("M2Ih"),n=function(t){void 0==t&&(t=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var e=0;e<256;e++)this.p[e]=Math.floor(256*t.random());this.perm=[];for(e=0;e<512;e++)this.perm[e]=this.p[255&e];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};n.prototype.dot=function(t,e,r){return t[0]*e+t[1]*r},n.prototype.dot3=function(t,e,r,i){return t[0]*e+t[1]*r+t[2]*i},n.prototype.dot4=function(t,e,r,i,a){return t[0]*e+t[1]*r+t[2]*i+t[3]*a},n.prototype.noise=function(t,e){var r,i,a=(t+e)*(.5*(Math.sqrt(3)-1)),n=Math.floor(t+a),s=Math.floor(e+a),o=(3-Math.sqrt(3))/6,h=(n+s)*o,l=t-(n-h),u=e-(s-h);l>u?(r=1,i=0):(r=0,i=1);var m=l-r+o,d=u-i+o,c=l-1+2*o,p=u-1+2*o,v=255&n,f=255&s,g=this.perm[v+this.perm[f]]%12,x=this.perm[v+r+this.perm[f+i]]%12,T=this.perm[v+1+this.perm[f+1]]%12,_=.5-l*l-u*u,S=.5-m*m-d*d,w=.5-c*c-p*p;return 70*((_<0?0:(_*=_)*_*this.dot(this.grad3[g],l,u))+(S<0?0:(S*=S)*S*this.dot(this.grad3[x],m,d))+(w<0?0:(w*=w)*w*this.dot(this.grad3[T],c,p)))},n.prototype.noise3d=function(t,e,r){var i,a,n,s,o,h,l=(t+e+r)*(1/3),u=Math.floor(t+l),m=Math.floor(e+l),d=Math.floor(r+l),c=1/6,p=(u+m+d)*c,v=t-(u-p),f=e-(m-p),g=r-(d-p);v>=f?f>=g?(i=1,a=0,n=0,s=1,o=1,h=0):v>=g?(i=1,a=0,n=0,s=1,o=0,h=1):(i=0,a=0,n=1,s=1,o=0,h=1):f<g?(i=0,a=0,n=1,s=0,o=1,h=1):v<g?(i=0,a=1,n=0,s=0,o=1,h=1):(i=0,a=1,n=0,s=1,o=1,h=0);var x=v-i+c,T=f-a+c,_=g-n+c,S=v-s+2*c,w=f-o+2*c,E=g-h+2*c,D=v-1+.5,b=f-1+.5,y=g-1+.5,H=255&u,R=255&m,C=255&d,F=this.perm[H+this.perm[R+this.perm[C]]]%12,M=this.perm[H+i+this.perm[R+a+this.perm[C+n]]]%12,W=this.perm[H+s+this.perm[R+o+this.perm[C+h]]]%12,V=this.perm[H+1+this.perm[R+1+this.perm[C+1]]]%12,N=.6-v*v-f*f-g*g,z=.6-x*x-T*T-_*_,U=.6-S*S-w*w-E*E,L=.6-D*D-b*b-y*y;return 32*((N<0?0:(N*=N)*N*this.dot3(this.grad3[F],v,f,g))+(z<0?0:(z*=z)*z*this.dot3(this.grad3[M],x,T,_))+(U<0?0:(U*=U)*U*this.dot3(this.grad3[W],S,w,E))+(L<0?0:(L*=L)*L*this.dot3(this.grad3[V],D,b,y)))},n.prototype.noise4d=function(t,e,r,i){var a,n,s,o,h,l,u,m,d,c,p,v,f=this.grad4,g=this.simplex,x=this.perm,T=(Math.sqrt(5)-1)/4,_=(5-Math.sqrt(5))/20,S=(t+e+r+i)*T,w=Math.floor(t+S),E=Math.floor(e+S),D=Math.floor(r+S),b=Math.floor(i+S),y=(w+E+D+b)*_,H=t-(w-y),R=e-(E-y),C=r-(D-y),F=i-(b-y),M=(H>R?32:0)+(H>C?16:0)+(R>C?8:0)+(H>F?4:0)+(R>F?2:0)+(C>F?1:0),W=H-(a=g[M][0]>=3?1:0)+_,V=R-(n=g[M][1]>=3?1:0)+_,N=C-(s=g[M][2]>=3?1:0)+_,z=F-(o=g[M][3]>=3?1:0)+_,U=H-(h=g[M][0]>=2?1:0)+2*_,L=R-(l=g[M][1]>=2?1:0)+2*_,B=C-(u=g[M][2]>=2?1:0)+2*_,I=F-(m=g[M][3]>=2?1:0)+2*_,$=H-(d=g[M][0]>=1?1:0)+3*_,O=R-(c=g[M][1]>=1?1:0)+3*_,P=C-(p=g[M][2]>=1?1:0)+3*_,A=F-(v=g[M][3]>=1?1:0)+3*_,k=H-1+4*_,G=R-1+4*_,j=C-1+4*_,q=F-1+4*_,J=255&w,K=255&E,Q=255&D,X=255&b,Y=x[J+x[K+x[Q+x[X]]]]%32,Z=x[J+a+x[K+n+x[Q+s+x[X+o]]]]%32,tt=x[J+h+x[K+l+x[Q+u+x[X+m]]]]%32,et=x[J+d+x[K+c+x[Q+p+x[X+v]]]]%32,rt=x[J+1+x[K+1+x[Q+1+x[X+1]]]]%32,it=.6-H*H-R*R-C*C-F*F,at=.6-W*W-V*V-N*N-z*z,nt=.6-U*U-L*L-B*B-I*I,st=.6-$*$-O*O-P*P-A*A,ot=.6-k*k-G*G-j*j-q*q;return 27*((it<0?0:(it*=it)*it*this.dot4(f[Y],H,R,C,F))+(at<0?0:(at*=at)*at*this.dot4(f[Z],W,V,N,z))+(nt<0?0:(nt*=nt)*nt*this.dot4(f[tt],U,L,B,I))+(st<0?0:(st*=st)*st*this.dot4(f[et],$,O,P,A))+(ot<0?0:(ot*=ot)*ot*this.dot4(f[rt],k,G,j,q)))};var s={data:function(){return{heightmapFragmentShader:null,smoothFragmentShader:null,readWaterLevelFragmentShader:null,waterVertexShader:null,gui:null,WIDTH:128,BOUNDS:512,BOUNDS_HALF:null,container:null,stats:null,camera:null,scene:null,renderer:null,mouseMoved:!1,mouseCoords:null,raycaster:null,waterMesh:null,meshRay:null,gpuCompute:null,heightmapVariable:null,waterUniforms:null,smoothShader:null,readWaterLevelShader:null,readWaterLevelRenderTarget:null,readWaterLevelImage:null,waterNormal:null,NUM_SPHERES:5,spheres:[],spheresEnabled:!0,simplex:null}},mounted:function(){this.heightmapFragmentShader="\n            #include <common>\n\t\t\tuniform vec2 mousePos;\n\t\t\tuniform float mouseSize;\n\t\t\tuniform float viscosityConstant;\n\t\t\tuniform float heightCompensation;\n\t\t\tvoid main()\t{\n\t\t\t\tvec2 cellSize = 1.0 / resolution.xy;\n\t\t\t\tvec2 uv = gl_FragCoord.xy * cellSize;\n\t\t\t\t// heightmapValue.x == height from previous frame\n\t\t\t\t// heightmapValue.y == height from penultimate frame\n\t\t\t\t// heightmapValue.z, heightmapValue.w not used\n\t\t\t\tvec4 heightmapValue = texture2D(heightmap, uv);\n\t\t\t\t// Get neighbours\n\t\t\t\tvec4 north = texture2D(heightmap, uv + vec2(0.0, cellSize.y));\n\t\t\t\tvec4 south = texture2D(heightmap, uv + vec2(0.0, - cellSize.y));\n\t\t\t\tvec4 east = texture2D(heightmap, uv + vec2(cellSize.x, 0.0));\n\t\t\t\tvec4 west = texture2D(heightmap, uv + vec2(- cellSize.x, 0.0));\n\t\t\t\t// https://web.archive.org/web/20080618181901/http://freespace.virgin.net/hugo.elias/graphics/x_water.htm\n\t\t\t\tfloat newHeight = ((north.x + south.x + east.x + west.x) * 0.5 - heightmapValue.y) * viscosityConstant;\n\t\t\t\t// Mouse influence\n\t\t\t\tfloat mousePhase = clamp(length((uv - vec2(0.5)) * BOUNDS - vec2(mousePos.x, - mousePos.y)) * PI / mouseSize, 0.0, PI);\n\t\t\t\tnewHeight += (cos(mousePhase) + 1.0) * 0.28;\n\t\t\t\theightmapValue.y = heightmapValue.x;\n\t\t\t\theightmapValue.x = newHeight;\n\t\t\t\tgl_FragColor = heightmapValue;\n            }",this.smoothFragmentShader="\n            uniform sampler2D smoothTexture;\n\t\t\tvoid main()\t{\n\t\t\t\tvec2 cellSize = 1.0 / resolution.xy;\n\t\t\t\tvec2 uv = gl_FragCoord.xy * cellSize;\n\t\t\t\t// Computes the mean of texel and 4 neighbours\n\t\t\t\tvec4 textureValue = texture2D(smoothTexture, uv);\n\t\t\t\ttextureValue += texture2D(smoothTexture, uv + vec2(0.0, cellSize.y));\n\t\t\t\ttextureValue += texture2D(smoothTexture, uv + vec2(0.0, - cellSize.y));\n\t\t\t\ttextureValue += texture2D(smoothTexture, uv + vec2(cellSize.x, 0.0));\n\t\t\t\ttextureValue += texture2D(smoothTexture, uv + vec2(- cellSize.x, 0.0));\n\t\t\t\ttextureValue /= 5.0;\n\t\t\t\tgl_FragColor = textureValue;\n            }",this.readWaterLevelFragmentShader="\n            uniform vec2 point1;\n\t\t\tuniform sampler2D levelTexture;\n\t\t\t// Integer to float conversion from https://stackoverflow.com/questions/17981163/webgl-read-pixels-from-floating-point-render-target\n\t\t\tfloat shift_right(float v, float amt) {\n\t\t\t\tv = floor(v) + 0.5;\n\t\t\t\treturn floor(v / exp2(amt));\n\t\t\t}\n\t\t\tfloat shift_left(float v, float amt) {\n\t\t\t\treturn floor(v * exp2(amt) + 0.5);\n\t\t\t}\n\t\t\tfloat mask_last(float v, float bits) {\n\t\t\t\treturn mod(v, shift_left(1.0, bits));\n\t\t\t}\n\t\t\tfloat extract_bits(float num, float from, float to) {\n\t\t\t\tfrom = floor(from + 0.5); to = floor(to + 0.5);\n\t\t\t\treturn mask_last(shift_right(num, from), to - from);\n\t\t\t}\n\t\t\tvec4 encode_float(float val) {\n\t\t\t\tif (val == 0.0) return vec4(0, 0, 0, 0);\n\t\t\t\tfloat sign = val > 0.0 ? 0.0 : 1.0;\n\t\t\t\tval = abs(val);\n\t\t\t\tfloat exponent = floor(log2(val));\n\t\t\t\tfloat biased_exponent = exponent + 127.0;\n\t\t\t\tfloat fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;\n\t\t\t\tfloat t = biased_exponent / 2.0;\n\t\t\t\tfloat last_bit_of_biased_exponent = fract(t) * 2.0;\n\t\t\t\tfloat remaining_bits_of_biased_exponent = floor(t);\n\t\t\t\tfloat byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;\n\t\t\t\tfloat byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;\n\t\t\t\tfloat byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\n\t\t\t\tfloat byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n\t\t\t\treturn vec4(byte4, byte3, byte2, byte1);\n\t\t\t}\n\t\t\tvoid main()\t{\n\t\t\t\tvec2 cellSize = 1.0 / resolution.xy;\n\t\t\t\tfloat waterLevel = texture2D(levelTexture, point1).x;\n\t\t\t\tvec2 normal = vec2(\n\t\t\t\t\t(texture2D(levelTexture, point1 + vec2(- cellSize.x, 0)).x - texture2D(levelTexture, point1 + vec2(cellSize.x, 0)).x) * WIDTH / BOUNDS,\n\t\t\t\t\t(texture2D(levelTexture, point1 + vec2(0, - cellSize.y)).x - texture2D(levelTexture, point1 + vec2(0, cellSize.y)).x) * WIDTH / BOUNDS);\n\t\t\t\tif (gl_FragCoord.x < 1.5) {\n\t\t\t\t\tgl_FragColor = encode_float(waterLevel);\n\t\t\t\t} else if (gl_FragCoord.x < 2.5) {\n\t\t\t\t\tgl_FragColor = encode_float(normal.x);\n\t\t\t\t} else if (gl_FragCoord.x < 3.5) {\n\t\t\t\t\tgl_FragColor = encode_float(normal.y);\n\t\t\t\t} else {\n\t\t\t\t\tgl_FragColor = encode_float(0.0);\n\t\t\t\t}\n            }",this.waterVertexShader="\n            uniform sampler2D heightmap;\n\t\t\t#define PHONG\n\t\t\tvarying vec3 vViewPosition;\n\t\t\t#ifndef FLAT_SHADED\n\t\t\t\tvarying vec3 vNormal;\n\t\t\t#endif\n\t\t\t#include <common>\n\t\t\t#include <uv_pars_vertex>\n\t\t\t#include <uv2_pars_vertex>\n\t\t\t#include <displacementmap_pars_vertex>\n\t\t\t#include <envmap_pars_vertex>\n\t\t\t#include <color_pars_vertex>\n\t\t\t#include <morphtarget_pars_vertex>\n\t\t\t#include <skinning_pars_vertex>\n\t\t\t#include <shadowmap_pars_vertex>\n\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t#include <clipping_planes_pars_vertex>\n\t\t\tvoid main() {\n\t\t\t\tvec2 cellSize = vec2(1.0 / WIDTH, 1.0 / WIDTH);\n\t\t\t\t#include <uv_vertex>\n\t\t\t\t#include <uv2_vertex>\n\t\t\t\t#include <color_vertex>\n\t\t\t\t// # include <beginnormal_vertex>\n\t\t\t\t// Compute normal from heightmap\n\t\t\t\tvec3 objectNormal = vec3(\n\t\t\t\t\t(texture2D(heightmap, uv + vec2(- cellSize.x, 0)).x - texture2D(heightmap, uv + vec2(cellSize.x, 0)).x) * WIDTH / BOUNDS,\n\t\t\t\t\t(texture2D(heightmap, uv + vec2(0, - cellSize.y)).x - texture2D(heightmap, uv + vec2(0, cellSize.y)).x) * WIDTH / BOUNDS,\n\t\t\t\t\t1.0);\n\t\t\t\t//<beginnormal_vertex>\n\t\t\t\t#include <morphnormal_vertex>\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\t\t\t\tvNormal = normalize(transformedNormal);\n\t\t\t#endif\n\t\t\t\t//# include <begin_vertex>\n\t\t\t\tfloat heightValue = texture2D(heightmap, uv).x;\n\t\t\t\tvec3 transformed = vec3(position.x, position.y, heightValue);\n\t\t\t\t//<begin_vertex>\n\t\t\t\t#include <morphtarget_vertex>\n\t\t\t\t#include <skinning_vertex>\n\t\t\t\t#include <displacementmap_vertex>\n\t\t\t\t#include <project_vertex>\n\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t#include <clipping_planes_vertex>\n\t\t\t\tvViewPosition = - mvPosition.xyz;\n\t\t\t\t#include <worldpos_vertex>\n\t\t\t\t#include <envmap_vertex>\n\t\t\t\t#include <shadowmap_vertex>\n            }",this.BOUNDS_HALF=.5*this.BOUNDS,this.mouseCoords=new this.$THREE.Vector2,this.raycaster=new this.$THREE.Raycaster,this.waterNormal=new this.$THREE.Vector3,this.simplex=new n,this.init(),this.animate()},beforeDestroy:function(){this.gui.hide()},methods:{init:function(){var t=this;this.container=document.createElement("div"),document.getElementsByClassName("webglGpgpuWater-container")[0].appendChild(this.container),this.camera=new this.$THREE.PerspectiveCamera(75,this.$webglInnerWidth/window.innerHeight,1,3e3),this.camera.position.set(0,200,350),this.camera.lookAt(0,0,0),this.scene=new this.$THREE.Scene;var e=new this.$THREE.DirectionalLight(16777215,1);e.position.set(300,400,175),this.scene.add(e);var r=new this.$THREE.DirectionalLight(4235328,.6);r.position.set(-100,350,-200),this.scene.add(r),this.renderer=new this.$THREE.WebGLRenderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.$webglInnerWidth,window.innerHeight),this.container.appendChild(this.renderer.domElement),this.stats=new this.$Stats,this.stats.dom.style.left="280px",this.container.appendChild(this.stats.dom),this.container.style.touchAction="none",this.container.addEventListener("pointermove",this.onPointerMove,!1),document.addEventListener("keydown",function(e){87===e.keyCode&&(t.waterMesh.material.wireframe=!t.waterMesh.material.wireframe,t.waterMesh.material.needsUpdate=!0)},!1),window.addEventListener("resize",this.onWindowResize,!1),this.gui=new i.a;var a={mouseSize:20,viscosity:.98,spheresEnabled:this.spheresEnabled},n=function(){t.heightmapVariable.material.uniforms.mouseSize.value=a.mouseSize,t.heightmapVariable.material.uniforms.viscosityConstant.value=a.viscosity,t.spheresEnabled=a.spheresEnabled;for(var e=0;e<t.NUM_SPHERES;e++)t.spheres[e]&&(t.spheres[e].visible=t.spheresEnabled)};this.gui.add(a,"mouseSize",1,100,1).onChange(n),this.gui.add(a,"viscosity",.9,.999,.001).onChange(n),this.gui.add(a,"spheresEnabled",0,1,1).onChange(n);var s={smoothWater:function(){t.smoothWater()}};this.gui.add(s,"smoothWater"),this.initWater(),this.createSpheres(),n()},initWater:function(){var t=new this.$THREE.PlaneBufferGeometry(this.BOUNDS,this.BOUNDS,this.WIDTH-1,this.WIDTH-1),e=new this.$THREE.ShaderMaterial({uniforms:this.$THREE.UniformsUtils.merge([this.$THREE.ShaderLib.phong.uniforms,{heightmap:{value:null}}]),vertexShader:this.waterVertexShader,fragmentShader:this.$THREE.ShaderChunk.meshphong_frag});e.lights=!0,e.color=new this.$THREE.Color(16576),e.specular=new this.$THREE.Color(1118481),e.shininess=50,e.uniforms.diffuse.value=e.color,e.uniforms.specular.value=e.specular,e.uniforms.shininess.value=Math.max(e.shininess,1e-4),e.uniforms.opacity.value=e.opacity,e.defines.WIDTH=this.WIDTH.toFixed(1),e.defines.BOUNDS=this.BOUNDS.toFixed(1),this.waterUniforms=e.uniforms,this.waterMesh=new this.$THREE.Mesh(t,e),this.waterMesh.rotation.x=-Math.PI/2,this.waterMesh.matrixAutoUpdate=!1,this.waterMesh.updateMatrix(),this.scene.add(this.waterMesh);var r=new this.$THREE.PlaneBufferGeometry(this.BOUNDS,this.BOUNDS,1,1);this.meshRay=new this.$THREE.Mesh(r,new this.$THREE.MeshBasicMaterial({color:16777215,visible:!1})),this.meshRay.rotation.x=-Math.PI/2,this.meshRay.matrixAutoUpdate=!1,this.meshRay.updateMatrix(),this.scene.add(this.meshRay),this.gpuCompute=new a.a(this.WIDTH,this.WIDTH,this.renderer),this.isSafari()&&this.gpuCompute.setDataType(this.$THREE.HalfFloatType);var i=this.gpuCompute.createTexture();this.fillTexture(i),this.heightmapVariable=this.gpuCompute.addVariable("heightmap",this.heightmapFragmentShader,i),this.gpuCompute.setVariableDependencies(this.heightmapVariable,[this.heightmapVariable]),this.heightmapVariable.material.uniforms.mousePos={value:new this.$THREE.Vector2(1e4,1e4)},this.heightmapVariable.material.uniforms.mouseSize={value:20},this.heightmapVariable.material.uniforms.viscosityConstant={value:.98},this.heightmapVariable.material.uniforms.heightCompensation={value:0},this.heightmapVariable.material.defines.BOUNDS=this.BOUNDS.toFixed(1);var n=this.gpuCompute.init();null!==n&&console.error(n),this.smoothShader=this.gpuCompute.createShaderMaterial(this.smoothFragmentShader,{smoothTexture:{value:null}}),this.readWaterLevelShader=this.gpuCompute.createShaderMaterial(this.readWaterLevelFragmentShader,{point1:{value:new this.$THREE.Vector2},levelTexture:{value:null}}),this.readWaterLevelShader.defines.WIDTH=this.WIDTH.toFixed(1),this.readWaterLevelShader.defines.BOUNDS=this.BOUNDS.toFixed(1),this.readWaterLevelImage=new Uint8Array(16),this.readWaterLevelRenderTarget=new this.$THREE.WebGLRenderTarget(4,1,{wrapS:this.$THREE.ClampToEdgeWrapping,wrapT:this.$THREE.ClampToEdgeWrapping,minFilter:this.$THREE.NearestFilter,magFilter:this.$THREE.NearestFilter,format:this.$THREE.RGBAFormat,type:this.$THREE.UnsignedByteType,depthBuffer:!1})},isSafari:function(){return!!navigator.userAgent.match(/Safari/i)&&!navigator.userAgent.match(/Chrome/i)},fillTexture:function(t){var e=10,r=this;function i(t,i){for(var a=e,n=.025,s=0,o=0;o<15;o++)s+=a*r.simplex.noise(t*n,i*n),a*=.53+.025*o,n*=1.25;return s}for(var a=t.image.data,n=0,s=0;s<this.WIDTH;s++)for(var o=0;o<this.WIDTH;o++){var h=128*o/this.WIDTH,l=128*s/this.WIDTH;a[n+0]=i(h,l),a[n+1]=a[n+0],a[n+2]=0,a[n+3]=1,n+=4}},smoothWater:function(){for(var t=this.gpuCompute.getCurrentRenderTarget(this.heightmapVariable),e=this.gpuCompute.getAlternateRenderTarget(this.heightmapVariable),r=0;r<10;r++)this.smoothShader.uniforms.smoothTexture.value=t.texture,this.gpuCompute.doRenderTarget(this.smoothShader,e),this.smoothShader.uniforms.smoothTexture.value=e.texture,this.gpuCompute.doRenderTarget(this.smoothShader,t)},createSpheres:function(){for(var t=new this.$THREE.Mesh(new this.$THREE.SphereBufferGeometry(4,24,12),new this.$THREE.MeshPhongMaterial({color:16776960})),e=0;e<this.NUM_SPHERES;e++){var r=t;e<this.NUM_SPHERES-1&&(r=t.clone()),r.position.x=(Math.random()-.5)*this.BOUNDS*.7,r.position.z=(Math.random()-.5)*this.BOUNDS*.7,r.userData.velocity=new this.$THREE.Vector3,this.scene.add(r),this.spheres[e]=r}},sphereDynamics:function(){var t=this.gpuCompute.getCurrentRenderTarget(this.heightmapVariable);this.readWaterLevelShader.uniforms.levelTexture.value=t.texture;for(var e=0;e<this.NUM_SPHERES;e++){var r=this.spheres[e];if(r){var i=.5*r.position.x/this.BOUNDS_HALF+.5,a=1-(.5*r.position.z/this.BOUNDS_HALF+.5);this.readWaterLevelShader.uniforms.point1.value.set(i,a),this.gpuCompute.doRenderTarget(this.readWaterLevelShader,this.readWaterLevelRenderTarget),this.renderer.readRenderTargetPixels(this.readWaterLevelRenderTarget,0,0,4,1,this.readWaterLevelImage);var n=new Float32Array(this.readWaterLevelImage.buffer);this.waterNormal.set(n[1],0,-n[2]);var s=r.position;s.y=n[0],this.waterNormal.multiplyScalar(.1),r.userData.velocity.add(this.waterNormal),r.userData.velocity.multiplyScalar(.998),s.add(r.userData.velocity),s.x<-this.BOUNDS_HALF?(s.x=.001-this.BOUNDS_HALF,r.userData.velocity.x*=-.3):s.x>this.BOUNDS_HALF&&(s.x=this.BOUNDS_HALF-.001,r.userData.velocity.x*=-.3),s.z<-this.BOUNDS_HALF?(s.z=.001-this.BOUNDS_HALF,r.userData.velocity.z*=-.3):s.z>this.BOUNDS_HALF&&(s.z=this.BOUNDS_HALF-.001,r.userData.velocity.z*=-.3)}}},onWindowResize:function(){this.$onWindowResize(this.camera,this.renderer)},setMouseCoords:function(t,e){this.mouseCoords.set(t/this.renderer.domElement.clientWidth*2-1,-e/this.renderer.domElement.clientHeight*2+1),this.mouseMoved=!0},onPointerMove:function(t){!1!==t.isPrimary&&this.setMouseCoords(t.clientX,t.clientY)},animate:function(){requestAnimationFrame(this.animate),this.render(),this.stats.update()},render:function(){var t=this.heightmapVariable.material.uniforms;if(this.mouseMoved){this.raycaster.setFromCamera(this.mouseCoords,this.camera);var e=this.raycaster.intersectObject(this.meshRay);if(e.length>0){var r=e[0].point;t.mousePos.value.set(r.x,r.z)}else t.mousePos.value.set(1e4,1e4);this.mouseMoved=!1}else t.mousePos.value.set(1e4,1e4);this.gpuCompute.compute(),this.spheresEnabled&&this.sphereDynamics(),this.waterUniforms.heightmap.value=this.gpuCompute.getCurrentRenderTarget(this.heightmapVariable).texture,this.renderer.render(this.scene,this.camera)}}},o={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"webglGpgpuWater-container"},[e("div",{attrs:{id:"info"}},[e("a",{attrs:{href:"https://threejs.org",target:"_blank",rel:"noopener"}},[this._v("three.js")]),this._v(" - "),e("span",{attrs:{id:"waterSize"}}),this._v(" webgl gpgpu water"),e("br"),this._v("\n\t\t\tMove mouse to disturb water."),e("br"),this._v("\n\t\t\tPress mouse button to orbit around. 'W' key toggles wireframe.\n\t\t")])])}]};var h=r("VU/8")(s,o,!1,function(t){r("e/Dr")},"data-v-11257774",null);e.default=h.exports},"e/Dr":function(t,e){}});
//# sourceMappingURL=7.a3009de1d3cfa4ee786a.js.map