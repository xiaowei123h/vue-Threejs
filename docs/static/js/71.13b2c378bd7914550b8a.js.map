{"version":3,"sources":["webpack:///./src/components/jsm/loaders/BVHLoader.js","webpack:///src/views/loader/webglLoaderBvh.vue","webpack:///./src/views/loader/webglLoaderBvh.vue?7821","webpack:///./src/views/loader/webglLoaderBvh.vue"],"names":["BVHLoader","manager","Loader","call","this","animateBonePositions","animateBoneRotations","prototype","Object","assign","create","constructor","load","url","onLoad","onProgress","onError","scope","loader","FileLoader","setPath","path","setRequestHeader","requestHeader","setWithCredentials","withCredentials","text","parse","e","console","error","itemError","readFrameData","data","frameTime","bone","type","keyframe","time","position","Vector3","rotation","Quaternion","frames","push","quat","vx","vy","vz","i","channels","length","x","parseFloat","shift","trim","y","z","setFromAxisAngle","Math","PI","multiply","warn","children","nextLine","lines","line","bones","list","root","readNode","firstline","node","name","tokens","split","toUpperCase","offset","isNaN","numChannels","parseInt","splice","numFrames","readBvh","threeBones","toTHREEBone","source","Bone","add","threeClip","tracks","times","positions","rotations","j","frame","w","VectorKeyframeTrack","QuaternionKeyframeTrack","AnimationClip","toTHREEAnimation","skeleton","Skeleton","clip","webglLoaderBvh","clock","camera","controls","scene","renderer","mixer","skeletonHelper","mounted","_this","$THREE","Clock","init","animate","BVHLoader_BVHLoader","result","SkeletonHelper","boneContainer","Group","AnimationMixer","clipAction","setEffectiveWeight","play","methods","PerspectiveCamera","$webglInnerWidth","window","innerHeight","set","Scene","background","Color","GridHelper","WebGLRenderer","antialias","setPixelRatio","devicePixelRatio","setSize","document","getElementsByClassName","appendChild","domElement","OrbitControls","minDistance","maxDistance","addEventListener","onWindowResize","$onWindowResize","requestAnimationFrame","delta","getDelta","update","render","loader_webglLoaderBvh","$createElement","_self","_c","_m","staticRenderFns","_h","staticClass","attrs","id","href","target","rel","_v","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/71.13b2c378bd7914550b8a.js","sourcesContent":["import {\r\n\tAnimationClip,\r\n\tBone,\r\n\tFileLoader,\r\n\tLoader,\r\n\tQuaternion,\r\n\tQuaternionKeyframeTrack,\r\n\tSkeleton,\r\n\tVector3,\r\n\tVectorKeyframeTrack\r\n} from \"@/components/build/three.module.js\";\r\n\r\n/**\r\n * Description: reads BVH files and outputs a single Skeleton and an AnimationClip\r\n *\r\n * Currently only supports bvh files containing a single root.\r\n *\r\n */\r\n\r\nvar BVHLoader = function ( manager ) {\r\n\r\n\tLoader.call( this, manager );\r\n\r\n\tthis.animateBonePositions = true;\r\n\tthis.animateBoneRotations = true;\r\n\r\n};\r\n\r\nBVHLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\tconstructor: BVHLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar loader = new FileLoader( scope.manager );\r\n\t\tloader.setPath( scope.path );\r\n\t\tloader.setRequestHeader( scope.requestHeader );\r\n\t\tloader.setWithCredentials( scope.withCredentials );\r\n\t\tloader.load( url, function ( text ) {\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\tonLoad( scope.parse( text ) );\r\n\r\n\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\tif ( onError ) {\r\n\r\n\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.manager.itemError( url );\r\n\r\n\t\t\t}\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tparse: function ( text ) {\r\n\r\n\t\t/*\r\n\t\t\treads a string array (lines) from a BVH file\r\n\t\t\tand outputs a skeleton structure including motion data\r\n\r\n\t\t\treturns thee root node:\r\n\t\t\t{ name: '', channels: [], children: [] }\r\n\t\t*/\r\n\t\tfunction readBvh( lines ) {\r\n\r\n\t\t\t// read model structure\r\n\r\n\t\t\tif ( nextLine( lines ) !== 'HIERARCHY' ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.BVHLoader: HIERARCHY expected.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar list = []; // collects flat array of all bones\r\n\t\t\tvar root = readNode( lines, nextLine( lines ), list );\r\n\r\n\t\t\t// read motion data\r\n\r\n\t\t\tif ( nextLine( lines ) !== 'MOTION' ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.BVHLoader: MOTION expected.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// number of frames\r\n\r\n\t\t\tvar tokens = nextLine( lines ).split( /[\\s]+/ );\r\n\t\t\tvar numFrames = parseInt( tokens[ 1 ] );\r\n\r\n\t\t\tif ( isNaN( numFrames ) ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.BVHLoader: Failed to read number of frames.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// frame time\r\n\r\n\t\t\ttokens = nextLine( lines ).split( /[\\s]+/ );\r\n\t\t\tvar frameTime = parseFloat( tokens[ 2 ] );\r\n\r\n\t\t\tif ( isNaN( frameTime ) ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.BVHLoader: Failed to read frame time.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// read frame data line by line\r\n\r\n\t\t\tfor ( var i = 0; i < numFrames; i ++ ) {\r\n\r\n\t\t\t\ttokens = nextLine( lines ).split( /[\\s]+/ );\r\n\t\t\t\treadFrameData( tokens, i * frameTime, root );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn list;\r\n\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\t\tRecursively reads data from a single frame into the bone hierarchy.\r\n\t\t\tThe passed bone hierarchy has to be structured in the same order as the BVH file.\r\n\t\t\tkeyframe data is stored in bone.frames.\r\n\r\n\t\t\t- data: splitted string array (frame values), values are shift()ed so\r\n\t\t\tthis should be empty after parsing the whole hierarchy.\r\n\t\t\t- frameTime: playback time for this keyframe.\r\n\t\t\t- bone: the bone to read frame data from.\r\n\t\t*/\r\n\t\tfunction readFrameData( data, frameTime, bone ) {\r\n\r\n\t\t\t// end sites have no motion data\r\n\r\n\t\t\tif ( bone.type === 'ENDSITE' ) return;\r\n\r\n\t\t\t// add keyframe\r\n\r\n\t\t\tvar keyframe = {\r\n\t\t\t\ttime: frameTime,\r\n\t\t\t\tposition: new Vector3(),\r\n\t\t\t\trotation: new Quaternion()\r\n\t\t\t};\r\n\r\n\t\t\tbone.frames.push( keyframe );\r\n\r\n\t\t\tvar quat = new Quaternion();\r\n\r\n\t\t\tvar vx = new Vector3( 1, 0, 0 );\r\n\t\t\tvar vy = new Vector3( 0, 1, 0 );\r\n\t\t\tvar vz = new Vector3( 0, 0, 1 );\r\n\r\n\t\t\t// parse values for each channel in node\r\n\r\n\t\t\tfor ( var i = 0; i < bone.channels.length; i ++ ) {\r\n\r\n\t\t\t\tswitch ( bone.channels[ i ] ) {\r\n\r\n\t\t\t\t\tcase 'Xposition':\r\n\t\t\t\t\t\tkeyframe.position.x = parseFloat( data.shift().trim() );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Yposition':\r\n\t\t\t\t\t\tkeyframe.position.y = parseFloat( data.shift().trim() );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Zposition':\r\n\t\t\t\t\t\tkeyframe.position.z = parseFloat( data.shift().trim() );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Xrotation':\r\n\t\t\t\t\t\tquat.setFromAxisAngle( vx, parseFloat( data.shift().trim() ) * Math.PI / 180 );\r\n\t\t\t\t\t\tkeyframe.rotation.multiply( quat );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Yrotation':\r\n\t\t\t\t\t\tquat.setFromAxisAngle( vy, parseFloat( data.shift().trim() ) * Math.PI / 180 );\r\n\t\t\t\t\t\tkeyframe.rotation.multiply( quat );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Zrotation':\r\n\t\t\t\t\t\tquat.setFromAxisAngle( vz, parseFloat( data.shift().trim() ) * Math.PI / 180 );\r\n\t\t\t\t\t\tkeyframe.rotation.multiply( quat );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.warn( 'THREE.BVHLoader: Invalid channel type.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// parse child nodes\r\n\r\n\t\t\tfor ( var i = 0; i < bone.children.length; i ++ ) {\r\n\r\n\t\t\t\treadFrameData( data, frameTime, bone.children[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\t Recursively parses the HIERACHY section of the BVH file\r\n\r\n\t\t - lines: all lines of the file. lines are consumed as we go along.\r\n\t\t - firstline: line containing the node type and name e.g. 'JOINT hip'\r\n\t\t - list: collects a flat list of nodes\r\n\r\n\t\t returns: a BVH node including children\r\n\t\t*/\r\n\t\tfunction readNode( lines, firstline, list ) {\r\n\r\n\t\t\tvar node = { name: '', type: '', frames: [] };\r\n\t\t\tlist.push( node );\r\n\r\n\t\t\t// parse node type and name\r\n\r\n\t\t\tvar tokens = firstline.split( /[\\s]+/ );\r\n\r\n\t\t\tif ( tokens[ 0 ].toUpperCase() === 'END' && tokens[ 1 ].toUpperCase() === 'SITE' ) {\r\n\r\n\t\t\t\tnode.type = 'ENDSITE';\r\n\t\t\t\tnode.name = 'ENDSITE'; // bvh end sites have no name\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tnode.name = tokens[ 1 ];\r\n\t\t\t\tnode.type = tokens[ 0 ].toUpperCase();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nextLine( lines ) !== '{' ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.BVHLoader: Expected opening { after type & name' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// parse OFFSET\r\n\r\n\t\t\ttokens = nextLine( lines ).split( /[\\s]+/ );\r\n\r\n\t\t\tif ( tokens[ 0 ] !== 'OFFSET' ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.BVHLoader: Expected OFFSET but got: ' + tokens[ 0 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( tokens.length !== 4 ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.BVHLoader: Invalid number of values for OFFSET.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar offset = new Vector3(\r\n\t\t\t\tparseFloat( tokens[ 1 ] ),\r\n\t\t\t\tparseFloat( tokens[ 2 ] ),\r\n\t\t\t\tparseFloat( tokens[ 3 ] )\r\n\t\t\t);\r\n\r\n\t\t\tif ( isNaN( offset.x ) || isNaN( offset.y ) || isNaN( offset.z ) ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.BVHLoader: Invalid values of OFFSET.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tnode.offset = offset;\r\n\r\n\t\t\t// parse CHANNELS definitions\r\n\r\n\t\t\tif ( node.type !== 'ENDSITE' ) {\r\n\r\n\t\t\t\ttokens = nextLine( lines ).split( /[\\s]+/ );\r\n\r\n\t\t\t\tif ( tokens[ 0 ] !== 'CHANNELS' ) {\r\n\r\n\t\t\t\t\tconsole.error( 'THREE.BVHLoader: Expected CHANNELS definition.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar numChannels = parseInt( tokens[ 1 ] );\r\n\t\t\t\tnode.channels = tokens.splice( 2, numChannels );\r\n\t\t\t\tnode.children = [];\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// read children\r\n\r\n\t\t\twhile ( true ) {\r\n\r\n\t\t\t\tvar line = nextLine( lines );\r\n\r\n\t\t\t\tif ( line === '}' ) {\r\n\r\n\t\t\t\t\treturn node;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tnode.children.push( readNode( lines, line, list ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\t\trecursively converts the internal bvh node structure to a Bone hierarchy\r\n\r\n\t\t\tsource: the bvh root node\r\n\t\t\tlist: pass an empty array, collects a flat list of all converted THREE.Bones\r\n\r\n\t\t\treturns the root Bone\r\n\t\t*/\r\n\t\tfunction toTHREEBone( source, list ) {\r\n\r\n\t\t\tvar bone = new Bone();\r\n\t\t\tlist.push( bone );\r\n\r\n\t\t\tbone.position.add( source.offset );\r\n\t\t\tbone.name = source.name;\r\n\r\n\t\t\tif ( source.type !== 'ENDSITE' ) {\r\n\r\n\t\t\t\tfor ( var i = 0; i < source.children.length; i ++ ) {\r\n\r\n\t\t\t\t\tbone.add( toTHREEBone( source.children[ i ], list ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn bone;\r\n\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\t\tbuilds a AnimationClip from the keyframe data saved in each bone.\r\n\r\n\t\t\tbone: bvh root node\r\n\r\n\t\t\treturns: a AnimationClip containing position and quaternion tracks\r\n\t\t*/\r\n\t\tfunction toTHREEAnimation( bones ) {\r\n\r\n\t\t\tvar tracks = [];\r\n\r\n\t\t\t// create a position and quaternion animation track for each node\r\n\r\n\t\t\tfor ( var i = 0; i < bones.length; i ++ ) {\r\n\r\n\t\t\t\tvar bone = bones[ i ];\r\n\r\n\t\t\t\tif ( bone.type === 'ENDSITE' )\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t// track data\r\n\r\n\t\t\t\tvar times = [];\r\n\t\t\t\tvar positions = [];\r\n\t\t\t\tvar rotations = [];\r\n\r\n\t\t\t\tfor ( var j = 0; j < bone.frames.length; j ++ ) {\r\n\r\n\t\t\t\t\tvar frame = bone.frames[ j ];\r\n\r\n\t\t\t\t\ttimes.push( frame.time );\r\n\r\n\t\t\t\t\t// the animation system animates the position property,\r\n\t\t\t\t\t// so we have to add the joint offset to all values\r\n\r\n\t\t\t\t\tpositions.push( frame.position.x + bone.offset.x );\r\n\t\t\t\t\tpositions.push( frame.position.y + bone.offset.y );\r\n\t\t\t\t\tpositions.push( frame.position.z + bone.offset.z );\r\n\r\n\t\t\t\t\trotations.push( frame.rotation.x );\r\n\t\t\t\t\trotations.push( frame.rotation.y );\r\n\t\t\t\t\trotations.push( frame.rotation.z );\r\n\t\t\t\t\trotations.push( frame.rotation.w );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( scope.animateBonePositions ) {\r\n\r\n\t\t\t\t\ttracks.push( new VectorKeyframeTrack( '.bones[' + bone.name + '].position', times, positions ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( scope.animateBoneRotations ) {\r\n\r\n\t\t\t\t\ttracks.push( new QuaternionKeyframeTrack( '.bones[' + bone.name + '].quaternion', times, rotations ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn new AnimationClip( 'animation', - 1, tracks );\r\n\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\t\treturns the next non-empty line in lines\r\n\t\t*/\r\n\t\tfunction nextLine( lines ) {\r\n\r\n\t\t\tvar line;\r\n\t\t\t// skip empty lines\r\n\t\t\twhile ( ( line = lines.shift().trim() ).length === 0 ) { }\r\n\r\n\t\t\treturn line;\r\n\r\n\t\t}\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar lines = text.split( /[\\r\\n]+/g );\r\n\r\n\t\tvar bones = readBvh( lines );\r\n\r\n\t\tvar threeBones = [];\r\n\t\ttoTHREEBone( bones[ 0 ], threeBones );\r\n\r\n\t\tvar threeClip = toTHREEAnimation( bones );\r\n\r\n\t\treturn {\r\n\t\t\tskeleton: new Skeleton( threeBones ),\r\n\t\t\tclip: threeClip\r\n\t\t};\r\n\r\n\t}\r\n\r\n} );\r\n\r\nexport { BVHLoader };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/jsm/loaders/BVHLoader.js","<template>\r\n    <div class=\"webglLoaderBvh-container\">\r\n        <div id=\"info\">\r\n\t\t\t<a href=\"https://threejs.org\" target=\"_blank\" rel=\"noopener\">three.js</a> - BVH Loader<br/>\r\n\t\t\tanimation from <a href=\"http://mocap.cs.cmu.edu/\">http://mocap.cs.cmu.edu/</a>\r\n\t\t</div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { OrbitControls } from '@/components/jsm/controls/OrbitControls.js';\r\nimport { BVHLoader } from '@/components/jsm/loaders/BVHLoader.js'\r\nexport default {\r\n    data() {\r\n        return {\r\n            clock: null,\r\n            camera: null,\r\n            controls: null,\r\n            scene: null,\r\n            renderer: null,\r\n            mixer: null,\r\n            skeletonHelper: null,\r\n            loader: null,\r\n        }\r\n    },\r\n    mounted() {\r\n        this.clock = new this.$THREE.Clock()\r\n        this.init()\r\n        this.animate()\r\n        this.loader = new BVHLoader()\r\n        this.loader.load(\"static/models/bvh/pirouette.bvh\", (result) => {\r\n            this.skeletonHelper = new this.$THREE.SkeletonHelper(result.skeleton.bones[ 0 ])\r\n            this.skeletonHelper.skeleton = result.skeleton // allow animation mixer to bind to this.$THREE.SkeletonHelper directly\r\n            var boneContainer = new this.$THREE.Group()\r\n            boneContainer.add(result.skeleton.bones[ 0 ])\r\n            this.scene.add(this.skeletonHelper)\r\n            this.scene.add(boneContainer)\r\n            // play animation\r\n            this.mixer = new this.$THREE.AnimationMixer(this.skeletonHelper)\r\n            this.mixer.clipAction(result.clip).setEffectiveWeight(1.0).play()\r\n        })\r\n    },\r\n    methods: {\r\n        init() {\r\n            this.camera = new this.$THREE.PerspectiveCamera(60, this.$webglInnerWidth / window.innerHeight, 1, 1000)\r\n            this.camera.position.set(0, 200, 300)\r\n            this.scene = new this.$THREE.Scene()\r\n            this.scene.background = new this.$THREE.Color(0xeeeeee)\r\n            this.scene.add(new this.$THREE.GridHelper(400, 10))\r\n            // renderer\r\n            this.renderer = new this.$THREE.WebGLRenderer({ antialias: true })\r\n            this.renderer.setPixelRatio(window.devicePixelRatio)\r\n            this.renderer.setSize(this.$webglInnerWidth, window.innerHeight)\r\n            document.getElementsByClassName('webglLoaderBvh-container')[0].appendChild(this.renderer.domElement)\r\n            this.controls = new OrbitControls(this.camera, this.renderer.domElement)\r\n            this.controls.minDistance = 300\r\n            this.controls.maxDistance = 700\r\n            window.addEventListener('resize', this.onWindowResize, false)\r\n        },\r\n        onWindowResize() {\r\n            this.$onWindowResize(this.camera, this.renderer)\r\n        },\r\n        animate() {\r\n            requestAnimationFrame(this.animate)\r\n            var delta = this.clock.getDelta()\r\n            if (this.mixer) this.mixer.update(delta)\r\n            this.renderer.render(this.scene, this.camera)\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.webglLoaderBvh-container {\r\n    width: 100%;\r\n    background-color: #eee;\r\n}\r\n#info {\t\t\r\n    color: #444;\r\n}\r\n#info a {\r\n    color: #08f;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/views/loader/webglLoaderBvh.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"webglLoaderBvh-container\"},[_c('div',{attrs:{\"id\":\"info\"}},[_c('a',{attrs:{\"href\":\"https://threejs.org\",\"target\":\"_blank\",\"rel\":\"noopener\"}},[_vm._v(\"three.js\")]),_vm._v(\" - BVH Loader\"),_c('br'),_vm._v(\"\\n\\t\\t\\tanimation from \"),_c('a',{attrs:{\"href\":\"http://mocap.cs.cmu.edu/\"}},[_vm._v(\"http://mocap.cs.cmu.edu/\")])])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-b5c68e26\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/loader/webglLoaderBvh.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-b5c68e26\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./webglLoaderBvh.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglLoaderBvh.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./webglLoaderBvh.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-b5c68e26\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./webglLoaderBvh.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-b5c68e26\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/loader/webglLoaderBvh.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}